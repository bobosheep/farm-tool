!function(){function t(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t=function(){return e};var e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof d?e:d,s=Object.create(o.prototype),a=new S(r||[]);return i(s,"_invoke",{value:T(t,n,a)}),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}e.wrap=h;var f={};function d(){}function p(){}function g(){}var y={};c(y,s,function(){return this});var v=Object.getPrototypeOf,m=v&&v(v(x([])));m&&m!==n&&r.call(m,s)&&(y=m);var b=g.prototype=d.prototype=Object.create(y);function w(t){["next","throw","return"].forEach(function(e){c(t,e,function(t){return this._invoke(e,t)})})}function I(t,e){function n(i,o,s,a){var u=l(t[i],t,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then(function(t){n("next",t,s,a)},function(t){n("throw",t,s,a)}):e.resolve(h).then(function(t){c.value=t,s(c)},function(t){return n("throw",t,s,a)})}a(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e(function(e,i){n(t,r,e,i)})}return o=o?o.then(i,i):i()}})}function T(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return k()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=O(s,n);if(a){if(a===f)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function O(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,O(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,f;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function x(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,i(b,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:p,configurable:!0}),p.displayName=c(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},w(I.prototype),c(I.prototype,a,function(){return this}),e.AsyncIterator=I,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new I(h(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then(function(t){return t.done?t.value:s.next()})},w(b),c(b,u,"Generator"),c(b,s,function(){return this}),c(b,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=x,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;_(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:x(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function e(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=a(t);if(e){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s(this,n)}}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,s,a=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(h){c=!0,i=h}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function f(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"7UCR":function(i,s,a){"use strict";a.r(s),a.d(s,"UserModule",function(){return Rg});var c,h=a("ofXK"),l=a("tyNb"),d=a("fXoL"),g=a("LRne"),y=a("mCNh"),v=a("lJxs"),m=a("IzEk"),b=a("eIep"),w=a("XNiG"),I=a("HDdC"),T=a("Cfvw"),O=a("VRyK"),E=a("pxpQ"),_=a("UXun"),S=a("SxV6"),x=a("aGrj"),k=a("tf+s"),C=a("pLZG"),j=a("spgP"),A=new d.r("angularfire2.auth.use-emulator"),D=new d.r("angularfire2.auth.settings"),N=new d.r("angularfire2.auth.tenant-id"),R=new d.r("angularfire2.auth.langugage-code"),P=new d.r("angularfire2.auth.use-device-language"),L=new d.r("angularfire.auth.persistence"),F=((c=f(function t(e,n,r,i,o,s,c,l,f,d){p(this,t);var y=new j.d(i),m=Object(j.h)(y),A=new w.a,D=Object(g.a)(void 0).pipe(Object(E.b)(y.outsideAngular),Object(b.a)(function(){return i.runOutsideAngular(function(){return a.e(20).then(a.bind(null,"6nsN"))})}),Object(v.a)(function(){return Object(j.g)(e,i,n)}),Object(v.a)(function(t){return i.runOutsideAngular(function(){var e=o,n=s;return Object(j.f)("".concat(t.name,".auth"),"AngularFireAuth",t,function(){var r=i.runOutsideAngular(function(){return t.auth()});if(e&&r.useEmulator("http://".concat(e.join(":"))),c&&(r.tenantId=c),r.languageCode=l,f&&r.useDeviceLanguage(),n)for(var o=0,s=Object.entries(n);o<s.length;o++){var a=u(s[o],2),h=a[0],p=a[1];r.settings[h]=p}return d&&r.setPersistence(d),r},[e,c,l,f,n,d])})}),Object(_.a)({bufferSize:1,refCount:!1}));if(Object(h.s)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(g.a)(null);else{D.pipe(Object(S.a)()).subscribe();var N=D.pipe(Object(b.a)(function(t){return t.getRedirectResult().then(function(t){return t},function(){return null})}),m,Object(_.a)({bufferSize:1,refCount:!1})),R=function(t){return new I.a(function(e){return{unsubscribe:i.runOutsideAngular(function(){return t(e)})}})},P=D.pipe(Object(b.a)(function(t){return R(t.onAuthStateChanged.bind(t))})),L=D.pipe(Object(b.a)(function(t){return R(t.onIdTokenChanged.bind(t))}));this.authState=N.pipe(Object(x.a)(P),Object(k.a)(y.outsideAngular),Object(E.b)(y.insideAngular)),this.user=N.pipe(Object(x.a)(L),Object(k.a)(y.outsideAngular),Object(E.b)(y.insideAngular)),this.idToken=this.user.pipe(Object(b.a)(function(t){return t?Object(T.a)(t.getIdToken()):Object(g.a)(null)})),this.idTokenResult=this.user.pipe(Object(b.a)(function(t){return t?Object(T.a)(t.getIdTokenResult()):Object(g.a)(null)})),this.credential=Object(O.a)(N,A,this.authState.pipe(Object(C.a)(function(t){return!t}))).pipe(Object(v.a)(function(t){return(null==t?void 0:t.user)?t:null}),Object(k.a)(y.outsideAngular),Object(E.b)(y.insideAngular))}return Object(j.i)(this,D,i,{spy:{apply:function(t,e,n){(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then(function(t){return A.next(t)})}}})})).\u0275fac=function(t){return new(t||c)(d.Vb(j.c),d.Vb(j.b,8),d.Vb(d.C),d.Vb(d.A),d.Vb(A,8),d.Vb(D,8),d.Vb(N,8),d.Vb(R,8),d.Vb(P,8),d.Vb(L,8))},c.\u0275prov=d.Hb({factory:function(){return new c(d.Vb(j.c),d.Vb(j.b,8),d.Vb(d.C),d.Vb(d.A),d.Vb(A,8),d.Vb(D,8),d.Vb(N,8),d.Vb(R,8),d.Vb(P,8),d.Vb(L,8))},token:c,providedIn:"any"}),c);Object(j.e)(F,[{app:null,applyActionCode:null,checkActionCode:null,confirmPasswordReset:null,createUserWithEmailAndPassword:null,currentUser:null,fetchSignInMethodsForEmail:null,isSignInWithEmailLink:null,getRedirectResult:null,languageCode:null,settings:null,onAuthStateChanged:null,onIdTokenChanged:null,sendSignInLinkToEmail:null,sendPasswordResetEmail:null,setPersistence:null,signInAndRetrieveDataWithCredential:null,signInAnonymously:null,signInWithCredential:null,signInWithCustomToken:null,signInWithEmailAndPassword:null,signInWithPhoneNumber:null,signInWithEmailLink:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,tenantId:null,updateCurrentUser:null,useDeviceLanguage:null,useEmulator:null,verifyPasswordResetCode:null}]);var M,V=Object(v.a)(function(t){return!!t}),U=((M=f(function t(e,n){var r=this;p(this,t),this.router=e,this.auth=n,this.canActivate=function(t,e){var n=t.data.authGuardPipe||function(){return V};return r.auth.user.pipe(Object(m.a)(1),n(t,e),Object(v.a)(function(t){return"boolean"==typeof t?t:Array.isArray(t)?r.router.createUrlTree(t):r.router.parseUrl(t)}))}})).\u0275fac=function(t){return new(t||M)(d.Vb(l.c),d.Vb(F))},M.\u0275prov=d.Hb({factory:function(){return new M(d.Vb(l.c),d.Vb(F))},token:M,providedIn:"any"}),M);Object(v.a)(function(t){return!!t&&!t.isAnonymous});var q=Object(b.a)(function(t){return t?t.getIdTokenResult():Object(g.a)(null)});Object(v.a)(function(t){return!!t&&t.emailVerified}),Object(y.a)(q,Object(v.a)(function(t){return t?t.claims:[]}));var B=a("Jgta"),Q=function(t){return t[t.Admin=0]="Admin",t[t.Editor=1]="Editor",t[t.ClubAdmin=2]="ClubAdmin",t[t.User=100]="User",t}({}),K=a("D0XW"),G=a("JX91"),z=a("7o/Q");function H(){return function(t){return t.lift(new W)}}var W=function(){function t(){p(this,t)}return f(t,[{key:"call",value:function(t,e){return e.subscribe(new Y(t))}}]),t}(),Y=function(t){r(n,t);var e=o(n);function n(t){var r;return p(this,n),(r=e.call(this,t)).hasPrev=!1,r}return f(n,[{key:"_next",value:function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}]),n}(z.a),X=a("Kqap"),$=function(){function t(e,n){p(this,t),this.compare=e,this.keySelector=n}return f(t,[{key:"call",value:function(t,e){return e.subscribe(new J(t,this.compare,this.keySelector))}}]),t}(),J=function(t){r(n,t);var e=o(n);function n(t,r,i){var o;return p(this,n),(o=e.call(this,t)).keySelector=i,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return f(n,[{key:"compare",value:function(t,e){return t===e}},{key:"_next",value:function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(i){return this.destination.error(i)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(i){return this.destination.error(i)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))}}]),n}(z.a),Z=a("zIRd"),tt=a("mrSG"),et=a("qOnz"),nt=a("q/0M"),rt=function(t,e){return(rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function it(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var ot,st="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},at=at||{},ut=st||self;function ct(){}function ht(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function lt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ft="closure_uid_"+(1e9*Math.random()>>>0),dt=0;function pt(t,e,n){return t.call.apply(t.bind,arguments)}function gt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function yt(t,e,n){return(yt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?pt:gt).apply(null,arguments)}function vt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function mt(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function bt(){this.s=this.s,this.o=this.o}var wt={};bt.prototype.s=!1,bt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,ft)&&t[ft]||(t[ft]=++dt)}(this);delete wt[t]}},bt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var It=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Tt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Ot(t){return Array.prototype.concat.apply([],arguments)}function Et(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function _t(t){return/^[\s\xa0]*$/.test(t)}var St,xt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function kt(t,e){return-1!=t.indexOf(e)}function Ct(t,e){return t<e?-1:t>e?1:0}t:{var jt=ut.navigator;if(jt){var At=jt.userAgent;if(At){St=At;break t}}St=""}function Dt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Nt(t){var e={};for(var n in t)e[n]=t[n];return e}var Rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Pt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Rt.length;o++)n=Rt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Lt(t){return Lt[" "](t),t}Lt[" "]=ct;var Ft,Mt,Vt=kt(St,"Opera"),Ut=kt(St,"Trident")||kt(St,"MSIE"),qt=kt(St,"Edge"),Bt=qt||Ut,Qt=kt(St,"Gecko")&&!(kt(St.toLowerCase(),"webkit")&&!kt(St,"Edge"))&&!(kt(St,"Trident")||kt(St,"MSIE"))&&!kt(St,"Edge"),Kt=kt(St.toLowerCase(),"webkit")&&!kt(St,"Edge");function Gt(){var t=ut.document;return t?t.documentMode:void 0}t:{var zt="",Ht=(Mt=St,Qt?/rv:([^\);]+)(\)|;)/.exec(Mt):qt?/Edge\/([\d\.]+)/.exec(Mt):Ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Mt):Kt?/WebKit\/(\S+)/.exec(Mt):Vt?/(?:Version)[ \/]?(\S+)/.exec(Mt):void 0);if(Ht&&(zt=Ht?Ht[1]:""),Ut){var Wt=Gt();if(null!=Wt&&Wt>parseFloat(zt)){Ft=String(Wt);break t}}Ft=zt}var Yt={},Xt=ut.document&&Ut&&(Gt()||parseInt(Ft,10))||void 0,$t=function(){if(!ut.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ut.addEventListener("test",ct,e),ut.removeEventListener("test",ct,e)}catch(n){}return t}();function Jt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Zt(t,e){if(Jt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Qt){t:{try{Lt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:te[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Zt.Z.h.call(this)}}Jt.prototype.h=function(){this.defaultPrevented=!0},mt(Zt,Jt);var te={2:"touch",3:"pen",4:"mouse"};Zt.prototype.h=function(){Zt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ee="closure_listenable_"+(1e6*Math.random()|0),ne=0;function re(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++ne,this.ca=this.fa=!1}function ie(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function oe(t){this.src=t,this.g={},this.h=0}function se(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=It(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ie(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ae(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}oe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=ae(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new re(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var ue="closure_lm_"+(1e6*Math.random()|0),ce={};function he(t,e,n,r,i){if(r&&r.once)return fe(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)he(t,e[o],n,r,i);return null}return n=be(n),t&&t[ee]?t.N(e,n,lt(r)?!!r.capture:!!r,i):le(t,e,n,!1,r,i)}function le(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=lt(i)?!!i.capture:!!i,a=ve(t);if(a||(t[ue]=a=new oe(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=ye;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)$t||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(ge(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function fe(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)fe(t,e[o],n,r,i);return null}return n=be(n),t&&t[ee]?t.O(e,n,lt(r)?!!r.capture:!!r,i):le(t,e,n,!0,r,i)}function de(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)de(t,e[o],n,r,i);else r=lt(r)?!!r.capture:!!r,n=be(n),t&&t[ee]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=ae(o=t.g[e],n,r,i))&&(ie(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=ve(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ae(e,n,r,i)),(n=-1<t?e[t]:null)&&pe(n))}function pe(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[ee])se(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ge(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ve(e))?(se(n,t),0==n.h&&(n.src=null,e[ue]=null)):ie(t)}}}function ge(t){return t in ce?ce[t]:ce[t]="on"+t}function ye(t,e){if(t.ca)t=!0;else{e=new Zt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&pe(t),t=n.call(r,e)}return t}function ve(t){return(t=t[ue])instanceof oe?t:null}var me="__closure_events_fn_"+(1e9*Math.random()>>>0);function be(t){return"function"==typeof t?t:(t[me]||(t[me]=function(e){return t.handleEvent(e)}),t[me])}function we(){bt.call(this),this.i=new oe(this),this.P=this,this.I=null}function Ie(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Jt(e,t);else if(e instanceof Jt)e.target=e.target||t;else{var i=e;Pt(e=new Jt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Te(s,r,!0,e)&&i}if(i=Te(s=e.g=t,r,!0,e)&&i,i=Te(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Te(s=e.g=n[o],r,!1,e)&&i}function Te(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&se(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}mt(we,bt),we.prototype[ee]=!0,we.prototype.removeEventListener=function(t,e,n,r){de(this,t,e,n,r)},we.prototype.M=function(){if(we.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)ie(n[r]);delete e.g[t],e.h--}}this.I=null},we.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},we.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Oe=ut.JSON.stringify;function Ee(){var t=De,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var _e,Se=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=xe.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),xe=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new ke},function(t){return t.reset()}),ke=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Ce(t){ut.setTimeout(function(){throw t},0)}function je(t,e){_e||function(){var t=ut.Promise.resolve(void 0);_e=function(){t.then(Ne)}}(),Ae||(_e(),Ae=!0),De.add(t,e)}var Ae=!1,De=new Se;function Ne(){for(var t;t=Ee();){try{t.h.call(t.g)}catch(n){Ce(n)}var e=xe;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ae=!1}function Re(t,e){we.call(this),this.h=t||1,this.g=e||ut,this.j=yt(this.kb,this),this.l=Date.now()}function Pe(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Le(t,e,n){if("function"==typeof t)n&&(t=yt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=yt(t.handleEvent,t)}return 2147483647<Number(e)?-1:ut.setTimeout(t,e||0)}function Fe(t){t.g=Le(function(){t.g=null,t.i&&(t.i=!1,Fe(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}mt(Re,we),(ot=Re.prototype).da=!1,ot.S=null,ot.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ie(this,"tick"),this.da&&(Pe(this),this.start()))}},ot.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ot.M=function(){Re.Z.M.call(this),Pe(this),delete this.g};var Me=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}rt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Fe(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(ut.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(bt);function Ve(t){bt.call(this),this.h=t,this.g={}}mt(Ve,bt);var Ue=[];function qe(t,e,n,r){Array.isArray(n)||(n&&(Ue[0]=n.toString()),n=Ue);for(var i=0;i<n.length;i++){var o=he(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Be(t){Dt(t.g,function(t,e){this.g.hasOwnProperty(e)&&pe(t)},t),t.g={}}function Qe(){this.g=!0}function Ke(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Oe(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}Ve.prototype.M=function(){Ve.Z.M.call(this),Be(this)},Ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Qe.prototype.Aa=function(){this.g=!1},Qe.prototype.info=function(){};var Ge={},ze=null;function He(){return ze=ze||new we}function We(t){Jt.call(this,Ge.Ma,t)}function Ye(t){var e=He();Ie(e,new We(e,t))}function Xe(t,e){Jt.call(this,Ge.STAT_EVENT,t),this.stat=e}function $e(t){var e=He();Ie(e,new Xe(e,t))}function Je(t,e){Jt.call(this,Ge.Na,t),this.size=e}function Ze(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return ut.setTimeout(function(){t()},e)}Ge.Ma="serverreachability",mt(We,Jt),Ge.STAT_EVENT="statevent",mt(Xe,Jt),Ge.Na="timingevent",mt(Je,Jt);var tn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},en={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function nn(){}function rn(){}nn.prototype.h=null;var on,sn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function an(){Jt.call(this,"d")}function un(){Jt.call(this,"c")}function cn(){}function hn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Ve(this),this.P=fn,this.W=new Re(t=Bt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ln}function ln(){this.i=null,this.g="",this.h=!1}mt(an,Jt),mt(un,Jt),mt(cn,nn),cn.prototype.g=function(){return new XMLHttpRequest},cn.prototype.i=function(){return{}},on=new cn;var fn=45e3,dn={},pn={};function gn(t,e,n){t.K=1,t.v=Mn(Dn(e)),t.s=n,t.U=!0,yn(t,null)}function yn(t,e){t.F=Date.now(),wn(t),t.A=Dn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),$n(n.h,"t",r),t.C=0,n=t.l.H,t.h=new ln,t.g=Jr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Me(yt(t.Ia,t,t.g),t.O)),qe(t.V,t.g,"readystatechange",t.gb),e=t.H?Nt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ye(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function vn(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function mn(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=bn(t,n))==pn){4==e&&(t.o=4,$e(14),i=!1),Ke(t.j,t.m,null,"[Incomplete Response]");break}if(r==dn){t.o=4,$e(15),Ke(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Ke(t.j,t.m,r,null),_n(t,r)}vn(t)&&r!=pn&&r!=dn&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,$e(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Kr(e),e.L=!0,$e(11))):(Ke(t.j,t.m,n,"[Invalid Chunked Response]"),En(t),On(t))}function bn(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?pn:(n=Number(e.substring(n,r)),isNaN(n)?dn:(r+=1)+n>e.length?pn:(e=e.substr(r,n),t.C=r+n,e))}function wn(t){t.Y=Date.now()+t.P,In(t,t.P)}function In(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ze(yt(t.eb,t),e)}function Tn(t){t.B&&(ut.clearTimeout(t.B),t.B=null)}function On(t){0==t.l.G||t.I||Hr(t.l,t)}function En(t){Tn(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Pe(t.W),Be(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function _n(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||ir(n.i,t)))if(n.I=t.N,!t.J&&ir(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;zr(n),Pr(n)}Qr(n),$e(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Ze(yt(n.ab,n),6e3));if(1>=rr(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Yr(n,11)}else if((t.J||n.g==t)&&zr(n),!_t(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(kt(h,"spdy")||kt(h,"quic")||kt(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(or(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Fn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=$r(r,r.H?r.la:null,r.W),d.J){sr(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(Tn(p),wn(p)),r.g=d}else Br(r);0<n.l.length&&Mr(n)}else"stop"!=o[0]&&"close"!=o[0]||Yr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Yr(n,7):Rr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Ye(4)}catch(o){}}function Sn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ht(t)||"string"==typeof t)Tt(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(ht(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(ht(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function xn(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof xn)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function kn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Cn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Cn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Cn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(ot=hn.prototype).setTimeout=function(t){this.P=t},ot.gb=function(t){t=t.target;var e=this.L;e&&3==Cr(t)?e.l():this.Ia(t)},ot.Ia=function(t){try{if(t==this.g)t:{var e=Cr(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||Bt||this.g&&(this.h.h||this.g.ga()||jr(this.g)))){this.I||4!=e||7==n||Ye(8==n||0>=r?3:2),Tn(this);var i=this.g.ba();this.N=i;e:if(vn(this)){var o=jr(this.g);t="";var s=o.length,a=4==Cr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){En(this),On(this);var u="";break e}this.h.i=new ut.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_t(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,$e(12),En(this),On(this);break t}Ke(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,_n(this,i)}this.U?(mn(this,e,u),Bt&&this.i&&3==e&&(qe(this.V,this.W,"tick",this.fb),this.W.start())):(Ke(this.j,this.m,u,null),_n(this,u)),4==e&&En(this),this.i&&!this.I&&(4==e?Hr(this.l,this):(this.i=!1,wn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,$e(12)):(this.o=0,$e(13)),En(this),On(this)}}}catch(e){}},ot.fb=function(){if(this.g){var t=Cr(this.g),e=this.g.ga();this.C<e.length&&(Tn(this),mn(this,t,e),this.i&&4!=t&&wn(this))}},ot.cancel=function(){this.I=!0,En(this)},ot.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Ye(3),$e(17)),En(this),this.o=2,On(this)):In(this,this.Y-t)},(ot=xn.prototype).R=function(){kn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},ot.T=function(){return kn(this),this.g.concat()},ot.get=function(t,e){return Cn(this.h,t)?this.h[t]:e},ot.set=function(t,e){Cn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},ot.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var jn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function An(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof An){this.g=void 0!==e?e:t.g,Nn(this,t.j),this.s=t.s,Rn(this,t.i),Pn(this,t.m),this.l=t.l,e=t.h;var n=new Hn;n.i=e.i,e.g&&(n.g=new xn(e.g),n.h=e.h),Ln(this,n),this.o=t.o}else t&&(n=String(t).match(jn))?(this.g=!!e,Nn(this,n[1]||"",!0),this.s=Vn(n[2]||""),Rn(this,n[3]||"",!0),Pn(this,n[4]),this.l=Vn(n[5]||"",!0),Ln(this,n[6]||"",!0),this.o=Vn(n[7]||"")):(this.g=!!e,this.h=new Hn(null,this.g))}function Dn(t){return new An(t)}function Nn(t,e,n){t.j=n?Vn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Rn(t,e,n){t.i=n?Vn(e,!0):e}function Pn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ln(t,e,n){e instanceof Hn?(t.h=e,function(t,e){e&&!t.j&&(Wn(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Yn(this,e),$n(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=Un(e,Gn)),t.h=new Hn(e,t.g))}function Fn(t,e,n){t.h.set(e,n)}function Mn(t){return Fn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Vn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Un(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,qn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function qn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}An.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Un(e,Bn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Un(e,Bn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Un(n,"/"==n.charAt(0)?Kn:Qn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Un(n,zn)),t.join("")};var Bn=/[#\/\?@]/g,Qn=/[#\?:]/g,Kn=/[#\?]/g,Gn=/[#\?@]/g,zn=/#/g;function Hn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Wn(t){t.g||(t.g=new xn,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Yn(t,e){Wn(t),e=Jn(t,e),Cn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Cn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&kn(t)))}function Xn(t,e){return Wn(t),e=Jn(t,e),Cn(t.g.h,e)}function $n(t,e,n){Yn(t,e),0<n.length&&(t.i=null,t.g.set(Jn(t,e),Et(n)),t.h+=n.length)}function Jn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(ot=Hn.prototype).add=function(t,e){Wn(this),this.i=null,t=Jn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},ot.forEach=function(t,e){Wn(this),this.g.forEach(function(n,r){Tt(n,function(n){t.call(e,n,r,this)},this)},this)},ot.T=function(){Wn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},ot.R=function(t){Wn(this);var e=[];if("string"==typeof t)Xn(this,t)&&(e=Ot(e,this.g.get(Jn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Ot(e,t[n])}return e},ot.set=function(t,e){return Wn(this),this.i=null,Xn(this,t=Jn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},ot.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},ot.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Zn=function(t,e){this.h=t,this.g=e};function tr(t){this.l=t||er,t=ut.PerformanceNavigationTiming?0<(t=ut.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(ut.g&&ut.g.Ea&&ut.g.Ea()&&ut.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var er=10;function nr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function rr(t){return t.h?1:t.g?t.g.size:0}function ir(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function or(t,e){t.g?t.g.add(e):t.h=e}function sr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ar(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=it(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return Et(t.i)}function ur(){}function cr(){this.g=new ur}function hr(t,e,n){var r=n||"";try{Sn(t,function(t,n){var i=t;lt(t)&&(i=Oe(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(wp){throw e.push(r+"type="+encodeURIComponent("_badmap")),wp}}function lr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function fr(t){this.l=t.$b||null,this.j=t.ib||!1}function dr(t,e){we.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=pr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tr.prototype.cancel=function(){var t,e;if(this.i=ar(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=it(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},ur.prototype.stringify=function(t){return ut.JSON.stringify(t,void 0)},ur.prototype.parse=function(t){return ut.JSON.parse(t,void 0)},mt(fr,nn),fr.prototype.g=function(){return new dr(this.l,this.j)},fr.prototype.i=function(t){return function(){return t}}({}),mt(dr,we);var pr=0;function gr(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function yr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,vr(t)}function vr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(ot=dr.prototype).open=function(t,e){if(this.readyState!=pr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,vr(this)},ot.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||ut).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},ot.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,yr(this)),this.readyState=pr},ot.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,vr(this)),this.g&&(this.readyState=3,vr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==ut.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gr(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},ot.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?yr(this):vr(this),3==this.readyState&&gr(this)}},ot.Ua=function(t){this.g&&(this.response=this.responseText=t,yr(this))},ot.Ta=function(t){this.g&&(this.response=t,yr(this))},ot.ha=function(){this.g&&yr(this)},ot.setRequestHeader=function(t,e){this.v.append(t,e)},ot.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},ot.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(dr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var mr=ut.JSON.parse;function br(t){we.call(this),this.headers=new xn,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=wr,this.K=this.L=!1}mt(br,we);var wr="",Ir=/^https?$/i,Tr=["POST","PUT"];function Or(t){return"content-type"==t.toLowerCase()}function Er(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,_r(t),xr(t)}function _r(t){t.D||(t.D=!0,Ie(t,"complete"),Ie(t,"error"))}function Sr(t){if(t.h&&void 0!==at&&(!t.C[1]||4!=Cr(t)||2!=t.ba()))if(t.v&&4==Cr(t))Le(t.Fa,0,t);else if(Ie(t,"readystatechange"),4==Cr(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(jn)[1]||null;if(!o&&ut.self&&ut.self.location){var s=ut.self.location.protocol;o=s.substr(0,s.length-1)}i=!Ir.test(o?o.toLowerCase():"")}e=i}if(e)Ie(t,"complete"),Ie(t,"success");else{t.m=6;try{var a=2<Cr(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",_r(t)}}finally{xr(t)}}}function xr(t,e){if(t.g){kr(t);var n=t.g,r=t.C[0]?ct:null;t.g=null,t.C=null,e||Ie(t,"ready");try{n.onreadystatechange=r}catch(wp){}}}function kr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(ut.clearTimeout(t.A),t.A=null)}function Cr(t){return t.g?t.g.readyState:0}function jr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case wr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ar(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Dt(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Fn(t,e,n))}function Dr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Nr(t){this.za=0,this.l=[],this.h=new Qe,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Dr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Dr("baseRetryDelayMs",5e3,t),this.$a=Dr("retryDelaySeedMs",1e4,t),this.Ya=Dr("forwardChannelMaxRetries",2,t),this.ra=Dr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new tr(t&&t.concurrentRequestLimit),this.Ca=new cr,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Rr(t){if(Lr(t),3==t.G){var e=t.V++,n=Dn(t.F);Fn(n,"SID",t.J),Fn(n,"RID",e),Fn(n,"TYPE","terminate"),Ur(t,n),(e=new hn(t,t.h,e,void 0)).K=2,e.v=Mn(Dn(n)),n=!1,ut.navigator&&ut.navigator.sendBeacon&&(n=ut.navigator.sendBeacon(e.v.toString(),"")),!n&&ut.Image&&((new Image).src=e.v,n=!0),n||(e.g=Jr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),wn(e)}Xr(t)}function Pr(t){t.g&&(Kr(t),t.g.cancel(),t.g=null)}function Lr(t){Pr(t),t.u&&(ut.clearTimeout(t.u),t.u=null),zr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&ut.clearTimeout(t.m),t.m=null)}function Fr(t,e){t.l.push(new Zn(t.Za++,e)),3==t.G&&Mr(t)}function Mr(t){nr(t.i)||t.m||(t.m=!0,je(t.Ha,t),t.C=0)}function Vr(t,e){var n;n=e?e.m:t.V++;var r=Dn(t.F);Fn(r,"SID",t.J),Fn(r,"RID",n),Fn(r,"AID",t.U),Ur(t,r),t.o&&t.s&&Ar(r,t.o,t.s),n=new hn(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=qr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),or(t.i,n),gn(n,r,e)}function Ur(t,e){t.j&&Sn({},function(t,n){Fn(e,n,t)})}function qr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?yt(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{hr(h,s,"req"+c+"_")}catch(ji){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Br(t){t.g||t.u||(t.Y=1,je(t.Ga,t),t.A=0)}function Qr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Ze(yt(t.Ga,t),Wr(t,t.A)),t.A++,0))}function Kr(t){null!=t.B&&(ut.clearTimeout(t.B),t.B=null)}function Gr(t){t.g=new hn(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Dn(t.oa);Fn(e,"RID","rpc"),Fn(e,"SID",t.J),Fn(e,"CI",t.N?"0":"1"),Fn(e,"AID",t.U),Ur(t,e),Fn(e,"TYPE","xmlhttp"),t.o&&t.s&&Ar(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Mn(Dn(e)),n.s=null,n.U=!0,yn(n,t)}function zr(t){null!=t.v&&(ut.clearTimeout(t.v),t.v=null)}function Hr(t,e){var n=null;if(t.g==e){zr(t),Kr(t),t.g=null;var r=2}else{if(!ir(t.i,e))return;n=e.D,sr(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Ie(r=He(),new Je(r,n,e,i)),Mr(t)}else Br(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(rr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Ze(yt(t.Ha,t,e),Wr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Qr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Yr(t,5);break;case 4:Yr(t,10);break;case 3:Yr(t,6);break;default:Yr(t,2)}}function Wr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Yr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=yt(t.jb,t);n||(n=new An("//www.google.com/images/cleardot.gif"),ut.location&&"http"==ut.location.protocol||Nn(n,"https"),Mn(n)),function(t,e){var n=new Qe;if(ut.Image){var r=new Image;r.onload=vt(lr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=vt(lr,n,r,"TestLoadImage: error",!1,e),r.onabort=vt(lr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=vt(lr,n,r,"TestLoadImage: timeout",!1,e),ut.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else $e(2);t.G=0,t.j&&t.j.va(e),Xr(t),Lr(t)}function Xr(t){t.G=0,t.I=-1,t.j&&(0==ar(t.i).length&&0==t.l.length||(t.i.i.length=0,Et(t.l),t.l.length=0),t.j.ua())}function $r(t,e,n){var r=function(t){return t instanceof An?Dn(t):new An(t,void 0)}(n);if(""!=r.i)e&&Rn(r,e+"."+r.i),Pn(r,r.m);else{var i=ut.location;r=function(t,e,n,r){var i=new An(null,void 0);return t&&Nn(i,t),e&&Rn(i,e),n&&Pn(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&Dt(t.aa,function(t,e){Fn(r,e,t)}),n=t.sa,(e=t.D)&&n&&Fn(r,e,n),Fn(r,"VER",t.ma),Ur(t,r),r}function Jr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new br(n&&t.Ba&&!t.qa?new fr({ib:!0}):t.qa)).L=t.H,e}function Zr(){}function ti(){if(Ut&&!(10<=Number(Xt)))throw Error("Environmental error: no available transport.")}function ei(t,e){we.call(this),this.g=new Nr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!_t(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!_t(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new ii(this)}function ni(t){an.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ri(){un.call(this),this.status=1}function ii(t){this.g=t}(ot=br.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():on.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:on),this.g.onreadystatechange=yt(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Er(this,o)}t=n||"";var i=new xn(this.headers);r&&Sn(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Or,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=ut.FormData&&t instanceof ut.FormData,!(0<=It(Tr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{kr(this),0<this.B&&((this.K=function(t){return Ut&&function(){return t=Yt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=xt(String(Ft)).split("."),n=xt("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Ct(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Ct(0==o[2].length,0==s[2].length)||Ct(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=yt(this.pa,this)):this.A=Le(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Er(this,o)}},ot.pa=function(){void 0!==at&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ie(this,"timeout"),this.abort(8))},ot.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ie(this,"complete"),Ie(this,"abort"),xr(this))},ot.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),xr(this,!0)),br.Z.M.call(this)},ot.Fa=function(){this.s||(this.F||this.v||this.l?Sr(this):this.cb())},ot.cb=function(){Sr(this)},ot.ba=function(){try{return 2<Cr(this)?this.g.status:-1}catch(Mt){return-1}},ot.ga=function(){try{return this.g?this.g.responseText:""}catch(Mt){return""}},ot.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),mr(e)}},ot.Da=function(){return this.m},ot.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(ot=Nr.prototype).ma=8,ot.G=1,ot.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},ot.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new hn(this,this.h,t,void 0),n=this.s;if(this.P&&(n?Pt(n=Nt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=qr(this,e,r),Fn(i=Dn(this.F),"RID",t),Fn(i,"CVER",22),this.D&&Fn(i,"X-HTTP-Session-Id",this.D),Ur(this,i),this.o&&n&&Ar(i,this.o,n),or(this.i,e),this.Ra&&Fn(i,"TYPE","init"),this.ja?(Fn(i,"$req",r),Fn(i,"SID","null"),e.$=!0,gn(e,i,null)):gn(e,i,r),this.G=2}}else 3==this.G&&(t?Vr(this,t):0==this.l.length||nr(this.i)||Vr(this))},ot.Ga=function(){if(this.u=null,Gr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Ze(yt(this.bb,this),t)}},ot.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,$e(10),Pr(this),Gr(this))},ot.ab=function(){null!=this.v&&(this.v=null,Pr(this),Qr(this),$e(19))},ot.jb=function(t){t?(this.h.info("Successfully pinged google.com"),$e(2)):(this.h.info("Failed to ping google.com"),$e(1))},(ot=Zr.prototype).xa=function(){},ot.wa=function(){},ot.va=function(){},ot.ua=function(){},ot.Oa=function(){},ti.prototype.g=function(t,e){return new ei(t,e)},mt(ei,we),ei.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),je(yt(t.hb,t,e))),$e(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=$r(t,null,t.W),Mr(t)},ei.prototype.close=function(){Rr(this.g)},ei.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Fr(this.g,e)}else this.v?((e={}).__data__=Oe(t),Fr(this.g,e)):Fr(this.g,t)},ei.prototype.M=function(){this.g.j=null,delete this.j,Rr(this.g),delete this.g,ei.Z.M.call(this)},mt(ni,an),mt(ri,un),mt(ii,Zr),ii.prototype.xa=function(){Ie(this.g,"a")},ii.prototype.wa=function(t){Ie(this.g,new ni(t))},ii.prototype.va=function(t){Ie(this.g,new ri(t))},ii.prototype.ua=function(){Ie(this.g,"b")},ti.prototype.createWebChannel=ti.prototype.g,ei.prototype.send=ei.prototype.u,ei.prototype.open=ei.prototype.m,ei.prototype.close=ei.prototype.close,tn.NO_ERROR=0,tn.TIMEOUT=8,tn.HTTP_ERROR=6,en.COMPLETE="complete",rn.EventType=sn,sn.OPEN="a",sn.CLOSE="b",sn.ERROR="c",sn.MESSAGE="d",we.prototype.listen=we.prototype.N,br.prototype.listenOnce=br.prototype.O,br.prototype.getLastError=br.prototype.La,br.prototype.getLastErrorCode=br.prototype.Da,br.prototype.getStatus=br.prototype.ba,br.prototype.getResponseJson=br.prototype.Qa,br.prototype.getResponseText=br.prototype.ga,br.prototype.send=br.prototype.ea;var oi=tn,si=en,ai=Ge,ui=fr,ci=rn,hi=br,li=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();li.o=-1;var fi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},di=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(tt.c)(e,t),e}(Error),pi=new nt.b("@firebase/firestore");function gi(){return pi.logLevel}function yi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(pi.logLevel<=nt.a.DEBUG){var r=e.map(bi);pi.debug.apply(pi,Object(tt.f)(["Firestore (8.10.1): "+t],r))}}function vi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(pi.logLevel<=nt.a.ERROR){var r=e.map(bi);pi.error.apply(pi,Object(tt.f)(["Firestore (8.10.1): "+t],r))}}function mi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(pi.logLevel<=nt.a.WARN){var r=e.map(bi);pi.warn.apply(pi,Object(tt.f)(["Firestore (8.10.1): "+t],r))}}function bi(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(wp){return t}}function wi(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw vi(e),new Error(e)}function Ii(t,e){t||wi()}function Ti(t,e){return t}function Oi(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Ei=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Oi(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function _i(t,e){return t<e?-1:t>e?1:0}function Si(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function xi(t){return t+"\0"}var ki=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new di(fi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new di(fi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new di(fi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new di(fi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?_i(this.nanoseconds,t.nanoseconds):_i(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Ci=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ki(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function ji(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ai(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Di(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ni=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&wi(),void 0===n?n=t.length-e:n>t.length-e&&wi(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new di(fi.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Ni),Pi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Li=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Pi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new di(fi.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new di(fi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new di(fi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new di(fi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Ni),Fi=function(){function t(t){this.fields=t,t.sort(Li.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Si(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),Mi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return _i(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Mi.EMPTY_BYTE_STRING=new Mi("");var Vi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ui(t){if(Ii(!!t),"string"==typeof t){var e=0,n=Vi.exec(t);if(Ii(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:qi(t.seconds),nanos:qi(t.nanos)}}function qi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Bi(t){return"string"==typeof t?Mi.fromBase64String(t):Mi.fromUint8Array(t)}function Qi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ki(t){var e=t.mapValue.fields.__previous_value__;return Qi(e)?Ki(e):e}function Gi(t){var e=Ui(t.mapValue.fields.__local_write_time__.timestampValue);return new ki(e.seconds,e.nanos)}function zi(t){return null==t}function Hi(t){return 0===t&&1/t==-1/0}function Wi(t){return"number"==typeof t&&Number.isInteger(t)&&!Hi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Yi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Ri.fromString(e))},t.fromName=function(e){return new t(Ri.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Ri.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Ri.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Ri(e.slice()))},t}();function Xi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Qi(t)?4:10:wi()}function $i(t,e){var n=Xi(t);if(n!==Xi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Gi(t).isEqual(Gi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ui(t.timestampValue),r=Ui(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Bi(t.bytesValue).isEqual(Bi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return qi(t.geoPointValue.latitude)===qi(e.geoPointValue.latitude)&&qi(t.geoPointValue.longitude)===qi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return qi(t.integerValue)===qi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=qi(t.doubleValue),r=qi(e.doubleValue);return n===r?Hi(n)===Hi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Si(t.arrayValue.values||[],e.arrayValue.values||[],$i);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ji(n)!==ji(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!$i(n[i],r[i])))return!1;return!0}(t,e);default:return wi()}}function Ji(t,e){return void 0!==(t.values||[]).find(function(t){return $i(t,e)})}function Zi(t,e){var n=Xi(t),r=Xi(e);if(n!==r)return _i(n,r);switch(n){case 0:return 0;case 1:return _i(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=qi(t.integerValue||t.doubleValue),r=qi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return to(t.timestampValue,e.timestampValue);case 4:return to(Gi(t),Gi(e));case 5:return _i(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Bi(t),r=Bi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=_i(n[i],r[i]);if(0!==o)return o}return _i(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=_i(qi(t.latitude),qi(e.latitude));return 0!==n?n:_i(qi(t.longitude),qi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Zi(n[i],r[i]);if(o)return o}return _i(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=_i(r[s],o[s]);if(0!==a)return a;var u=Zi(n[r[s]],i[o[s]]);if(0!==u)return u}return _i(r.length,o.length)}(t.mapValue,e.mapValue);default:throw wi()}}function to(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return _i(t,e);var n=Ui(t),r=Ui(e),i=_i(n.seconds,r.seconds);return 0!==i?i:_i(n.nanos,r.nanos)}function eo(t){return no(t)}function no(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Ui(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Bi(t.bytesValue).toBase64():"referenceValue"in t?Yi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=no(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+no(t.fields[o])}return e+"}"}(t.mapValue):wi();var e}function ro(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function io(t){return!!t&&"integerValue"in t}function oo(t){return!!t&&"arrayValue"in t}function so(t){return!!t&&"nullValue"in t}function ao(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function uo(t){return!!t&&"mapValue"in t}function co(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Ai(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=co(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=co(t.arrayValue.values[r]);return n}return Object.assign({},t)}var ho=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!uo(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=co(e)},t.prototype.setAll=function(t){var e=this,n=Li.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=co(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());uo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return $i(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];uo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Ai(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(co(this.value))},t}();function lo(t){var e=[];return Ai(t.fields,function(t,n){var r=new Li([t]);if(uo(n)){var i=lo(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new Fi(e)}var fo=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Ci.min(),ho.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,ho.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,ho.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ho.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ho.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),po=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function go(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new po(t,e,n,r,i,o,s)}function yo(t){var e=Ti(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+eo(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),zi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Co(e.startAt)),e.endAt&&(n+="|ub:",n+=Co(e.endAt)),e.h=n}return e.h}function vo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ao(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!$i(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!No(t.startAt,e.startAt)&&No(t.endAt,e.endAt)}function mo(t){return Yi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var bo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(tt.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new wo(t,n,r):"array-contains"===n?new Eo(t,r):"in"===n?new _o(t,r):"not-in"===n?new So(t,r):"array-contains-any"===n?new xo(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Io(t,n):new To(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Zi(e,this.value)):null!==e&&Xi(this.value)===Xi(e)&&this.m(Zi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return wi()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),wo=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Yi.fromName(r.referenceValue),i}return Object(tt.c)(e,t),e.prototype.matches=function(t){var e=Yi.comparator(t.key,this.key);return this.m(e)},e}(bo),Io=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Oo(0,n),r}return Object(tt.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(bo),To=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Oo(0,n),r}return Object(tt.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(bo);function Oo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Yi.fromName(t.referenceValue)})}var Eo=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(tt.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return oo(e)&&Ji(e.arrayValue,this.value)},e}(bo),_o=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(tt.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Ji(this.value.arrayValue,e)},e}(bo),So=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(tt.c)(e,t),e.prototype.matches=function(t){if(Ji(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Ji(this.value.arrayValue,e)},e}(bo),xo=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(tt.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!oo(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Ji(e.value.arrayValue,t)})},e}(bo),ko=function(t,e){this.position=t,this.before=e};function Co(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return eo(t)}).join(",")}var jo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ao(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Do(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Yi.comparator(Yi.fromName(s.referenceValue),n.key):Zi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function No(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!$i(t.position[n],e.position[n]))return!1;return!0}var Ro=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Po(t,e,n,r,i,o,s,a){return new Ro(t,e,n,r,i,o,s,a)}function Lo(t){return new Ro(t)}function Fo(t){return!zi(t.limit)&&"F"===t.limitType}function Mo(t){return!zi(t.limit)&&"L"===t.limitType}function Vo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Uo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function qo(t){return null!==t.collectionGroup}function Bo(t){var e=Ti(t);if(null===e.p){e.p=[];var n=Uo(e),r=Vo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new jo(n)),e.p.push(new jo(Li.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new jo(Li.keyField(),u))}}}return e.p}function Qo(t){var e=Ti(t);if(!e.T)if("F"===e.limitType)e.T=go(e.path,e.collectionGroup,Bo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Bo(e);r<i.length;r++){var o=i[r];n.push(new jo(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new ko(e.endAt.position,!e.endAt.before):null,a=e.startAt?new ko(e.startAt.position,!e.startAt.before):null;e.T=go(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Ko(t,e,n){return new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Go(t,e){return vo(Qo(t),Qo(e))&&t.limitType===e.limitType}function zo(t){return yo(Qo(t))+"|lt:"+t.limitType}function Ho(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+eo(e.value);var e}).join(", ")+"]"),zi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Co(t.startAt)),t.endAt&&(e+=", endAt: "+Co(t.endAt)),"Target("+e+")"}(Qo(t))+"; limitType="+t.limitType+")"}function Wo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Yi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Do(t.startAt,Bo(t),e)||t.endAt&&Do(t.endAt,Bo(t),e))}(t,e)}function Yo(t){return function(e,n){for(var r=!1,i=0,o=Bo(t);i<o.length;i++){var s=o[i],a=Xo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Xo(t,e,n){var r=t.field.isKeyField()?Yi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Zi(r,i):wi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return wi()}}function $o(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Hi(e)?"-0":e}}function Jo(t){return{integerValue:""+t}}function Zo(t,e){return Wi(e)?Jo(e):$o(t,e)}var ts=function(){this._=void 0};function es(t,e,n){return t instanceof is?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof os?ss(t,e):t instanceof as?us(t,e):function(t,e){var n=rs(t,e),r=hs(n)+hs(t.A);return io(n)&&io(t.A)?Jo(r):$o(t.R,r)}(t,e)}function ns(t,e,n){return t instanceof os?ss(t,e):t instanceof as?us(t,e):n}function rs(t,e){return t instanceof cs?io(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var is=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e}(ts),os=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(tt.c)(e,t),e}(ts);function ss(t,e){for(var n=ls(e),r=function(t){n.some(function(e){return $i(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var as=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(tt.c)(e,t),e}(ts);function us(t,e){for(var n=ls(e),r=function(t){n=n.filter(function(e){return!$i(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var cs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(tt.c)(e,t),e}(ts);function hs(t){return qi(t.integerValue||t.doubleValue)}function ls(t){return oo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var fs=function(t,e){this.field=t,this.transform=e},ds=function(t,e){this.version=t,this.transformResults=e},ps=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function gs(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var ys=function(){};function vs(t,e,n){t instanceof Ts?function(t,e,n){var r=t.value.clone(),i=_s(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Os?function(t,e,n){if(gs(t.precondition,e)){var r=_s(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Es(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ms(t,e,n){t instanceof Ts?function(t,e,n){if(gs(t.precondition,e)){var r=t.value.clone(),i=Ss(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Is(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Os?function(t,e,n){if(gs(t.precondition,e)){var r=Ss(t.fieldTransforms,n,e),i=e.data;i.setAll(Es(t)),i.setAll(r),e.convertToFoundDocument(Is(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){gs(t.precondition,e)&&e.convertToNoDocument(Ci.min())}(t,e)}function bs(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=rs(o.transform,s||null);null!=a&&(null==n&&(n=ho.empty()),n.set(o.field,a))}return n||null}function ws(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Si(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof os&&e instanceof os||t instanceof as&&e instanceof as?Si(t.elements,e.elements,$i):t instanceof cs&&e instanceof cs?$i(t.A,e.A):t instanceof is&&e instanceof is}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Is(t){return t.isFoundDocument()?t.version:Ci.min()}var Ts=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(tt.c)(e,t),e}(ys),Os=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(tt.c)(e,t),e}(ys);function Es(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function _s(t,e,n){var r=new Map;Ii(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,ns(s,a,n[i]))}return r}function Ss(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,es(a,u,e))}return r}var xs,ks,Cs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(tt.c)(e,t),e}(ys),js=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(tt.c)(e,t),e}(ys),As=function(t){this.count=t};function Ds(t){switch(t){case fi.OK:return wi();case fi.CANCELLED:case fi.UNKNOWN:case fi.DEADLINE_EXCEEDED:case fi.RESOURCE_EXHAUSTED:case fi.INTERNAL:case fi.UNAVAILABLE:case fi.UNAUTHENTICATED:return!1;case fi.INVALID_ARGUMENT:case fi.NOT_FOUND:case fi.ALREADY_EXISTS:case fi.PERMISSION_DENIED:case fi.FAILED_PRECONDITION:case fi.ABORTED:case fi.OUT_OF_RANGE:case fi.UNIMPLEMENTED:case fi.DATA_LOSS:return!0;default:return wi()}}function Ns(t){if(void 0===t)return vi("GRPC error has no .code"),fi.UNKNOWN;switch(t){case xs.OK:return fi.OK;case xs.CANCELLED:return fi.CANCELLED;case xs.UNKNOWN:return fi.UNKNOWN;case xs.DEADLINE_EXCEEDED:return fi.DEADLINE_EXCEEDED;case xs.RESOURCE_EXHAUSTED:return fi.RESOURCE_EXHAUSTED;case xs.INTERNAL:return fi.INTERNAL;case xs.UNAVAILABLE:return fi.UNAVAILABLE;case xs.UNAUTHENTICATED:return fi.UNAUTHENTICATED;case xs.INVALID_ARGUMENT:return fi.INVALID_ARGUMENT;case xs.NOT_FOUND:return fi.NOT_FOUND;case xs.ALREADY_EXISTS:return fi.ALREADY_EXISTS;case xs.PERMISSION_DENIED:return fi.PERMISSION_DENIED;case xs.FAILED_PRECONDITION:return fi.FAILED_PRECONDITION;case xs.ABORTED:return fi.ABORTED;case xs.OUT_OF_RANGE:return fi.OUT_OF_RANGE;case xs.UNIMPLEMENTED:return fi.UNIMPLEMENTED;case xs.DATA_LOSS:return fi.DATA_LOSS;default:return wi()}}(ks=xs||(xs={}))[ks.OK=0]="OK",ks[ks.CANCELLED=1]="CANCELLED",ks[ks.UNKNOWN=2]="UNKNOWN",ks[ks.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ks[ks.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ks[ks.NOT_FOUND=5]="NOT_FOUND",ks[ks.ALREADY_EXISTS=6]="ALREADY_EXISTS",ks[ks.PERMISSION_DENIED=7]="PERMISSION_DENIED",ks[ks.UNAUTHENTICATED=16]="UNAUTHENTICATED",ks[ks.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ks[ks.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ks[ks.ABORTED=10]="ABORTED",ks[ks.OUT_OF_RANGE=11]="OUT_OF_RANGE",ks[ks.UNIMPLEMENTED=12]="UNIMPLEMENTED",ks[ks.INTERNAL=13]="INTERNAL",ks[ks.UNAVAILABLE=14]="UNAVAILABLE",ks[ks.DATA_LOSS=15]="DATA_LOSS";var Rs=function(){function t(t,e){this.comparator=t,this.root=e||Ls.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ls.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ls.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ps(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ps(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ps(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ps(this.root,t,this.comparator,!0)},t}(),Ps=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Ls=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw wi();if(this.right.isRed())throw wi();var t=this.left.check();if(t!==this.right.check())throw wi();return t+(this.isRed()?0:1)},t}();Ls.EMPTY=null,Ls.RED=!0,Ls.BLACK=!1,Ls.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw wi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw wi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw wi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw wi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw wi()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Ls(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Fs=function(){function t(t){this.comparator=t,this.data=new Rs(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Ms(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Ms(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Ms=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Vs=new Rs(Yi.comparator);function Us(){return Vs}var qs=new Rs(Yi.comparator);function Bs(){return qs}var Qs=new Rs(Yi.comparator);function Ks(){return Qs}var Gs=new Fs(Yi.comparator);function zs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Gs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Hs=new Fs(_i);function Ws(){return Hs}var Ys=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Xs.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Ci.min(),r,Ws(),Us(),zs())},t}(),Xs=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Mi.EMPTY_BYTE_STRING,n,zs(),zs(),zs())},t}(),$s=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Js=function(t,e){this.targetId=t,this.V=e},Zs=function(t,e,n,r){void 0===n&&(n=Mi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ta=function(){function t(){this.S=0,this.D=ra(),this.C=Mi.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=zs(),e=zs(),n=zs();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:wi()}}),new Xs(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=ra()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),ea=function(){function t(t){this.W=t,this.G=new Map,this.H=Us(),this.J=na(),this.Y=new Fs(_i)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:wi()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(mo(i))if(0===n){var o=new Yi(i.path);this.tt(e,o,fo.newNoDocument(o,Ci.min()))}else Ii(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&mo(o.target)){var s=new Yi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,fo.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=zs();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ys(t,n,this.Y,this.H,r);return this.H=Us(),this.J=na(),this.Y=new Fs(_i),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ta,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Fs(_i),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||yi("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ta),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function na(){return new Rs(Yi.comparator)}function ra(){return new Rs(Yi.comparator)}var ia={asc:"ASCENDING",desc:"DESCENDING"},oa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sa=function(t,e){this.databaseId=t,this.I=e};function aa(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ua(t,e){return t.I?e.toBase64():e.toUint8Array()}function ca(t,e){return aa(t,e.toTimestamp())}function ha(t){return Ii(!!t),Ci.fromTimestamp(function(t){var e=Ui(t);return new ki(e.seconds,e.nanos)}(t))}function la(t,e){return function(t){return new Ri(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function fa(t){var e=Ri.fromString(t);return Ii(La(e)),e}function da(t,e){return la(t.databaseId,e.path)}function pa(t,e){var n=fa(e);if(n.get(1)!==t.databaseId.projectId)throw new di(fi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new di(fi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Yi(ma(n))}function ga(t,e){return la(t.databaseId,e)}function ya(t){var e=fa(t);return 4===e.length?Ri.emptyPath():ma(e)}function va(t){return new Ri(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ma(t){return Ii(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ba(t,e,n){return{name:da(t,e),fields:n.value.mapValue.fields}}function wa(t,e,n){var r=pa(t,e.name),i=ha(e.updateTime),o=new ho({mapValue:{fields:e.fields}}),s=fo.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Ia(t,e){var n;if(e instanceof Ts)n={update:ba(t,e.key,e.value)};else if(e instanceof Cs)n={delete:da(t,e.key)};else if(e instanceof Os)n={update:ba(t,e.key,e.data),updateMask:Pa(e.fieldMask)};else{if(!(e instanceof js))return wi();n={verify:da(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof is)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof os)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof as)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof cs)return{fieldPath:e.field.canonicalString(),increment:n.A};throw wi()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ca(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:wi()}(t,e.precondition)),n}function Ta(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?ps.updateTime(ha(t.updateTime)):void 0!==t.exists?ps.exists(t.exists):ps.none()}(e.currentDocument):ps.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Ii("REQUEST_TIME"===e.setToServerValue),n=new is):"appendMissingElements"in e?n=new os(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new as(e.removeAllFromArray.values||[]):"increment"in e?n=new cs(t,e.increment):wi();var r=Li.fromServerFormat(e.fieldPath);return new fs(r,n)}(t,e)}):[];if(e.update){var i=pa(t,e.update.name),o=new ho({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new Fi((t.fieldPaths||[]).map(function(t){return Li.fromServerFormat(t)}))}(e.updateMask);return new Os(i,o,s,n,r)}return new Ts(i,o,n,r)}if(e.delete){var a=pa(t,e.delete);return new Cs(a,n)}if(e.verify){var u=pa(t,e.verify);return new js(u,n)}return wi()}function Oa(t,e){return{documents:[ga(t,e.path)]}}function Ea(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ga(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ga(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(ao(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NAN"}};if(so(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ao(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NAN"}};if(so(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Aa(t.field),op:ja(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Aa(t.field),direction:Ca(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||zi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=xa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=xa(e.endAt)),n}function _a(t){var e=ya(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Ii(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Sa(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new jo(Da(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return zi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ka(n.startAt));var h=null;return n.endAt&&(h=ka(n.endAt)),Po(e,i,a,s,u,"F",c,h)}function Sa(t){return t?void 0!==t.unaryFilter?[Ra(t)]:void 0!==t.fieldFilter?[Na(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Sa(t)}).reduce(function(t,e){return t.concat(e)}):wi():[]}function xa(t){return{before:t.before,values:t.position}}function ka(t){return new ko(t.values||[],!!t.before)}function Ca(t){return ia[t]}function ja(t){return oa[t]}function Aa(t){return{fieldPath:t.canonicalString()}}function Da(t){return Li.fromServerFormat(t.fieldPath)}function Na(t){return bo.create(Da(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return wi()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ra(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Da(t.unaryFilter.field);return bo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Da(t.unaryFilter.field);return bo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Da(t.unaryFilter.field);return bo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Da(t.unaryFilter.field);return bo.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return wi()}}function Pa(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function La(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Fa(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Va(e)),e=Ma(t.get(n),e);return Va(e)}function Ma(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Va(t){return t+"\x01\x01"}function Ua(t){var e=t.length;if(Ii(e>=2),2===e)return Ii("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Ri.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&wi(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:wi()}o=s+2}return new Ri(r)}var qa=function(t,e){this.seconds=t,this.nanoseconds=e},Ba=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ba.store="owner",Ba.key="owner";var Qa=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Qa.store="mutationQueues",Qa.keyPath="userId";var Ka=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ka.store="mutations",Ka.keyPath="batchId",Ka.userMutationsIndex="userMutationsIndex",Ka.userMutationsKeyPath=["userId","batchId"];var Ga=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Fa(e)]},t.key=function(t,e,n){return[t,Fa(e),n]},t}();Ga.store="documentMutations",Ga.PLACEHOLDER=new Ga;var za=function(t,e){this.path=t,this.readTime=e},Ha=function(t,e){this.path=t,this.version=e},Wa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Wa.store="remoteDocuments",Wa.readTimeIndex="readTimeIndex",Wa.readTimeIndexPath="readTime",Wa.collectionReadTimeIndex="collectionReadTimeIndex",Wa.collectionReadTimeIndexPath=["parentPath","readTime"];var Ya=function(t){this.byteSize=t};Ya.store="remoteDocumentGlobal",Ya.key="remoteDocumentGlobalKey";var Xa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Xa.store="targets",Xa.keyPath="targetId",Xa.queryTargetsIndexName="queryTargetsIndex",Xa.queryTargetsKeyPath=["canonicalId","targetId"];var $a=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};$a.store="targetDocuments",$a.keyPath=["targetId","path"],$a.documentTargetsIndex="documentTargetsIndex",$a.documentTargetsKeyPath=["path","targetId"];var Ja=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ja.key="targetGlobalKey",Ja.store="targetGlobal";var Za=function(t,e){this.collectionId=t,this.parent=e};Za.store="collectionParents",Za.keyPath=["collectionId","parent"];var tu=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};tu.store="clientMetadata",tu.keyPath="clientId";var eu=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};eu.store="bundles",eu.keyPath="bundleId";var nu=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};nu.store="namedQueries",nu.keyPath="name";var ru=Object(tt.f)(Object(tt.f)([],Object(tt.f)(Object(tt.f)([],Object(tt.f)(Object(tt.f)([],Object(tt.f)(Object(tt.f)([],[Qa.store,Ka.store,Ga.store,Wa.store,Xa.store,Ba.store,Ja.store,$a.store]),[tu.store])),[Ya.store])),[Za.store])),[eu.store,nu.store]),iu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ou=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),su=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},au=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&wi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),uu=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new su,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new lu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=yu(e.target.error);n.ft.reject(new lu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new lu(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(yi("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new du(e)},t}(),cu=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(et.j)())&&vi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return yi("SimpleDb","Removing database:",t),pu(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(et.j)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(tt.b)(this,void 0,void 0,function(){var e,n=this;return Object(tt.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(yi("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new lu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new di(fi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new lu(t,n))},i.onupgradeneeded=function(t){yi("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){yi("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(tt.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(tt.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(tt.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=uu.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),au.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return yi("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),hu=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return pu(this.Pt.delete())},t}(),lu=function(t){function e(e,n){var r=this;return(r=t.call(this,fi.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(tt.c)(e,t),e}(di);function fu(t){return"IndexedDbTransactionError"===t.name}var du=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(yi("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(yi("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),pu(n)},t.prototype.add=function(t){return yi("SimpleDb","ADD",this.store.name,t,t),pu(this.store.add(t))},t.prototype.get=function(t){var e=this;return pu(this.store.get(t)).next(function(n){return void 0===n&&(n=null),yi("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return yi("SimpleDb","DELETE",this.store.name,t),pu(this.store.delete(t))},t.prototype.count=function(){return yi("SimpleDb","COUNT",this.store.name),pu(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.kt=function(t,e){yi("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new au(function(n,r){e.onerror=function(t){var e=yu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new au(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new hu(i),s=e(i.primaryKey,i.value,o);if(s instanceof au){var a=s.catch(function(t){return o.done(),au.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return au.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function pu(t){return new au(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=yu(t.target.error);n(e)}})}var gu=!1;function yu(t){var e=cu._t(Object(et.j)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new di("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return gu||(gu=!0,setTimeout(function(){throw r},0)),r}}return t}var vu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(tt.c)(e,t),e}(ou);function mu(t,e){var n=Ti(t);return cu.It(n.Mt,e)}var bu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&vs(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&ms(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&ms(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Ci.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},zs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Si(this.mutations,t.mutations,function(t,e){return ws(t,e)})&&Si(this.baseMutations,t.baseMutations,function(t,e){return ws(t,e)})},t}(),wu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Ii(e.mutations.length===r.length);for(var i=Ks(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Iu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Ci.min()),void 0===o&&(o=Ci.min()),void 0===s&&(s=Mi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Tu=function(t){this.Lt=t};function Ou(t,e){if(e.document)return wa(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Yi.fromSegments(e.noDocument.path),r=ku(e.noDocument.readTime),i=fo.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Yi.fromSegments(e.unknownDocument.path);return r=ku(e.unknownDocument.version),fo.newUnknownDocument(o,r)}return wi()}function Eu(t,e,n){var r=_u(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:da(t,e.key),fields:e.data.value.mapValue.fields,updateTime:aa(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Wa(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=xu(e.version);return s=e.hasCommittedMutations,new Wa(null,new za(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=xu(e.version);return new Wa(new Ha(c,h),null,null,!0,r,i)}return wi()}function _u(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Su(t){var e=new ki(t[0],t[1]);return Ci.fromTimestamp(e)}function xu(t){var e=t.toTimestamp();return new qa(e.seconds,e.nanoseconds)}function ku(t){var e=new ki(t.seconds,t.nanoseconds);return Ci.fromTimestamp(e)}function Cu(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Ta(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Ta(t.Lt,e)}),o=ki.fromMillis(e.localWriteTimeMs);return new bu(e.batchId,o,n,i)}function ju(t){var e,n,r=ku(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ku(t.lastLimboFreeSnapshotVersion):Ci.min();return void 0!==t.query.documents?(Ii(1===(n=t.query).documents.length),e=Qo(Lo(ya(n.documents[0])))):e=function(t){return Qo(_a(t))}(t.query),new Iu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Mi.fromBase64String(t.resumeToken))}function Au(t,e){var n,r=xu(e.snapshotVersion),i=xu(e.lastLimboFreeSnapshotVersion);n=mo(e.target)?Oa(t.Lt,e.target):Ea(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Xa(e.targetId,yo(e.target),r,o,e.sequenceNumber,i,n)}function Du(t){var e=_a({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ko(e,e.limit,"L"):e}var Nu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Ru(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:ku(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Ru(t).put({bundleId:(n=e).id,createTime:xu(ha(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Pu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Du(e.bundledQuery),readTime:ku(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return Pu(t).put(function(t){return{name:t.name,readTime:xu(ha(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Ru(t){return mu(t,eu.store)}function Pu(t){return mu(t,nu.store)}var Lu=function(){function t(){this.Bt=new Fu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),au.resolve()},t.prototype.getCollectionParents=function(t,e){return au.resolve(this.Bt.getEntries(e))},t}(),Fu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Fs(Ri.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Fs(Ri.comparator)).toArray()},t}(),Mu=function(){function t(){this.qt=new Fu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:Fa(i)};return Vu(t).put(o)}return au.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[xi(e),""],!1,!0);return Vu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ua(o.parent))}return n})},t}();function Vu(t){return mu(t,Za.store)}var Uu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Bu(t,e,n){var r=t.store(Ka.store),i=t.store(Ga.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Ii(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Ga.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return au.waitFor(o).next(function(){return c})}function Qu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw wi();e=t.noDocument}return JSON.stringify(e).length}qu.DEFAULT_COLLECTION_PERCENTILE=10,qu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qu.DEFAULT=new qu(41943040,qu.DEFAULT_COLLECTION_PERCENTILE,qu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qu.DISABLED=new qu(-1,0,0);var Ku=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Ii(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zu(t).$t({index:Ka.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Hu(t),s=zu(t);return s.add({}).next(function(a){Ii("number"==typeof a);for(var u=new bu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Ia(t.Lt,e)}),i=n.mutations.map(function(e){return Ia(t.Lt,e)});return new Ka(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Fs(function(t,e){return _i(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],g=Ga.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Ga.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),au.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return zu(t).get(e).next(function(t){return t?(Ii(t.userId===n.userId),Cu(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?au.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return zu(t).$t({index:Ka.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Ii(e.batchId>=r),o=Cu(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return zu(t).$t({index:Ka.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return zu(t).Nt(Ka.userMutationsIndex,n).next(function(t){return t.map(function(t){return Cu(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Ga.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Hu(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=Ua(r[1]);if(a===n.userId&&e.path.isEqual(c))return zu(t).get(u).next(function(t){if(!t)throw wi();Ii(t.userId===n.userId),o.push(Cu(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Fs(_i),i=[];return e.forEach(function(e){var o=Ga.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Hu(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=Ua(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),au.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ga.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Fs(_i);return Hu(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=Ua(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(zu(t).get(e).next(function(t){if(null===t)throw wi();Ii(t.userId===n.userId),r.push(Cu(n.R,t))}))}),au.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Bu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),au.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return au.resolve();var r=IDBKeyRange.lowerBound(Ga.prefixForUser(e.userId)),i=[];return Hu(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Ua(t[1]);i.push(o)}else r.done()}).next(function(){Ii(0===i.length)})})},t.prototype.containsKey=function(t,e){return Gu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Wu(t).get(this.userId).next(function(t){return t||new Qa(e.userId,-1,"")})},t}();function Gu(t,e,n){var r=Ga.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Hu(t).$t({range:o,Ft:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function zu(t){return mu(t,Ka.store)}function Hu(t){return mu(t,Ga.store)}function Wu(t){return mu(t,Qa.store)}var Yu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Xu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Yu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Ci.fromTimestamp(new ki(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return $u(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Ii(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return $u(t).$t(function(s,a){var u=ju(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return au.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return $u(t).$t(function(t,n){var r=ju(n);e(r)})},t.prototype.Xt=function(t){return Ju(t).get(Ja.key).next(function(t){return Ii(null!==t),t})},t.prototype.Zt=function(t,e){return Ju(t).put(Ja.key,e)},t.prototype.te=function(t,e){return $u(t).put(Au(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=yo(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return $u(t).$t({range:r,index:Xa.queryTargetsIndexName},function(t,n,r){var o=ju(n);vo(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Zu(t);return e.forEach(function(e){var s=Fa(e.path);i.push(o.put(new $a(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),au.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Zu(t);return au.forEach(e,function(e){var o=Fa(e.path);return au.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Zu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Zu(t),i=zs();return r.$t({range:n,Ft:!0},function(t,e,n){var r=Ua(t[1]),o=new Yi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Fa(e.path),r=IDBKeyRange.bound([n],[xi(n)],!1,!0),i=0;return Zu(t).$t({index:$a.documentTargetsIndex,Ft:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return $u(t).get(e).next(function(t){return t?ju(t):null})},t}();function $u(t){return mu(t,Xa.store)}function Ju(t){return mu(t,Ja.store)}function Zu(t){return mu(t,$a.store)}function tc(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){if(t.code!==fi.FAILED_PRECONDITION||t.message!==iu)throw t;return yi("LocalStore","Unexpectedly lost primary lease"),[2]})})}function ec(t,e){var n=t[1],r=e[1],i=_i(t[0],e[0]);return 0===i?_i(n,r):i}var nc=function(){function t(t){this.ne=t,this.buffer=new Fs(ec),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ec(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),rc=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;yi("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(tt.b)(e,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return fu(e=n.sent())?(yi("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,tc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),ic=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return au.resolve(li.o);var r=new nc(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(yi("LruGarbageCollector","Garbage collection skipped; disabled"),au.resolve(Uu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(yi("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Uu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(yi("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),gi()<=nt.a.DEBUG&&yi("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),au.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),oc=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new ic(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return sc(t,n)},t.prototype.removeReference=function(t,e,n){return sc(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return sc(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Wu(t).Ot(function(r){return Gu(t,r,e).next(function(t){return t&&(n=!0),au.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Zu(t).delete([0,Fa(s.path)])})});i.push(u)}}).next(function(){return au.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return sc(t,e)},t.prototype.we=function(t,e){var n,r=Zu(t),i=li.o;return r.$t({index:$a.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==li.o&&e(new Yi(Ua(n)),i),i=s,n=o):i=li.o}).next(function(){i!==li.o&&e(new Yi(Ua(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function sc(t,e){return Zu(t).put(function(t,e){return new $a(0,Fa(t.path),e)}(e,t.currentSequenceNumber))}var ac=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Ai(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return Di(this.inner)},t}(),uc=function(){function t(){this.changes=new ac(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Ci.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:fo.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?au.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),cc=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return fc(t).put(dc(e),n)},t.prototype.removeEntry=function(t,e){var n=fc(t),r=dc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return fc(t).get(dc(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return fc(t).get(dc(e)).next(function(t){return{document:n.ye(e,t),size:Qu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Us();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Us(),i=new Rs(Yi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Qu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return au.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return fc(t).$t({range:r},function(t,e,r){for(var s=Yi.fromSegments(t);o&&Yi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Us(),o=e.path.length+1,s={};if(n.isEqual(Ci.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=_u(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Wa.collectionReadTimeIndex}return fc(t).$t(s,function(t,n,s){if(t.length===o){var a=Ou(r.R,n);e.path.isPrefixOf(a.key.path)?Wo(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new hc(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return lc(t).get(Ya.key).next(function(t){return Ii(!!t),t})},t.prototype.me=function(t,e){return lc(t).put(Ya.key,e)},t.prototype.ye=function(t,e){if(e){var n=Ou(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Ci.min()))return n}return fo.newInvalidDocument(t)},t}(),hc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ac(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(tt.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Fs(function(t,e){return _i(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Eu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Qu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Eu(e.Ie.R,fo.newNoDocument(o,Ci.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),au.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(uc);function lc(t){return mu(t,Ya.store)}function fc(t){return mu(t,Wa.store)}function dc(t){return t.path.toArray()}var pc=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Ii(n<r&&n>=0&&r<=11);var o=new uu("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ba.store)}(t),function(t){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath}),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath,autoIncrement:!0}).createIndex(Ka.userMutationsIndex,Ka.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ga.store)}(t),gc(t),function(t){t.createObjectStore(Wa.store)}(t));var s=au.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore($a.store),t.deleteObjectStore(Xa.store),t.deleteObjectStore(Ja.store)}(t),gc(t)),s=s.next(function(){return function(t){var e=t.store(Ja.store),n=new Ja(0,0,Ci.min().toTimestamp(),0);return e.put(Ja.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Ka.store).Nt().next(function(n){t.deleteObjectStore(Ka.store),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath,autoIncrement:!0}).createIndex(Ka.userMutationsIndex,Ka.userMutationsKeyPath,{unique:!0});var r=e.store(Ka.store),i=n.map(function(t){return r.put(t)});return au.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(tu.store,{keyPath:tu.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Ya.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Wa.store);e.createIndex(Wa.readTimeIndex,Wa.readTimeIndexPath,{unique:!1}),e.createIndex(Wa.collectionReadTimeIndex,Wa.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(eu.store,{keyPath:eu.keyPath})}(t),function(t){t.createObjectStore(nu.store,{keyPath:nu.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Wa.store).$t(function(t,n){e+=Qu(n)}).next(function(){var n=new Ya(e);return t.store(Ya.store).put(Ya.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Qa.store),r=t.store(Ka.store);return n.Nt().next(function(n){return au.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Ka.userMutationsIndex,i).next(function(r){return au.forEach(r,function(r){Ii(r.userId===n.userId);var i=Cu(e.R,r);return Bu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store($a.store),n=t.store(Wa.store);return t.store(Ja.store).get(Ja.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new Ri(n),s=function(t){return[0,Fa(t)]}(o);r.push(e.get(s).next(function(n){return n?au.resolve():function(n){return e.put(new $a(0,Fa(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return au.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Za.store,{keyPath:Za.keyPath});var n=e.store(Za.store),r=new Fu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Fa(i)})}};return e.store(Wa.store).$t({Ft:!0},function(t,e){var n=new Ri(t);return i(n.popLast())}).next(function(){return e.store(Ga.store).$t({Ft:!0},function(t,e){var n=Ua(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Xa.store);return n.$t(function(t,r){var i=ju(r),o=Au(e.R,i);return n.put(o)})},t}();function gc(t){t.createObjectStore($a.store,{keyPath:$a.keyPath}).createIndex($a.documentTargetsIndex,$a.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Xa.store,{keyPath:Xa.keyPath}).createIndex(Xa.queryTargetsIndexName,Xa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ja.store)}var yc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",vc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new di(fi.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oc(this,i),this.Le=n+"main",this.R=new Tu(u),this.Be=new cu(this.Le,11,new pc(this.R)),this.qe=new Xu(this.referenceDelegate,this.R),this.Ut=new Mu,this.Ue=function(t,e){return new cc(t,e)}(this.R,this.Ut),this.Ke=new Nu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&vi("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new di(fi.FAILED_PRECONDITION,yc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new li(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(tt.b)(e,void 0,void 0,function(){return Object(tt.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(tt.b)(e,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(tt.b)(e,void 0,void 0,function(){return Object(tt.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return bc(e).put(new tu(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(fu(e))return yi("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return yi("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return mc(t).get(Ba.key).next(function(t){return au.resolve(e.tn(t))})},t.prototype.en=function(t){return bc(t).delete(this.clientId)},t.prototype.nn=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(tt.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=mu(t,tu.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return au.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?au.resolve(!0):mc(t).get(Ba.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new di(fi.FAILED_PRECONDITION,yc);return!1}}return!(!e.networkEnabled||!e.inForeground)||bc(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&yi("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(tt.b)(this,void 0,void 0,function(){var t=this;return Object(tt.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ba.store,tu.store],function(e){var n=new vu(e,li.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return bc(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Ku.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return yi("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",ru,function(o){return r=new vu(o,i.Ne?i.Ne.next():li.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw vi("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new di(fi.FAILED_PRECONDITION,iu);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return mc(t).get(Ba.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new di(fi.FAILED_PRECONDITION,yc)})},t.prototype.Ze=function(t){var e=new Ba(this.clientId,this.allowTabSynchronization,Date.now());return mc(t).put(Ba.key,e)},t.yt=function(){return cu.yt()},t.prototype.Xe=function(t){var e=this,n=mc(t);return n.get(Ba.key).next(function(t){return e.tn(t)?(yi("IndexedDbPersistence","Releasing primary lease."),n.delete(Ba.key)):au.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(vi("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),Object(et.r)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return yi("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return vi("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){vi("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function mc(t){return mu(t,Ba.store)}function bc(t){return mu(t,tu.store)}function wc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Ic=function(t,e){this.progress=t,this.wn=e},Tc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Yi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):qo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Yi(e)).next(function(t){var e=Bs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Bs();return this.Ut.getCollectionParents(t,i).next(function(s){return au.forEach(s,function(s){var a=function(t,e){return new Ro(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=fo.newInvalidDocument(c),r=r.insert(c,h)),ms(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){Wo(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=zs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Os&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Oc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=zs(),i=zs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ec=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Ci.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(Fo(e)||Mo(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(gi()<=nt.a.DEBUG&&yi("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ho(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new Fs(Yo(t));return e.forEach(function(e,r){Wo(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return gi()<=nt.a.DEBUG&&yi("QueryEngine","Using full collection scan to execute query:",Ho(e)),this.Sn.getDocumentsMatchingQuery(t,e,Ci.min())},t}(),_c=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Rs(_i),this.Fn=new ac(function(t){return yo(t)},vo),this.$n=Ci.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Tc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.kn)})},t}();function Sc(t,e,n,r){return new _c(t,e,n,r)}function xc(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(tt.d)(this,function(s){switch(s.label){case 0:return n=Ti(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Tc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=zs(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function kc(t,e){var n=Ti(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=au.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Ii(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Cc(t){var e=Ti(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function jc(t,e){var n=Ti(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Ii(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=Us();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Ac(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Ci.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return au.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.kn=i,t})}function Ac(t,e,n,r,i){var o=zs();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Us();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Ci.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):yi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Dc(t,e){var n=Ti(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Nc(t,e){var n=Ti(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?au.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Iu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t})}function Rc(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(tt.d)(this,function(a){switch(a.label){case 0:r=Ti(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!fu(s=a.sent()))throw s;return yi("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}})})}function Pc(t,e,n){var r=Ti(t),i=Ci.min(),o=zs();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Ti(t),i=r.Fn.get(n);return void 0!==i?au.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,Qo(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Ci.min(),n?o:zs())}).next(function(t){return{documents:t,Bn:o}})})}function Lc(t,e){var n=Ti(t),r=Ti(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function Fc(t){var e=Ti(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Ti(t),i=Us(),o=_u(n),s=fc(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Wa.readTimeIndex,range:a},function(t,e){var n=Ou(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Su(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function Mc(t){return Object(tt.b)(this,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){return[2,(e=Ti(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=fc(t),n=Ci.min();return e.$t({index:Wa.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Su(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function Vc(t,e,n,r){return Object(tt.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(tt.d)(this,function(p){switch(p.label){case 0:for(i=Ti(t),o=zs(),s=Us(),a=Ks(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,Nc(i,function(t){return Qo(Lo(Ri.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Ac(t,f,s,Ci.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Uc(t,e,n){return void 0===n&&(n=zs()),Object(tt.b)(this,void 0,void 0,function(){var r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:return[4,Nc(t,Qo(Du(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Ti(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=ha(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Mi.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var qc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return au.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:ha(n.createTime)}),au.resolve()},t.prototype.getNamedQuery=function(t,e){return au.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Du(t.bundledQuery),readTime:ha(t.readTime)}}(e)),au.resolve()},t}(),Bc=function(){function t(){this.Wn=new Fs(Qc.Gn),this.zn=new Fs(Qc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Qc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Qc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Yi(new Ri([])),r=new Qc(n,t),i=new Qc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Yi(new Ri([])),n=new Qc(e,t),r=new Qc(e,t+1),i=zs();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Qc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Qc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Yi.comparator(t.key,e.key)||_i(t.ns,e.ns)},t.Hn=function(t,e){return _i(t.ns,e.ns)||Yi.comparator(t.key,e.key)},t}(),Kc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Fs(Qc.Gn)}return t.prototype.checkEmpty=function(t){return au.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new bu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Qc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return au.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return au.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return au.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return au.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return au.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Qc(e,0),i=new Qc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),au.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Fs(_i);return e.forEach(function(t){var e=new Qc(t,0),i=new Qc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),au.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Yi.isDocumentKey(i)||(i=i.child(""));var o=new Qc(new Yi(i),0),s=new Fs(_i);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),au.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Ii(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return au.forEach(e.mutations,function(i){var o=new Qc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Qc(e,0),r=this.rs.firstAfterOrEqual(n);return au.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return au.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Gc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Rs(Yi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return au.resolve(n?n.document.clone():fo.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Us();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():fo.newInvalidDocument(t))}),au.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Us(),i=new Yi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Wo(e,u)&&(r=r.insert(u.key,u.clone()))}return au.resolve(r)},t.prototype.fs=function(t,e){return au.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new zc(this)},t.prototype.getSize=function(t){return au.resolve(this.size)},t}(),zc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(tt.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),au.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(uc),Hc=function(){function t(t){this.persistence=t,this.ds=new ac(function(t){return yo(t)},vo),this.lastRemoteSnapshotVersion=Ci.min(),this.highestTargetId=0,this.ws=0,this._s=new Bc,this.targetCount=0,this.ys=Yu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),au.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return au.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return au.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),au.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),au.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Yu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,au.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),au.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,au.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),au.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return au.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return au.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),au.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),au.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),au.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return au.resolve(n)},t.prototype.containsKey=function(t,e){return au.resolve(this._s.containsKey(e))},t}(),Wc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new li(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Hc(this),this.Ut=new Lu,this.Ue=function(t,e){return new Gc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Tu(e),this.Ke=new qc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Kc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;yi("MemoryPersistence","Starting transaction:",t);var i=new Yc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return au.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Yc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(tt.c)(e,t),e}(ou),Xc=function(){function t(t){this.persistence=t,this.As=new Bc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw wi()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),au.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),au.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),au.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return au.forEach(this.vs,function(r){var i=Yi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return au.or([function(){return au.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),$c=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Jc(t,e){return"firestore_clients_"+t+"_"+e}function Zc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function th(t,e){return"firestore_targets_"+t+"_"+e}$c.UNAUTHENTICATED=new $c(null),$c.GOOGLE_CREDENTIALS=new $c("google-credentials-uid"),$c.FIRST_PARTY=new $c("first-party-uid"),$c.MOCK_USER=new $c("mock-user");var eh=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new di(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(vi("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),nh=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new di(i.error.code,i.error.message)),o?new t(e,i.state,r):(vi("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),rh=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ws(),s=0;i&&s<r.activeTargetIds.length;++s)i=Wi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(vi("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),ih=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(vi("SharedClientState","Failed to parse online state: "+e),null)},t}(),oh=function(){function t(){this.activeTargetIds=Ws()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),sh=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Rs(_i),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Jc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new oh),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(tt.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Jc(this.persistenceKey,r)))&&(o=rh.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.ks(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(th(this.persistenceKey,t));if(n){var r=nh.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(th(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return yi("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){yi("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){yi("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(yi("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void vi("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(tt.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(tt.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=li.o;if(null!=t)try{var n=JSON.parse(t);Ii("number"==typeof n),e=n}catch(t){vi("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==li.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new eh(this.currentUser,t,e,n),i=Zc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Zc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=th(this.persistenceKey,t),i=new nh(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return rh.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return eh.Vs(new $c(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return nh.Vs(r,e)},t.prototype.js=function(t){return ih.Vs(t)},t.prototype.ii=function(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(yi("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.Fs=r})},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Ws();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),ah=function(){function t(){this.li=new oh,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new oh,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),uh=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),ch=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){yi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){yi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),hh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},lh=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),fh=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(tt.c)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise(function(i,o){var s=new hi;s.listenOnce(si.COMPLETE,function(){try{switch(s.getLastErrorCode()){case oi.NO_ERROR:var e=s.getResponseJson();yi("Connection","XHR received:",JSON.stringify(e)),i(e);break;case oi.TIMEOUT:yi("Connection",'RPC "'+t+'" timed out'),o(new di(fi.DEADLINE_EXCEEDED,"Request time out"));break;case oi.HTTP_ERROR:var n=s.getStatus();if(yi("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(fi).indexOf(e)>=0?e:fi.UNKNOWN}(r.status);o(new di(a,r.message))}else o(new di(fi.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new di(fi.UNAVAILABLE,"Connection failed."));break;default:wi()}}finally{yi("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new ti,i=He(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new ui({})),this.ki(o.initMessageHeaders,e),Object(et.o)()||Object(et.q)()||Object(et.m)()||Object(et.n)()||Object(et.s)()||Object(et.l)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");yi("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new lh({Ei:function(t){c?yi("Connection","Not sending because WebChannel is closed:",t):(u||(yi("Connection","Opening WebChannel transport."),a.open(),u=!0),yi("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,ci.EventType.OPEN,function(){c||yi("Connection","WebChannel transport opened.")}),l(a,ci.EventType.CLOSE,function(){c||(c=!0,yi("Connection","WebChannel transport closed"),h.Vi())}),l(a,ci.EventType.ERROR,function(t){c||(c=!0,mi("Connection","WebChannel transport errored:",t),h.Vi(new di(fi.UNAVAILABLE,"The operation could not be completed")))}),l(a,ci.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Ii(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){yi("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=xs[t];if(void 0!==e)return Ns(e)}(i),s=r.message;void 0===o&&(o=fi.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new di(o,s)),a.close()}else yi("Connection","WebChannel received:",n),h.Si(n)}}),l(i,ai.STAT_EVENT,function(t){10===t.stat?yi("Connection","Detected buffering proxy"):11===t.stat&&yi("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);yi("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then(function(t){return yi("RestConnection","Received: ",t),t},function(e){throw mi("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+hh[t]},t}());function dh(){return"undefined"!=typeof window?window:null}function ph(){return"undefined"!=typeof document?document:null}function gh(t){return new sa(t,!0)}var yh=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&yi("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),vh=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new yh(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===fi.RESOURCE_EXHAUSTED?(vi(e.toString()),vi("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===fi.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new di(fi.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(tt.b)(t,void 0,void 0,function(){return Object(tt.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return yi("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(yi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),mh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(tt.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:wi()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Ii(void 0===e||"string"==typeof e),Mi.fromBase64String(e||"")):(Ii(void 0===e||e instanceof Uint8Array),Mi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?fi.UNKNOWN:Ns(t.code);return new di(e,t.message||"")}(a);n=new Zs(r,i,o,s||null)}else if("documentChange"in e){i=pa(t,(r=e.documentChange).document.name),o=ha(r.document.updateTime);var a=new ho({mapValue:{fields:r.document.fields}}),u=(s=fo.newFoundDocument(i,o,a),r.targetIds||[]);n=new $s(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=pa(t,(r=e.documentDelete).document),o=r.readTime?ha(r.readTime):Ci.min(),a=fo.newNoDocument(i,o),n=new $s([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=pa(t,(r=e.documentRemove).document),n=new $s([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return wi();var c=e.filter;i=new As(r=c.count||0),n=new Js(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Ci.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ci.min():e.readTime?ha(e.readTime):Ci.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=va(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=mo(r)?{documents:Oa(t,r)}:{query:Ea(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ua(t,e.resumeToken):e.snapshotVersion.compareTo(Ci.min())>0&&(n.readTime=aa(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return wi()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=va(this.R),e.removeTarget=t,this.cr(e)},e}(vh),bh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(tt.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Ii(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Ii(void 0!==e),t.map(function(t){return function(t,e){var n=ha(t.updateTime?t.updateTime:e);return n.isEqual(Ci.min())&&(n=ha(e)),new ds(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=ha(t.commitTime);return this.listener.Tr(n,e)}return Ii(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=va(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ia(e.R,t)})};this.cr(n)},e}(vh),wh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(tt.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new di(fi.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===fi.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new di(fi.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===fi.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new di(fi.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Ih=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(vi(e),this.Vr=!1):yi("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Th=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(tt.b)(o,void 0,void 0,function(){return Object(tt.d)(this,function(t){switch(t.label){case 0:return Ah(this)?(yi("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(tt.b)(this,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return(e=Ti(t)).Or.add(4),[4,Eh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Oh(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Ih(n,r)};function Oh(t){return Object(tt.b)(this,void 0,void 0,function(){var e,n;return Object(tt.d)(this,function(r){switch(r.label){case 0:if(!Ah(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Eh(t){return Object(tt.b)(this,void 0,void 0,function(){var e,n;return Object(tt.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function _h(t,e){var n=Ti(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),jh(n)?Ch(n):zh(n).er()&&xh(n,e))}function Sh(t,e){var n=Ti(t),r=zh(n);n.$r.delete(e),r.er()&&kh(n,e),0===n.$r.size&&(r.er()?r.ir():Ah(n)&&n.Br.set("Unknown"))}function xh(t,e){t.qr.U(e.targetId),zh(t).mr(e)}function kh(t,e){t.qr.U(e),zh(t).yr(e)}function Ch(t){t.qr=new ea({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),zh(t).start(),t.Br.Sr()}function jh(t){return Ah(t)&&!zh(t).tr()&&t.$r.size>0}function Ah(t){return 0===Ti(t).Or.size}function Dh(t){t.qr=void 0}function Nh(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){return t.$r.forEach(function(e,n){xh(t,e)}),[2]})})}function Rh(t,e){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(n){return Dh(t),jh(t)?(t.Br.Nr(e),Ch(t)):t.Br.set("Unknown"),[2]})})}function Ph(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i,o;return Object(tt.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Zs&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(tt.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),yi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Lh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof $s?t.qr.X(e):e instanceof Js?t.qr.rt(e):t.qr.et(e),n.isEqual(Ci.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Cc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Mi.EMPTY_BYTE_STRING,n.snapshotVersion)),kh(t,e);var r=new Iu(n.target,e,1,n.sequenceNumber);xh(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return yi("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Lh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Lh(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r=this;return Object(tt.d)(this,function(i){switch(i.label){case 0:if(!fu(e))throw e;return t.Or.add(1),[4,Eh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Cc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(tt.b)(r,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return yi("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Oh(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Fh(t,e){return e().catch(function(n){return Lh(t,n,e)})}function Mh(t){return Object(tt.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(tt.d)(this,function(s){switch(s.label){case 0:e=Ti(t),n=Hh(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Ah(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Dc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=Hh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Lh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Vh(e)&&Uh(e),[2]}})})}function Vh(t){return Ah(t)&&!Hh(t).tr()&&t.Fr.length>0}function Uh(t){Hh(t).start()}function qh(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){return Hh(t).Ar(),[2]})})}function Bh(t){return Object(tt.b)(this,void 0,void 0,function(){var e,n,r;return Object(tt.d)(this,function(i){for(e=Hh(t),n=0,r=t.Fr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function Qh(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=wu.from(r,e,n),[4,Fh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,Mh(t)];case 2:return o.sent(),[2]}})})}function Kh(t,e){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(n){switch(n.label){case 0:return e&&Hh(t).pr?[4,function(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r;return Object(tt.d)(this,function(i){switch(i.label){case 0:return Ds(r=e.code)&&r!==fi.ABORTED?(n=t.Fr.shift(),Hh(t).sr(),[4,Fh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,Mh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Vh(t)&&Uh(t),[2]}})})}function Gh(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n;return Object(tt.d)(this,function(r){switch(r.label){case 0:return n=Ti(t),e?(n.Or.delete(2),[4,Oh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Eh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function zh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Ti(t);return r.br(),new mh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Nh.bind(null,t),Ri:Rh.bind(null,t),_r:Ph.bind(null,t)}),t.Mr.push(function(n){return Object(tt.b)(e,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),jh(t)?Ch(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Dh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Hh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Ti(t);return r.br(),new bh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:qh.bind(null,t),Ri:Kh.bind(null,t),Ir:Bh.bind(null,t),Tr:Qh.bind(null,t)}),t.Mr.push(function(n){return Object(tt.b)(e,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Mh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(yi("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Wh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new su,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new di(fi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Yh(t,e){if(vi("AsyncQueue",e+": "+t),fu(t))return new di(fi.UNAVAILABLE,e+": "+t);throw t}var Xh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Yi.comparator(e.key,n.key)}:function(t,e){return Yi.comparator(t.key,e.key)},this.keyedMap=Bs(),this.sortedSet=new Rs(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),$h=function(){function t(){this.Qr=new Rs(Yi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):wi():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Jh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Xh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Go(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Zh=function(){this.Wr=void 0,this.listeners=[]},tl=function(){this.queries=new ac(function(t){return zo(t)},Go),this.onlineState="Unknown",this.Gr=new Set};function el(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(tt.d)(this,function(c){switch(c.label){case 0:if(n=Ti(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Zh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Yh(a,"Initialization of query '"+Ho(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&ol(n),[2]}})})}function nl(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(tt.d)(this,function(a){return n=Ti(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function rl(t,e){for(var n=Ti(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&ol(n)}function il(t,e,n){var r=Ti(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function ol(t){t.Gr.forEach(function(t){t.next()})}var sl=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Jh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Jh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),al=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),ul=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return pa(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?wa(this.R,t.document,!1):fo.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return ha(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new ul(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||zs()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:return[4,Vc(this.localStore,new ul(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Uc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Ic(Object.assign({},this.progress),t))]}})})}}();var cl=function(t){this.key=t},hl=function(t){this.key=t},ll=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=zs(),this.mutatedKeys=zs(),this.lo=Yo(t),this.fo=new Xh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new $h,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Fo(this.query)&&i.size===this.query.limit?i.last():null,c=Mo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=Wo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),Fo(this.query)||Mo(this.query))for(;s.size>this.query.limit;){var h=Fo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return wi()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Jh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new $h,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=zs(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new hl(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new cl(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=zs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Jh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),fl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},dl=function(t){this.key=t,this.bo=!1},pl=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ac(function(t){return zo(t)},Go),this.Vo=new Map,this.So=new Set,this.Do=new Rs(Yi.comparator),this.Co=new Map,this.No=new Bc,this.xo={},this.ko=new Map,this.Fo=Yu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function gl(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(tt.d)(this,function(a){switch(a.label){case 0:return n=Kl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Nc(n.localStore,Qo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,yl(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&_h(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function yl(t,e,n,r){return Object(tt.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(tt.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(tt.b)(this,void 0,void 0,function(){var i,o,s;return Object(tt.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Pc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Cl(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,Pc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new ll(e,i.Bn),s=o._o(i.documents),a=Xs.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Cl(t,n,u.To),c=new fl(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function vl(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:return n=Ti(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!Go(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Rc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Sh(n.remoteStore,r.targetId),xl(n,r.targetId)}).catch(tc)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return xl(n,r.targetId),[4,Rc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function ml(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(tt.d)(this,function(a){switch(a.label){case 0:r=Gl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Ti(t),i=ki.now(),o=e.reduce(function(t,e){return t.add(e.key)},zs());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=bs(c,n.get(c.key));null!=h&&s.push(new Os(c.key,h,lo(h.value.mapValue),ps.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Rs(_i)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Dl(r,i.changes)];case 3:return a.sent(),[4,Mh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Yh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function bl(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r;return Object(tt.d)(this,function(i){switch(i.label){case 0:n=Ti(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,jc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Ii(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Ii(r.bo):t.removedDocuments.size>0&&(Ii(r.bo),r.bo=!1))}),[4,Dl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,tc(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function wl(t,e,n){var r=Ti(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Ti(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&ol(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Il(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(tt.d)(this,function(c){switch(c.label){case 0:return(r=Ti(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Rs(Yi.comparator)).insert(o,fo.newNoDocument(o,Ci.min())),a=zs().add(o),u=new Ys(Ci.min(),new Map,new Fs(_i),s,a),[4,bl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Al(r),[3,4];case 2:return[4,Rc(r.localStore,e,!1).then(function(){return xl(r,e,n)}).catch(tc)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Tl(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:n=Ti(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,kc(n.localStore,e)];case 2:return i=o.sent(),Sl(n,r,null),_l(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Dl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,tc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Ol(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:r=Ti(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Ti(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Ii(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Sl(r,e,n),_l(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Dl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,tc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function El(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(tt.d)(this,function(a){switch(a.label){case 0:Ah((n=Ti(t)).remoteStore)||yi("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Ti(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=Yh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function _l(t,e){(t.ko.get(e)||[]).forEach(function(t){t.resolve()}),t.ko.delete(e)}function Sl(t,e,n){var r=Ti(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function xl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||kl(t,e)})}function kl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Sh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Al(t))}function Cl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof cl?(t.No.addReference(o.key,e),jl(t,o)):o instanceof hl?(yi("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||kl(t,o.key)):wi()}}function jl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(yi("SyncEngine","New document in limbo: "+n),t.So.add(r),Al(t))}function Al(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Yi(Ri.fromString(e)),r=t.Fo.next();t.Co.set(r,new dl(n)),t.Do=t.Do.insert(n,r),_h(t.remoteStore,new Iu(Qo(Lo(n.path)),r,2,li.o))}}function Dl(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(tt.d)(this,function(a){switch(a.label){case 0:return r=Ti(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Oc.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(tt.d)(this,function(h){switch(h.label){case 0:n=Ti(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return au.forEach(e,function(e){return au.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return au.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!fu(r=h.sent()))throw r;return yi("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.kn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.kn=n.kn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Nl(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r;return Object(tt.d)(this,function(i){switch(i.label){case 0:return(n=Ti(t)).currentUser.isEqual(e)?[3,3]:(yi("SyncEngine","User change. New user:",e.toKey()),[4,xc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach(function(t){t.forEach(function(t){t.reject(new di(fi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Dl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Rl(t,e){var n=Ti(t),r=n.Co.get(e);if(r&&r.bo)return zs().add(r.key);var i=zs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Pl(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:return[4,Pc((n=Ti(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Cl(n,e.targetId,i.To),i)]}})})}function Ll(t){return Object(tt.b)(this,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){return[2,Fc((e=Ti(t)).localStore).then(function(t){return Dl(e,t)})]})})}function Fl(t,e,n,r){return Object(tt.b)(this,void 0,void 0,function(){var i,o;return Object(tt.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Ti(t),r=Ti(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):au.resolve(null)})})}((i=Ti(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Mh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Sl(i,e,r||null),_l(i,e),function(t,e){Ti(Ti(t)._n).Gt(e)}(i.localStore,e)):wi(),s.label=4;case 4:return[4,Dl(i,o)];case 5:return s.sent(),[3,7];case 6:yi("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function Ml(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(tt.d)(this,function(c){switch(c.label){case 0:return Kl(n=Ti(t)),Gl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Vl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Gh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)_h(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return xl(n,e),Rc(n.localStore,e,!0)}),Sh(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,Vl(n,a)];case 5:return c.sent(),function(t){var e=Ti(t);e.Co.forEach(function(t,n){Sh(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Rs(Yi.comparator)}(n),n.$o=!1,[4,Gh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function Vl(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(tt.d)(this,function(g){switch(g.label){case 0:n=Ti(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Nc(n.localStore,Qo(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Pl(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Lc(n.localStore,a)];case 8:return p=g.sent(),[4,Nc(n.localStore,p)];case 9:return u=g.sent(),[4,yl(n,Ul(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function Ul(t){return Po(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ql(t){var e=Ti(t);return Ti(Ti(e.localStore).persistence).fn()}function Bl(t,e,n,r){return Object(tt.b)(this,void 0,void 0,function(){var i,o,s;return Object(tt.d)(this,function(a){switch(a.label){case 0:return(i=Ti(t)).$o?(yi("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Fc(i.localStore)];case 3:return o=a.sent(),s=Ys.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Dl(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Rc(i.localStore,e,!0)];case 6:return a.sent(),xl(i,e,r),[3,8];case 7:wi(),a.label=8;case 8:return[2]}})})}function Ql(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(tt.d)(this,function(f){switch(f.label){case 0:if(!(r=Kl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(yi("SyncEngine","Adding an already active target "+s),[3,5]):[4,Lc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Nc(r.localStore,a)];case 3:return u=f.sent(),[4,yl(r,Ul(a),u.targetId,!1)];case 4:f.sent(),_h(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(tt.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Rc(r.localStore,t,!1).then(function(){Sh(r.remoteStore,t),xl(r,t)}).catch(tc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function Kl(t){var e=Ti(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=bl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Rl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Il.bind(null,e),e.vo._r=rl.bind(null,e.eventManager),e.vo.Mo=il.bind(null,e.eventManager),e}function Gl(t){var e=Ti(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Tl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ol.bind(null,e),e}var zl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return this.R=gh(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Sc(this.persistence,new Ec,t.initialUser,this.R)},t.prototype.qo=function(t){return new Wc(Xc.bs,this.R)},t.prototype.Bo=function(t){return new ah},t.prototype.terminate=function(){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Hl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(tt.c)(e,t),e.prototype.initialize=function(e){return Object(tt.b)(this,void 0,void 0,function(){var n=this;return Object(tt.d)(this,function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,Mc(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,Gl(this.Qo.syncEngine)];case 4:return r.sent(),[4,Mh(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He(function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()})];case 6:return r.sent(),[2]}})})},e.prototype.Ko=function(t){return Sc(this.persistence,new Ec,t.initialUser,this.R)},e.prototype.Uo=function(t){return new rc(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=wc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?qu.withCacheSize(this.cacheSizeBytes):qu.DEFAULT;return new vc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,dh(),ph(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new ah},e}(zl),Wl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(tt.c)(e,t),e.prototype.initialize=function(e){return Object(tt.b)(this,void 0,void 0,function(){var n,r=this;return Object(tt.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof sh?(this.sharedClientState.syncEngine={ui:Fl.bind(null,n),ai:Bl.bind(null,n),hi:Ql.bind(null,n),fn:ql.bind(null,n),ci:Ll.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(tt.b)(r,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return[4,Ml(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=dh();if(!sh.yt(e))throw new di(fi.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=wc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new sh(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Hl),Yl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n=this;return Object(tt.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return wl(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Nl.bind(null,this.syncEngine),[4,Gh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new tl},t.prototype.createDatastore=function(t){var e=gh(t.databaseInfo.databaseId),n=new fh(t.databaseInfo);return function(t,e,n){return new wh(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return wl(s.syncEngine,t,0)},o=ch.yt()?new ch:new uh,new Th(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new pl(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(tt.b)(this,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return e=Ti(t),yi("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Eh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Xl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),$l=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new su,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(tt.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new al(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(tt.b)(this,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(tt.b)(this,void 0,void 0,function(){var e,n=this;return Object(tt.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new di(fi.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(tt.d)(this,function(u){switch(u.label){case 0:return n=Ti(t),r=va(n.R)+"/documents",i={documents:e.map(function(t){return da(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Ii(!!e.found);var n=pa(t,e.found.name),r=ha(e.found.updateTime),i=new ho({mapValue:{fields:e.found.fields}});return fo.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Ii(!!e.missing),Ii(!!e.readTime);var n=pa(t,e.missing),r=ha(e.readTime);return fo.newNoDocument(n,r)}(t,e):wi()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Ii(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Cs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e=this;return Object(tt.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Yi.fromPath(n);e.mutations.push(new js(r,e.precondition(r)))}),[4,function(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:return n=Ti(t),r=va(n.R)+"/documents",i={writes:e.map(function(t){return Ia(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw wi();e=Ci.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new di(fi.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ps.updateTime(e):ps.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Ci.min()))throw new di(fi.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ps.updateTime(e)}return ps.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Jl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new yh(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(tt.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(tt.d)(this,function(r){return t=new $l(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!zi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ds(e)}return!1},t}(),Zl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=$c.UNAUTHENTICATED,this.clientId=Ei.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(tt.b)(r,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return yi("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new di(fi.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new su;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(tt.b)(t,void 0,void 0,function(){var t,n;return Object(tt.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Yh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function tf(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(tt.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),yi("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(tt.b)(i,void 0,void 0,function(){return Object(tt.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,xc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function ef(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r;return Object(tt.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,nf(t)];case 1:return n=i.sent(),yi("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(tt.b)(this,void 0,void 0,function(){var n,r;return Object(tt.d)(this,function(i){switch(i.label){case 0:return(n=Ti(t)).asyncQueue.verifyOperationInProgress(),yi("RemoteStore","RemoteStore received new credentials"),r=Ah(n),n.Or.add(3),[4,Eh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Oh(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function nf(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(yi("FirestoreClient","Using default OfflineComponentProvider"),[4,tf(t,new zl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function rf(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(yi("FirestoreClient","Using default OnlineComponentProvider"),[4,ef(t,new Yl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function of(t){return nf(t).then(function(t){return t.persistence})}function sf(t){return nf(t).then(function(t){return t.localStore})}function af(t){return rf(t).then(function(t){return t.remoteStore})}function uf(t){return rf(t).then(function(t){return t.syncEngine})}function cf(t){return Object(tt.b)(this,void 0,void 0,function(){var e,n;return Object(tt.d)(this,function(r){switch(r.label){case 0:return[4,rf(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=gl.bind(null,e.syncEngine),n.onUnlisten=vl.bind(null,e.syncEngine),n)]}})})}function hf(t,e,n){var r=this;void 0===n&&(n={});var i=new su;return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(r,void 0,void 0,function(){var r;return Object(tt.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Xl({next:function(o){e.enqueueAndForget(function(){return nl(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new di(fi.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new di(fi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new sl(Lo(n.path),o,{includeMetadataChanges:!0,so:!0});return el(t,s)},[4,cf(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function lf(t,e,n){var r=this;void 0===n&&(n={});var i=new su;return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(r,void 0,void 0,function(){var r;return Object(tt.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Xl({next:function(n){e.enqueueAndForget(function(){return nl(t,s)}),n.fromCache&&"server"===r.source?i.reject(new di(fi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new sl(n,o,{includeMetadataChanges:!0,so:!0});return el(t,s)},[4,cf(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var ff=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},df=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),pf=new Map,gf=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},yf=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e($c.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),vf=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),mf=function(){function t(t){var e=this;this.currentUser=$c.UNAUTHENTICATED,this.oc=new su,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){yi("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(yi("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(yi("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Ii("string"==typeof n.accessToken),new gf(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(tt.b)(n,void 0,void 0,function(){return Object(tt.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Ii(null===t||"string"==typeof t),new $c(t)},t}(),bf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=$c.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),wf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new bf(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e($c.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function If(t,e,n){if(!n)throw new di(fi.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Tf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new di(fi.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Of(t,e,n,r){if(!0===e&&!0===r)throw new di(fi.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Ef(t){if(!Yi.isDocumentKey(t))throw new di(fi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function _f(t){if(Yi.isDocumentKey(t))throw new di(fi.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Sf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":wi()}function xf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new di(fi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Sf(t);throw new di(fi.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function kf(t,e){if(e<=0)throw new di(fi.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Cf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new di(fi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new di(fi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Of("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),jf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Cf({}),this._settingsFrozen=!1,t instanceof df?(this._databaseId=t,this._credentials=new yf):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new di(fi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new df(t.options.projectId)}(t),this._credentials=new mf(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new di(fi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new di(fi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Cf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new yf;switch(t.type){case"gapi":var e=t.client;return Ii(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new wf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new di(fi.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=pf.get(this))&&(yi("ComponentProvider","Removing Datastore"),pf.delete(this),t.terminate()),Promise.resolve();var t},t}(),Af=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Nf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Df=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Nf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Lo(r))||this)._path=r,i.type="collection",i}return Object(tt.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Af(this.firestore,null,new Yi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Df);function Rf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(et.i)(t),If("collection","path",e),t instanceof jf)return _f(n=Ri.fromString.apply(Ri,Object(tt.f)([e],r))),new Nf(t,null,n);if(!(t instanceof Af||t instanceof Nf))throw new di(fi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return _f(n=Ri.fromString.apply(Ri,Object(tt.f)([t.path],r)).child(Ri.fromString(e))),new Nf(t.firestore,null,n)}function Pf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(et.i)(t),1===arguments.length&&(e=Ei.u()),If("doc","path",e),t instanceof jf)return Ef(n=Ri.fromString.apply(Ri,Object(tt.f)([e],r))),new Af(t,null,new Yi(n));if(!(t instanceof Af||t instanceof Nf))throw new di(fi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ef(n=t._path.child(Ri.fromString.apply(Ri,Object(tt.f)([e],r)))),new Af(t.firestore,t instanceof Nf?t.converter:null,new Yi(n))}function Lf(t,e){return t=Object(et.i)(t),e=Object(et.i)(e),(t instanceof Af||t instanceof Nf)&&(e instanceof Af||e instanceof Nf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Ff(t,e){return t=Object(et.i)(t),e=Object(et.i)(e),t instanceof Df&&e instanceof Df&&t.firestore===e.firestore&&Go(t._query,e._query)&&t.converter===e.converter}var Mf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new yh(this,"async_queue_retry"),this.Ic=function(){var e=ph();e&&yi("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=ph();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=ph();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new su;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return Object(tt.b)(this,void 0,void 0,function(){var t,e=this;return Object(tt.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!fu(t=n.sent()))throw t;return yi("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,vi("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Wh.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&wi()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(tt.b)(this,void 0,void 0,function(){var t;return Object(tt.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function Vf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new su,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Uf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Mf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(tt.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Bf(this),this._firestoreClient.terminate()},e}(jf);function qf(t){return t._firestoreClient||Bf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Bf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new ff(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Zl(t._credentials,t._queue,r)}function Qf(t,e,n){var r=this,i=new su;return t.asyncQueue.enqueue(function(){return Object(tt.b)(r,void 0,void 0,function(){var r;return Object(tt.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,tf(t,n)];case 1:return o.sent(),[4,ef(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===fi.FAILED_PRECONDITION||t.code===fi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Kf(t){if(t._initialized||t._terminated)throw new di(fi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Gf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new di(fi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Li(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),zf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Mi.fromBase64String(e))}catch(e){throw new di(fi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Mi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Hf=function(t){this._methodName=t},Wf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new di(fi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new di(fi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return _i(this._lat,t._lat)||_i(this._long,t._long)},t}(),Yf=/^__.*__$/,Xf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Os(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ts(t,this.data,e,this.fieldTransforms)},t}(),$f=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Os(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Jf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw wi()}}var Zf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return bd(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Jf(this.Nc)&&Yf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),td=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||gh(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new Zf({Nc:t,methodName:e,qc:n,path:Li.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function ed(t){var e=t._freezeSettings(),n=gh(t._databaseId);return new td(t._databaseId,!!e.ignoreUndefinedProperties,n)}function nd(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);gd("Data must be an object, but it was:",s,r);var a,u,c=dd(r,s);if(o.merge)a=new Fi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=yd(e,f[l],n);if(!s.contains(d))throw new di(fi.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");wd(h,d)||h.push(d)}a=new Fi(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Xf(new ho(c),a,u)}var rd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Hf);function id(t,e,n){return new Zf({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var od=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e.prototype._toFieldTransform=function(t){return new fs(t.path,new is)},e.prototype.isEqual=function(t){return t instanceof e},e}(Hf),sd=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(tt.c)(e,t),e.prototype._toFieldTransform=function(t){var e=id(this,t,!0),n=this.Kc.map(function(t){return fd(t,e)}),r=new os(n);return new fs(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Hf),ad=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(tt.c)(e,t),e.prototype._toFieldTransform=function(t){var e=id(this,t,!0),n=this.Kc.map(function(t){return fd(t,e)}),r=new as(n);return new fs(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Hf),ud=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(tt.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new cs(t.R,Zo(t.R,this.Qc));return new fs(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Hf);function cd(t,e,n,r){var i=t.Uc(1,e,n);gd("Data must be an object, but it was:",i,r);var o=[],s=ho.empty();Ai(r,function(t,r){var a=md(e,t,n);r=Object(et.i)(r);var u=i.Oc(a);if(r instanceof rd)o.push(a);else{var c=fd(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new Fi(o);return new $f(s,a,i.fieldTransforms)}function hd(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[yd(e,r,n)],u=[i];if(o.length%2!=0)throw new di(fi.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(yd(e,o[c])),u.push(o[c+1]);for(var h=[],l=ho.empty(),f=a.length-1;f>=0;--f)if(!wd(h,a[f])){var d=a[f],p=u[f];p=Object(et.i)(p);var g=s.Oc(d);if(p instanceof rd)h.push(d);else{var y=fd(p,g);null!=y&&(h.push(d),l.set(d,y))}}var v=new Fi(h);return new $f(l,v,s.fieldTransforms)}function ld(t,e,n,r){return void 0===r&&(r=!1),fd(n,t.Uc(r?4:3,e))}function fd(t,e){if(pd(t=Object(et.i)(t)))return gd("Unsupported field value:",e,t),dd(t,e);if(t instanceof Hf)return function(t,e){if(!Jf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=fd(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(et.i)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Zo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ki.fromDate(t);return{timestampValue:aa(e.R,n)}}if(t instanceof ki)return n=new ki(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:aa(e.R,n)};if(t instanceof Wf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof zf)return{bytesValue:ua(e.R,t._byteString)};if(t instanceof Af){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:la(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Sf(t))}(t,e)}function dd(t,e){var n={};return Di(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ai(t,function(t,r){var i=fd(r,e.kc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function pd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ki||t instanceof Wf||t instanceof zf||t instanceof Af||t instanceof Hf)}function gd(t,e,n){if(!pd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Sf(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function yd(t,e,n){if((e=Object(et.i)(e))instanceof Gf)return e._internalPath;if("string"==typeof e)return md(t,e);throw bd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var vd=new RegExp("[~\\*/\\[\\]]");function md(t,e,n){if(e.search(vd)>=0)throw bd("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Gf.bind.apply(Gf,Object(tt.f)([void 0],e.split(".")))))._internalPath}catch(wp){throw bd("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function bd(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new di(fi.INVALID_ARGUMENT,(a+=". ")+t+u)}function wd(t,e){return t.some(function(t){return t.isEqual(e)})}var Id=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Af(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Td(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Od("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Td=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Id);function Od(t,e){return"string"==typeof e?md(t,e):e instanceof Gf?e._internalPath:e._delegate._internalPath}var Ed=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),_d=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(tt.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Sd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Od("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Id),Sd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(_d),xd=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Ed(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Sd(n._firestore,n._userDataWriter,r.key,r,new Ed(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new di(fi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Sd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ed(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Sd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ed(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:kd(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function kd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return wi()}}function Cd(t,e){return t instanceof _d&&e instanceof _d?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof xd&&e instanceof xd&&t._firestore===e._firestore&&Ff(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function jd(t){if(Mo(t)&&0===t.explicitOrderBy.length)throw new di(fi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ad=function(){};function Dd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(tt.c)(e,t),e.prototype._apply=function(t){var e=ed(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new di(fi.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Ud(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(Vd(r,t,h[c]));a={arrayValue:{values:u}}}else a=Vd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Ud(s,o),a=ld(n,"where",s,"in"===o||"not-in"===o);var l=bo.create(i,o,a);return function(t,e){if(e.g()){var n=Uo(t);if(null!==n&&!n.isEqual(e.field))throw new di(fi.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Vo(t);null!==r&&qd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new di(fi.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Df(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Ad),Rd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(tt.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new di(fi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new di(fi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new jo(e,n);return function(t,e){if(null===Vo(t)){var n=Uo(t);null!==n&&qd(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Df(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Ro(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Ad),Pd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(tt.c)(e,t),e.prototype._apply=function(t){return new Df(t.firestore,t.converter,Ko(t._query,this.Hc,this.Jc))},e}(Ad),Ld=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(tt.c)(e,t),e.prototype._apply=function(t){var e=Md(t,this.type,this.Yc,this.Xc);return new Df(t.firestore,t.converter,function(t,e){return new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Ad),Fd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(tt.c)(e,t),e.prototype._apply=function(t){var e=Md(t,this.type,this.Yc,this.Xc);return new Df(t.firestore,t.converter,function(t,e){return new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Ad);function Md(t,e,n,r){if(n[0]=Object(et.i)(n[0]),n[0]instanceof Id)return function(t,e,n,r,i){if(!r)throw new di(fi.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Bo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(ro(e,r.key));else{var c=r.data.field(u.field);if(Qi(c))throw new di(fi.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new di(fi.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new ko(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=ed(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new di(fi.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new di(fi.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!qo(t)&&-1!==c.indexOf("/"))throw new di(fi.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Ri.fromString(c));if(!Yi.isDocumentKey(h))throw new di(fi.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Yi(h);a.push(ro(e,l))}else{var f=ld(n,r,c);a.push(f)}}return new ko(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Vd(t,e,n){if("string"==typeof(n=Object(et.i)(n))){if(""===n)throw new di(fi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!qo(e)&&-1!==n.indexOf("/"))throw new di(fi.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Ri.fromString(n));if(!Yi.isDocumentKey(r))throw new di(fi.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ro(t,new Yi(r))}if(n instanceof Af)return ro(t,n._key);throw new di(fi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Sf(n)+".")}function Ud(t,e){if(!Array.isArray(t)||0===t.length)throw new di(fi.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new di(fi.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function qd(t,e,n){if(!n.isEqual(e))throw new di(fi.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Bd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Xi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return qi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Bi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw wi()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Ai(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Wf(qi(t.latitude),qi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Ki(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Gi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Ui(t);return new ki(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Ri.fromString(t);Ii(La(n));var r=new df(n.get(1),n.get(3)),i=new Yi(n.popFirst(5));return r.isEqual(e)||vi("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Qd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Kd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(tt.c)(e,t),e.prototype.convertBytes=function(t){return new zf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Af(this.firestore,null,e)},e}(Bd),Gd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=ed(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=zd(t,this._firestore),i=Qd(r.converter,e,n),o=nd(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,ps.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=zd(t,this._firestore);return o="string"==typeof(e=Object(et.i)(e))||e instanceof Gf?hd(this._dataReader,"WriteBatch.update",s._key,e,n,r):cd(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,ps.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=zd(t,this._firestore);return this._mutations=this._mutations.concat(new Cs(e._key,ps.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new di(fi.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function zd(t,e){if((t=Object(et.i)(t)).firestore!==e)throw new di(fi.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Hd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(tt.c)(e,t),e.prototype.convertBytes=function(t){return new zf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Af(this.firestore,null,e)},e}(Bd);function Wd(t,e,n){t=xf(t,Af);var r=xf(t.firestore,Uf),i=Qd(t.converter,e,n);return $d(r,[nd(ed(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,ps.none())])}function Yd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=xf(t,Af);var o=xf(t.firestore,Uf),s=ed(o);return $d(o,[("string"==typeof(e=Object(et.i)(e))||e instanceof Gf?hd(s,"updateDoc",t._key,e,n,r):cd(s,"updateDoc",t._key,e)).toMutation(t._key,ps.exists(!0))])}function Xd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(et.i)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||Vf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(Vf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Af)c=xf(t.firestore,Uf),h=Lo(t._key.path),u={next:function(e){i[a]&&i[a](Jd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=xf(t,Df);c=xf(d.firestore,Uf),h=d._query;var p=new Hd(c);u={next:function(t){i[a]&&i[a](new xd(c,p,d,t))},error:i[a+1],complete:i[a+2]},jd(t._query)}return function(t,e,n,r){var i=this,o=new Xl(r),s=new sl(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(i,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return e=el,[4,cf(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(i,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return e=nl,[4,cf(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(qf(c),h,l,u)}function $d(t,e){return function(t,e){var n=this,r=new su;return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(n,void 0,void 0,function(){var n;return Object(tt.d)(this,function(i){switch(i.label){case 0:return n=ml,[4,uf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(qf(t),e)}function Jd(t,e,n){var r=n.docs.get(e._key),i=new Hd(t);return new _d(t,i,e._key,r,new Ed(n.hasPendingWrites,n.fromCache),e.converter)}var Zd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(tt.c)(e,t),e.prototype.get=function(e){var n=this,r=zd(e,this._firestore),i=new Hd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new _d(n._firestore,i,r._key,t._document,new Ed(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=ed(t)}return t.prototype.get=function(t){var e=this,n=zd(t,this._firestore),r=new Kd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return wi();var i=t[0];if(i.isFoundDocument())return new Id(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Id(e._firestore,r,n._key,null,n.converter);throw wi()})},t.prototype.set=function(t,e,n){var r=zd(t,this._firestore),i=Qd(r.converter,e,n),o=nd(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=zd(t,this._firestore);return o="string"==typeof(e=Object(et.i)(e))||e instanceof Gf?hd(this._dataReader,"Transaction.update",s._key,e,n,r):cd(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=zd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function tp(){if("undefined"==typeof Uint8Array)throw new di(fi.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ep(){if("undefined"==typeof atob)throw new di(fi.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var np=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return ep(),new t(zf.fromBase64String(e))},t.fromUint8Array=function(e){return tp(),new t(zf.fromUint8Array(e))},t.prototype.toBase64=function(){return ep(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return tp(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),rp=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Kf(t=xf(t,Uf));var n=qf(t),r=t._freezeSettings(),i=new Yl;return Qf(n,i,new Hl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Kf(t=xf(t,Uf));var e=qf(t),n=t._freezeSettings(),r=new Yl;return Qf(e,r,new Wl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new di(fi.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new su;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(tt.b)(e,void 0,void 0,function(){var e;return Object(tt.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(tt.b)(this,void 0,void 0,function(){return Object(tt.d)(this,function(e){switch(e.label){case 0:return cu.yt()?[4,cu.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(wc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),ip=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof df||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||mi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=xf(t,jf))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&mi("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=$c.MOCK_USER;else{s=Object(et.e)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new di(fi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new $c(u)}t._credentials=new vf(new gf(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(tt.b)(e,void 0,void 0,function(){var e,n;return Object(tt.d)(this,function(r){switch(r.label){case 0:return[4,of(t)];case 1:return e=r.sent(),[4,af(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Ti(t);return e.Or.delete(0),Oh(e)}(n))]}})})})}(qf(xf(this._delegate,Uf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(tt.b)(e,void 0,void 0,function(){var e,n;return Object(tt.d)(this,function(r){switch(r.label){case 0:return[4,of(t)];case 1:return e=r.sent(),[4,af(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(tt.b)(this,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return(e=Ti(t)).Or.add(0),[4,Eh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(qf(xf(this._delegate,Uf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Of("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new su;return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(e,void 0,void 0,function(){var e;return Object(tt.d)(this,function(r){switch(r.label){case 0:return e=El,[4,uf(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(qf(xf(this._delegate,Uf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Xl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(n,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Ti(t).Gr.add(e),e.next()},[4,cf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(n,void 0,void 0,function(){var e;return Object(tt.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Ti(t).Gr.delete(e)},[4,cf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(qf(t=xf(t,Uf)),Vf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new di(fi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new mp(this,Rf(this._delegate,t))}catch(t){throw hp(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new cp(this,Pf(this._delegate,t))}catch(t){throw hp(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new gp(this,function(t,e){if(t=xf(t,jf),If("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new di(fi.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Df(t,null,function(t){return new Ro(Ri.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw hp(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new su;return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(n,void 0,void 0,function(){var n;return Object(tt.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return rf(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new Jl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(qf(t),function(n){return e(new Zd(t,n))})}(this._delegate,function(n){return t(new sp(e,n))})},t.prototype.batch=function(){var t=this;return qf(this._delegate),new ap(new Gd(this._delegate,function(e){return $d(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new di(fi.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new di(fi.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),op=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(tt.c)(e,t),e.prototype.convertBytes=function(t){return new np(new zf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return cp.eu(e,this.firestore,null)},e}(Bd),sp=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new op(t)}return t.prototype.get=function(t){var e=this,n=bp(t);return this._delegate.get(n).then(function(t){return new dp(e._firestore,new _d(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=bp(t);return n?(Tf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=bp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(tt.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=bp(t);return this._delegate.delete(e),this},t}(),ap=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=bp(t);return n?(Tf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=bp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(tt.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=bp(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),up=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Sd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new pp(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new op(e),n),i.set(n,o)),o},t}();up.su=new WeakMap;var cp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new op(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new di(fi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Af(n._delegate,r,new Yi(e)))},t.eu=function(e,n,r){return new t(n,new Af(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new mp(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new mp(this.firestore,Rf(this._delegate,t))}catch(t){throw hp(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(et.i)(t))instanceof Af&&Lf(this._delegate,t)},t.prototype.set=function(t,e){e=Tf("DocumentReference.set",e);try{return e?Wd(this._delegate,t,e):Wd(this._delegate,t)}catch(t){throw hp(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Yd(this._delegate,t):Yd.apply(void 0,Object(tt.f)([this._delegate,t,e],n))}catch(t){throw hp(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return $d(xf((t=this._delegate).firestore,Uf),[new Cs(t._key,ps.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=lp(e),i=fp(e,function(e){return new dp(t.firestore,new _d(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Xd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=xf(t,Af);var e=xf(t.firestore,Uf),n=qf(e),r=new Hd(e);return function(t,e){var n=this,r=new su;return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(n,void 0,void 0,function(){var n;return Object(tt.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i;return Object(tt.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Ti(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new di(fi.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Yh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,sf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new _d(e,r,t._key,n,new Ed(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=xf(t,Af);var e=xf(t.firestore,Uf);return hf(qf(e),t._key,{source:"server"}).then(function(n){return Jd(e,t,n)})}(this._delegate):function(t){t=xf(t,Af);var e=xf(t.firestore,Uf);return hf(qf(e),t._key).then(function(n){return Jd(e,t,n)})}(this._delegate)).then(function(t){return new dp(e.firestore,new _d(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?up.nu(this.firestore,e):null))},t}();function hp(t,e,n){return t.message=t.message.replace(e,n),t}function lp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Vf(r))return r}return{}}function fp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Vf(t[0])?t[0]:Vf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var dp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new cp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Cd(this._delegate,t._delegate)},t}(),pp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(tt.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(dp),gp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new op(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Dd(this._delegate,function(t,e,n){var r=e,i=Od("where",t);return new Nd(i,r,n)}(e,n,r)))}catch(e){throw hp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Dd(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Od("orderBy",t);return new Rd(r,n)}(e,n)))}catch(e){throw hp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Dd(this._delegate,function(t){return kf("limit",t),new Pd("limit",t,"F")}(e)))}catch(e){throw hp(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Dd(this._delegate,function(t){return kf("limitToLast",t),new Pd("limitToLast",t,"L")}(e)))}catch(e){throw hp(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ld("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw hp(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ld("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw hp(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Fd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw hp(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Fd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw hp(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Ff(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=xf(t,Df);var e=xf(t.firestore,Uf),n=qf(e),r=new Hd(e);return function(t,e){var n=this,r=new su;return t.asyncQueue.enqueueAndForget(function(){return Object(tt.b)(n,void 0,void 0,function(){var n;return Object(tt.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(tt.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(tt.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Pc(t,e,!0)];case 1:return a=u.sent(),r=new ll(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Yh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,sf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new xd(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=xf(t,Df);var e=xf(t.firestore,Uf),n=qf(e),r=new Hd(e);return lf(n,t._query,{source:"server"}).then(function(n){return new xd(e,r,t,n)})}(this._delegate):function(t){t=xf(t,Df);var e=xf(t.firestore,Uf),n=qf(e),r=new Hd(e);return jd(t._query),lf(n,t._query).then(function(n){return new xd(e,r,t,n)})}(this._delegate)).then(function(t){return new vp(e.firestore,new xd(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=lp(e),i=fp(e,function(e){return new vp(t.firestore,new xd(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Xd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?up.nu(this.firestore,e):null))},t}(),yp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new pp(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),vp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new gp(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new pp(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new yp(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new pp(n._firestore,r))})},t.prototype.isEqual=function(t){return Cd(this._delegate,t._delegate)},t}(),mp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(tt.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new cp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new cp(this.firestore,void 0===t?Pf(this._delegate):Pf(this._delegate,t))}catch(t){throw hp(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=xf(t.firestore,Uf),r=Pf(t),i=Qd(t.converter,e);return $d(n,[nd(ed(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,ps.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new cp(e.firestore,t)})},e.prototype.isEqual=function(t){return Lf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?up.nu(this.firestore,t):null))},e}(gp);function bp(t){return xf(t,Af)}var wp,Ip=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Gf.bind.apply(Gf,Object(tt.f)([void 0],t)))}return t.documentId=function(){return new t(Li.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(et.i)(t))instanceof Gf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Tp=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new od("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new rd("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sd("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ad("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new ud("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Op=a("/6Yf"),Ep={Firestore:ip,GeoPoint:Wf,Timestamp:ki,Blob:np,Transaction:sp,WriteBatch:ap,DocumentReference:cp,DocumentSnapshot:dp,Query:gp,QueryDocumentSnapshot:pp,QuerySnapshot:vp,CollectionReference:mp,FieldPath:Ip,FieldValue:Tp,setLogLevel:function(t){pi.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function _p(t,e){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.b;return new I.a(function(n){var r;return null!=e?e.schedule(function(){r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),function(){null!=r&&r()}})}(t,e)}function Sp(t,e){return _p(t,e).pipe(Object(v.a)(function(t){return{payload:t,type:"query"}}))}function xp(t,e){return Sp(t,e).pipe(Object(G.a)(void 0),H(),Object(v.a)(function(t){var e=u(t,2),n=e[0],r=e[1],i=r.payload.docChanges(),o=i.map(function(t){return{type:t.type,payload:t}});return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach(function(t,e){var r=i.find(function(e){return e.doc.ref.isEqual(t.ref)}),s=null==n?void 0:n.payload.docs.find(function(e){return e.ref.isEqual(t.ref)});r&&JSON.stringify(r.doc.metadata)===JSON.stringify(t.metadata)||!r&&s&&JSON.stringify(s.metadata)===JSON.stringify(t.metadata)||o.push({type:"modified",payload:{oldIndex:e,newIndex:e,type:"modified",doc:t}})}),o}))}function kp(t,e,n){return xp(t,n).pipe(Object(X.a)(function(t,n){return function(t,e,n){return e.forEach(function(e){n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Cp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){var n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Cp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Cp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(function(t){return t.payload}),e)},[]),function(t){return t.lift(new $(void 0,void 0))},Object(v.a)(function(t){return t.map(function(t){return{type:t.type,payload:t}})}))}function Cp(t,e,n){for(var r=t.slice(),i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return r.splice.apply(r,[e,n].concat(o)),r}function jp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}(function(t,e){t.INTERNAL.registerComponent(new Op.a("firestore",function(t){return function(t,e){return new ip(t,new Uf(t,e),new rp)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Ep)))})(wp=Z.a),wp.registerVersion("@firebase/firestore","2.4.1");var Ap=function(){function t(e,n,r){p(this,t),this.ref=e,this.query=n,this.afs=r}return f(t,[{key:"stateChanges",value:function(t){var e=xp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(v.a)(function(e){return e.filter(function(e){return t.indexOf(e.type)>-1})}))),e.pipe(Object(G.a)(void 0),H(),Object(C.a)(function(t){var e=u(t,2),n=e[0];return e[1].length>0||!n}),Object(v.a)(function(t){var e=u(t,2);e[0];return e[1]}),this.afs.keepUnstableUntilFirst)}},{key:"auditTrail",value:function(t){return this.stateChanges(t).pipe(Object(X.a)(function(t,e){return[].concat(n(t),n(e))},[]))}},{key:"snapshotChanges",value:function(t){var e=jp(t);return kp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Sp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(v.a)(function(n){return n.payload.docs.map(function(n){return t.idField?Object.assign(Object.assign({},n.data()),e({},t.idField,n.id)):n.data()})}),this.afs.keepUnstableUntilFirst)}},{key:"get",value:function(t){return Object(T.a)(this.query.get(t)).pipe(Object(E.b)(this.afs.schedulers.insideAngular))}},{key:"add",value:function(t){return this.ref.add(t)}},{key:"doc",value:function(t){return new Dp(this.ref.doc(t),this.afs)}}]),t}(),Dp=function(){function t(e,n){p(this,t),this.ref=e,this.afs=n}return f(t,[{key:"set",value:function(t,e){return this.ref.set(t,e)}},{key:"update",value:function(t){return this.ref.update(t)}},{key:"delete",value:function(){return this.ref.delete()}},{key:"collection",value:function(t,e){var n=Mp(this.ref.collection(t),e),r=n.ref,i=n.query;return new Ap(r,i,this.afs)}},{key:"snapshotChanges",value:function(){return _p(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(G.a)(void 0),H(),Object(v.a)(function(t){var e=u(t,2),n=e[0],r=e[1];return r.exists?(null==n?void 0:n.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}})).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.snapshotChanges().pipe(Object(v.a)(function(n){var r=n.payload;return t.idField?Object.assign(Object.assign({},r.data()),e({},t.idField,r.id)):r.data()}))}},{key:"get",value:function(t){return Object(T.a)(this.ref.get(t)).pipe(Object(E.b)(this.afs.schedulers.insideAngular))}}]),t}(),Np=function(){function t(e,n){p(this,t),this.query=e,this.afs=n}return f(t,[{key:"stateChanges",value:function(t){return t&&0!==t.length?xp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(v.a)(function(e){return e.filter(function(e){return t.indexOf(e.type)>-1})}),Object(C.a)(function(t){return t.length>0}),this.afs.keepUnstableUntilFirst):xp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"auditTrail",value:function(t){return this.stateChanges(t).pipe(Object(X.a)(function(t,e){return[].concat(n(t),n(e))},[]))}},{key:"snapshotChanges",value:function(t){var e=jp(t);return kp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Sp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(v.a)(function(n){return n.payload.docs.map(function(n){return t.idField?Object.assign(e({},t.idField,n.id),n.data()):n.data()})}),this.afs.keepUnstableUntilFirst)}},{key:"get",value:function(t){return Object(T.a)(this.query.get(t)).pipe(Object(E.b)(this.afs.schedulers.insideAngular))}}]),t}(),Rp=new d.r("angularfire2.enableFirestorePersistence"),Pp=new d.r("angularfire2.firestore.persistenceSettings"),Lp=new d.r("angularfire2.firestore.settings"),Fp=new d.r("angularfire2.firestore.use-emulator");function Mp(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t};return{query:e(t),ref:t}}var Vp,Up,qp,Bp=((Up=function(){function t(e,r,i,o,s,a,c,l,f){p(this,t),this.schedulers=new j.d(a),this.keepUnstableUntilFirst=Object(j.h)(this.schedulers);var d=Object(j.g)(e,a,r);!B.a.auth&&f&&Object(j.j)();var y=l,v=u(Object(j.f)("".concat(d.name,".firestore"),"AngularFirestore",d,function(){var t=a.runOutsideAngular(function(){return d.firestore()});return o&&t.settings(o),y&&t.useEmulator.apply(t,n(y)),i&&!Object(h.s)(s)?[t,a.runOutsideAngular(function(){try{return Object(T.a)(t.enablePersistence(c||void 0).then(function(){return!0},function(){return!1}))}catch(wp){return"undefined"!=typeof console&&console.warn(wp),Object(g.a)(!1)}})]:[t,Object(g.a)(!1)]},[o,y,i]),2);this.firestore=v[0],this.persistenceEnabled$=v[1]}return f(t,[{key:"collection",value:function(t,e){var n=Mp("string"==typeof t?this.firestore.collection(t):t,e),r=n.ref,i=n.query,o=this.schedulers.ngZone.run(function(){return r});return new Ap(o,i,this)}},{key:"collectionGroup",value:function(t,e){var n=e||function(t){return t},r=this.firestore.collectionGroup(t);return new Np(n(r),this)}},{key:"doc",value:function(t){var e;e="string"==typeof t?this.firestore.doc(t):t;var n=this.schedulers.ngZone.run(function(){return e});return new Dp(n,this)}},{key:"createId",value:function(){return this.firestore.collection("_").doc().id}}]),t}()).\u0275fac=function(t){return new(t||Up)(d.Vb(j.c),d.Vb(j.b,8),d.Vb(Rp,8),d.Vb(Lp,8),d.Vb(d.C),d.Vb(d.A),d.Vb(Pp,8),d.Vb(Fp,8),d.Vb(A,8))},Up.\u0275prov=d.Hb({factory:function(){return new Up(d.Vb(j.c),d.Vb(j.b,8),d.Vb(Rp,8),d.Vb(Lp,8),d.Vb(d.C),d.Vb(d.A),d.Vb(Pp,8),d.Vb(Fp,8),d.Vb(A,8))},token:Up,providedIn:"any"}),Up),Qp=((Vp=function(){function t(e,n,r){p(this,t),this.auth=e,this.router=n,this.firestore=r,this.db=this.firestore.collection("users"),this.authUser=this.auth.user}return f(t,[{key:"login",value:function(){var t=this;return this.auth.signInWithPopup(new B.a.auth.GoogleAuthProvider).then(function(e){t.authUser=t.auth.user,t.router.navigateByUrl("/user/profile")})}},{key:"logout",value:function(){var t=this;this.auth.signOut().then(function(e){t.router.navigateByUrl("/")})}},{key:"createUser",value:function(t){var e=this.db.doc(t.uid),n=this.getCurrentTime(),r=Q.User,i={id:t.uid,name:t.displayName,auth_data:[Object.assign({},t.providerData[0])],email:t.email,image_url:t.photoURL,level:r,created_time:n,last_login:n,max_card_limit:5,max_card_edit_limit:1e3,total_card:0,total_card_edit:0};e.set(i)}},{key:"createRealfarmInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe(function(r){var i=r.data();if(i.total_card<i.max_card_limit&&i.total_card_edit<i.max_card_edit_limit){var o=n.getUID(),s=n.getCurrentTime(),a=Object.assign(Object.assign({},e),{id:o,uid:i.name,last_update:s,created_time:s});n.db.doc(t).collection("realfarms").doc(o).set(a),n.updateUser(t,"total_card",i.total_card+1)}})}},{key:"updateUser",value:function(t,e,n){var r=this.db.doc(t),i={};i[e]=n,r.update(i)}},{key:"upateRealFamrInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe(function(r){var i=r.data();if(i.total_card_edit<i.max_card_edit_limit){n.getUID();var o=n.getCurrentTime(),s=Object.assign(Object.assign({},e),{id:e.id,uid:e.uid,last_update:o,created_time:e.created_time});n.db.doc(t).collection("realfarms").doc(e.id).update(s),n.updateUser(t,"total_card_edit",i.total_card_edit+1)}})}},{key:"deleteRealFarmInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe(function(r){var i=r.data();n.db.doc(t).collection("realfarms").doc(e.id).delete(),n.updateUser(t,"total_card",i.total_card-1)})}},{key:"updateUserCollection",value:function(t,e,n){this.db.doc(t).collection(e).doc(n.id).update(n)}},{key:"getCurrentTime",value:function(){var t=new Date;return t.toDateString()+" "+t.toTimeString()}},{key:"getUID",value:function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)}}]),t}()).\u0275fac=function(t){return new(t||Vp)(d.Vb(F),d.Vb(l.c),d.Vb(Bp))},Vp.\u0275prov=d.Hb({token:Vp,factory:Vp.\u0275fac,providedIn:"any"}),Vp),Kp=a("jhN1"),Gp=a("320Y"),zp=((qp=function(){function t(e,n,r){p(this,t),this.user=e,this.title=n,this.meta=r}return f(t,[{key:"ngOnInit",value:function(){this.updateHeader()}},{key:"login",value:function(){this.user.login()}},{key:"updateHeader",value:function(){this.title.setTitle("\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"),this.meta.updateTag({name:"description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({name:"apple-mobile-web-app-title",content:"\u500b\u4eba\u8cc7\u8a0a  | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:title",content:"\u500b\u4eba\u8cc7\u8a0a  | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({property:"og:image",content:"https://bobosheep.github.io/farm-tool/assets/DisplayRealFarmCard.jpg"}),this.meta.updateTag({property:"og:url",content:"https://bobosheep.github.io/farm-tool/user/"})}}]),t}()).\u0275fac=function(t){return new(t||qp)(d.Lb(Qp),d.Lb(Kp.d),d.Lb(Kp.c))},qp.\u0275cmp=d.Fb({type:qp,selectors:[["app-login"]],decls:6,vars:4,consts:[["title","\u6b61\u8fce\u4f86\u5230\u500b\u4eba\u9801\u9762","subtitle","\u8acb\u767b\u5165\u4ee5\u7e7c\u7e8c\u4f7f\u7528",3,"showBackIcon","showCustomIcon"],[1,"container"],["id","googleBtn",1,"button",3,"click"],["src","/assets/others/g-logo.png",3,"width","height"]],template:function(t,e){1&t&&(d.Mb(0,"app-header",0),d.Rb(1,"section",1),d.Rb(2,"button",2),d.Yb("click",function(){return e.login()}),d.Mb(3,"img",3),d.Rb(4,"span"),d.vc(5,"\u4f7f\u7528 Google \u767b\u5165"),d.Qb(),d.Qb(),d.Qb()),2&t&&(d.gc("showBackIcon",!1)("showCustomIcon",!1),d.Bb(3),d.gc("width",18)("height",18))},directives:[Gp.a],styles:[".container[_ngcontent-%COMP%]{display:flex;width:90%;margin:16px auto;justify-content:center}#googleBtn[_ngcontent-%COMP%]{display:flex;width:-moz-fit-content;width:fit-content;border:0;border-radius:2px;padding:11px 8px}#googleBtn[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{height:18px;width:18px;padding-right:24px}#googleBtn[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{cursor:inherit;height:18px;font-size:14px;color:rgba(0,0,0,.54);font-weight:600;display:inline-block;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}"]}),qp),Hp=a("wHSu"),Wp=a("6NWb"),Yp=function(){function t(){p(this,t)}return f(t,null,[{key:"drawRect",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#FFFFF",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"#333333";t.fillStyle=o,t.fillRect(e,n,r,i),s>0&&(t.strokeStyle=a,t.lineWidth=s,t.strokeRect(e,n,r,i))}},{key:"drawRoundRect",value:function(t,e,n,r,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#FFFFFF",a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"#333333";r<2*o&&(o=r/2),i<2*o&&(o=i/2),t.fillStyle=s,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.fill(),a>0&&(t.strokeStyle=u,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.stroke())}},{key:"addImage",value:function(t,e,n,r,i,o){var s=new Image;s.onload=function(){t.drawImage(s,n,r,i,o)},s.src=e}},{key:"addImageSource",value:function(t,e,n,r,i,o){t.drawImage(e,n,r,i,o)}},{key:"addText",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#333333",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500;t.font="".concat(s," ").concat(i,"px sans-serif"),t.fillStyle=o,t.fillText(e,n,r+i)}}]),t}(),Xp=f(function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5?arguments[5]:void 0;p(this,t),this.canvas=s,this.x=e,this.y=n,this.width=r,this.height=i,this.scale=o}),$p=function(t){r(n,t);var e=o(n);function n(t,r,i,o){var s,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,u=arguments.length>5?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"#FEFEFE",f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"#333333";return p(this,n),(s=e.call(this,t,r,i,o,a,u)).bgColor=l,s.borderWidth=c,s.borderRadius=h,s.borderColor=f,s.width<2*s.borderRadius&&(s.borderRadius=s.width/2),s.height<2*s.borderRadius&&(s.borderRadius=s.height/2),s}return f(n,[{key:"draw",value:function(){this.borderRadius>0?this.drawRoundRect():this.drawRect()}},{key:"drawRect",value:function(){Yp.drawRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}},{key:"drawRoundRect",value:function(){Yp.drawRoundRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.borderRadius*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}}]),n}(Xp),Jp=function(t){r(n,t);var e=o(n);function n(t,r,i){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000000",c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:12,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:500;return p(this,n),(o=e.call(this,r,i,0,0,s,a)).text=t,o.color=u,o.fontSize=c,o.fontWeight=h,o}return f(n,[{key:"draw",value:function(){Yp.addText(this.canvas,this.text,this.x*this.scale,this.y*this.scale,this.fontSize*this.scale,this.color,this.fontWeight)}}]),n}(Xp),Zp=function(t){r(n,t);var e=o(n);function n(t,r,i,o,s){var a,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,c=arguments.length>6?arguments[6]:void 0;return p(this,n),(a=e.call(this,r,i,o,s,u,c)).src=t,a}return f(n,[{key:"draw",value:function(){Yp.addImage(this.canvas,this.src,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale)}}]),n}(Xp);function tg(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500;return t.font="".concat(r," ").concat(n,"px sans-serif"),t.measureText(e).width}var eg,ng,rg=function(t){return t[t.default=0]="default",t}({}),ig=function(){var t=f(function t(){p(this,t),this.scale=4,this.titleFont=16,this.detailFont=12,this.footnoteFont=11,this.font={title:{size:16,weight:700},content:{size:12,weight:600},footnote:{size:11,weight:500}},this.card={x:0,y:0,w:320,h:180,borderRadius:12,border:1,padding:{v:12,h:12}},this.greet={x:this.card.padding.h,y:64,w:296,h:88,borderRadius:8,border:0,padding:{v:6,h:8},maxLine:5,lineHeight:16,fontSize:12,fontWeight:600},this.logoText={x:236,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.userIDText={x:this.card.padding.h,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.levelText={x:this.card.padding.h,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.gameIdText={x:this.card.padding.h,y:32,size:this.font.title.size,weight:this.font.title.weight},this.favoriteText={x:125,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.favoriteImg={max:3,x:125,y:32,w:20,h:20},this.logoImg={x:288,y:156,w:20,h:20}});return t.getLayout=function(e){return new t},t}(),og=function(t){return t[t.primary=0]="primary",t[t.secondary=1]="secondary",t[t.skyBlue=2]="skyBlue",t}({}),sg=function(t){return t.black="#333333",t.white="#FFFFFF",t.green="#459C7F",t.light_green="#F0FFFA",t.orange="#E4766A",t.light_orange="#FFE9E7",t.blue="#368FD4",t.light_blue="#DDF1FF",t}({}),ag=function(){var t=f(function t(){p(this,t),this.primaryColor=sg.green,this.secondaryColor=sg.light_green,this.contentColor=sg.black,this.contentBgColor=sg.white});return t.getTheme=function(e){var n=new t;switch(e){case og.primary:n.primaryColor=sg.green,n.secondaryColor=sg.light_green;break;case og.secondary:n.primaryColor=sg.orange,n.secondaryColor=sg.light_orange;break;case og.skyBlue:n.primaryColor=sg.blue,n.secondaryColor=sg.light_blue;break;default:n.primaryColor=sg.green,n.secondaryColor=sg.light_green}return n},t}(),ug=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rg.default,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:og.primary;p(this,t),this.info=e,this.layout=ig.getLayout(n),this.theme=ag.getTheme(r),this.canvasObjects=[]}return f(t,[{key:"resetCanvas",value:function(){this.canvasObjects=[]}},{key:"genBlocks",value:function(t){var e=this.genCardBlock(t),n=this.genGreetingBlock(t);this.canvasObjects.push(e),this.canvasObjects.push(n)}},{key:"genCardBlock",value:function(t){return new $p(this.layout.card.x,this.layout.card.y,this.layout.card.w,this.layout.card.h,this.layout.scale,t,this.layout.card.border,this.layout.card.borderRadius,this.theme.secondaryColor,this.theme.primaryColor)}},{key:"genGreetingBlock",value:function(t){return new $p(this.layout.greet.x,this.layout.greet.y,this.layout.greet.w,this.layout.greet.h,this.layout.scale,t,this.layout.greet.border,this.layout.greet.borderRadius,this.theme.contentBgColor,this.theme.contentBgColor)}},{key:"genTexts",value:function(t){var e,r=this.genLogoText(t,"Create by"),i=this.genUserText(t,"ID: ".concat(this.info.uid)),o=this.genLevelText(t,"Lv. ".concat(this.info.level)),s=this.genGameIDText(t,this.info.gid),a=this.genFavoriteText(t,"\u6211\u7684\u6700\u611b"),u=this.genGreetingText(t,this.info.greeting);this.canvasObjects.push(r),this.canvasObjects.push(i),this.canvasObjects.push(o),this.canvasObjects.push(s),this.canvasObjects.push(a),(e=this.canvasObjects).push.apply(e,n(u))}},{key:"genLogoText",value:function(t,e){return new Jp(e,this.layout.logoText.x,this.layout.logoText.y,this.layout.scale,t,this.theme.contentColor,this.layout.logoText.size,this.layout.logoText.weight)}},{key:"genUserText",value:function(t,e){return new Jp(e,this.layout.userIDText.x,this.layout.userIDText.y,this.layout.scale,t,this.theme.contentColor,this.layout.userIDText.size,this.layout.userIDText.weight)}},{key:"genLevelText",value:function(t,e){return new Jp(e,this.layout.levelText.x,this.layout.levelText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.levelText.size,this.layout.levelText.weight)}},{key:"genGameIDText",value:function(t,e){return new Jp(e,this.layout.gameIdText.x,this.layout.gameIdText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.gameIdText.size,this.layout.gameIdText.weight)}},{key:"genFavoriteText",value:function(t,e){return new Jp(e,this.layout.favoriteText.x,this.layout.favoriteText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.favoriteText.size,this.layout.favoriteText.weight)}},{key:"genGreetingText",value:function(t,e){for(var n=this,r=this.layout.greet.maxLine,i=this.layout.greet.x+this.layout.greet.padding.h,o=this.layout.greet.y+this.layout.greet.padding.v,s=this.layout.greet.w-2*this.layout.greet.padding.h,a=this.layout.greet.lineHeight,u=this.layout.font.content.size,c=this.layout.font.content.weight,h=0,l=e.length,f=[],d=0;d<r;d++){var p=e.indexOf("\n",h),g=Math.round((h+l+1)/2),y=e.slice(h,l),v=tg(t,y,u,c);if(h>=e.length)break;if(v<s)g=l;else{for(y=e.slice(h,g),v=tg(t,y,u,c);g<l&&v<=s;)g+=1,y=e.slice(h,g),v=tg(t,y,u,c);for(;g>=0&&v>s;)g-=1,y=e.slice(h,g),v=tg(t,y,u,c)}-1!=p&&p<g&&(g=p+1),f.push(e.slice(h,g)),h=g}return f.map(function(e,r){return new Jp(e,i,o+r*a,n.layout.scale,t,n.theme.contentColor,u,c)})}},{key:"genImages",value:function(t,e,r){var i;this.canvasObjects.push(this.genLogoImg(t,e)),(i=this.canvasObjects).push.apply(i,n(this.genFavoriteItemsImg(t,r)))}},{key:"genLogoImg",value:function(t,e){return new Zp(e,this.layout.logoImg.x,this.layout.logoImg.y,this.layout.logoImg.w,this.layout.logoImg.h,this.layout.scale,t)}},{key:"genFavoriteItemsImg",value:function(t,e){var n=this,r=this.layout.favoriteImg.x,i=this.layout.favoriteImg.y,o=this.layout.favoriteImg.w,s=this.layout.favoriteImg.h;return e.map(function(e,a){return new Zp(e,r+a*o,i,o,s,n.layout.scale,t)})}},{key:"draw",value:function(){this.canvasObjects.forEach(function(t){t.draw()})}}]),t}(),cg=a("kvnP"),hg=a("m7U+"),lg=["cardCanvas"],fg=["downloadButton"],dg=((ng=function(){function e(t,n,r){p(this,e),this.consumableServ=t,this.cropServ=n,this.document=r,this.layout=rg.default,this.theme=og.primary,this.logoImg="assets/icons/LOGO-71x71.png",this.isEditing=!1,this.onEdit=new d.n,this.onDelete=new d.n,this.closeSettingIcon=Hp.tb,this.settingIcon=Hp.D,this.editIcon=Hp.C,this.shareIcon=Hp.kb,this.updateThemeIcon=Hp.ab,this.copyIcon=Hp.r,this.downloadIcon=Hp.B,this.deleteIcon=Hp.wb,this.window=this.document.defaultView}return f(e,[{key:"ngOnInit",value:function(){this.isEditing=!1,this.realfarmCard=new ug(this.data,rg.default,this.theme),this.filename=this.data.gid+"_RealFarm\u5c0f\u5e6b\u624b.png"}},{key:"ngAfterViewInit",value:function(){this.context=this.canvas.nativeElement.getContext("2d"),this.drawCard()}},{key:"drawCard",value:function(){var t=this;this.realfarmCard=new ug(this.data,rg.default,this.theme),this.realfarmCard.genBlocks(this.context),this.realfarmCard.genTexts(this.context),this.realfarmCard.genImages(this.context,this.logoImg,this.data.favorites.map(function(e,n){return n>=t.realfarmCard.layout.favoriteImg.max?"":t.cropServ.searchSeed(e)?t.cropServ.searchSeed(e).img:t.consumableServ.searchConsumable(e)[0].img})),this.realfarmCard.draw(),this.link2Canvas()}},{key:"link2Canvas",value:function(){this.downloadBtn.nativeElement.href=this.canvas.nativeElement.toDataURL("image/png")}},{key:"shareCard",value:function(){return Object(tt.b)(this,void 0,void 0,t().mark(function e(){var n,r;return t().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.link2Canvas(),t.next=3,fetch(this.downloadBtn.nativeElement.href);case 3:return t.next=5,t.sent.blob();case 5:return n=t.sent,r=Object({files:[new File([n],this.filename,{type:n.type,lastModified:(new Date).getTime()})]}),t.prev=7,t.next=10,this.window.navigator.share(r);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(7),20!==t.t0.code&&alert("[".concat(t.t0.code,"] \u6b64\u700f\u89bd\u5668\u7248\u672c\u5206\u4eab\u529f\u80fd\u51fa\u4e86\u9ede\u554f\u984c\ud83d\ude25"));case 15:case"end":return t.stop()}},e,this,[[7,12]])}))}},{key:"copyImage",value:function(){}},{key:"editInfo",value:function(){this.isEditing=!1,this.onEdit.emit(this.data.id)}},{key:"deleteCard",value:function(){this.isEditing=!1,this.onDelete.emit(this.data.id)}},{key:"switchEditButtons",value:function(){this.isEditing=!this.isEditing}},{key:"updateTheme",value:function(){switch(this.theme){case og.primary:this.theme=og.secondary;break;case og.secondary:this.theme=og.skyBlue;break;case og.skyBlue:this.theme=og.primary}this.drawCard()}}]),e}()).\u0275fac=function(t){return new(t||ng)(d.Lb(cg.a),d.Lb(hg.a),d.Lb(h.d))},ng.\u0275cmp=d.Fb({type:ng,selectors:[["app-realfarm-card"]],viewQuery:function(t,e){var n;1&t&&(d.Ac(lg,1),d.Ac(fg,1)),2&t&&(d.lc(n=d.Zb())&&(e.canvas=n.first),d.lc(n=d.Zb())&&(e.downloadBtn=n.first))},inputs:{data:"data"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:28,vars:12,consts:[[1,"container"],["id","card-canvas",2,"width","100%",3,"width","height","click"],["cardCanvas",""],[1,"mask",3,"ngClass"],[1,"icon-button","settings",3,"ngClass","click"],[3,"icon"],[1,"wrapper","animation",3,"ngClass"],[1,"icon-button","updateTheme",3,"click"],[1,"icon-button","edit",3,"click"],[1,"icon-button","download",3,"download","click"],["downloadButton",""],[1,"icon-button","delete",3,"click"]],template:function(t,e){1&t&&(d.Rb(0,"div",0),d.Rb(1,"canvas",1,2),d.Yb("click",function(){return e.editInfo()}),d.Qb(),d.Mb(3,"div",3),d.Rb(4,"div",4),d.Yb("click",function(){return e.switchEditButtons()}),d.Mb(5,"fa-icon",5),d.Qb(),d.Rb(6,"div",6),d.Rb(7,"a",7),d.Yb("click",function(){return e.updateTheme()}),d.Mb(8,"fa-icon",5),d.Rb(9,"span"),d.vc(10,"\u66f4\u63db\u4e3b\u984c"),d.Qb(),d.Qb(),d.Rb(11,"a",8),d.Yb("click",function(){return e.shareCard()}),d.Mb(12,"fa-icon",5),d.Rb(13,"span"),d.vc(14,"\u5206\u4eab\u5361\u7247"),d.Qb(),d.Qb(),d.Rb(15,"a",8),d.Yb("click",function(){return e.editInfo()}),d.Mb(16,"fa-icon",5),d.Rb(17,"span"),d.vc(18,"\u7de8\u8f2f"),d.Qb(),d.Qb(),d.Rb(19,"a",9,10),d.Yb("click",function(){return e.link2Canvas()}),d.Mb(21,"fa-icon",5),d.Rb(22,"span"),d.vc(23,"\u5132\u5b58"),d.Qb(),d.Qb(),d.Rb(24,"a",11),d.Yb("click",function(){return e.deleteCard()}),d.Mb(25,"fa-icon",5),d.Rb(26,"span"),d.vc(27,"\u522a\u9664"),d.Qb(),d.Qb(),d.Qb(),d.Qb()),2&t&&(d.Bb(1),d.gc("width",e.realfarmCard.layout.card.w*e.realfarmCard.layout.scale)("height",e.realfarmCard.layout.card.h*e.realfarmCard.layout.scale),d.Bb(2),d.gc("ngClass",e.isEditing?"open":""),d.Bb(1),d.gc("ngClass",e.isEditing?"closeSettings":""),d.Bb(1),d.gc("icon",e.isEditing?e.closeSettingIcon:e.settingIcon),d.Bb(1),d.gc("ngClass",e.isEditing?"open":""),d.Bb(2),d.gc("icon",e.updateThemeIcon),d.Bb(4),d.gc("icon",e.shareIcon),d.Bb(4),d.gc("icon",e.editIcon),d.Bb(3),d.gc("download",e.filename),d.Bb(2),d.gc("icon",e.downloadIcon),d.Bb(4),d.gc("icon",e.deleteIcon))},directives:[h.j,Wp.a],styles:[".container[_ngcontent-%COMP%]{min-width:320px;max-width:400px;min-height:180px;max-height:225px;width:80%;height:80%;margin:0 auto;position:relative;aspect-ratio:16/9}.wrapper[_ngcontent-%COMP%]{margin:0 auto;display:flex;align-items:flex-end;justify-content:center;position:absolute;flex-direction:column;right:0;top:28px;transform:translateY(-50%) scaleY(0);z-index:0}.wrapper.open[_ngcontent-%COMP%]{transform:translateY(0) scaleY(1);z-index:5}.icon-button[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:28px;margin:4px;padding:4px 12px;border-radius:8px;align-items:center;justify-content:space-around;display:inline-flex;box-shadow:0 2px 8px 4px rgba(0,0,0,.15);background-color:var(--white)}.icon-button[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.icon-button[_ngcontent-%COMP%]:hover, .icon-button[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{cursor:pointer}.icon-button.settings[_ngcontent-%COMP%]{position:absolute;right:0;top:-20px;width:28px;height:28px;padding:4px;border-radius:50%;z-index:4}.icon-button.settings.closeSettings[_ngcontent-%COMP%]{z-index:6}.mask[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;background:rgba(0,0,0,.3);border-radius:12px;transform:scale(0)}.mask.open[_ngcontent-%COMP%]{transform:scale(1)}.animation[_ngcontent-%COMP%]{transition:.2s ease-in}.delete[_ngcontent-%COMP%]{color:var(--danger)}"]}),ng),pg=((eg=function(){function t(){p(this,t)}return f(t,[{key:"ngOnInit",value:function(){}}]),t}()).\u0275fac=function(t){return new(t||eg)},eg.\u0275cmp=d.Fb({type:eg,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"wrapper"],[1,"loader"]],template:function(t,e){1&t&&(d.Rb(0,"div",0),d.Mb(1,"span",1),d.Qb())},styles:['.wrapper[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;display:flex;justify-content:center;align-items:center}.loader[_ngcontent-%COMP%]{width:48px;height:48px;border:10px solid var(--light-gray);position:relative;transform:rotate(45deg)}.loader[_ngcontent-%COMP%], .loader[_ngcontent-%COMP%]:before{border-radius:50%;box-sizing:border-box}.loader[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:-10px;border:10px solid var(--secondary);animation:prixClipFix 2s linear infinite}@keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}']}),eg),gg=a("0zEo"),yg=function(t){return t[t.Unknown=0]="Unknown",t[t.Male=1]="Male",t[t.Female=2]="Female",t}({}),vg=a("3Pt+");function mg(t,e){if(1&t&&(d.Rb(0,"option",23),d.vc(1),d.Qb()),2&t){var n=e.$implicit;d.gc("value",n.name),d.Bb(1),d.xc(" ",n.name," ")}}function bg(t,e){if(1&t){var n=d.Sb();d.Rb(0,"div",9),d.Rb(1,"select",20),d.Yb("ngModelChange",function(t){return d.nc(n),d.ac().favorite=t}),d.tc(2,mg,2,2,"option",21),d.Qb(),d.Rb(3,"button",22),d.Yb("click",function(){return d.nc(n),d.ac().addFavorites()}),d.Mb(4,"fa-icon",18),d.Qb(),d.Qb()}if(2&t){var r=d.ac();d.Bb(1),d.gc("ngModel",r.favorite),d.Bb(1),d.gc("ngForOf",r.displayObjs),d.Bb(2),d.gc("icon",r.addIcon)}}function wg(t,e){if(1&t){var n=d.Sb();d.Rb(0,"div",24),d.Mb(1,"img",25),d.Rb(2,"fa-icon",26),d.Yb("click",function(){d.nc(n);var t=e.$implicit;return d.ac().removeFavorite(t)}),d.Qb(),d.Qb()}if(2&t){var r=e.$implicit,i=d.ac();d.Bb(1),d.gc("src",i.getImg(r),d.pc)("height",28)("alt",r+"\u7684\u5716\u7247"),d.Bb(1),d.gc("icon",i.closeIcon)}}var Ig,Tg=((Ig=function(){function t(e,n){p(this,t),this.cs=e,this.is=n,this.done=new d.n,this.cancel=new d.n,this.addIcon=Hp.bb,this.closeIcon=Hp.ub,this.cancelIcon=Hp.tb,this.doneIcon=Hp.k}return f(t,[{key:"ngOnInit",value:function(){var t=this.cs.getAllCrops().map(function(t){return{name:t.name,img:t.img,group:"\u4f5c\u7269"}}),e=this.is.getAllConsumables().map(function(t){return{name:t.name,img:t.img,group:t.group}});this.realfarmObjs=[].concat(n(t),n(e)),null==this.data&&(this.data={id:"",uid:"",gid:"",greeting:"",level:10,gender:yg.Male,is_primary:!1,favorites:[]}),this.updateObjList()}},{key:"isMale",value:function(){return this.data.gender===yg.Male}},{key:"updateGender",value:function(t){this.data.gender=t?yg.Male:yg.Female}},{key:"updateObjList",value:function(){var t=this;this.displayObjs=this.realfarmObjs.filter(function(e){return!t.data.favorites.includes(e.name)}),this.favorite=this.displayObjs[0].name}},{key:"addFavorites",value:function(){console.log(this.data),this.data.favorites=[].concat(n(this.data.favorites),[this.favorite]),this.data=Object.assign({},this.data),this.updateObjList()}},{key:"removeFavorite",value:function(t){this.data.favorites=this.data.favorites.filter(function(e){return e!==t}),this.data=Object.assign({},this.data),this.updateObjList()}},{key:"getImg",value:function(t){var e=this.realfarmObjs.filter(function(e){return e.name===t});return e.length>0?e[0].img:""}},{key:"doDone",value:function(){this.done.emit(this.data)}},{key:"doCancel",value:function(){this.cancel.emit(!0)}}]),t}()).\u0275fac=function(t){return new(t||Ig)(d.Lb(hg.a),d.Lb(cg.a))},Ig.\u0275cmp=d.Fb({type:Ig,selectors:[["app-realfarm-form"]],inputs:{data:"data"},outputs:{cancel:"cancel",done:"done"},decls:52,vars:11,consts:[[1,"wrapper"],[1,"header"],[1,"info"],[1,"form"],[1,"group"],[1,"title"],[1,"element","horizontal"],["type","text","name","gid",1,"value",3,"ngModel","ngModelChange"],["type","number","step","1","name","level",1,"value",3,"ngModel","ngModelChange"],[1,"value"],["type","radio","name","gender",3,"checked","change"],["class","value",4,"ngIf"],[1,"element","item-list"],["class","item",4,"ngFor","ngForOf"],[1,"element","vertical"],["rows","5","name","greeting","maxlength","200",1,"value",3,"ngModel","ngModelChange"],[1,"actions"],[1,"button","cancel",3,"click"],[3,"icon"],[1,"button","submit",3,"click"],["name","favorite",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"button","add","item",3,"click"],[3,"value"],[1,"item"],[3,"src","height","alt"],[1,"close",3,"icon","click"]],template:function(t,e){1&t&&(d.Rb(0,"section",0),d.Rb(1,"h1",1),d.vc(2),d.Qb(),d.Rb(3,"div",2),d.vc(4,"\u5efa\u7acb/\u7de8\u8f2f\u81ea\u5df1\u7684\u904a\u6232\u8cc7\u8a0a\uff0c\u4e14\u53ef\u4ee5\u4e0b\u8f09\u5716\u7247\u5f8c\u5206\u4eab\u7d66\u5176\u4ed6\u8fb2\u53cb"),d.Qb(),d.Qb(),d.Rb(5,"section",0),d.Rb(6,"form",3),d.Rb(7,"section",4),d.Rb(8,"h2",5),d.vc(9,"\u904a\u6232\u57fa\u672c\u8cc7\u8a0a"),d.Qb(),d.Rb(10,"label",6),d.Rb(11,"span",5),d.vc(12,"\u904a\u6232 ID"),d.Qb(),d.Rb(13,"input",7),d.Yb("ngModelChange",function(t){return e.data.gid=t}),d.Qb(),d.Qb(),d.Rb(14,"label",6),d.Rb(15,"span",5),d.vc(16,"\u7b49\u7d1a"),d.Qb(),d.Rb(17,"input",8),d.Yb("ngModelChange",function(t){return e.data.level=t}),d.Qb(),d.Qb(),d.Rb(18,"label",6),d.Rb(19,"span",5),d.vc(20,"\u89d2\u8272\u6027\u5225"),d.Qb(),d.Rb(21,"div",9),d.Rb(22,"label"),d.Rb(23,"input",10),d.Yb("change",function(){return e.updateGender(!0)}),d.Qb(),d.Rb(24,"span"),d.vc(25,"\u7537"),d.Qb(),d.Qb(),d.Rb(26,"label"),d.Rb(27,"input",10),d.Yb("change",function(){return e.updateGender(!1)}),d.Qb(),d.Rb(28,"span"),d.vc(29,"\u5973"),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Rb(30,"section",4),d.Rb(31,"h2",5),d.vc(32,"\u5176\u4ed6\u8cc7\u8a0a"),d.Qb(),d.Rb(33,"label",6),d.Rb(34,"div",5),d.Rb(35,"span"),d.vc(36,"\u6211\u7684\u6700\u611b"),d.Qb(),d.Qb(),d.tc(37,bg,5,3,"div",11),d.Qb(),d.Rb(38,"div",12),d.tc(39,wg,3,4,"div",13),d.Qb(),d.Rb(40,"label",14),d.Rb(41,"span",5),d.vc(42),d.Qb(),d.Rb(43,"textarea",15),d.Yb("ngModelChange",function(t){return e.data.greeting=t}),d.vc(44,"                "),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Rb(45,"div",16),d.Rb(46,"button",17),d.Yb("click",function(){return e.doCancel()}),d.Mb(47,"fa-icon",18),d.vc(48," \u53d6\u6d88 "),d.Qb(),d.Rb(49,"button",19),d.Yb("click",function(){return e.doDone()}),d.Mb(50,"fa-icon",18),d.vc(51," \u5b8c\u6210 "),d.Qb(),d.Qb(),d.Qb()),2&t&&(d.Bb(2),d.xc("",""!==e.data.id?"\u7de8\u8f2f":"\u5efa\u7acb"," \u5361\u7247\u8cc7\u8a0a"),d.Bb(11),d.gc("ngModel",e.data.gid),d.Bb(4),d.gc("ngModel",e.data.level),d.Bb(6),d.gc("checked",e.isMale()),d.Bb(4),d.gc("checked",!e.isMale()),d.Bb(10),d.gc("ngIf",e.data.favorites.length<3),d.Bb(2),d.gc("ngForOf",e.data.favorites),d.Bb(3),d.xc("\u5361\u7247\u5167\u5bb9 (",e.data.greeting.length," / 200)"),d.Bb(1),d.gc("ngModel",e.data.greeting),d.Bb(4),d.gc("icon",e.cancelIcon),d.Bb(3),d.gc("icon",e.doneIcon))},directives:[vg.t,vg.k,vg.l,vg.b,vg.j,vg.m,vg.o,h.l,h.k,vg.i,Wp.a,vg.r,vg.n,vg.u],styles:[".value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:8px}.value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:4px;margin-left:0}.title.favorite[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{display:inline-block;width:40%;line-height:28px}.item-list[_ngcontent-%COMP%]{margin-top:8px}.item[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;display:inline-block;position:relative;padding:4px 8px}.item[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-4px;width:16px;height:16px}.button.add[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;padding:4px;margin-left:12px}.actions[_ngcontent-%COMP%]{width:100%;margin:8px;display:flex;flex-direction:row;justify-content:center}.button.cancel[_ngcontent-%COMP%], .button.submit[_ngcontent-%COMP%]{flex-grow:1;margin:0 8px;font-size:18px;height:36px;border-radius:4px;border:0}.button.submit[_ngcontent-%COMP%]{background-color:var(--primary);color:var(--white)}"]}),Ig);function Og(t,e){if(1&t){var n=d.Sb();d.Rb(0,"div",6),d.Rb(1,"app-realfarm-card",9),d.Yb("onEdit",function(t){return d.nc(n),d.ac(2).editCard(t)})("onDelete",function(t){return d.nc(n),d.ac(2).deleteCard(t)}),d.Qb(),d.Qb()}if(2&t){var r=e.$implicit;d.Bb(1),d.gc("data",r)}}function Eg(t,e){if(1&t){var n=d.Sb();d.Rb(0,"section"),d.Rb(1,"app-header",3),d.Yb("onClickCustomIcon",function(){return d.nc(n),d.ac().logout()}),d.bc(2,"async"),d.Qb(),d.Rb(3,"div",4),d.tc(4,Og,2,1,"div",5),d.bc(5,"async"),d.Rb(6,"div",6),d.Rb(7,"div",7),d.Yb("click",function(){return d.nc(n),d.ac().editCard(void 0)}),d.Mb(8,"fa-icon",8),d.Rb(9,"span"),d.vc(10,"\u65b0\u589e RealFarm \u5361\u7247"),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Qb()}if(2&t){var r,i=d.ac();d.Bb(1),d.gc("title",null==(r=d.cc(2,8,i.userData))?null:r.name)("subtitle","\u500b\u4eba RealFarm \u8cc7\u8a0a "+i.cardInfos.length+"/5")("showBackIcon",!1)("showCustomIcon",!0)("customIcon",i.logoutIcon)("customString","\u767b\u51fa"),d.Bb(3),d.gc("ngForOf",d.cc(5,10,i.userRealFarm)),d.Bb(4),d.gc("icon",i.addIcon)}}function _g(t,e){1&t&&d.Mb(0,"app-loading")}function Sg(t,e){if(1&t){var n=d.Sb();d.Rb(0,"app-modal",10),d.Yb("cancel",function(){return d.nc(n),d.ac().cancelEdit()}),d.Rb(1,"app-realfarm-form",11),d.Yb("done",function(t){return d.nc(n),d.ac().finishEdit(t)})("cancel",function(){return d.nc(n),d.ac().cancelEdit()}),d.Qb(),d.Qb()}if(2&t){var r=d.ac();d.Bb(1),d.gc("data",-1!==r.editIdx?r.cardInfos[r.editIdx]:null)}}var xg,kg,Cg,jg=function(){return t=["user","profile"],Object(y.a)(V,Object(v.a)(function(e){return e&&t||!0}));var t},Ag=[{path:"",component:zp,canActivate:[U],data:{authGuardPipe:jg}},{path:"login",component:zp,canActivate:[U],data:{authGuardPipe:jg}},{path:"profile",component:(xg=function(){function t(e,n,r,i,o){var s=this;p(this,t),this.auth=e,this.store=n,this.us=r,this.title=i,this.meta=o,this.cardNumber=0,this.logoutIcon=Hp.lb,this.addIcon=Hp.bb,this.auth.user.subscribe(function(t){var e=s.store.collection("users").doc(t.uid);s.userId=t.uid,s.userData=e.valueChanges(),s.userRealFarm=e.collection("realfarms").valueChanges(),e.get().subscribe(function(e){e.exists?s.us.updateUser(e.id,"last_login",s.us.getCurrentTime()):s.us.createUser(t)}),s.userRealFarm.subscribe(function(t){s.cardInfos=t}),s.userData.subscribe(function(t){s.userName=t.name,s.updateHeader()}),s.updateHeader()})}return f(t,[{key:"ngOnInit",value:function(){this.editMode=0,this.userName=""}},{key:"logout",value:function(){this.us.logout()}},{key:"updateHeader",value:function(){""!==this.userName&&this.title.setTitle("".concat(this.userName," | \u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b")),this.meta.updateTag({name:"description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({name:"apple-mobile-web-app-title",content:"\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:title",content:"\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({property:"og:image",content:"https://bobosheep.github.io/farm-tool/assets/DisplayUserInfo.jpg"}),this.meta.updateTag({property:"og:url",content:"https://bobosheep.github.io/farm-tool/user/"})}},{key:"editCard",value:function(t){var e=this;t?(this.cardInfos.forEach(function(n,r){n.id===t&&(e.editIdx=r)}),this.editMode=2):(this.editIdx=-1,this.editMode=1)}},{key:"cancelEdit",value:function(){this.editMode=0}},{key:"finishEdit",value:function(t){1==this.editMode?this.createCard(t):this.updateCard(t),this.editMode=0}},{key:"createCard",value:function(t){this.us.createRealfarmInfo(this.userId,t)}},{key:"updateCard",value:function(t){this.cardInfos[this.editIdx]=t,this.us.upateRealFamrInfo(this.userId,this.cardInfos[this.editIdx])}},{key:"deleteCard",value:function(t){var e=this;if(confirm("\u78ba\u5b9a\u522a\u9664\u6b64\u5361\u7247")&&t)for(var n=0;n<this.cardInfos.length;n++)this.cardInfos[n].id===t&&(this.us.deleteRealFarmInfo(this.userId,this.cardInfos[n]),this.userRealFarm.subscribe(function(t){e.cardInfos=t}))}}]),t}(),xg.\u0275fac=function(t){return new(t||xg)(d.Lb(F),d.Lb(Bp),d.Lb(Qp),d.Lb(Kp.d),d.Lb(Kp.c))},xg.\u0275cmp=d.Fb({type:xg,selectors:[["app-profile"]],decls:5,vars:5,consts:[[4,"ngIf","ngIfElse"],["loadingTemplate",""],[3,"cancel",4,"ngIf"],[3,"title","subtitle","showBackIcon","showCustomIcon","customIcon","customString","onClickCustomIcon"],[1,"cards"],["class","card wrapper",4,"ngFor","ngForOf"],[1,"card","wrapper"],["id","add-card",3,"click"],[3,"icon"],[3,"data","onEdit","onDelete"],[3,"cancel"],[3,"data","done","cancel"]],template:function(t,e){if(1&t&&(d.tc(0,Eg,11,12,"section",0),d.bc(1,"async"),d.tc(2,_g,1,0,"ng-template",null,1,d.uc),d.tc(4,Sg,2,1,"app-modal",2)),2&t){var n=d.mc(3);d.gc("ngIf",d.cc(1,3,e.userData))("ngIfElse",n),d.Bb(4),d.gc("ngIf",0!==e.editMode)}},directives:[h.l,Gp.a,h.k,Wp.a,dg,pg,gg.a,Tg],pipes:[h.b],styles:[".cards[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;align-items:center;justify-content:flex-start;margin-top:32px}.card[_ngcontent-%COMP%]{width:100%;margin-bottom:12px}#add-card[_ngcontent-%COMP%]{font-size:14px;min-width:320px;max-width:400px;width:80%;margin:0 auto;height:64px;color:var(--gray);display:flex;align-items:center;justify-content:center;background-image:url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23909090' stroke-width='2' stroke-dasharray='14' stroke-dashoffset='14' stroke-linecap='square'/%3e%3c/svg%3e\");border-radius:12px}#add-card[_ngcontent-%COMP%]:hover, #add-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:hover{cursor:pointer}#add-card[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 8px}"]}),xg),canActivate:[U],data:{authGuardPipe:function(){return t=["user","login"],Object(y.a)(V,Object(v.a)(function(e){return e||t}));var t}}}],Dg=((kg=f(function t(){p(this,t)})).\u0275fac=function(t){return new(t||kg)},kg.\u0275mod=d.Jb({type:kg}),kg.\u0275inj=d.Ib({imports:[[h.c,l.g.forChild(Ag)]]}),kg),Ng=a("jICo"),Rg=((Cg=f(function t(){p(this,t)})).\u0275fac=function(t){return new(t||Cg)},Cg.\u0275mod=d.Jb({type:Cg}),Cg.\u0275inj=d.Ib({imports:[[h.c,Dg,Ng.a,Wp.b,vg.h,vg.q]]}),Cg)}}])}();