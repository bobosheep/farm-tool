!function(){function t(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t=function(){return e};var e={},n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(k){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),s=new E(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=I(s,n);if(a){if(a===l)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=h(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,s),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(k){return{type:"throw",arg:k}}}e.wrap=c;var l={};function f(){}function d(){}function p(){}var g={};u(g,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(_([])));v&&v!==n&&r.call(v,o)&&(g=v);var m=p.prototype=f.prototype=Object.create(g);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(i,o){function s(){return new e((function(n,s){!function n(i,o,s,a){var u=h(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,a)}))}a(u.arg)}(i,o,n,s)}))}return n=n?n.then(s,s):s()}}function I(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,I(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=h(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function _(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=p,u(m,"constructor",p),u(p,"constructor",d),d.displayName=u(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,s,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new w(c(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},b(m),u(m,a,"Generator"),u(m,o,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=_,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=a(t);if(e){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s(this,n)}}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);s=!0);}catch(u){a=!0,i=u}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"7UCR":function(i,s,a){"use strict";a.r(s),a.d(s,"UserModule",(function(){return xg}));var c,h,l=a("SVse"),p=a("iInd"),g=a("8Y7J"),y=a("LRne"),v=a("mCNh"),m=a("lJxs"),b=a("IzEk"),w=a("eIep"),I=a("XNiG"),O=a("HDdC"),T=a("Cfvw"),E=a("VRyK"),_=a("pxpQ"),S=a("UXun"),k=a("SxV6"),x=a("aGrj"),N=a("tf+s"),C=a("pLZG"),j=a("jmUF"),D=new g.q("angularfire2.auth.use-emulator"),A=new g.q("angularfire2.auth.settings"),R=new g.q("angularfire2.auth.tenant-id"),P=new g.q("angularfire2.auth.langugage-code"),F=new g.q("angularfire2.auth.use-device-language"),L=new g.q("angularfire.auth.persistence"),M=((c=f((function t(e,n,r,i,o,s,c,h,f,p){d(this,t);var g=new j.d(i),v=Object(j.h)(g),b=new I.a,D=Object(y.a)(void 0).pipe(Object(_.b)(g.outsideAngular),Object(w.a)((function(){return i.runOutsideAngular((function(){return a.e(20).then(a.bind(null,"6nsN"))}))})),Object(m.a)((function(){return Object(j.g)(e,i,n)})),Object(m.a)((function(t){return i.runOutsideAngular((function(){var e=o,n=s;return Object(j.f)(t.name+".auth","AngularFireAuth",t,(function(){var r=i.runOutsideAngular((function(){return t.auth()}));if(e&&r.useEmulator("http://"+e.join(":")),c&&(r.tenantId=c),r.languageCode=h,f&&r.useDeviceLanguage(),n)for(var o=0,s=Object.entries(n);o<s.length;o++){var a=u(s[o],2),l=a[0],d=a[1];r.settings[l]=d}return p&&r.setPersistence(p),r}),[e,c,h,f,n,p])}))})),Object(S.a)({bufferSize:1,refCount:!1}));if(Object(l.s)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(y.a)(null);else{D.pipe(Object(k.a)()).subscribe();var A=D.pipe(Object(w.a)((function(t){return t.getRedirectResult().then((function(t){return t}),(function(){return null}))})),v,Object(S.a)({bufferSize:1,refCount:!1})),R=function(t){return new O.a((function(e){return{unsubscribe:i.runOutsideAngular((function(){return t(e)}))}}))},P=D.pipe(Object(w.a)((function(t){return R(t.onAuthStateChanged.bind(t))}))),F=D.pipe(Object(w.a)((function(t){return R(t.onIdTokenChanged.bind(t))})));this.authState=A.pipe(Object(x.a)(P),Object(N.a)(g.outsideAngular),Object(_.b)(g.insideAngular)),this.user=A.pipe(Object(x.a)(F),Object(N.a)(g.outsideAngular),Object(_.b)(g.insideAngular)),this.idToken=this.user.pipe(Object(w.a)((function(t){return t?Object(T.a)(t.getIdToken()):Object(y.a)(null)}))),this.idTokenResult=this.user.pipe(Object(w.a)((function(t){return t?Object(T.a)(t.getIdTokenResult()):Object(y.a)(null)}))),this.credential=Object(E.a)(A,b,this.authState.pipe(Object(C.a)((function(t){return!t})))).pipe(Object(m.a)((function(t){return(null==t?void 0:t.user)?t:null})),Object(N.a)(g.outsideAngular),Object(_.b)(g.insideAngular))}return Object(j.i)(this,D,i,{spy:{apply:function(t,e,n){(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then((function(t){return b.next(t)}))}}})}))).\u0275fac=function(t){return new(t||c)(g.Sb(j.c),g.Sb(j.b,8),g.Sb(g.B),g.Sb(g.z),g.Sb(D,8),g.Sb(A,8),g.Sb(R,8),g.Sb(P,8),g.Sb(F,8),g.Sb(L,8))},c.\u0275prov=g.Eb({factory:function(){return new c(g.Sb(j.c),g.Sb(j.b,8),g.Sb(g.B),g.Sb(g.z),g.Sb(D,8),g.Sb(A,8),g.Sb(R,8),g.Sb(P,8),g.Sb(F,8),g.Sb(L,8))},token:c,providedIn:"any"}),c),U=Object(m.a)((function(t){return!!t})),V=((h=f((function t(e,n){var r=this;d(this,t),this.router=e,this.auth=n,this.canActivate=function(t,e){var n=t.data.authGuardPipe||function(){return U};return r.auth.user.pipe(Object(b.a)(1),n(t,e),Object(m.a)((function(t){return"boolean"==typeof t?t:Array.isArray(t)?r.router.createUrlTree(t):r.router.parseUrl(t)})))}}))).\u0275fac=function(t){return new(t||h)(g.Sb(p.c),g.Sb(M))},h.\u0275prov=g.Eb({factory:function(){return new h(g.Sb(p.c),g.Sb(M))},token:h,providedIn:"any"}),h),q=a("Jgta"),B=function(t){return t[t.Admin=0]="Admin",t[t.Editor=1]="Editor",t[t.ClubAdmin=2]="ClubAdmin",t[t.User=100]="User",t}({}),K=a("D0XW"),G=a("JX91"),z=a("7o/Q");function Q(){return function(t){return t.lift(new H)}}var H=function(){function t(){d(this,t)}return f(t,[{key:"call",value:function(t,e){return e.subscribe(new W(t))}}]),t}(),W=function(t){r(n,t);var e=o(n);function n(t){var r;return d(this,n),(r=e.call(this,t)).hasPrev=!1,r}return f(n,[{key:"_next",value:function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}]),n}(z.a),Y=a("Kqap"),X=function(){function t(e,n){d(this,t),this.compare=e,this.keySelector=n}return f(t,[{key:"call",value:function(t,e){return e.subscribe(new J(t,this.compare,this.keySelector))}}]),t}(),J=function(t){r(n,t);var e=o(n);function n(t,r,i){var o;return d(this,n),(o=e.call(this,t)).keySelector=i,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return f(n,[{key:"compare",value:function(t,e){return t===e}},{key:"_next",value:function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(i){return this.destination.error(i)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(i){return this.destination.error(i)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))}}]),n}(z.a),$=a("zIRd"),Z=a("mrSG"),tt=a("qOnz"),et=a("q/0M"),nt=function(t,e){return(nt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function rt(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var it,ot="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},st=st||{},at=ot||self;function ut(){}function ct(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function ht(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var lt="closure_uid_"+(1e9*Math.random()>>>0),ft=0;function dt(t,e,n){return t.call.apply(t.bind,arguments)}function pt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function gt(t,e,n){return(gt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?dt:pt).apply(null,arguments)}function yt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function vt(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function mt(){this.s=this.s,this.o=this.o}var bt={};mt.prototype.s=!1,mt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,lt)&&t[lt]||(t[lt]=++ft)}(this);delete bt[t]}},mt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var wt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},It=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Ot(t){return Array.prototype.concat.apply([],arguments)}function Tt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Et(t){return/^[\s\xa0]*$/.test(t)}var _t,St=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function kt(t,e){return-1!=t.indexOf(e)}function xt(t,e){return t<e?-1:t>e?1:0}t:{var Nt=at.navigator;if(Nt){var Ct=Nt.userAgent;if(Ct){_t=Ct;break t}}_t=""}function jt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Dt(t){var e={};for(var n in t)e[n]=t[n];return e}var At="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<At.length;o++)n=At[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Pt(t){return Pt[" "](t),t}Pt[" "]=ut;var Ft,Lt,Mt=kt(_t,"Opera"),Ut=kt(_t,"Trident")||kt(_t,"MSIE"),Vt=kt(_t,"Edge"),qt=Vt||Ut,Bt=kt(_t,"Gecko")&&!(kt(_t.toLowerCase(),"webkit")&&!kt(_t,"Edge"))&&!(kt(_t,"Trident")||kt(_t,"MSIE"))&&!kt(_t,"Edge"),Kt=kt(_t.toLowerCase(),"webkit")&&!kt(_t,"Edge");function Gt(){var t=at.document;return t?t.documentMode:void 0}t:{var zt="",Qt=(Lt=_t,Bt?/rv:([^\);]+)(\)|;)/.exec(Lt):Vt?/Edge\/([\d\.]+)/.exec(Lt):Ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Lt):Kt?/WebKit\/(\S+)/.exec(Lt):Mt?/(?:Version)[ \/]?(\S+)/.exec(Lt):void 0);if(Qt&&(zt=Qt?Qt[1]:""),Ut){var Ht=Gt();if(null!=Ht&&Ht>parseFloat(zt)){Ft=String(Ht);break t}}Ft=zt}var Wt={},Yt=at.document&&Ut&&(Gt()||parseInt(Ft,10))||void 0,Xt=function(){if(!at.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{at.addEventListener("test",ut,e),at.removeEventListener("test",ut,e)}catch(n){}return t}();function Jt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function $t(t,e){if(Jt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Bt){t:{try{Pt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Zt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&$t.Z.h.call(this)}}Jt.prototype.h=function(){this.defaultPrevented=!0},vt($t,Jt);var Zt={2:"touch",3:"pen",4:"mouse"};$t.prototype.h=function(){$t.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var te="closure_listenable_"+(1e6*Math.random()|0),ee=0;function ne(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++ee,this.ca=this.fa=!1}function re(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ie(t){this.src=t,this.g={},this.h=0}function oe(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=wt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(re(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function se(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}ie.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=se(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new ne(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var ae="closure_lm_"+(1e6*Math.random()|0),ue={};function ce(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=ye(r),e&&e[te]?e.O(n,r,ht(i)?!!i.capture:!!i,o):he(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)ce(t,e[o],n,r,i);return null}return n=ye(n),t&&t[te]?t.N(e,n,ht(r)?!!r.capture:!!r,i):he(t,e,n,!1,r,i)}function he(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=ht(i)?!!i.capture:!!i,a=pe(t);if(a||(t[ae]=a=new ie(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=de;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Xt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(fe(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function le(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[te])oe(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(fe(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=pe(e))?(oe(n,t),0==n.h&&(n.src=null,e[ae]=null)):re(t)}}}function fe(t){return t in ue?ue[t]:ue[t]="on"+t}function de(t,e){if(t.ca)t=!0;else{e=new $t(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&le(t),t=n.call(r,e)}return t}function pe(t){return(t=t[ae])instanceof ie?t:null}var ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function ye(t){return"function"==typeof t?t:(t[ge]||(t[ge]=function(e){return t.handleEvent(e)}),t[ge])}function ve(){mt.call(this),this.i=new ie(this),this.P=this,this.I=null}function me(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Jt(e,t);else if(e instanceof Jt)e.target=e.target||t;else{var i=e;Rt(e=new Jt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=be(s,r,!0,e)&&i}if(i=be(s=e.g=t,r,!0,e)&&i,i=be(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=be(s=e.g=n[o],r,!1,e)&&i}function be(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&oe(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}vt(ve,mt),ve.prototype[te]=!0,ve.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=ht(i)?!!i.capture:!!i,r=ye(r),e&&e[te]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=se(s=e.g[n],r,i,o))&&(re(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):e&&(e=pe(e))&&(n=e.g[n.toString()],e=-1,n&&(e=se(n,r,i,o)),(r=-1<e?n[e]:null)&&le(r))}(this,t,e,n,r)},ve.prototype.M=function(){if(ve.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)re(n[r]);delete e.g[t],e.h--}}this.I=null},ve.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},ve.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var we=at.JSON.stringify;function Ie(){var t=Ne,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Oe,Te=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Ee.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Ee=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())((function(){return new _e}),(function(t){return t.reset()})),_e=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Se(t){at.setTimeout((function(){throw t}),0)}function ke(t,e){Oe||function(){var t=at.Promise.resolve(void 0);Oe=function(){t.then(Ce)}}(),xe||(Oe(),xe=!0),Ne.add(t,e)}var xe=!1,Ne=new Te;function Ce(){for(var t;t=Ie();){try{t.h.call(t.g)}catch(n){Se(n)}var e=Ee;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}xe=!1}function je(t,e){ve.call(this),this.h=t||1,this.g=e||at,this.j=gt(this.kb,this),this.l=Date.now()}function De(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Ae(t,e,n){if("function"==typeof t)n&&(t=gt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=gt(t.handleEvent,t)}return 2147483647<Number(e)?-1:at.setTimeout(t,e||0)}function Re(t){t.g=Ae((function(){t.g=null,t.i&&(t.i=!1,Re(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}vt(je,ve),(it=je.prototype).da=!1,it.S=null,it.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),me(this,"tick"),this.da&&(De(this),this.start()))}},it.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},it.M=function(){je.Z.M.call(this),De(this),delete this.g};var Pe=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}nt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Re(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(at.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(mt);function Fe(t){mt.call(this),this.h=t,this.g={}}vt(Fe,mt);var Le=[];function Me(t,e,n,r){Array.isArray(n)||(n&&(Le[0]=n.toString()),n=Le);for(var i=0;i<n.length;i++){var o=ce(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Ue(t){jt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&le(t)}),t),t.g={}}function Ve(){this.g=!0}function qe(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return we(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Fe.prototype.M=function(){Fe.Z.M.call(this),Ue(this)},Fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ve.prototype.Aa=function(){this.g=!1},Ve.prototype.info=function(){};var Be={},Ke=null;function Ge(){return Ke=Ke||new ve}function ze(t){Jt.call(this,Be.Ma,t)}function Qe(t){var e=Ge();me(e,new ze(e,t))}function He(t,e){Jt.call(this,Be.STAT_EVENT,t),this.stat=e}function We(t){var e=Ge();me(e,new He(e,t))}function Ye(t,e){Jt.call(this,Be.Na,t),this.size=e}function Xe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return at.setTimeout((function(){t()}),e)}Be.Ma="serverreachability",vt(ze,Jt),Be.STAT_EVENT="statevent",vt(He,Jt),Be.Na="timingevent",vt(Ye,Jt);var Je={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},$e={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ze(){}function tn(){}Ze.prototype.h=null;var en,nn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function rn(){Jt.call(this,"d")}function on(){Jt.call(this,"c")}function sn(){}function an(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Fe(this),this.P=cn,this.W=new je(t=qt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new un}function un(){this.i=null,this.g="",this.h=!1}vt(rn,Jt),vt(on,Jt),vt(sn,Ze),sn.prototype.g=function(){return new XMLHttpRequest},sn.prototype.i=function(){return{}},en=new sn;var cn=45e3,hn={},ln={};function fn(t,e,n){t.K=1,t.v=Pn(Nn(e)),t.s=n,t.U=!0,dn(t,null)}function dn(t,e){t.F=Date.now(),vn(t),t.A=Nn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Wn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new un,t.g=Yr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Pe(gt(t.Ia,t,t.g),t.O)),Me(t.V,t.g,"readystatechange",t.gb),e=t.H?Dt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Qe(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function pn(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function gn(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=yn(t,n))==ln){4==e&&(t.o=4,We(14),i=!1),qe(t.j,t.m,null,"[Incomplete Response]");break}if(r==hn){t.o=4,We(15),qe(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}qe(t.j,t.m,r,null),On(t,r)}pn(t)&&r!=ln&&r!=hn&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,We(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),qr(e),e.L=!0,We(11))):(qe(t.j,t.m,n,"[Invalid Chunked Response]"),In(t),wn(t))}function yn(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?ln:(n=Number(e.substring(n,r)),isNaN(n)?hn:(r+=1)+n>e.length?ln:(e=e.substr(r,n),t.C=r+n,e))}function vn(t){t.Y=Date.now()+t.P,mn(t,t.P)}function mn(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Xe(gt(t.eb,t),e)}function bn(t){t.B&&(at.clearTimeout(t.B),t.B=null)}function wn(t){0==t.l.G||t.I||Gr(t.l,t)}function In(t){bn(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,De(t.W),Ue(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function On(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||er(n.i,t)))if(n.I=t.N,!t.J&&er(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Kr(n),Dr(n)}Vr(n),We(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Xe(gt(n.ab,n),6e3));if(1>=tr(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Qr(n,11)}else if((t.J||n.g==t)&&Kr(n),!Et(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(kt(h,"spdy")||kt(h,"quic")||kt(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(nr(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Rn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=Wr(r,r.H?r.la:null,r.W),d.J){rr(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(bn(p),vn(p)),r.g=d}else Ur(r);0<n.l.length&&Pr(n)}else"stop"!=o[0]&&"close"!=o[0]||Qr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Qr(n,7):jr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Qe(4)}catch(o){}}function Tn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ct(t)||"string"==typeof t)It(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(ct(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(ct(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function En(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof En)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function _n(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Sn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Sn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Sn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(it=an.prototype).setTimeout=function(t){this.P=t},it.gb=function(t){t=t.target;var e=this.L;e&&3==Sr(t)?e.l():this.Ia(t)},it.Ia=function(t){try{if(t==this.g)t:{var e=Sr(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||qt||this.g&&(this.h.h||this.g.ga()||kr(this.g)))){this.I||4!=e||7==n||Qe(8==n||0>=r?3:2),bn(this);var i=this.g.ba();this.N=i;e:if(pn(this)){var o=kr(this.g);t="";var s=o.length,a=4==Sr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){In(this),wn(this);var u="";break e}this.h.i=new at.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Et(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,We(12),In(this),wn(this);break t}qe(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,On(this,i)}this.U?(gn(this,e,u),qt&&this.i&&3==e&&(Me(this.V,this.W,"tick",this.fb),this.W.start())):(qe(this.j,this.m,u,null),On(this,u)),4==e&&In(this),this.i&&!this.I&&(4==e?Gr(this.l,this):(this.i=!1,vn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,We(12)):(this.o=0,We(13)),In(this),wn(this)}}}catch(e){}},it.fb=function(){if(this.g){var t=Sr(this.g),e=this.g.ga();this.C<e.length&&(bn(this),gn(this,t,e),this.i&&4!=t&&vn(this))}},it.cancel=function(){this.I=!0,In(this)},it.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(Qe(3),We(17)),In(this),this.o=2,wn(this)):mn(this,this.Y-t)},(it=En.prototype).R=function(){_n(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},it.T=function(){return _n(this),this.g.concat()},it.get=function(t,e){return Sn(this.h,t)?this.h[t]:e},it.set=function(t,e){Sn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},it.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var kn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function xn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof xn){this.g=void 0!==e?e:t.g,Cn(this,t.j),this.s=t.s,jn(this,t.i),Dn(this,t.m),this.l=t.l,e=t.h;var n=new Gn;n.i=e.i,e.g&&(n.g=new En(e.g),n.h=e.h),An(this,n),this.o=t.o}else t&&(n=String(t).match(kn))?(this.g=!!e,Cn(this,n[1]||"",!0),this.s=Fn(n[2]||""),jn(this,n[3]||"",!0),Dn(this,n[4]),this.l=Fn(n[5]||"",!0),An(this,n[6]||"",!0),this.o=Fn(n[7]||"")):(this.g=!!e,this.h=new Gn(null,this.g))}function Nn(t){return new xn(t)}function Cn(t,e,n){t.j=n?Fn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function jn(t,e,n){t.i=n?Fn(e,!0):e}function Dn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function An(t,e,n){e instanceof Gn?(t.h=e,function(t,e){e&&!t.j&&(zn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Qn(this,e),Wn(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=Ln(e,Bn)),t.h=new Gn(e,t.g))}function Rn(t,e,n){t.h.set(e,n)}function Pn(t){return Rn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Fn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ln(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Mn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Mn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}xn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ln(e,Un,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Ln(e,Un,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ln(n,"/"==n.charAt(0)?qn:Vn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Ln(n,Kn)),t.join("")};var Un=/[#\/\?@]/g,Vn=/[#\?:]/g,qn=/[#\?]/g,Bn=/[#\?@]/g,Kn=/#/g;function Gn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function zn(t){t.g||(t.g=new En,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Qn(t,e){zn(t),e=Yn(t,e),Sn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Sn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&_n(t)))}function Hn(t,e){return zn(t),e=Yn(t,e),Sn(t.g.h,e)}function Wn(t,e,n){Qn(t,e),0<n.length&&(t.i=null,t.g.set(Yn(t,e),Tt(n)),t.h+=n.length)}function Yn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(it=Gn.prototype).add=function(t,e){zn(this),this.i=null,t=Yn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},it.forEach=function(t,e){zn(this),this.g.forEach((function(n,r){It(n,(function(n){t.call(e,n,r,this)}),this)}),this)},it.T=function(){zn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},it.R=function(t){zn(this);var e=[];if("string"==typeof t)Hn(this,t)&&(e=Ot(e,this.g.get(Yn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Ot(e,t[n])}return e},it.set=function(t,e){return zn(this),this.i=null,Hn(this,t=Yn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},it.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},it.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Xn=function(t,e){this.h=t,this.g=e};function Jn(t){this.l=t||$n,t=at.PerformanceNavigationTiming?0<(t=at.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(at.g&&at.g.Ea&&at.g.Ea()&&at.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var $n=10;function Zn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function tr(t){return t.h?1:t.g?t.g.size:0}function er(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function nr(t,e){t.g?t.g.add(e):t.h=e}function rr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ir(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=rt(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return Tt(t.i)}function or(){}function sr(){this.g=new or}function ar(t,e,n){var r=n||"";try{Tn(t,(function(t,n){var i=t;ht(t)&&(i=we(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(pp){throw e.push(r+"type="+encodeURIComponent("_badmap")),pp}}function ur(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function cr(t){this.l=t.$b||null,this.j=t.ib||!1}function hr(t,e){ve.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=lr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Jn.prototype.cancel=function(){var t,e;if(this.i=ir(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=rt(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},or.prototype.stringify=function(t){return at.JSON.stringify(t,void 0)},or.prototype.parse=function(t){return at.JSON.parse(t,void 0)},vt(cr,Ze),cr.prototype.g=function(){return new hr(this.l,this.j)},cr.prototype.i=function(t){return function(){return t}}({}),vt(hr,ve);var lr=0;function fr(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function dr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,pr(t)}function pr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(it=hr.prototype).open=function(t,e){if(this.readyState!=lr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,pr(this)},it.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||at).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},it.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,dr(this)),this.readyState=lr},it.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,pr(this)),this.g&&(this.readyState=3,pr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==at.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;fr(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},it.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?dr(this):pr(this),3==this.readyState&&fr(this)}},it.Ua=function(t){this.g&&(this.response=this.responseText=t,dr(this))},it.Ta=function(t){this.g&&(this.response=t,dr(this))},it.ha=function(){this.g&&dr(this)},it.setRequestHeader=function(t,e){this.v.append(t,e)},it.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},it.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(hr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var gr=at.JSON.parse;function yr(t){ve.call(this),this.headers=new En,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=vr,this.K=this.L=!1}vt(yr,ve);var vr="",mr=/^https?$/i,br=["POST","PUT"];function wr(t){return"content-type"==t.toLowerCase()}function Ir(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Or(t),Er(t)}function Or(t){t.D||(t.D=!0,me(t,"complete"),me(t,"error"))}function Tr(t){if(t.h&&void 0!==st&&(!t.C[1]||4!=Sr(t)||2!=t.ba()))if(t.v&&4==Sr(t))Ae(t.Fa,0,t);else if(me(t,"readystatechange"),4==Sr(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(kn)[1]||null;if(!o&&at.self&&at.self.location){var s=at.self.location.protocol;o=s.substr(0,s.length-1)}i=!mr.test(o?o.toLowerCase():"")}e=i}if(e)me(t,"complete"),me(t,"success");else{t.m=6;try{var a=2<Sr(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",Or(t)}}finally{Er(t)}}}function Er(t,e){if(t.g){_r(t);var n=t.g,r=t.C[0]?ut:null;t.g=null,t.C=null,e||me(t,"ready");try{n.onreadystatechange=r}catch(pp){}}}function _r(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(at.clearTimeout(t.A),t.A=null)}function Sr(t){return t.g?t.g.readyState:0}function kr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case vr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function xr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return jt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Rn(t,e,n))}function Nr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Cr(t){this.za=0,this.l=[],this.h=new Ve,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Nr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Nr("baseRetryDelayMs",5e3,t),this.$a=Nr("retryDelaySeedMs",1e4,t),this.Ya=Nr("forwardChannelMaxRetries",2,t),this.ra=Nr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Jn(t&&t.concurrentRequestLimit),this.Ca=new sr,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function jr(t){if(Ar(t),3==t.G){var e=t.V++,n=Nn(t.F);Rn(n,"SID",t.J),Rn(n,"RID",e),Rn(n,"TYPE","terminate"),Lr(t,n),(e=new an(t,t.h,e,void 0)).K=2,e.v=Pn(Nn(n)),n=!1,at.navigator&&at.navigator.sendBeacon&&(n=at.navigator.sendBeacon(e.v.toString(),"")),!n&&at.Image&&((new Image).src=e.v,n=!0),n||(e.g=Yr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),vn(e)}Hr(t)}function Dr(t){t.g&&(qr(t),t.g.cancel(),t.g=null)}function Ar(t){Dr(t),t.u&&(at.clearTimeout(t.u),t.u=null),Kr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&at.clearTimeout(t.m),t.m=null)}function Rr(t,e){t.l.push(new Xn(t.Za++,e)),3==t.G&&Pr(t)}function Pr(t){Zn(t.i)||t.m||(t.m=!0,ke(t.Ha,t),t.C=0)}function Fr(t,e){var n;n=e?e.m:t.V++;var r=Nn(t.F);Rn(r,"SID",t.J),Rn(r,"RID",n),Rn(r,"AID",t.U),Lr(t,r),t.o&&t.s&&xr(r,t.o,t.s),n=new an(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Mr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),nr(t.i,n),fn(n,r,e)}function Lr(t,e){t.j&&Tn({},(function(t,n){Rn(e,n,t)}))}function Mr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?gt(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{ar(h,s,"req"+c+"_")}catch(ki){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Ur(t){t.g||t.u||(t.Y=1,ke(t.Ga,t),t.A=0)}function Vr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Xe(gt(t.Ga,t),zr(t,t.A)),t.A++,0))}function qr(t){null!=t.B&&(at.clearTimeout(t.B),t.B=null)}function Br(t){t.g=new an(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Nn(t.oa);Rn(e,"RID","rpc"),Rn(e,"SID",t.J),Rn(e,"CI",t.N?"0":"1"),Rn(e,"AID",t.U),Lr(t,e),Rn(e,"TYPE","xmlhttp"),t.o&&t.s&&xr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Pn(Nn(e)),n.s=null,n.U=!0,dn(n,t)}function Kr(t){null!=t.v&&(at.clearTimeout(t.v),t.v=null)}function Gr(t,e){var n=null;if(t.g==e){Kr(t),qr(t),t.g=null;var r=2}else{if(!er(t.i,e))return;n=e.D,rr(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;me(r=Ge(),new Ye(r,n,e,i)),Pr(t)}else Ur(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(tr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Xe(gt(t.Ha,t,e),zr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Vr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Qr(t,5);break;case 4:Qr(t,10);break;case 3:Qr(t,6);break;default:Qr(t,2)}}function zr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Qr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=gt(t.jb,t);n||(n=new xn("//www.google.com/images/cleardot.gif"),at.location&&"http"==at.location.protocol||Cn(n,"https"),Pn(n)),function(t,e){var n=new Ve;if(at.Image){var r=new Image;r.onload=yt(ur,n,r,"TestLoadImage: loaded",!0,e),r.onerror=yt(ur,n,r,"TestLoadImage: error",!1,e),r.onabort=yt(ur,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=yt(ur,n,r,"TestLoadImage: timeout",!1,e),at.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else We(2);t.G=0,t.j&&t.j.va(e),Hr(t),Ar(t)}function Hr(t){t.G=0,t.I=-1,t.j&&(0==ir(t.i).length&&0==t.l.length||(t.i.i.length=0,Tt(t.l),t.l.length=0),t.j.ua())}function Wr(t,e,n){var r=function(t){return t instanceof xn?Nn(t):new xn(t,void 0)}(n);if(""!=r.i)e&&jn(r,e+"."+r.i),Dn(r,r.m);else{var i=at.location;r=function(t,e,n,r){var i=new xn(null,void 0);return t&&Cn(i,t),e&&jn(i,e),n&&Dn(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&jt(t.aa,(function(t,e){Rn(r,e,t)})),n=t.sa,(e=t.D)&&n&&Rn(r,e,n),Rn(r,"VER",t.ma),Lr(t,r),r}function Yr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new yr(n&&t.Ba&&!t.qa?new cr({ib:!0}):t.qa)).L=t.H,e}function Xr(){}function Jr(){if(Ut&&!(10<=Number(Yt)))throw Error("Environmental error: no available transport.")}function $r(t,e){ve.call(this),this.g=new Cr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Et(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Et(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new ei(this)}function Zr(t){rn.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ti(){on.call(this),this.status=1}function ei(t){this.g=t}(it=yr.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():en.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:en),this.g.onreadystatechange=gt(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Ir(this,o)}t=n||"";var i=new En(this.headers);r&&Tn(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=wr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=at.FormData&&t instanceof at.FormData,!(0<=wt(br,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{_r(this),0<this.B&&((this.K=function(t){return Ut&&function(){return t=Wt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=St(String(Ft)).split("."),n=St("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=xt(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||xt(0==o[2].length,0==s[2].length)||xt(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=gt(this.pa,this)):this.A=Ae(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Ir(this,o)}},it.pa=function(){void 0!==st&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,me(this,"timeout"),this.abort(8))},it.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,me(this,"complete"),me(this,"abort"),Er(this))},it.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Er(this,!0)),yr.Z.M.call(this)},it.Fa=function(){this.s||(this.F||this.v||this.l?Tr(this):this.cb())},it.cb=function(){Tr(this)},it.ba=function(){try{return 2<Sr(this)?this.g.status:-1}catch(Lt){return-1}},it.ga=function(){try{return this.g?this.g.responseText:""}catch(Lt){return""}},it.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),gr(e)}},it.Da=function(){return this.m},it.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(it=Cr.prototype).ma=8,it.G=1,it.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},it.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new an(this,this.h,t,void 0),n=this.s;if(this.P&&(n?Rt(n=Dt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Mr(this,e,r),Rn(i=Nn(this.F),"RID",t),Rn(i,"CVER",22),this.D&&Rn(i,"X-HTTP-Session-Id",this.D),Lr(this,i),this.o&&n&&xr(i,this.o,n),nr(this.i,e),this.Ra&&Rn(i,"TYPE","init"),this.ja?(Rn(i,"$req",r),Rn(i,"SID","null"),e.$=!0,fn(e,i,null)):fn(e,i,r),this.G=2}}else 3==this.G&&(t?Fr(this,t):0==this.l.length||Zn(this.i)||Fr(this))},it.Ga=function(){if(this.u=null,Br(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Xe(gt(this.bb,this),t)}},it.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,We(10),Dr(this),Br(this))},it.ab=function(){null!=this.v&&(this.v=null,Dr(this),Vr(this),We(19))},it.jb=function(t){t?(this.h.info("Successfully pinged google.com"),We(2)):(this.h.info("Failed to ping google.com"),We(1))},(it=Xr.prototype).xa=function(){},it.wa=function(){},it.va=function(){},it.ua=function(){},it.Oa=function(){},Jr.prototype.g=function(t,e){return new $r(t,e)},vt($r,ve),$r.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),ke(gt(t.hb,t,e))),We(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Wr(t,null,t.W),Pr(t)},$r.prototype.close=function(){jr(this.g)},$r.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Rr(this.g,e)}else this.v?((e={}).__data__=we(t),Rr(this.g,e)):Rr(this.g,t)},$r.prototype.M=function(){this.g.j=null,delete this.j,jr(this.g),delete this.g,$r.Z.M.call(this)},vt(Zr,rn),vt(ti,on),vt(ei,Xr),ei.prototype.xa=function(){me(this.g,"a")},ei.prototype.wa=function(t){me(this.g,new Zr(t))},ei.prototype.va=function(t){me(this.g,new ti(t))},ei.prototype.ua=function(){me(this.g,"b")},Jr.prototype.createWebChannel=Jr.prototype.g,$r.prototype.send=$r.prototype.u,$r.prototype.open=$r.prototype.m,$r.prototype.close=$r.prototype.close,Je.NO_ERROR=0,Je.TIMEOUT=8,Je.HTTP_ERROR=6,$e.COMPLETE="complete",tn.EventType=nn,nn.OPEN="a",nn.CLOSE="b",nn.ERROR="c",nn.MESSAGE="d",ve.prototype.listen=ve.prototype.N,yr.prototype.listenOnce=yr.prototype.O,yr.prototype.getLastError=yr.prototype.La,yr.prototype.getLastErrorCode=yr.prototype.Da,yr.prototype.getStatus=yr.prototype.ba,yr.prototype.getResponseJson=yr.prototype.Qa,yr.prototype.getResponseText=yr.prototype.ga,yr.prototype.send=yr.prototype.ea;var ni=Je,ri=$e,ii=Be,oi=cr,si=tn,ai=yr,ui=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();ui.o=-1;var ci={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},hi=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(Z.c)(e,t),e}(Error),li=new et.b("@firebase/firestore");function fi(){return li.logLevel}function di(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(li.logLevel<=et.a.DEBUG){var r=e.map(yi);li.debug.apply(li,Object(Z.f)(["Firestore (8.10.1): "+t],r))}}function pi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(li.logLevel<=et.a.ERROR){var r=e.map(yi);li.error.apply(li,Object(Z.f)(["Firestore (8.10.1): "+t],r))}}function gi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(li.logLevel<=et.a.WARN){var r=e.map(yi);li.warn.apply(li,Object(Z.f)(["Firestore (8.10.1): "+t],r))}}function yi(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(pp){return t}}function vi(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw pi(e),new Error(e)}function mi(t,e){t||vi()}function bi(t,e){return t}function wi(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Ii=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=wi(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Oi(t,e){return t<e?-1:t>e?1:0}function Ti(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Ei(t){return t+"\0"}var _i=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new hi(ci.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new hi(ci.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new hi(ci.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new hi(ci.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Oi(this.nanoseconds,t.nanoseconds):Oi(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Si=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new _i(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function ki(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function xi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ni(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ci=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&vi(),void 0===n?n=t.length-e:n>t.length-e&&vi(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ji=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new hi(ci.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Ci),Di=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ai=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Di.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new hi(ci.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new hi(ci.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new hi(ci.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new hi(ci.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Ci),Ri=function(){function t(t){this.fields=t,t.sort(Ai.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Ti(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Pi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Oi(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Pi.EMPTY_BYTE_STRING=new Pi("");var Fi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Li(t){if(mi(!!t),"string"==typeof t){var e=0,n=Fi.exec(t);if(mi(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Mi(t.seconds),nanos:Mi(t.nanos)}}function Mi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ui(t){return"string"==typeof t?Pi.fromBase64String(t):Pi.fromUint8Array(t)}function Vi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function qi(t){var e=Li(t.mapValue.fields.__local_write_time__.timestampValue);return new _i(e.seconds,e.nanos)}function Bi(t){return null==t}function Ki(t){return 0===t&&1/t==-1/0}function Gi(t){return"number"==typeof t&&Number.isInteger(t)&&!Ki(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var zi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(ji.fromString(e))},t.fromName=function(e){return new t(ji.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ji.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ji.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ji(e.slice()))},t}();function Qi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Vi(t)?4:10:vi()}function Hi(t,e){var n=Qi(t);if(n!==Qi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return qi(t).isEqual(qi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Li(t.timestampValue),r=Li(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ui(t.bytesValue).isEqual(Ui(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Mi(t.geoPointValue.latitude)===Mi(e.geoPointValue.latitude)&&Mi(t.geoPointValue.longitude)===Mi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Mi(t.integerValue)===Mi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Mi(t.doubleValue),r=Mi(e.doubleValue);return n===r?Ki(n)===Ki(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Ti(t.arrayValue.values||[],e.arrayValue.values||[],Hi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ki(n)!==ki(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Hi(n[i],r[i])))return!1;return!0}(t,e);default:return vi()}}function Wi(t,e){return void 0!==(t.values||[]).find((function(t){return Hi(t,e)}))}function Yi(t,e){var n=Qi(t),r=Qi(e);if(n!==r)return Oi(n,r);switch(n){case 0:return 0;case 1:return Oi(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Mi(t.integerValue||t.doubleValue),r=Mi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Xi(t.timestampValue,e.timestampValue);case 4:return Xi(qi(t),qi(e));case 5:return Oi(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Ui(t),r=Ui(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Oi(n[i],r[i]);if(0!==o)return o}return Oi(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Oi(Mi(t.latitude),Mi(e.latitude));return 0!==n?n:Oi(Mi(t.longitude),Mi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Yi(n[i],r[i]);if(o)return o}return Oi(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Oi(r[s],o[s]);if(0!==a)return a;var u=Yi(n[r[s]],i[o[s]]);if(0!==u)return u}return Oi(r.length,o.length)}(t.mapValue,e.mapValue);default:throw vi()}}function Xi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Oi(t,e);var n=Li(t),r=Li(e),i=Oi(n.seconds,r.seconds);return 0!==i?i:Oi(n.nanos,r.nanos)}function Ji(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Li(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ui(e.bytesValue).toBase64():"referenceValue"in e?zi.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):vi();var n}(t)}function $i(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Zi(t){return!!t&&"integerValue"in t}function to(t){return!!t&&"arrayValue"in t}function eo(t){return!!t&&"nullValue"in t}function no(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ro(t){return!!t&&"mapValue"in t}function io(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return xi(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=io(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=io(t.arrayValue.values[r]);return n}return Object.assign({},t)}var oo=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!ro(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=io(e)},t.prototype.setAll=function(t){var e=this,n=Ai.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=io(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());ro(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Hi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];ro(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){xi(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(io(this.value))},t}();function so(t){var e=[];return xi(t.fields,(function(t,n){var r=new Ai([t]);if(ro(n)){var i=so(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)})),new Ri(e)}var ao=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Si.min(),oo.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,oo.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,oo.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=oo.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=oo.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),uo=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function co(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new uo(t,e,n,r,i,o,s)}function ho(t){var e=bi(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Ji(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),Bi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Eo(e.startAt)),e.endAt&&(n+="|ub:",n+=Eo(e.endAt)),e.h=n}return e.h}function lo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!So(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Hi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!xo(t.startAt,e.startAt)&&xo(t.endAt,e.endAt)}function fo(t){return zi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var po=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(Z.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new go(t,n,r):"array-contains"===n?new bo(t,r):"in"===n?new wo(t,r):"not-in"===n?new Io(t,r):"array-contains-any"===n?new Oo(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new yo(t,n):new vo(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Yi(e,this.value)):null!==e&&Qi(this.value)===Qi(e)&&this.m(Yi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return vi()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),go=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=zi.fromName(r.referenceValue),i}return Object(Z.c)(e,t),e.prototype.matches=function(t){var e=zi.comparator(t.key,this.key);return this.m(e)},e}(po),yo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=mo(0,n),r}return Object(Z.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(po),vo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=mo(0,n),r}return Object(Z.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(po);function mo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return zi.fromName(t.referenceValue)}))}var bo=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(Z.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return to(e)&&Wi(e.arrayValue,this.value)},e}(po),wo=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(Z.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Wi(this.value.arrayValue,e)},e}(po),Io=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(Z.c)(e,t),e.prototype.matches=function(t){if(Wi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Wi(this.value.arrayValue,e)},e}(po),Oo=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(Z.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!to(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Wi(e.value.arrayValue,t)}))},e}(po),To=function(t,e){this.position=t,this.before=e};function Eo(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Ji(t)})).join(",")}var _o=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function So(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ko(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?zi.comparator(zi.fromName(s.referenceValue),n.key):Yi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function xo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Hi(t.position[n],e.position[n]))return!1;return!0}var No=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Co(t,e,n,r,i,o,s,a){return new No(t,e,n,r,i,o,s,a)}function jo(t){return new No(t)}function Do(t){return!Bi(t.limit)&&"F"===t.limitType}function Ao(t){return!Bi(t.limit)&&"L"===t.limitType}function Ro(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Po(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Fo(t){return null!==t.collectionGroup}function Lo(t){var e=bi(t);if(null===e.p){e.p=[];var n=Po(e),r=Ro(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new _o(n)),e.p.push(new _o(Ai.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new _o(Ai.keyField(),u))}}}return e.p}function Mo(t){var e=bi(t);if(!e.T)if("F"===e.limitType)e.T=co(e.path,e.collectionGroup,Lo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Lo(e);r<i.length;r++){var o=i[r];n.push(new _o(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new To(e.endAt.position,!e.endAt.before):null,a=e.startAt?new To(e.startAt.position,!e.startAt.before):null;e.T=co(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Uo(t,e,n){return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Vo(t,e){return lo(Mo(t),Mo(e))&&t.limitType===e.limitType}function qo(t){return ho(Mo(t))+"|lt:"+t.limitType}function Bo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Ji(e.value);var e})).join(", ")+"]"),Bi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Eo(t.startAt)),t.endAt&&(e+=", endAt: "+Eo(t.endAt)),"Target("+e+")"}(Mo(t))+"; limitType="+t.limitType+")"}function Ko(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):zi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!ko(t.startAt,Lo(t),e)||t.endAt&&ko(t.endAt,Lo(t),e))}(t,e)}function Go(t){return function(e,n){for(var r=!1,i=0,o=Lo(t);i<o.length;i++){var s=o[i],a=zo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function zo(t,e,n){var r=t.field.isKeyField()?zi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Yi(r,i):vi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return vi()}}function Qo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ki(e)?"-0":e}}function Ho(t){return{integerValue:""+t}}function Wo(t,e){return Gi(e)?Ho(e):Qo(t,e)}var Yo=function(){this._=void 0};function Xo(t,e,n){return t instanceof Zo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ts?es(t,e):t instanceof ns?rs(t,e):function(t,e){var n=$o(t,e),r=os(n)+os(t.A);return Zi(n)&&Zi(t.A)?Ho(r):Qo(t.R,r)}(t,e)}function Jo(t,e,n){return t instanceof ts?es(t,e):t instanceof ns?rs(t,e):n}function $o(t,e){return t instanceof is?Zi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Zo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e}(Yo),ts=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Z.c)(e,t),e}(Yo);function es(t,e){for(var n=ss(e),r=function(t){n.some((function(e){return Hi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ns=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Z.c)(e,t),e}(Yo);function rs(t,e){for(var n=ss(e),r=function(t){n=n.filter((function(e){return!Hi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var is=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(Z.c)(e,t),e}(Yo);function os(t){return Mi(t.integerValue||t.doubleValue)}function ss(t){return to(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var as=function(t,e){this.field=t,this.transform=e},us=function(t,e){this.version=t,this.transformResults=e},cs=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function hs(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var ls=function(){};function fs(t,e,n){t instanceof vs?function(t,e,n){var r=t.value.clone(),i=ws(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ms?function(t,e,n){if(hs(t.precondition,e)){var r=ws(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(bs(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ds(t,e,n){t instanceof vs?function(t,e,n){if(hs(t.precondition,e)){var r=t.value.clone(),i=Is(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ys(e),r).setHasLocalMutations()}}(t,e,n):t instanceof ms?function(t,e,n){if(hs(t.precondition,e)){var r=Is(t.fieldTransforms,n,e),i=e.data;i.setAll(bs(t)),i.setAll(r),e.convertToFoundDocument(ys(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){hs(t.precondition,e)&&e.convertToNoDocument(Si.min())}(t,e)}function ps(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=$o(o.transform,s||null);null!=a&&(null==n&&(n=oo.empty()),n.set(o.field,a))}return n||null}function gs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Ti(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ts&&e instanceof ts||t instanceof ns&&e instanceof ns?Ti(t.elements,e.elements,Hi):t instanceof is&&e instanceof is?Hi(t.A,e.A):t instanceof Zo&&e instanceof Zo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ys(t){return t.isFoundDocument()?t.version:Si.min()}var vs=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(Z.c)(e,t),e}(ls),ms=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(Z.c)(e,t),e}(ls);function bs(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function ws(t,e,n){var r=new Map;mi(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Jo(s,a,n[i]))}return r}function Is(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Xo(a,u,e))}return r}var Os,Ts,Es=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(Z.c)(e,t),e}(ls),_s=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(Z.c)(e,t),e}(ls),Ss=function(t){this.count=t};function ks(t){switch(t){case ci.OK:return vi();case ci.CANCELLED:case ci.UNKNOWN:case ci.DEADLINE_EXCEEDED:case ci.RESOURCE_EXHAUSTED:case ci.INTERNAL:case ci.UNAVAILABLE:case ci.UNAUTHENTICATED:return!1;case ci.INVALID_ARGUMENT:case ci.NOT_FOUND:case ci.ALREADY_EXISTS:case ci.PERMISSION_DENIED:case ci.FAILED_PRECONDITION:case ci.ABORTED:case ci.OUT_OF_RANGE:case ci.UNIMPLEMENTED:case ci.DATA_LOSS:return!0;default:return vi()}}function xs(t){if(void 0===t)return pi("GRPC error has no .code"),ci.UNKNOWN;switch(t){case Os.OK:return ci.OK;case Os.CANCELLED:return ci.CANCELLED;case Os.UNKNOWN:return ci.UNKNOWN;case Os.DEADLINE_EXCEEDED:return ci.DEADLINE_EXCEEDED;case Os.RESOURCE_EXHAUSTED:return ci.RESOURCE_EXHAUSTED;case Os.INTERNAL:return ci.INTERNAL;case Os.UNAVAILABLE:return ci.UNAVAILABLE;case Os.UNAUTHENTICATED:return ci.UNAUTHENTICATED;case Os.INVALID_ARGUMENT:return ci.INVALID_ARGUMENT;case Os.NOT_FOUND:return ci.NOT_FOUND;case Os.ALREADY_EXISTS:return ci.ALREADY_EXISTS;case Os.PERMISSION_DENIED:return ci.PERMISSION_DENIED;case Os.FAILED_PRECONDITION:return ci.FAILED_PRECONDITION;case Os.ABORTED:return ci.ABORTED;case Os.OUT_OF_RANGE:return ci.OUT_OF_RANGE;case Os.UNIMPLEMENTED:return ci.UNIMPLEMENTED;case Os.DATA_LOSS:return ci.DATA_LOSS;default:return vi()}}(Ts=Os||(Os={}))[Ts.OK=0]="OK",Ts[Ts.CANCELLED=1]="CANCELLED",Ts[Ts.UNKNOWN=2]="UNKNOWN",Ts[Ts.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ts[Ts.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ts[Ts.NOT_FOUND=5]="NOT_FOUND",Ts[Ts.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ts[Ts.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ts[Ts.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ts[Ts.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ts[Ts.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ts[Ts.ABORTED=10]="ABORTED",Ts[Ts.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ts[Ts.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ts[Ts.INTERNAL=13]="INTERNAL",Ts[Ts.UNAVAILABLE=14]="UNAVAILABLE",Ts[Ts.DATA_LOSS=15]="DATA_LOSS";var Ns=function(){function t(t,e){this.comparator=t,this.root=e||js.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,js.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,js.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Cs(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Cs(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Cs(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Cs(this.root,t,this.comparator,!0)},t}(),Cs=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),js=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw vi();if(this.right.isRed())throw vi();var t=this.left.check();if(t!==this.right.check())throw vi();return t+(this.isRed()?0:1)},t}();js.EMPTY=null,js.RED=!0,js.BLACK=!1,js.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw vi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw vi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw vi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw vi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw vi()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new js(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Ds=function(){function t(t){this.comparator=t,this.data=new Ns(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new As(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new As(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),As=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Rs=new Ns(zi.comparator);function Ps(){return Rs}var Fs=new Ns(zi.comparator);function Ls(){return Fs}var Ms=new Ns(zi.comparator);function Us(){return Ms}var Vs=new Ds(zi.comparator);function qs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Vs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Bs=new Ds(Oi);function Ks(){return Bs}var Gs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,zs.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Si.min(),r,Ks(),Ps(),qs())},t}(),zs=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Pi.EMPTY_BYTE_STRING,n,qs(),qs(),qs())},t}(),Qs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Hs=function(t,e){this.targetId=t,this.V=e},Ws=function(t,e,n,r){void 0===n&&(n=Pi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ys=function(){function t(){this.S=0,this.D=$s(),this.C=Pi.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=qs(),e=qs(),n=qs();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:vi()}})),new zs(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=$s()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),Xs=function(){function t(t){this.W=t,this.G=new Map,this.H=Ps(),this.J=Js(),this.Y=new Ds(Oi)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:vi()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(fo(i))if(0===n){var o=new zi(i.path);this.tt(e,o,ao.newNoDocument(o,Si.min()))}else mi(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&fo(o.target)){var s=new zi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,ao.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=qs();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Gs(t,n,this.Y,this.H,r);return this.H=Ps(),this.J=Js(),this.Y=new Ds(Oi),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Ys,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ds(Oi),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||di("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Ys),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Js(){return new Ns(zi.comparator)}function $s(){return new Ns(zi.comparator)}var Zs={asc:"ASCENDING",desc:"DESCENDING"},ta={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ea=function(t,e){this.databaseId=t,this.I=e};function na(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ra(t,e){return t.I?e.toBase64():e.toUint8Array()}function ia(t,e){return na(t,e.toTimestamp())}function oa(t){return mi(!!t),Si.fromTimestamp(function(t){var e=Li(t);return new _i(e.seconds,e.nanos)}(t))}function sa(t,e){return function(t){return new ji(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function aa(t){var e=ji.fromString(t);return mi(Ca(e)),e}function ua(t,e){return sa(t.databaseId,e.path)}function ca(t,e){var n=aa(e);if(n.get(1)!==t.databaseId.projectId)throw new hi(ci.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new hi(ci.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new zi(da(n))}function ha(t,e){return sa(t.databaseId,e)}function la(t){var e=aa(t);return 4===e.length?ji.emptyPath():da(e)}function fa(t){return new ji(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function da(t){return mi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function pa(t,e,n){return{name:ua(t,e),fields:n.value.mapValue.fields}}function ga(t,e,n){var r=ca(t,e.name),i=oa(e.updateTime),o=new oo({mapValue:{fields:e.fields}}),s=ao.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function ya(t,e){var n;if(e instanceof vs)n={update:pa(t,e.key,e.value)};else if(e instanceof Es)n={delete:ua(t,e.key)};else if(e instanceof ms)n={update:pa(t,e.key,e.data),updateMask:Na(e.fieldMask)};else{if(!(e instanceof _s))return vi();n={verify:ua(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Zo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ts)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ns)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof is)return{fieldPath:e.field.canonicalString(),increment:n.A};throw vi()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ia(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:vi()}(t,e.precondition)),n}function va(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?cs.updateTime(oa(t.updateTime)):void 0!==t.exists?cs.exists(t.exists):cs.none()}(e.currentDocument):cs.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;"setToServerValue"in e?(mi("REQUEST_TIME"===e.setToServerValue),n=new Zo):"appendMissingElements"in e?n=new ts(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new ns(e.removeAllFromArray.values||[]):"increment"in e?n=new is(t,e.increment):vi();var r=Ai.fromServerFormat(e.fieldPath);return new as(r,n)}(t,e)})):[];if(e.update){var i=ca(t,e.update.name),o=new oo({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new Ri((t.fieldPaths||[]).map((function(t){return Ai.fromServerFormat(t)})))}(e.updateMask);return new ms(i,o,s,n,r)}return new vs(i,o,n,r)}if(e.delete){var a=ca(t,e.delete);return new Es(a,n)}if(e.verify){var u=ca(t,e.verify);return new _s(u,n)}return vi()}function ma(t,e){return{documents:[ha(t,e.path)]}}function ba(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ha(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ha(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(no(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NAN"}};if(eo(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(no(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NOT_NAN"}};if(eo(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_a(t.field),op:Ea(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:_a(t.field),direction:Ta(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Bi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Ia(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ia(e.endAt)),n}function wa(t){var e=la(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){mi(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[xa(e)]:void 0!==e.fieldFilter?[ka(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):vi():[]}(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new _o(Sa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return Bi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Oa(n.startAt));var h=null;return n.endAt&&(h=Oa(n.endAt)),Co(e,i,a,s,u,"F",c,h)}function Ia(t){return{before:t.before,values:t.position}}function Oa(t){return new To(t.values||[],!!t.before)}function Ta(t){return Zs[t]}function Ea(t){return ta[t]}function _a(t){return{fieldPath:t.canonicalString()}}function Sa(t){return Ai.fromServerFormat(t.fieldPath)}function ka(t){return po.create(Sa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return vi()}}(t.fieldFilter.op),t.fieldFilter.value)}function xa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Sa(t.unaryFilter.field);return po.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Sa(t.unaryFilter.field);return po.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Sa(t.unaryFilter.field);return po.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Sa(t.unaryFilter.field);return po.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return vi()}}function Na(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Ca(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ja(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Aa(e)),e=Da(t.get(n),e);return Aa(e)}function Da(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Aa(t){return t+"\x01\x01"}function Ra(t){var e=t.length;if(mi(e>=2),2===e)return mi("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),ji.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&vi(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:vi()}o=s+2}return new ji(r)}var Pa=function(t,e){this.seconds=t,this.nanoseconds=e},Fa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Fa.store="owner",Fa.key="owner";var La=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};La.store="mutationQueues",La.keyPath="userId";var Ma=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ma.store="mutations",Ma.keyPath="batchId",Ma.userMutationsIndex="userMutationsIndex",Ma.userMutationsKeyPath=["userId","batchId"];var Ua=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ja(e)]},t.key=function(t,e,n){return[t,ja(e),n]},t}();Ua.store="documentMutations",Ua.PLACEHOLDER=new Ua;var Va=function(t,e){this.path=t,this.readTime=e},qa=function(t,e){this.path=t,this.version=e},Ba=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ba.store="remoteDocuments",Ba.readTimeIndex="readTimeIndex",Ba.readTimeIndexPath="readTime",Ba.collectionReadTimeIndex="collectionReadTimeIndex",Ba.collectionReadTimeIndexPath=["parentPath","readTime"];var Ka=function(t){this.byteSize=t};Ka.store="remoteDocumentGlobal",Ka.key="remoteDocumentGlobalKey";var Ga=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ga.store="targets",Ga.keyPath="targetId",Ga.queryTargetsIndexName="queryTargetsIndex",Ga.queryTargetsKeyPath=["canonicalId","targetId"];var za=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};za.store="targetDocuments",za.keyPath=["targetId","path"],za.documentTargetsIndex="documentTargetsIndex",za.documentTargetsKeyPath=["path","targetId"];var Qa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Qa.key="targetGlobalKey",Qa.store="targetGlobal";var Ha=function(t,e){this.collectionId=t,this.parent=e};Ha.store="collectionParents",Ha.keyPath=["collectionId","parent"];var Wa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Wa.store="clientMetadata",Wa.keyPath="clientId";var Ya=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ya.store="bundles",Ya.keyPath="bundleId";var Xa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Xa.store="namedQueries",Xa.keyPath="name";var Ja=Object(Z.f)(Object(Z.f)([],Object(Z.f)(Object(Z.f)([],Object(Z.f)(Object(Z.f)([],Object(Z.f)(Object(Z.f)([],[La.store,Ma.store,Ua.store,Ba.store,Ga.store,Fa.store,Qa.store,za.store]),[Wa.store])),[Ka.store])),[Ha.store])),[Ya.store,Xa.store]),$a="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Za=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),tu=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},eu=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&vi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),nu=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new tu,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new ou(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=hu(e.target.error);n.ft.reject(new ou(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new ou(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(di("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new au(e)},t}(),ru=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(tt.j)())&&pi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return di("SimpleDb","Removing database:",t),uu(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(tt.j)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(Z.b)(this,void 0,void 0,(function(){var e,n=this;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(di("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new ou(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new hi(ci.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new ou(t,n))},i.onupgradeneeded=function(t){di("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next((function(){di("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(Z.b)(this,void 0,void 0,(function(){var i,o,s,a,u;return Object(Z.d)(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(Z.d)(this,(function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=nu.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),eu.reject(t)})).toPromise(),u={},s.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return di("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),iu=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return uu(this.Pt.delete())},t}(),ou=function(t){function e(e,n){var r=this;return(r=t.call(this,ci.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(Z.c)(e,t),e}(hi);function su(t){return"IndexedDbTransactionError"===t.name}var au=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(di("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(di("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),uu(n)},t.prototype.add=function(t){return di("SimpleDb","ADD",this.store.name,t,t),uu(this.store.add(t))},t.prototype.get=function(t){var e=this;return uu(this.store.get(t)).next((function(n){return void 0===n&&(n=null),di("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return di("SimpleDb","DELETE",this.store.name,t),uu(this.store.delete(t))},t.prototype.count=function(){return di("SimpleDb","COUNT",this.store.name),uu(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.kt=function(t,e){di("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new eu((function(n,r){e.onerror=function(t){var e=hu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new eu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new iu(i),s=e(i.primaryKey,i.value,o);if(s instanceof eu){var a=s.catch((function(t){return o.done(),eu.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return eu.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function uu(t){return new eu((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=hu(t.target.error);n(e)}}))}var cu=!1;function hu(t){var e=ru._t(Object(tt.j)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new hi("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return cu||(cu=!0,setTimeout((function(){throw r}),0)),r}}return t}var lu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(Z.c)(e,t),e}(Za);function fu(t,e){var n=bi(t);return ru.It(n.Mt,e)}var du=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&fs(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&ds(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&ds(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Si.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),qs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ti(this.mutations,t.mutations,(function(t,e){return gs(t,e)}))&&Ti(this.baseMutations,t.baseMutations,(function(t,e){return gs(t,e)}))},t}(),pu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){mi(e.mutations.length===r.length);for(var i=Us(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),gu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Si.min()),void 0===o&&(o=Si.min()),void 0===s&&(s=Pi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),yu=function(t){this.Lt=t};function vu(t,e){if(e.document)return ga(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=zi.fromSegments(e.noDocument.path),r=Ou(e.noDocument.readTime),i=ao.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=zi.fromSegments(e.unknownDocument.path);return r=Ou(e.unknownDocument.version),ao.newUnknownDocument(o,r)}return vi()}function mu(t,e,n){var r=bu(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:ua(t,e.key),fields:e.data.value.mapValue.fields,updateTime:na(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Ba(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Iu(e.version);return s=e.hasCommittedMutations,new Ba(null,new Va(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Iu(e.version);return new Ba(new qa(c,h),null,null,!0,r,i)}return vi()}function bu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function wu(t){var e=new _i(t[0],t[1]);return Si.fromTimestamp(e)}function Iu(t){var e=t.toTimestamp();return new Pa(e.seconds,e.nanoseconds)}function Ou(t){var e=new _i(t.seconds,t.nanoseconds);return Si.fromTimestamp(e)}function Tu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return va(t.Lt,e)})),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map((function(e){return va(t.Lt,e)})),o=_i.fromMillis(e.localWriteTimeMs);return new du(e.batchId,o,n,i)}function Eu(t){var e,n,r=Ou(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ou(t.lastLimboFreeSnapshotVersion):Si.min();return void 0!==t.query.documents?(mi(1===(n=t.query).documents.length),e=Mo(jo(la(n.documents[0])))):e=function(t){return Mo(wa(t))}(t.query),new gu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Pi.fromBase64String(t.resumeToken))}function _u(t,e){var n,r=Iu(e.snapshotVersion),i=Iu(e.lastLimboFreeSnapshotVersion);n=fo(e.target)?ma(t.Lt,e.target):ba(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Ga(e.targetId,ho(e.target),r,o,e.sequenceNumber,i,n)}function Su(t){var e=wa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Uo(e,e.limit,"L"):e}var ku=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return xu(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Ou(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return xu(t).put({bundleId:(n=e).id,createTime:Iu(oa(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Nu(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Su(e.bundledQuery),readTime:Ou(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Nu(t).put(function(t){return{name:t.name,readTime:Iu(oa(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function xu(t){return fu(t,Ya.store)}function Nu(t){return fu(t,Xa.store)}var Cu=function(){function t(){this.Bt=new ju}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),eu.resolve()},t.prototype.getCollectionParents=function(t,e){return eu.resolve(this.Bt.getEntries(e))},t}(),ju=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ds(ji.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ds(ji.comparator)).toArray()},t}(),Du=function(){function t(){this.qt=new ju}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:ja(i)};return Au(t).put(o)}return eu.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ei(e),""],!1,!0);return Au(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ra(o.parent))}return n}))},t}();function Au(t){return fu(t,Ha.store)}var Ru={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Fu(t,e,n){var r=t.store(Ma.store),i=t.store(Ua.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){mi(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Ua.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return eu.waitFor(o).next((function(){return c}))}function Lu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw vi();e=t.noDocument}return JSON.stringify(e).length}Pu.DEFAULT_COLLECTION_PERCENTILE=10,Pu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pu.DEFAULT=new Pu(41943040,Pu.DEFAULT_COLLECTION_PERCENTILE,Pu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pu.DISABLED=new Pu(-1,0,0);var Mu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return mi(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Vu(t).$t({index:Ma.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=qu(t),s=Vu(t);return s.add({}).next((function(a){mi("number"==typeof a);for(var u=new du(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return ya(t.Lt,e)})),i=n.mutations.map((function(e){return ya(t.Lt,e)}));return new Ma(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Ds((function(t,e){return Oi(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],g=Ua.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Ua.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),eu.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Vu(t).get(e).next((function(t){return t?(mi(t.userId===n.userId),Tu(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?eu.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Vu(t).$t({index:Ma.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(mi(e.batchId>=r),o=Tu(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Vu(t).$t({index:Ma.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Vu(t).Nt(Ma.userMutationsIndex,n).next((function(t){return t.map((function(t){return Tu(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Ua.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return qu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[2],c=Ra(r[1]);if(a===n.userId&&e.path.isEqual(c))return Vu(t).get(u).next((function(t){if(!t)throw vi();mi(t.userId===n.userId),o.push(Tu(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ds(Oi),i=[];return e.forEach((function(e){var o=Ua.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=qu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[2],u=Ra(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()}));i.push(a)})),eu.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ua.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Ds(Oi);return qu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[2],c=Ra(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Vu(t).get(e).next((function(t){if(null===t)throw vi();mi(t.userId===n.userId),r.push(Tu(n.R,t))})))})),eu.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Fu(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),eu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return eu.resolve();var r=IDBKeyRange.lowerBound(Ua.prefixForUser(e.userId)),i=[];return qu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Ra(t[1]);i.push(o)}else r.done()})).next((function(){mi(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Uu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Bu(t).get(this.userId).next((function(t){return t||new La(e.userId,-1,"")}))},t}();function Uu(t,e,n){var r=Ua.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return qu(t).$t({range:o,Ft:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()})).next((function(){return s}))}function Vu(t){return fu(t,Ma.store)}function qu(t){return fu(t,Ua.store)}function Bu(t){return fu(t,La.store)}var Ku=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Gu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Ku(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Si.fromTimestamp(new _i(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return zu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return mi(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return zu(t).$t((function(s,a){var u=Eu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return eu.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return zu(t).$t((function(t,n){var r=Eu(n);e(r)}))},t.prototype.Xt=function(t){return Qu(t).get(Qa.key).next((function(t){return mi(null!==t),t}))},t.prototype.Zt=function(t,e){return Qu(t).put(Qa.key,e)},t.prototype.te=function(t,e){return zu(t).put(_u(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=ho(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return zu(t).$t({range:r,index:Ga.queryTargetsIndexName},(function(t,n,r){var o=Eu(n);lo(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Hu(t);return e.forEach((function(e){var s=ja(e.path);i.push(o.put(new za(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),eu.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Hu(t);return eu.forEach(e,(function(e){var o=ja(e.path);return eu.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Hu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Hu(t),i=qs();return r.$t({range:n,Ft:!0},(function(t,e,n){var r=Ra(t[1]),o=new zi(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=ja(e.path),r=IDBKeyRange.bound([n],[Ei(n)],!1,!0),i=0;return Hu(t).$t({index:za.documentTargetsIndex,Ft:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return zu(t).get(e).next((function(t){return t?Eu(t):null}))},t}();function zu(t){return fu(t,Ga.store)}function Qu(t){return fu(t,Qa.store)}function Hu(t){return fu(t,za.store)}function Wu(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){if(t.code!==ci.FAILED_PRECONDITION||t.message!==$a)throw t;return di("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Yu(t,e){var n=t[1],r=e[1],i=Oi(t[0],e[0]);return 0===i?Oi(n,r):i}var Xu=function(){function t(t){this.ne=t,this.buffer=new Ds(Yu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Yu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Ju=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;di("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return Object(Z.b)(e,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return su(e=n.sent())?(di("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Wu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),$u=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return eu.resolve(ui.o);var r=new Xu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(di("LruGarbageCollector","Garbage collection skipped; disabled"),eu.resolve(Ru)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(di("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Ru):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(di("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),fi()<=et.a.DEBUG&&di("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),eu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),Zu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new $u(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return tc(t,n)},t.prototype.removeReference=function(t,e,n){return tc(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return tc(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Bu(t).Ot((function(r){return Uu(t,r,e).next((function(t){return t&&(n=!0),eu.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Hu(t).delete([0,ja(s.path)])}))}));i.push(u)}})).next((function(){return eu.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return tc(t,e)},t.prototype.we=function(t,e){var n,r=Hu(t),i=ui.o;return r.$t({index:za.documentTargetsIndex},(function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==ui.o&&e(new zi(Ra(n)),i),i=s,n=o):i=ui.o})).next((function(){i!==ui.o&&e(new zi(Ra(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function tc(t,e){return Hu(t).put(function(t,e){return new za(0,ja(t.path),e)}(e,t.currentSequenceNumber))}var ec=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){xi(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},t.prototype.isEmpty=function(){return Ni(this.inner)},t}(),nc=function(){function t(){this.changes=new ec((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Si.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:ao.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?eu.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),rc=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return sc(t).put(ac(e),n)},t.prototype.removeEntry=function(t,e){var n=sc(t),r=ac(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return sc(t).get(ac(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return sc(t).get(ac(e)).next((function(t){return{document:n.ye(e,t),size:Lu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Ps();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Ps(),i=new Ns(zi.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Lu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return eu.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return sc(t).$t({range:r},(function(t,e,r){for(var s=zi.fromSegments(t);o&&zi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Ps(),o=e.path.length+1,s={};if(n.isEqual(Si.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=bu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Ba.collectionReadTimeIndex}return sc(t).$t(s,(function(t,n,s){if(t.length===o){var a=vu(r.R,n);e.path.isPrefixOf(a.key.path)?Ko(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new ic(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return oc(t).get(Ka.key).next((function(t){return mi(!!t),t}))},t.prototype.me=function(t,e){return oc(t).put(Ka.key,e)},t.prototype.ye=function(t,e){if(e){var n=vu(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Si.min()))return n}return ao.newInvalidDocument(t)},t}(),ic=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ec((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(Z.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ds((function(t,e){return Oi(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=mu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Lu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=mu(e.Ie.R,ao.newNoDocument(o,Si.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),eu.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(nc);function oc(t){return fu(t,Ka.store)}function sc(t){return fu(t,Ba.store)}function ac(t){return t.path.toArray()}var uc=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;mi(n<r&&n>=0&&r<=11);var o=new nu("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Fa.store)}(t),function(t){t.createObjectStore(La.store,{keyPath:La.keyPath}),t.createObjectStore(Ma.store,{keyPath:Ma.keyPath,autoIncrement:!0}).createIndex(Ma.userMutationsIndex,Ma.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ua.store)}(t),cc(t),function(t){t.createObjectStore(Ba.store)}(t));var s=eu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(za.store),t.deleteObjectStore(Ga.store),t.deleteObjectStore(Qa.store)}(t),cc(t)),s=s.next((function(){return function(t){var e=t.store(Qa.store),n=new Qa(0,0,Si.min().toTimestamp(),0);return e.put(Qa.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Ma.store).Nt().next((function(n){t.deleteObjectStore(Ma.store),t.createObjectStore(Ma.store,{keyPath:Ma.keyPath,autoIncrement:!0}).createIndex(Ma.userMutationsIndex,Ma.userMutationsKeyPath,{unique:!0});var r=e.store(Ma.store),i=n.map((function(t){return r.put(t)}));return eu.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Wa.store,{keyPath:Wa.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Ka.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ba.store);e.createIndex(Ba.readTimeIndex,Ba.readTimeIndexPath,{unique:!1}),e.createIndex(Ba.collectionReadTimeIndex,Ba.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Ya.store,{keyPath:Ya.keyPath})}(t),function(t){t.createObjectStore(Xa.store,{keyPath:Xa.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Ba.store).$t((function(t,n){e+=Lu(n)})).next((function(){var n=new Ka(e);return t.store(Ka.store).put(Ka.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(La.store),r=t.store(Ma.store);return n.Nt().next((function(n){return eu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Ma.userMutationsIndex,i).next((function(r){return eu.forEach(r,(function(r){mi(r.userId===n.userId);var i=Tu(e.R,r);return Fu(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(za.store),n=t.store(Ba.store);return t.store(Qa.store).get(Qa.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new ji(n),s=function(t){return[0,ja(t)]}(o);r.push(e.get(s).next((function(n){return n?eu.resolve():function(n){return e.put(new za(0,ja(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return eu.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(Ha.store,{keyPath:Ha.keyPath});var n=e.store(Ha.store),r=new ju,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ja(i)})}};return e.store(Ba.store).$t({Ft:!0},(function(t,e){var n=new ji(t);return i(n.popLast())})).next((function(){return e.store(Ua.store).$t({Ft:!0},(function(t,e){var n=Ra(t[1]);return i(n.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(Ga.store);return n.$t((function(t,r){var i=Eu(r),o=_u(e.R,i);return n.put(o)}))},t}();function cc(t){t.createObjectStore(za.store,{keyPath:za.keyPath}).createIndex(za.documentTargetsIndex,za.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ga.store,{keyPath:Ga.keyPath}).createIndex(Ga.queryTargetsIndexName,Ga.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Qa.store)}var hc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",lc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new hi(ci.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Zu(this,i),this.Le=n+"main",this.R=new yu(u),this.Be=new ru(this.Le,11,new uc(this.R)),this.qe=new Gu(this.referenceDelegate,this.R),this.Ut=new Du,this.Ue=function(t,e){return new rc(t,e)}(this.R,this.Ut),this.Ke=new ku,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&pi("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new hi(ci.FAILED_PRECONDITION,hc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new ui(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(Z.b)(e,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return Object(Z.b)(e,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return Object(Z.b)(e,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return dc(e).put(new Wa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(su(e))return di("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return di("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return fc(t).get(Fa.key).next((function(t){return eu.resolve(e.tn(t))}))},t.prototype.en=function(t){return dc(t).delete(this.clientId)},t.prototype.nn=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=fu(t,Wa.store);return e.Nt().next((function(t){var n=r.rn(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return eu.forEach(i,(function(t){return e.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?eu.resolve(!0):fc(t).get(Fa.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new hi(ci.FAILED_PRECONDITION,hc);return!1}}return!(!e.networkEnabled||!e.inForeground)||dc(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&di("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t=this;return Object(Z.d)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Fa.store,Wa.store],(function(e){var n=new lu(e,ui.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return dc(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Mu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return di("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ja,(function(o){return r=new lu(o,i.Ne?i.Ne.next():ui.o),"readwrite-primary"===e?i.Je(r).next((function(t){return!!t||i.Ye(r)})).next((function(e){if(!e)throw pi("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable((function(){return i.Me(!1)})),new hi(ci.FAILED_PRECONDITION,$a);return n(r)})).next((function(t){return i.Ze(r).next((function(){return t}))})):i.dn(r).next((function(){return n(r)}))})).then((function(t){return r.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return fc(t).get(Fa.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new hi(ci.FAILED_PRECONDITION,hc)}))},t.prototype.Ze=function(t){var e=new Fa(this.clientId,this.allowTabSynchronization,Date.now());return fc(t).put(Fa.key,e)},t.yt=function(){return ru.yt()},t.prototype.Xe=function(t){var e=this,n=fc(t);return n.get(Fa.key).next((function(t){return e.tn(t)?(di("IndexedDbPersistence","Releasing primary lease."),n.delete(Fa.key)):eu.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(pi("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),Object(tt.r)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return di("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return pi("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){pi("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function fc(t){return fu(t,Fa.store)}function dc(t){return fu(t,Wa.store)}function pc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var gc=function(t,e){this.progress=t,this.wn=e},yc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return zi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Fo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new zi(e)).next((function(t){var e=Ls();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Ls();return this.Ut.getCollectionParents(t,i).next((function(s){return eu.forEach(s,(function(s){var a=function(t,e){return new No(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o.Rn(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=ao.newInvalidDocument(c),r=r.insert(c,h)),ds(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Ko(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=qs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ms&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),vc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=qs(),i=qs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),mc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Si.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return(Do(e)||Ao(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(fi()<=et.a.DEBUG&&di("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Bo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Ds(Go(t));return e.forEach((function(e,r){Ko(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return fi()<=et.a.DEBUG&&di("QueryEngine","Using full collection scan to execute query:",Bo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Si.min())},t}(),bc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Ns(Oi),this.Fn=new ec((function(t){return ho(t)}),lo),this.$n=Si.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new yc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},t}();function wc(t,e,n,r){return new bc(t,e,n,r)}function Ic(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(Z.d)(this,(function(s){switch(s.label){case 0:return n=bi(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new yc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=qs(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Oc(t,e){var n=bi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=eu.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);mi(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Tc(t){var e=bi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Ec(t,e){var n=bi(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return mi(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=Ps();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(_c(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Si.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return eu.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.kn=i,t}))}function _c(t,e,n,r,i){var o=qs();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Ps();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Si.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):di("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Sc(t,e){var n=bi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function kc(t,e){var n=bi(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?eu.resolve(r=i):n.qe.allocateTargetId(t).next((function(i){return r=new gu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t}))}function xc(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(Z.d)(this,(function(a){switch(a.label){case 0:r=bi(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!su(s=a.sent()))throw s;return di("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}}))}))}function Nc(t,e,n){var r=bi(t),i=Si.min(),o=qs();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=bi(t),i=r.Fn.get(n);return void 0!==i?eu.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,Mo(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Si.min(),n?o:qs())})).next((function(t){return{documents:t,Bn:o}}))}))}function Cc(t,e){var n=bi(t),r=bi(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function jc(t){var e=bi(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=bi(t),i=Ps(),o=bu(n),s=sc(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Ba.readTimeIndex,range:a},(function(t,e){var n=vu(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:wu(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn;return e.$n=t.readTime,n}))}function Dc(t){return Object(Z.b)(this,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){return[2,(e=bi(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=sc(t),n=Si.min();return e.$t({index:Ba.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=wu(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}function Ac(t,e,n,r){return Object(Z.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return Object(Z.d)(this,(function(p){switch(p.label){case 0:for(i=bi(t),o=qs(),s=Ps(),a=Us(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,kc(i,function(t){return Mo(jo(ji.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return _c(t,f,s,Si.min(),a).next((function(e){return f.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Rc(t,e,n){return void 0===n&&(n=qs()),Object(Z.b)(this,void 0,void 0,(function(){var r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return[4,kc(t,Mo(Su(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=bi(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=oa(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Pi.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Ke.saveNamedQuery(t,e)}))}))]}}))}))}var Pc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return eu.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:oa(n.createTime)}),eu.resolve()},t.prototype.getNamedQuery=function(t,e){return eu.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Su(t.bundledQuery),readTime:oa(t.readTime)}}(e)),eu.resolve()},t}(),Fc=function(){function t(){this.Wn=new Ds(Lc.Gn),this.zn=new Ds(Lc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Lc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Lc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new zi(new ji([])),r=new Lc(n,t),i=new Lc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new zi(new ji([])),n=new Lc(e,t),r=new Lc(e,t+1),i=qs();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Lc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Lc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return zi.comparator(t.key,e.key)||Oi(t.ns,e.ns)},t.Hn=function(t,e){return Oi(t.ns,e.ns)||zi.comparator(t.key,e.key)},t}(),Mc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ds(Lc.Gn)}return t.prototype.checkEmpty=function(t){return eu.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new du(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Lc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return eu.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return eu.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return eu.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return eu.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return eu.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Lc(e,0),i=new Lc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),eu.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ds(Oi);return e.forEach((function(t){var e=new Lc(t,0),i=new Lc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),eu.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;zi.isDocumentKey(i)||(i=i.child(""));var o=new Lc(new zi(i),0),s=new Ds(Oi);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),eu.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;mi(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return eu.forEach(e.mutations,(function(i){var o=new Lc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Lc(e,0),r=this.rs.firstAfterOrEqual(n);return eu.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return eu.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Uc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ns(zi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return eu.resolve(n?n.document.clone():ao.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ps();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():ao.newInvalidDocument(t))})),eu.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ps(),i=new zi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Ko(e,u)&&(r=r.insert(u.key,u.clone()))}return eu.resolve(r)},t.prototype.fs=function(t,e){return eu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Vc(this)},t.prototype.getSize=function(t){return eu.resolve(this.size)},t}(),Vc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(Z.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),eu.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(nc),qc=function(){function t(t){this.persistence=t,this.ds=new ec((function(t){return ho(t)}),lo),this.lastRemoteSnapshotVersion=Si.min(),this.highestTargetId=0,this.ws=0,this._s=new Fc,this.targetCount=0,this.ys=Ku.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),eu.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return eu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return eu.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),eu.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),eu.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Ku(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,eu.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),eu.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,eu.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),eu.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return eu.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return eu.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),eu.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),eu.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),eu.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return eu.resolve(n)},t.prototype.containsKey=function(t,e){return eu.resolve(this._s.containsKey(e))},t}(),Bc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new ui(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new qc(this),this.Ut=new Cu,this.Ue=function(t,e){return new Uc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new yu(e),this.Ke=new Pc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Mc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;di("MemoryPersistence","Starting transaction:",t);var i=new Kc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return eu.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),Kc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(Z.c)(e,t),e}(Za),Gc=function(){function t(t){this.persistence=t,this.As=new Fc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw vi()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),eu.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),eu.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),eu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eu.forEach(this.vs,(function(r){var i=zi.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return eu.or([function(){return eu.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),zc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Qc(t,e){return"firestore_clients_"+t+"_"+e}function Hc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Wc(t,e){return"firestore_targets_"+t+"_"+e}zc.UNAUTHENTICATED=new zc(null),zc.GOOGLE_CREDENTIALS=new zc("google-credentials-uid"),zc.FIRST_PARTY=new zc("first-party-uid"),zc.MOCK_USER=new zc("mock-user");var Yc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new hi(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(pi("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Xc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new hi(i.error.code,i.error.message)),o?new t(e,i.state,r):(pi("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Jc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ks(),s=0;i&&s<r.activeTargetIds.length;++s)i=Gi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(pi("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),$c=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(pi("SharedClientState","Failed to parse online state: "+e),null)},t}(),Zc=function(){function t(){this.activeTargetIds=Ks()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),th=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Ns(Oi),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Qc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new Zc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(Z.d)(this,(function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Qc(this.persistenceKey,r)))&&(o=Jc.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.ks(c[u]);return this.$s=[],this.window.addEventListener("pagehide",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Wc(this.persistenceKey,t));if(n){var r=Xc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Wc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return di("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){di("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){di("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(di("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void pi("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return Object(Z.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(Z.d)(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=ui.o;if(null!=t)try{var n=JSON.parse(t);mi("number"==typeof n),e=n}catch(t){pi("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==ui.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Yc(this.currentUser,t,e,n),i=Hc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Hc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Wc(this.persistenceKey,t),i=new Xc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Jc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Yc.Vs(new zc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Xc.Vs(r,e)},t.prototype.js=function(t){return $c.Vs(t)},t.prototype.ii=function(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(di("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Ks();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),eh=function(){function t(){this.li=new Zc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Zc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),nh=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),rh=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){di("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){di("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),ih={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},oh=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),sh=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(Z.c)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise((function(i,o){var s=new ai;s.listenOnce(ri.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case ni.NO_ERROR:var e=s.getResponseJson();di("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ni.TIMEOUT:di("Connection",'RPC "'+t+'" timed out'),o(new hi(ci.DEADLINE_EXCEEDED,"Request time out"));break;case ni.HTTP_ERROR:var n=s.getStatus();if(di("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(ci).indexOf(e)>=0?e:ci.UNKNOWN}(r.status);o(new hi(a,r.message))}else o(new hi(ci.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new hi(ci.UNAVAILABLE,"Connection failed."));break;default:vi()}}finally{di("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Jr,i=Ge(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new oi({})),this.ki(o.initMessageHeaders,e),Object(tt.o)()||Object(tt.q)()||Object(tt.m)()||Object(tt.n)()||Object(tt.s)()||Object(tt.l)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");di("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new oh({Ei:function(t){c?di("Connection","Not sending because WebChannel is closed:",t):(u||(di("Connection","Opening WebChannel transport."),a.open(),u=!0),di("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return l(a,si.EventType.OPEN,(function(){c||di("Connection","WebChannel transport opened.")})),l(a,si.EventType.CLOSE,(function(){c||(c=!0,di("Connection","WebChannel transport closed"),h.Vi())})),l(a,si.EventType.ERROR,(function(t){c||(c=!0,gi("Connection","WebChannel transport errored:",t),h.Vi(new hi(ci.UNAVAILABLE,"The operation could not be completed")))})),l(a,si.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];mi(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){di("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Os[t];if(void 0!==e)return xs(e)}(i),s=r.message;void 0===o&&(o=ci.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new hi(o,s)),a.close()}else di("Connection","WebChannel received:",n),h.Si(n)}})),l(i,ii.STAT_EVENT,(function(t){10===t.stat?di("Connection","Detected buffering proxy"):11===t.stat&&di("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Pi()}),0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);di("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then((function(t){return di("RestConnection","Received: ",t),t}),(function(e){throw gi("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+ih[t]},t}());function ah(){return"undefined"!=typeof window?window:null}function uh(){return"undefined"!=typeof document?document:null}function ch(t){return new ea(t,!0)}var hh=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&di("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),lh=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new hh(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===ci.RESOURCE_EXHAUSTED?(pi(e.toString()),pi("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===ci.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new hi(ci.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return Object(Z.b)(t,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return di("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(di("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),fh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(Z.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:vi()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(mi(void 0===e||"string"==typeof e),Pi.fromBase64String(e||"")):(mi(void 0===e||e instanceof Uint8Array),Pi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?ci.UNKNOWN:xs(t.code);return new hi(e,t.message||"")}(a);n=new Ws(r,i,o,s||null)}else if("documentChange"in e){i=ca(t,(r=e.documentChange).document.name),o=oa(r.document.updateTime);var a=new oo({mapValue:{fields:r.document.fields}}),u=(s=ao.newFoundDocument(i,o,a),r.targetIds||[]);n=new Qs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=ca(t,(r=e.documentDelete).document),o=r.readTime?oa(r.readTime):Si.min(),a=ao.newNoDocument(i,o),n=new Qs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=ca(t,(r=e.documentRemove).document),n=new Qs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return vi();var c=e.filter;i=new Ss(r=c.count||0),n=new Hs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Si.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Si.min():e.readTime?oa(e.readTime):Si.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=fa(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=fo(r)?{documents:ma(t,r)}:{query:ba(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ra(t,e.resumeToken):e.snapshotVersion.compareTo(Si.min())>0&&(n.readTime=na(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return vi()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=fa(this.R),e.removeTarget=t,this.cr(e)},e}(lh),dh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(Z.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(mi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(mi(void 0!==e),t.map((function(t){return function(t,e){var n=oa(t.updateTime?t.updateTime:e);return n.isEqual(Si.min())&&(n=oa(e)),new us(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=oa(t.commitTime);return this.listener.Tr(n,e)}return mi(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=fa(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return ya(e.R,t)}))};this.cr(n)},e}(lh),ph=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(Z.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new hi(ci.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===ci.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new hi(ci.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===ci.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new hi(ci.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),gh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(pi(e),this.Vr=!1):di("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),yh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return Object(Z.b)(o,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){switch(t.label){case 0:return _h(this)?(di("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(Z.b)(this,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return(e=bi(t)).Or.add(4),[4,mh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,vh(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new gh(n,r)};function vh(t){return Object(Z.b)(this,void 0,void 0,(function(){var e,n;return Object(Z.d)(this,(function(r){switch(r.label){case 0:if(!_h(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function mh(t){return Object(Z.b)(this,void 0,void 0,(function(){var e,n;return Object(Z.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function bh(t,e){var n=bi(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Eh(n)?Th(n):Vh(n).er()&&Ih(n,e))}function wh(t,e){var n=bi(t),r=Vh(n);n.$r.delete(e),r.er()&&Oh(n,e),0===n.$r.size&&(r.er()?r.ir():_h(n)&&n.Br.set("Unknown"))}function Ih(t,e){t.qr.U(e.targetId),Vh(t).mr(e)}function Oh(t,e){t.qr.U(e),Vh(t).yr(e)}function Th(t){t.qr=new Xs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Vh(t).start(),t.Br.Sr()}function Eh(t){return _h(t)&&!Vh(t).tr()&&t.$r.size>0}function _h(t){return 0===bi(t).Or.size}function Sh(t){t.qr=void 0}function kh(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){return t.$r.forEach((function(e,n){Ih(t,e)})),[2]}))}))}function xh(t,e){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(n){return Sh(t),Eh(t)?(t.Br.Nr(e),Th(t)):t.Br.set("Unknown"),[2]}))}))}function Nh(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i,o;return Object(Z.d)(this,(function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Ws&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(Z.d)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),di("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Ch(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Qs?t.qr.X(e):e instanceof Hs?t.qr.rt(e):t.qr.et(e),n.isEqual(Si.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Tc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Pi.EMPTY_BYTE_STRING,n.snapshotVersion)),Oh(t,e);var r=new gu(n.target,e,1,n.sequenceNumber);Ih(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return di("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Ch(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Ch(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r=this;return Object(Z.d)(this,(function(i){switch(i.label){case 0:if(!su(e))throw e;return t.Or.add(1),[4,mh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Tc(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return Object(Z.b)(r,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return di("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,vh(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function jh(t,e){return e().catch((function(n){return Ch(t,n,e)}))}function Dh(t){return Object(Z.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(Z.d)(this,(function(s){switch(s.label){case 0:e=bi(t),n=qh(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return _h(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Sc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=qh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Ch(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Ah(e)&&Rh(e),[2]}}))}))}function Ah(t){return _h(t)&&!qh(t).tr()&&t.Fr.length>0}function Rh(t){qh(t).start()}function Ph(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){return qh(t).Ar(),[2]}))}))}function Fh(t){return Object(Z.b)(this,void 0,void 0,(function(){var e,n,r;return Object(Z.d)(this,(function(i){for(e=qh(t),n=0,r=t.Fr;n<r.length;n++)e.Er(r[n].mutations);return[2]}))}))}function Lh(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=pu.from(r,e,n),[4,jh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Dh(t)];case 2:return o.sent(),[2]}}))}))}function Mh(t,e){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(n){switch(n.label){case 0:return e&&qh(t).pr?[4,function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return ks(r=e.code)&&r!==ci.ABORTED?(n=t.Fr.shift(),qh(t).sr(),[4,jh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Dh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Ah(t)&&Rh(t),[2]}}))}))}function Uh(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return n=bi(t),e?(n.Or.delete(2),[4,vh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,mh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Vh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=bi(t);return r.br(),new fh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:kh.bind(null,t),Ri:xh.bind(null,t),_r:Nh.bind(null,t)}),t.Mr.push((function(n){return Object(Z.b)(e,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Eh(t)?Th(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Sh(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function qh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=bi(t);return r.br(),new dh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ph.bind(null,t),Ri:Mh.bind(null,t),Ir:Fh.bind(null,t),Tr:Lh.bind(null,t)}),t.Mr.push((function(n){return Object(Z.b)(e,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Dh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(di("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var Bh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new tu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new hi(ci.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Kh(t,e){if(pi("AsyncQueue",e+": "+t),su(t))return new hi(ci.UNAVAILABLE,e+": "+t);throw t}var Gh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||zi.comparator(e.key,n.key)}:function(t,e){return zi.comparator(t.key,e.key)},this.keyedMap=Ls(),this.sortedSet=new Ns(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),zh=function(){function t(){this.Qr=new Ns(zi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):vi():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),Qh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Gh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Vo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Hh=function(){this.Wr=void 0,this.listeners=[]},Wh=function(){this.queries=new ec((function(t){return qo(t)}),Vo),this.onlineState="Unknown",this.Gr=new Set};function Yh(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(Z.d)(this,(function(c){switch(c.label){case 0:if(n=bi(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Hh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Kh(a,"Initialization of query '"+Bo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Zh(n),[2]}}))}))}function Xh(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(Z.d)(this,(function(a){return n=bi(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function Jh(t,e){for(var n=bi(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Zh(n)}function $h(t,e,n){var r=bi(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Zh(t){t.Gr.forEach((function(t){t.next()}))}var tl=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Qh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Qh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),el=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),nl=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return ca(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?ga(this.R,t.document,!1):ao.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return oa(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new nl(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||qs()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return[4,Ac(this.localStore,new nl(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Rc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new gc(Object.assign({},this.progress),t))]}}))}))}}();var rl=function(t){this.key=t},il=function(t){this.key=t},ol=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=qs(),this.mutatedKeys=qs(),this.lo=Go(t),this.fo=new Gh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new zh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Do(this.query)&&i.size===this.query.limit?i.last():null,c=Ao(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Ko(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Do(this.query)||Ao(this.query))for(;s.size>this.query.limit;){var h=Do(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return vi()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Qh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new zh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=qs(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new il(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new rl(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=qs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Qh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),sl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},al=function(t){this.key=t,this.bo=!1},ul=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ec((function(t){return qo(t)}),Vo),this.Vo=new Map,this.So=new Set,this.Do=new Ns(zi.comparator),this.Co=new Map,this.No=new Fc,this.xo={},this.ko=new Map,this.Fo=Ku.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function cl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(Z.d)(this,(function(a){switch(a.label){case 0:return n=Ml(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,kc(n.localStore,Mo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,hl(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&bh(n.remoteStore,o),a.label=4;case 4:return[2,r]}}))}))}function hl(t,e,n,r){return Object(Z.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c;return Object(Z.d)(this,(function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(Z.b)(this,void 0,void 0,(function(){var i,o,s;return Object(Z.d)(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Nc(t.localStore,e.query,!1).then((function(t){return e.view._o(t.documents,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Tl(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Nc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new ol(e,i.Bn),s=o._o(i.documents),a=zs.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Tl(t,n,u.To),c=new sl(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}}))}))}function ll(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return n=bi(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!Vo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,xc(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),wh(n.remoteStore,r.targetId),Il(n,r.targetId)})).catch(Wu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Il(n,r.targetId),[4,xc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function fl(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(Z.d)(this,(function(a){switch(a.label){case 0:r=Ul(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=bi(t),i=_i.now(),o=e.reduce((function(t,e){return t.add(e.key)}),qs());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=ps(c,n.get(c.key));null!=h&&s.push(new ms(c.key,h,so(h.value.mapValue),cs.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ns(Oi)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Sl(r,i.changes)];case 3:return a.sent(),[4,Dh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Kh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function dl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r;return Object(Z.d)(this,(function(i){switch(i.label){case 0:n=bi(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Ec(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(mi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?mi(r.bo):t.removedDocuments.size>0&&(mi(r.bo),r.bo=!1))})),[4,Sl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Wu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function pl(t,e,n){var r=bi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=bi(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&Zh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function gl(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u;return Object(Z.d)(this,(function(c){switch(c.label){case 0:return(r=bi(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Ns(zi.comparator)).insert(o,ao.newNoDocument(o,Si.min())),a=qs().add(o),u=new Gs(Si.min(),new Map,new Ds(Oi),s,a),[4,dl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),_l(r),[3,4];case 2:return[4,xc(r.localStore,e,!1).then((function(){return Il(r,e,n)})).catch(Wu)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function yl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:n=bi(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Oc(n.localStore,e)];case 2:return i=o.sent(),wl(n,r,null),bl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Sl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Wu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function vl(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:r=bi(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=bi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return mi(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),wl(r,e,n),bl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Sl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Wu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function ml(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(Z.d)(this,(function(a){switch(a.label){case 0:_h((n=bi(t)).remoteStore)||di("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=bi(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=Kh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function bl(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function wl(t,e,n){var r=bi(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Il(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Ol(t,e)}))}function Ol(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(wh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),_l(t))}function Tl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof rl?(t.No.addReference(o.key,e),El(t,o)):o instanceof il?(di("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Ol(t,o.key)):vi()}}function El(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(di("SyncEngine","New document in limbo: "+n),t.So.add(r),_l(t))}function _l(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new zi(ji.fromString(e)),r=t.Fo.next();t.Co.set(r,new al(n)),t.Do=t.Do.insert(n,r),bh(t.remoteStore,new gu(Mo(jo(n.path)),r,2,ui.o))}}function Sl(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(Z.d)(this,(function(a){switch(a.label){case 0:return r=bi(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.Oo(a,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=vc.Pn(a.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return Object(Z.d)(this,(function(h){switch(h.label){case 0:n=bi(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return eu.forEach(e,(function(e){return eu.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return eu.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!su(r=h.sent()))throw r;return di("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.kn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.kn=n.kn.insert(a,c));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function kl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return(n=bi(t)).currentUser.isEqual(e)?[3,3]:(di("SyncEngine","User change. New user:",e.toKey()),[4,Ic(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach((function(t){t.forEach((function(t){t.reject(new hi(ci.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Sl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function xl(t,e){var n=bi(t),r=n.Co.get(e);if(r&&r.bo)return qs().add(r.key);var i=qs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Nl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return[4,Nc((n=bi(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Tl(n,e.targetId,i.To),i)]}}))}))}function Cl(t){return Object(Z.b)(this,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){return[2,jc((e=bi(t)).localStore).then((function(t){return Sl(e,t)}))]}))}))}function jl(t,e,n,r){return Object(Z.b)(this,void 0,void 0,(function(){var i,o;return Object(Z.d)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=bi(t),r=bi(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):eu.resolve(null)}))}))}((i=bi(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Dh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(wl(i,e,r||null),bl(i,e),function(t,e){bi(bi(t)._n).Gt(e)}(i.localStore,e)):vi(),s.label=4;case 4:return[4,Sl(i,o)];case 5:return s.sent(),[3,7];case 6:di("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Dl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(Z.d)(this,(function(c){switch(c.label){case 0:return Ml(n=bi(t)),Ul(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Al(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Uh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)bh(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then((function(){return Il(n,e),xc(n.localStore,e,!0)})),wh(n.remoteStore,e)})),[4,u]);case 4:return c.sent(),[4,Al(n,a)];case 5:return c.sent(),function(t){var e=bi(t);e.Co.forEach((function(t,n){wh(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Ns(zi.comparator)}(n),n.$o=!1,[4,Uh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))}function Al(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(Z.d)(this,(function(g){switch(g.label){case 0:n=bi(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,kc(n.localStore,Mo(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Nl(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Cc(n.localStore,a)];case 8:return p=g.sent(),[4,kc(n.localStore,p)];case 9:return u=g.sent(),[4,hl(n,Rl(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function Rl(t){return Co(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Pl(t){var e=bi(t);return bi(bi(e.localStore).persistence).fn()}function Fl(t,e,n,r){return Object(Z.b)(this,void 0,void 0,(function(){var i,o,s;return Object(Z.d)(this,(function(a){switch(a.label){case 0:return(i=bi(t)).$o?(di("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,jc(i.localStore)];case 3:return o=a.sent(),s=Gs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Sl(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,xc(i.localStore,e,!0)];case 6:return a.sent(),Il(i,e,r),[3,8];case 7:vi(),a.label=8;case 8:return[2]}}))}))}function Ll(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,h,l;return Object(Z.d)(this,(function(f){switch(f.label){case 0:if(!(r=Ml(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(di("SyncEngine","Adding an already active target "+s),[3,5]):[4,Cc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,kc(r.localStore,a)];case 3:return u=f.sent(),[4,hl(r,Rl(a),u.targetId,!1)];case 4:f.sent(),bh(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,xc(r.localStore,t,!1).then((function(){wh(r.remoteStore,t),Il(r,t)})).catch(Wu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function Ml(t){var e=bi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=dl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gl.bind(null,e),e.vo._r=Jh.bind(null,e.eventManager),e.vo.Mo=$h.bind(null,e.eventManager),e}function Ul(t){var e=bi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=yl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=vl.bind(null,e),e}var Vl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return this.R=ch(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return wc(this.persistence,new mc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Bc(Gc.bs,this.R)},t.prototype.Bo=function(t){return new eh},t.prototype.terminate=function(){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),ql=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(Z.c)(e,t),e.prototype.initialize=function(e){return Object(Z.b)(this,void 0,void 0,(function(){var n=this;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,Dc(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,Ul(this.Qo.syncEngine)];case 4:return r.sent(),[4,Dh(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}))];case 6:return r.sent(),[2]}}))}))},e.prototype.Ko=function(t){return wc(this.persistence,new mc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Ju(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=pc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Pu.withCacheSize(this.cacheSizeBytes):Pu.DEFAULT;return new lc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,ah(),uh(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new eh},e}(Vl),Bl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(Z.c)(e,t),e.prototype.initialize=function(e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r=this;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof th?(this.sharedClientState.syncEngine={ui:jl.bind(null,n),ai:Fl.bind(null,n),hi:Ll.bind(null,n),fn:Pl.bind(null,n),ci:Cl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return Object(Z.b)(r,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return[4,Dl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=ah();if(!th.yt(e))throw new hi(ci.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=pc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new th(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(ql),Kl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n=this;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return pl(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=kl.bind(null,this.syncEngine),[4,Uh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new Wh},t.prototype.createDatastore=function(t){var e=ch(t.databaseInfo.databaseId),n=new sh(t.databaseInfo);return function(t,e,n){return new ph(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return pl(s.syncEngine,t,0)},o=rh.yt()?new rh:new nh,new yh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new ul(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(Z.b)(this,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return e=bi(t),di("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,mh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),Gl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),zl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new tu,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new el(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return Object(Z.b)(this,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(Z.b)(this,void 0,void 0,(function(){var e,n=this;return Object(Z.d)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new hi(ci.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(Z.d)(this,(function(u){switch(u.label){case 0:return n=bi(t),r=fa(n.R)+"/documents",i={documents:e.map((function(t){return ua(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){mi(!!e.found);var n=ca(t,e.found.name),r=oa(e.found.updateTime),i=new oo({mapValue:{fields:e.found.fields}});return ao.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){mi(!!e.missing),mi(!!e.readTime);var n=ca(t,e.missing),r=oa(e.readTime);return ao.newNoDocument(n,r)}(t,e):vi()}(n.R,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());mi(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Es(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e=this;return Object(Z.d)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=zi.fromPath(n);e.mutations.push(new _s(r,e.precondition(r)))})),[4,function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return n=bi(t),r=fa(n.R)+"/documents",i={writes:e.map((function(t){return ya(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw vi();e=Si.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new hi(ci.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?cs.updateTime(e):cs.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Si.min()))throw new hi(ci.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return cs.updateTime(e)}return cs.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Ql=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new hh(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return Object(Z.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(Z.d)(this,(function(r){return t=new zl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Bi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!ks(e)}return!1},t}(),Hl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=zc.UNAUTHENTICATED,this.clientId=Ii.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return Object(Z.b)(r,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return di("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new hi(ci.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new tu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return Object(Z.b)(t,void 0,void 0,(function(){var t,n;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Kh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function Wl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),di("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return Object(Z.b)(i,void 0,void 0,(function(){return Object(Z.d)(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Ic(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Yl(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Xl(t)];case 1:return n=i.sent(),di("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return Object(Z.b)(this,void 0,void 0,(function(){var n,r;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return(n=bi(t)).asyncQueue.verifyOperationInProgress(),di("RemoteStore","RemoteStore received new credentials"),r=_h(n),n.Or.add(3),[4,mh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,vh(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function Xl(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(di("FirestoreClient","Using default OfflineComponentProvider"),[4,Wl(t,new Vl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function Jl(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(di("FirestoreClient","Using default OnlineComponentProvider"),[4,Yl(t,new Kl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function $l(t){return Xl(t).then((function(t){return t.persistence}))}function Zl(t){return Xl(t).then((function(t){return t.localStore}))}function tf(t){return Jl(t).then((function(t){return t.remoteStore}))}function ef(t){return Jl(t).then((function(t){return t.syncEngine}))}function nf(t){return Object(Z.b)(this,void 0,void 0,(function(){var e,n;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return[4,Jl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=cl.bind(null,e.syncEngine),n.onUnlisten=ll.bind(null,e.syncEngine),n)]}}))}))}function rf(t,e,n){var r=this;void 0===n&&(n={});var i=new tu;return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(r,void 0,void 0,(function(){var r;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Gl({next:function(o){e.enqueueAndForget((function(){return Xh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new hi(ci.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new hi(ci.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new tl(jo(n.path),o,{includeMetadataChanges:!0,so:!0});return Yh(t,s)},[4,nf(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function of(t,e,n){var r=this;void 0===n&&(n={});var i=new tu;return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(r,void 0,void 0,(function(){var r;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Gl({next:function(n){e.enqueueAndForget((function(){return Xh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new hi(ci.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new tl(n,o,{includeMetadataChanges:!0,so:!0});return Yh(t,s)},[4,nf(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var sf=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},af=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),uf=new Map,cf=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},hf=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(zc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),lf=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),ff=function(){function t(t){var e=this;this.currentUser=zc.UNAUTHENTICATED,this.oc=new tu,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){di("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(di("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(di("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(mi("string"==typeof n.accessToken),new cf(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return Object(Z.b)(n,void 0,void 0,(function(){return Object(Z.d)(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return mi(null===t||"string"==typeof t),new zc(t)},t}(),df=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=zc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),pf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new df(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(zc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function gf(t,e,n){if(!n)throw new hi(ci.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function yf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new hi(ci.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function vf(t,e,n,r){if(!0===e&&!0===r)throw new hi(ci.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function mf(t){if(!zi.isDocumentKey(t))throw new hi(ci.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function bf(t){if(zi.isDocumentKey(t))throw new hi(ci.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function wf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":vi()}function If(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new hi(ci.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=wf(t);throw new hi(ci.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Of(t,e){if(e<=0)throw new hi(ci.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Tf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new hi(ci.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new hi(ci.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,vf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Ef=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Tf({}),this._settingsFrozen=!1,t instanceof af?(this._databaseId=t,this._credentials=new hf):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new hi(ci.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new af(t.options.projectId)}(t),this._credentials=new ff(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new hi(ci.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new hi(ci.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Tf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new hf;switch(t.type){case"gapi":var e=t.client;return mi(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new pf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new hi(ci.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=uf.get(this))&&(di("ComponentProvider","Removing Datastore"),uf.delete(this),t.terminate()),Promise.resolve();var t},t}(),_f=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new kf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Sf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),kf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,jo(r))||this)._path=r,i.type="collection",i}return Object(Z.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new _f(this.firestore,null,new zi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Sf);function xf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(tt.i)(t),gf("collection","path",e),t instanceof Ef)return bf(n=ji.fromString.apply(ji,Object(Z.f)([e],r))),new kf(t,null,n);if(!(t instanceof _f||t instanceof kf))throw new hi(ci.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return bf(n=ji.fromString.apply(ji,Object(Z.f)([t.path],r)).child(ji.fromString(e))),new kf(t.firestore,null,n)}function Nf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(tt.i)(t),1===arguments.length&&(e=Ii.u()),gf("doc","path",e),t instanceof Ef)return mf(n=ji.fromString.apply(ji,Object(Z.f)([e],r))),new _f(t,null,new zi(n));if(!(t instanceof _f||t instanceof kf))throw new hi(ci.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return mf(n=t._path.child(ji.fromString.apply(ji,Object(Z.f)([e],r)))),new _f(t.firestore,t instanceof kf?t.converter:null,new zi(n))}function Cf(t,e){return t=Object(tt.i)(t),e=Object(tt.i)(e),(t instanceof _f||t instanceof kf)&&(e instanceof _f||e instanceof kf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function jf(t,e){return t=Object(tt.i)(t),e=Object(tt.i)(e),t instanceof Sf&&e instanceof Sf&&t.firestore===e.firestore&&Vo(t._query,e._query)&&t.converter===e.converter}var Df=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new hh(this,"async_queue_retry"),this.Ic=function(){var e=uh();e&&di("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=uh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=uh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new tu;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t,e=this;return Object(Z.d)(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!su(t=n.sent()))throw t;return di("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,pi("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Bh.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&vi()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(Z.b)(this,void 0,void 0,(function(){var t;return Object(Z.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function Af(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new tu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Rf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Df,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(Z.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Ff(this),this._firestoreClient.terminate()},e}(Ef);function Pf(t){return t._firestoreClient||Ff(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ff(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new sf(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Hl(t._credentials,t._queue,r)}function Lf(t,e,n){var r=this,i=new tu;return t.asyncQueue.enqueue((function(){return Object(Z.b)(r,void 0,void 0,(function(){var r;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Wl(t,n)];case 1:return o.sent(),[4,Yl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===ci.FAILED_PRECONDITION||t.code===ci.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Mf(t){if(t._initialized||t._terminated)throw new hi(ci.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Uf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new hi(ci.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ai(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Vf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Pi.fromBase64String(e))}catch(e){throw new hi(ci.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Pi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),qf=function(t){this._methodName=t},Bf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new hi(ci.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new hi(ci.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Oi(this._lat,t._lat)||Oi(this._long,t._long)},t}(),Kf=/^__.*__$/,Gf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ms(t,this.data,this.fieldMask,e,this.fieldTransforms):new vs(t,this.data,e,this.fieldTransforms)},t}(),zf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new ms(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Qf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw vi()}}var Hf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return dd(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Qf(this.Nc)&&Kf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),Wf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||ch(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new Hf({Nc:t,methodName:e,qc:n,path:Ai.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Yf(t){var e=t._freezeSettings(),n=ch(t._databaseId);return new Wf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Xf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);cd("Data must be an object, but it was:",s,r);var a,u,c=ad(r,s);if(o.merge)a=new Ri(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=hd(e,f[l],n);if(!s.contains(d))throw new hi(ci.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");pd(h,d)||h.push(d)}a=new Ri(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Gf(new oo(c),a,u)}var Jf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(qf);function $f(t,e,n){return new Hf({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Zf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e.prototype._toFieldTransform=function(t){return new as(t.path,new Zo)},e.prototype.isEqual=function(t){return t instanceof e},e}(qf),td=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(Z.c)(e,t),e.prototype._toFieldTransform=function(t){var e=$f(this,t,!0),n=this.Kc.map((function(t){return sd(t,e)})),r=new ts(n);return new as(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(qf),ed=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(Z.c)(e,t),e.prototype._toFieldTransform=function(t){var e=$f(this,t,!0),n=this.Kc.map((function(t){return sd(t,e)})),r=new ns(n);return new as(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(qf),nd=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(Z.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new is(t.R,Wo(t.R,this.Qc));return new as(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(qf);function rd(t,e,n,r){var i=t.Uc(1,e,n);cd("Data must be an object, but it was:",i,r);var o=[],s=oo.empty();xi(r,(function(t,r){var a=fd(e,t,n);r=Object(tt.i)(r);var u=i.Oc(a);if(r instanceof Jf)o.push(a);else{var c=sd(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Ri(o);return new zf(s,a,i.fieldTransforms)}function id(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[hd(e,r,n)],u=[i];if(o.length%2!=0)throw new hi(ci.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(hd(e,o[c])),u.push(o[c+1]);for(var h=[],l=oo.empty(),f=a.length-1;f>=0;--f)if(!pd(h,a[f])){var d=a[f],p=u[f];p=Object(tt.i)(p);var g=s.Oc(d);if(p instanceof Jf)h.push(d);else{var y=sd(p,g);null!=y&&(h.push(d),l.set(d,y))}}var v=new Ri(h);return new zf(l,v,s.fieldTransforms)}function od(t,e,n,r){return void 0===r&&(r=!1),sd(n,t.Uc(r?4:3,e))}function sd(t,e){if(ud(t=Object(tt.i)(t)))return cd("Unsupported field value:",e,t),ad(t,e);if(t instanceof qf)return function(t,e){if(!Qf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=sd(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(tt.i)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Wo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=_i.fromDate(t);return{timestampValue:na(e.R,n)}}if(t instanceof _i)return n=new _i(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:na(e.R,n)};if(t instanceof Bf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Vf)return{bytesValue:ra(e.R,t._byteString)};if(t instanceof _f){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:sa(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+wf(t))}(t,e)}function ad(t,e){var n={};return Ni(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xi(t,(function(t,r){var i=sd(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function ud(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof _i||t instanceof Bf||t instanceof Vf||t instanceof _f||t instanceof qf)}function cd(t,e,n){if(!ud(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=wf(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function hd(t,e,n){if((e=Object(tt.i)(e))instanceof Uf)return e._internalPath;if("string"==typeof e)return fd(t,e);throw dd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ld=new RegExp("[~\\*/\\[\\]]");function fd(t,e,n){if(e.search(ld)>=0)throw dd("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Uf.bind.apply(Uf,Object(Z.f)([void 0],e.split(".")))))._internalPath}catch(pp){throw dd("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function dd(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new hi(ci.INVALID_ARGUMENT,(a+=". ")+t+u)}function pd(t,e){return t.some((function(t){return t.isEqual(e)}))}var gd=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new _f(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new yd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(vd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),yd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(gd);function vd(t,e){return"string"==typeof e?fd(t,e):e instanceof Uf?e._internalPath:e._delegate._internalPath}var md=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),bd=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(Z.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new wd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(vd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(gd),wd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(bd),Id=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new md(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new wd(n._firestore,n._userDataWriter,r.key,r,new md(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new hi(ci.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new wd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new md(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new wd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new md(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Od(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Od(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return vi()}}function Td(t,e){return t instanceof bd&&e instanceof bd?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Id&&e instanceof Id&&t._firestore===e._firestore&&jf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Ed(t){if(Ao(t)&&0===t.explicitOrderBy.length)throw new hi(ci.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var _d=function(){};function Sd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var kd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(Z.c)(e,t),e.prototype._apply=function(t){var e=Yf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new hi(ci.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Rd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(Ad(r,t,h[c]));a={arrayValue:{values:u}}}else a=Ad(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Rd(s,o),a=od(n,"where",s,"in"===o||"not-in"===o);var l=po.create(i,o,a);return function(t,e){if(e.g()){var n=Po(t);if(null!==n&&!n.isEqual(e.field))throw new hi(ci.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Ro(t);null!==r&&Pd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new hi(ci.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Sf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(_d),xd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(Z.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new hi(ci.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new hi(ci.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new _o(e,n);return function(t,e){if(null===Ro(t)){var n=Po(t);null!==n&&Pd(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Sf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new No(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(_d),Nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(Z.c)(e,t),e.prototype._apply=function(t){return new Sf(t.firestore,t.converter,Uo(t._query,this.Hc,this.Jc))},e}(_d),Cd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(Z.c)(e,t),e.prototype._apply=function(t){var e=Dd(t,this.type,this.Yc,this.Xc);return new Sf(t.firestore,t.converter,function(t,e){return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(_d),jd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(Z.c)(e,t),e.prototype._apply=function(t){var e=Dd(t,this.type,this.Yc,this.Xc);return new Sf(t.firestore,t.converter,function(t,e){return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(_d);function Dd(t,e,n,r){if(n[0]=Object(tt.i)(n[0]),n[0]instanceof gd)return function(t,e,n,r,i){if(!r)throw new hi(ci.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Lo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push($i(e,r.key));else{var c=r.data.field(u.field);if(Vi(c))throw new hi(ci.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new hi(ci.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new To(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Yf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new hi(ci.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new hi(ci.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Fo(t)&&-1!==c.indexOf("/"))throw new hi(ci.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ji.fromString(c));if(!zi.isDocumentKey(h))throw new hi(ci.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new zi(h);a.push($i(e,l))}else{var f=od(n,r,c);a.push(f)}}return new To(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Ad(t,e,n){if("string"==typeof(n=Object(tt.i)(n))){if(""===n)throw new hi(ci.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fo(e)&&-1!==n.indexOf("/"))throw new hi(ci.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ji.fromString(n));if(!zi.isDocumentKey(r))throw new hi(ci.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return $i(t,new zi(r))}if(n instanceof _f)return $i(t,n._key);throw new hi(ci.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+wf(n)+".")}function Rd(t,e){if(!Array.isArray(t)||0===t.length)throw new hi(ci.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new hi(ci.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Pd(t,e,n){if(!n.isEqual(e))throw new hi(ci.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Fd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Qi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Mi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ui(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw vi()}},t.prototype.convertObject=function(t,e){var n=this,r={};return xi(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Bf(Mi(t.latitude),Mi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return Vi(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(qi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Li(t);return new _i(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=ji.fromString(t);mi(Ca(n));var r=new af(n.get(1),n.get(3)),i=new zi(n.popFirst(5));return r.isEqual(e)||pi("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Ld(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Md=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Z.c)(e,t),e.prototype.convertBytes=function(t){return new Vf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new _f(this.firestore,null,e)},e}(Fd),Ud=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Yf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Vd(t,this._firestore),i=Ld(r.converter,e,n),o=Xf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,cs.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Vd(t,this._firestore);return o="string"==typeof(e=Object(tt.i)(e))||e instanceof Uf?id(this._dataReader,"WriteBatch.update",s._key,e,n,r):rd(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,cs.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Vd(t,this._firestore);return this._mutations=this._mutations.concat(new Es(e._key,cs.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new hi(ci.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Vd(t,e){if((t=Object(tt.i)(t)).firestore!==e)throw new hi(ci.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var qd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Z.c)(e,t),e.prototype.convertBytes=function(t){return new Vf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new _f(this.firestore,null,e)},e}(Fd);function Bd(t,e,n){t=If(t,_f);var r=If(t.firestore,Rf),i=Ld(t.converter,e,n);return zd(r,[Xf(Yf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,cs.none())])}function Kd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=If(t,_f);var o=If(t.firestore,Rf),s=Yf(o);return zd(o,[("string"==typeof(e=Object(tt.i)(e))||e instanceof Uf?id(s,"updateDoc",t._key,e,n,r):rd(s,"updateDoc",t._key,e)).toMutation(t._key,cs.exists(!0))])}function Gd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(tt.i)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||Af(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(Af(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof _f)c=If(t.firestore,Rf),h=jo(t._key.path),u={next:function(e){i[a]&&i[a](Qd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=If(t,Sf);c=If(d.firestore,Rf),h=d._query;var p=new qd(c);u={next:function(t){i[a]&&i[a](new Id(c,p,d,t))},error:i[a+1],complete:i[a+2]},Ed(t._query)}return function(t,e,n,r){var i=this,o=new Gl(r),s=new tl(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(i,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return e=Yh,[4,nf(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(i,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return e=Xh,[4,nf(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(Pf(c),h,l,u)}function zd(t,e){return function(t,e){var n=this,r=new tu;return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(n,void 0,void 0,(function(){var n;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return n=fl,[4,ef(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Pf(t),e)}function Qd(t,e,n){var r=n.docs.get(e._key),i=new qd(t);return new bd(t,i,e._key,r,new md(n.hasPendingWrites,n.fromCache),e.converter)}var Hd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(Z.c)(e,t),e.prototype.get=function(e){var n=this,r=Vd(e,this._firestore),i=new qd(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new bd(n._firestore,i,r._key,t._document,new md(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Yf(t)}return t.prototype.get=function(t){var e=this,n=Vd(t,this._firestore),r=new Md(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return vi();var i=t[0];if(i.isFoundDocument())return new gd(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new gd(e._firestore,r,n._key,null,n.converter);throw vi()}))},t.prototype.set=function(t,e,n){var r=Vd(t,this._firestore),i=Ld(r.converter,e,n),o=Xf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Vd(t,this._firestore);return o="string"==typeof(e=Object(tt.i)(e))||e instanceof Uf?id(this._dataReader,"Transaction.update",s._key,e,n,r):rd(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Vd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Wd(){if("undefined"==typeof Uint8Array)throw new hi(ci.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Yd(){if("undefined"==typeof atob)throw new hi(ci.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Xd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Yd(),new t(Vf.fromBase64String(e))},t.fromUint8Array=function(e){return Wd(),new t(Vf.fromUint8Array(e))},t.prototype.toBase64=function(){return Yd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Wd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Jd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Mf(t=If(t,Rf));var n=Pf(t),r=t._freezeSettings(),i=new Kl;return Lf(n,i,new ql(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Mf(t=If(t,Rf));var e=Pf(t),n=t._freezeSettings(),r=new Kl;return Lf(e,r,new Bl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new hi(ci.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new tu;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return Object(Z.b)(e,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(Z.b)(this,void 0,void 0,(function(){return Object(Z.d)(this,(function(e){switch(e.label){case 0:return ru.yt()?[4,ru.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(pc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),$d=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof af||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||gi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=If(t,Ef))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&gi("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=zc.MOCK_USER;else{s=Object(tt.e)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new hi(ci.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new zc(u)}t._credentials=new lf(new cf(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(Z.b)(e,void 0,void 0,(function(){var e,n;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return[4,$l(t)];case 1:return e=r.sent(),[4,tf(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=bi(t);return e.Or.delete(0),vh(e)}(n))]}}))}))}))}(Pf(If(this._delegate,Rf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(Z.b)(e,void 0,void 0,(function(){var e,n;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return[4,$l(t)];case 1:return e=r.sent(),[4,tf(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(Z.b)(this,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return(e=bi(t)).Or.add(0),[4,mh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Pf(If(this._delegate,Rf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&vf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new tu;return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(e,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(r){switch(r.label){case 0:return e=ml,[4,ef(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Pf(If(this._delegate,Rf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Gl(e);return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(n,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){bi(t).Gr.add(e),e.next()},[4,nf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(n,void 0,void 0,(function(){var e;return Object(Z.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){bi(t).Gr.delete(e)},[4,nf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Pf(t=If(t,Rf)),Af(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new hi(ci.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new fp(this,xf(this._delegate,t))}catch(t){throw ip(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new rp(this,Nf(this._delegate,t))}catch(t){throw ip(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new cp(this,function(t,e){if(t=If(t,Ef),gf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new hi(ci.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Sf(t,null,function(t){return new No(ji.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw ip(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new tu;return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(n,void 0,void 0,(function(){var n;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return Jl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new Ql(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Pf(t),(function(n){return e(new Hd(t,n))}))}(this._delegate,(function(n){return t(new tp(e,n))}))},t.prototype.batch=function(){var t=this;return Pf(this._delegate),new ep(new Ud(this._delegate,(function(e){return zd(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new hi(ci.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new hi(ci.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Zd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Z.c)(e,t),e.prototype.convertBytes=function(t){return new Xd(new Vf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return rp.eu(e,this.firestore,null)},e}(Fd),tp=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Zd(t)}return t.prototype.get=function(t){var e=this,n=dp(t);return this._delegate.get(n).then((function(t){return new ap(e._firestore,new bd(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=dp(t);return n?(yf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=dp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Z.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=dp(t);return this._delegate.delete(e),this},t}(),ep=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=dp(t);return n?(yf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=dp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Z.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=dp(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),np=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new wd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new up(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Zd(e),n),i.set(n,o)),o},t}();np.su=new WeakMap;var rp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Zd(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new hi(ci.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new _f(n._delegate,r,new zi(e)))},t.eu=function(e,n,r){return new t(n,new _f(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new fp(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new fp(this.firestore,xf(this._delegate,t))}catch(t){throw ip(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(tt.i)(t))instanceof _f&&Cf(this._delegate,t)},t.prototype.set=function(t,e){e=yf("DocumentReference.set",e);try{return e?Bd(this._delegate,t,e):Bd(this._delegate,t)}catch(t){throw ip(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Kd(this._delegate,t):Kd.apply(void 0,Object(Z.f)([this._delegate,t,e],n))}catch(t){throw ip(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return zd(If((t=this._delegate).firestore,Rf),[new Es(t._key,cs.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=op(e),i=sp(e,(function(e){return new ap(t.firestore,new bd(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return Gd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=If(t,_f);var e=If(t.firestore,Rf),n=Pf(e),r=new qd(e);return function(t,e){var n=this,r=new tu;return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(n,void 0,void 0,(function(){var n;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i;return Object(Z.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=bi(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new hi(ci.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Kh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,Zl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new bd(e,r,t._key,n,new md(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=If(t,_f);var e=If(t.firestore,Rf);return rf(Pf(e),t._key,{source:"server"}).then((function(n){return Qd(e,t,n)}))}(this._delegate):function(t){t=If(t,_f);var e=If(t.firestore,Rf);return rf(Pf(e),t._key).then((function(n){return Qd(e,t,n)}))}(this._delegate)).then((function(t){return new ap(e.firestore,new bd(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?np.nu(this.firestore,e):null))},t}();function ip(t,e,n){return t.message=t.message.replace(e,n),t}function op(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Af(r))return r}return{}}function sp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Af(t[0])?t[0]:Af(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var ap=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new rp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Td(this._delegate,t._delegate)},t}(),up=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Z.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(ap),cp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Zd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Sd(this._delegate,function(t,e,n){var r=e,i=vd("where",t);return new kd(i,r,n)}(e,n,r)))}catch(e){throw ip(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Sd(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=vd("orderBy",t);return new xd(r,n)}(e,n)))}catch(e){throw ip(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Sd(this._delegate,function(t){return Of("limit",t),new Nd("limit",t,"F")}(e)))}catch(e){throw ip(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Sd(this._delegate,function(t){return Of("limitToLast",t),new Nd("limitToLast",t,"L")}(e)))}catch(e){throw ip(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw ip(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw ip(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw ip(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw ip(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return jf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=If(t,Sf);var e=If(t.firestore,Rf),n=Pf(e),r=new qd(e);return function(t,e){var n=this,r=new tu;return t.asyncQueue.enqueueAndForget((function(){return Object(Z.b)(n,void 0,void 0,(function(){var n;return Object(Z.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Z.b)(this,void 0,void 0,(function(){var r,i,o,s,a;return Object(Z.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Nc(t,e,!0)];case 1:return a=u.sent(),r=new ol(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Kh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,Zl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Id(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=If(t,Sf);var e=If(t.firestore,Rf),n=Pf(e),r=new qd(e);return of(n,t._query,{source:"server"}).then((function(n){return new Id(e,r,t,n)}))}(this._delegate):function(t){t=If(t,Sf);var e=If(t.firestore,Rf),n=Pf(e),r=new qd(e);return Ed(t._query),of(n,t._query).then((function(n){return new Id(e,r,t,n)}))}(this._delegate)).then((function(t){return new lp(e.firestore,new Id(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=op(e),i=sp(e,(function(e){return new lp(t.firestore,new Id(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Gd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?np.nu(this.firestore,e):null))},t}(),hp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new up(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),lp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new cp(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new up(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new hp(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new up(n._firestore,r))}))},t.prototype.isEqual=function(t){return Td(this._delegate,t._delegate)},t}(),fp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(Z.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new rp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new rp(this.firestore,void 0===t?Nf(this._delegate):Nf(this._delegate,t))}catch(t){throw ip(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=If(t.firestore,Rf),r=Nf(t),i=Ld(t.converter,e);return zd(n,[Xf(Yf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,cs.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new rp(e.firestore,t)}))},e.prototype.isEqual=function(t){return Cf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?np.nu(this.firestore,t):null))},e}(cp);function dp(t){return If(t,_f)}var pp,gp=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Uf.bind.apply(Uf,Object(Z.f)([void 0],t)))}return t.documentId=function(){return new t(Ai.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(tt.i)(t))instanceof Uf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),yp=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Zf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Jf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new td("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ed("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new nd("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),vp=a("/6Yf"),mp={Firestore:$d,GeoPoint:Bf,Timestamp:_i,Blob:Xd,Transaction:tp,WriteBatch:ep,DocumentReference:rp,DocumentSnapshot:ap,Query:cp,QueryDocumentSnapshot:up,QuerySnapshot:lp,CollectionReference:fp,FieldPath:gp,FieldValue:yp,setLogLevel:function(t){li.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function bp(t,e){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.b;return new O.a((function(n){var r;return null!=e?e.schedule((function(){r=t.onSnapshot({includeMetadataChanges:!0},n)})):r=t.onSnapshot({includeMetadataChanges:!0},n),function(){null!=r&&r()}}))}(t,e)}function wp(t,e){return bp(t,e).pipe(Object(m.a)((function(t){return{payload:t,type:"query"}})))}function Ip(t,e){return wp(t,e).pipe(Object(G.a)(void 0),Q(),Object(m.a)((function(t){var e=u(t,2),n=e[0],r=e[1],i=r.payload.docChanges(),o=i.map((function(t){return{type:t.type,payload:t}}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((function(t,e){var r=i.find((function(e){return e.doc.ref.isEqual(t.ref)})),s=null==n?void 0:n.payload.docs.find((function(e){return e.ref.isEqual(t.ref)}));r&&JSON.stringify(r.doc.metadata)===JSON.stringify(t.metadata)||!r&&s&&JSON.stringify(s.metadata)===JSON.stringify(t.metadata)||o.push({type:"modified",payload:{oldIndex:e,newIndex:e,type:"modified",doc:t}})})),o})))}function Op(t,e,n){return Ip(t,n).pipe(Object(Y.a)((function(t,n){return function(t,e,n){return e.forEach((function(e){n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Tp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){var n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Tp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Tp(t,e.oldIndex,1)}return t}(t,e))})),t}(t,n.map((function(t){return t.payload})),e)}),[]),(function(t){return t.lift(new X(void 0,void 0))}),Object(m.a)((function(t){return t.map((function(t){return{type:t.type,payload:t}}))})))}function Tp(t,e,n){for(var r=t.slice(),i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return r.splice.apply(r,[e,n].concat(o)),r}function Ep(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}(function(t,e){t.INTERNAL.registerComponent(new vp.a("firestore",(function(t){return function(t,e){return new $d(t,new Rf(t,e),new Jd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},mp)))})(pp=$.a),pp.registerVersion("@firebase/firestore","2.4.1");var _p=function(){function t(e,n,r){d(this,t),this.ref=e,this.query=n,this.afs=r}return f(t,[{key:"stateChanges",value:function(t){var e=Ip(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(m.a)((function(e){return e.filter((function(e){return t.indexOf(e.type)>-1}))})))),e.pipe(Object(G.a)(void 0),Q(),Object(C.a)((function(t){var e=u(t,2),n=e[0];return e[1].length>0||!n})),Object(m.a)((function(t){var e=u(t,2);e[0];return e[1]})),this.afs.keepUnstableUntilFirst)}},{key:"auditTrail",value:function(t){return this.stateChanges(t).pipe(Object(Y.a)((function(t,e){return[].concat(n(t),n(e))}),[]))}},{key:"snapshotChanges",value:function(t){var e=Ep(t);return Op(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return wp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)((function(n){return n.payload.docs.map((function(n){return t.idField?Object.assign(Object.assign({},n.data()),e({},t.idField,n.id)):n.data()}))})),this.afs.keepUnstableUntilFirst)}},{key:"get",value:function(t){return Object(T.a)(this.query.get(t)).pipe(Object(_.b)(this.afs.schedulers.insideAngular))}},{key:"add",value:function(t){return this.ref.add(t)}},{key:"doc",value:function(t){return new Sp(this.ref.doc(t),this.afs)}}]),t}(),Sp=function(){function t(e,n){d(this,t),this.ref=e,this.afs=n}return f(t,[{key:"set",value:function(t,e){return this.ref.set(t,e)}},{key:"update",value:function(t){return this.ref.update(t)}},{key:"delete",value:function(){return this.ref.delete()}},{key:"collection",value:function(t,e){var n=Dp(this.ref.collection(t),e),r=n.ref,i=n.query;return new _p(r,i,this.afs)}},{key:"snapshotChanges",value:function(){return bp(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(G.a)(void 0),Q(),Object(m.a)((function(t){var e=u(t,2),n=e[0],r=e[1];return r.exists?(null==n?void 0:n.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.snapshotChanges().pipe(Object(m.a)((function(n){var r=n.payload;return t.idField?Object.assign(Object.assign({},r.data()),e({},t.idField,r.id)):r.data()})))}},{key:"get",value:function(t){return Object(T.a)(this.ref.get(t)).pipe(Object(_.b)(this.afs.schedulers.insideAngular))}}]),t}(),kp=function(){function t(e,n){d(this,t),this.query=e,this.afs=n}return f(t,[{key:"stateChanges",value:function(t){return t&&0!==t.length?Ip(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)((function(e){return e.filter((function(e){return t.indexOf(e.type)>-1}))})),Object(C.a)((function(t){return t.length>0})),this.afs.keepUnstableUntilFirst):Ip(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"auditTrail",value:function(t){return this.stateChanges(t).pipe(Object(Y.a)((function(t,e){return[].concat(n(t),n(e))}),[]))}},{key:"snapshotChanges",value:function(t){var e=Ep(t);return Op(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return wp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)((function(n){return n.payload.docs.map((function(n){return t.idField?Object.assign(e({},t.idField,n.id),n.data()):n.data()}))})),this.afs.keepUnstableUntilFirst)}},{key:"get",value:function(t){return Object(T.a)(this.query.get(t)).pipe(Object(_.b)(this.afs.schedulers.insideAngular))}}]),t}(),xp=new g.q("angularfire2.enableFirestorePersistence"),Np=new g.q("angularfire2.firestore.persistenceSettings"),Cp=new g.q("angularfire2.firestore.settings"),jp=new g.q("angularfire2.firestore.use-emulator");function Dp(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t};return{query:e(t),ref:t}}var Ap,Rp,Pp,Fp=((Rp=function(){function t(e,r,i,o,s,a,c,h,f){d(this,t),this.schedulers=new j.d(a),this.keepUnstableUntilFirst=Object(j.h)(this.schedulers);var p=Object(j.g)(e,a,r);!q.a.auth&&f&&Object(j.j)();var g=h,v=u(Object(j.f)(p.name+".firestore","AngularFirestore",p,(function(){var t=a.runOutsideAngular((function(){return p.firestore()}));return o&&t.settings(o),g&&t.useEmulator.apply(t,n(g)),i&&!Object(l.s)(s)?[t,a.runOutsideAngular((function(){try{return Object(T.a)(t.enablePersistence(c||void 0).then((function(){return!0}),(function(){return!1})))}catch(pp){return"undefined"!=typeof console&&console.warn(pp),Object(y.a)(!1)}}))]:[t,Object(y.a)(!1)]}),[o,g,i]),2);this.firestore=v[0],this.persistenceEnabled$=v[1]}return f(t,[{key:"collection",value:function(t,e){var n=Dp("string"==typeof t?this.firestore.collection(t):t,e),r=n.ref,i=n.query,o=this.schedulers.ngZone.run((function(){return r}));return new _p(o,i,this)}},{key:"collectionGroup",value:function(t,e){var n=e||function(t){return t},r=this.firestore.collectionGroup(t);return new kp(n(r),this)}},{key:"doc",value:function(t){var e;e="string"==typeof t?this.firestore.doc(t):t;var n=this.schedulers.ngZone.run((function(){return e}));return new Sp(n,this)}},{key:"createId",value:function(){return this.firestore.collection("_").doc().id}}]),t}()).\u0275fac=function(t){return new(t||Rp)(g.Sb(j.c),g.Sb(j.b,8),g.Sb(xp,8),g.Sb(Cp,8),g.Sb(g.B),g.Sb(g.z),g.Sb(Np,8),g.Sb(jp,8),g.Sb(D,8))},Rp.\u0275prov=g.Eb({factory:function(){return new Rp(g.Sb(j.c),g.Sb(j.b,8),g.Sb(xp,8),g.Sb(Cp,8),g.Sb(g.B),g.Sb(g.z),g.Sb(Np,8),g.Sb(jp,8),g.Sb(D,8))},token:Rp,providedIn:"any"}),Rp),Lp=((Ap=function(){function t(e,n,r){d(this,t),this.auth=e,this.router=n,this.firestore=r,this.db=this.firestore.collection("users"),this.authUser=this.auth.user}return f(t,[{key:"login",value:function(){var t=this;return this.auth.signInWithPopup(new q.a.auth.GoogleAuthProvider).then((function(e){t.authUser=t.auth.user,t.router.navigateByUrl("/user/profile")}))}},{key:"logout",value:function(){var t=this;this.auth.signOut().then((function(e){t.router.navigateByUrl("/")}))}},{key:"createUser",value:function(t){var e=this.db.doc(t.uid),n=this.getCurrentTime(),r=B.User,i={id:t.uid,name:t.displayName,auth_data:[Object.assign({},t.providerData[0])],email:t.email,image_url:t.photoURL,level:r,created_time:n,last_login:n,max_card_limit:5,max_card_edit_limit:1e3,total_card:0,total_card_edit:0};e.set(i)}},{key:"createRealfarmInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe((function(r){var i=r.data();if(i.total_card<i.max_card_limit&&i.total_card_edit<i.max_card_edit_limit){var o=n.getUID(),s=n.getCurrentTime(),a=Object.assign(Object.assign({},e),{id:o,uid:i.name,last_update:s,created_time:s});n.db.doc(t).collection("realfarms").doc(o).set(a),n.updateUser(t,"total_card",i.total_card+1)}}))}},{key:"updateUser",value:function(t,e,n){var r=this.db.doc(t),i={};i[e]=n,r.update(i)}},{key:"upateRealFamrInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe((function(r){var i=r.data();if(i.total_card_edit<i.max_card_edit_limit){n.getUID();var o=n.getCurrentTime(),s=Object.assign(Object.assign({},e),{id:e.id,uid:e.uid,last_update:o,created_time:e.created_time});n.db.doc(t).collection("realfarms").doc(e.id).update(s),n.updateUser(t,"total_card_edit",i.total_card_edit+1)}}))}},{key:"deleteRealFarmInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe((function(r){var i=r.data();n.db.doc(t).collection("realfarms").doc(e.id).delete(),n.updateUser(t,"total_card",i.total_card-1)}))}},{key:"updateUserCollection",value:function(t,e,n){this.db.doc(t).collection(e).doc(n.id).update(n)}},{key:"getCurrentTime",value:function(){var t=new Date;return t.toDateString()+" "+t.toTimeString()}},{key:"getUID",value:function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)}}]),t}()).\u0275fac=function(t){return new(t||Ap)(g.Sb(M),g.Sb(p.c),g.Sb(Fp))},Ap.\u0275prov=g.Eb({token:Ap,factory:Ap.\u0275fac,providedIn:"any"}),Ap),Mp=a("cUpR"),Up=a("320Y"),Vp=((Pp=function(){function t(e,n,r){d(this,t),this.user=e,this.title=n,this.meta=r}return f(t,[{key:"ngOnInit",value:function(){this.updateHeader()}},{key:"login",value:function(){this.user.login()}},{key:"updateHeader",value:function(){this.title.setTitle("\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"),this.meta.updateTag({name:"description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({name:"apple-mobile-web-app-title",content:"\u500b\u4eba\u8cc7\u8a0a  | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:title",content:"\u500b\u4eba\u8cc7\u8a0a  | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({property:"og:image",content:"https://bobosheep.github.io/farm-tool/assets/DisplayRealFarmCard.jpg"}),this.meta.updateTag({property:"og:url",content:"https://bobosheep.github.io/farm-tool/user/"})}}]),t}()).\u0275fac=function(t){return new(t||Pp)(g.Ib(Lp),g.Ib(Mp.d),g.Ib(Mp.c))},Pp.\u0275cmp=g.Cb({type:Pp,selectors:[["app-login"]],decls:6,vars:4,consts:[["title","\u6b61\u8fce\u4f86\u5230\u500b\u4eba\u9801\u9762","subtitle","\u8acb\u767b\u5165\u4ee5\u7e7c\u7e8c\u4f7f\u7528",3,"showBackIcon","showCustomIcon"],[1,"container"],["id","googleBtn",1,"button",3,"click"],["src","/assets/others/g-logo.png",3,"width","height"]],template:function(t,e){1&t&&(g.Jb(0,"app-header",0),g.Ob(1,"section",1),g.Ob(2,"button",2),g.Vb("click",(function(){return e.login()})),g.Jb(3,"img",3),g.Ob(4,"span"),g.sc(5,"\u4f7f\u7528 Google \u767b\u5165"),g.Nb(),g.Nb(),g.Nb()),2&t&&(g.dc("showBackIcon",!1)("showCustomIcon",!1),g.yb(3),g.dc("width",18)("height",18))},directives:[Up.a],styles:[".container[_ngcontent-%COMP%]{display:flex;width:90%;margin:16px auto;justify-content:center}#googleBtn[_ngcontent-%COMP%]{display:flex;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;border:0;border-radius:2px;padding:11px 8px}#googleBtn[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{height:18px;width:18px;padding-right:24px}#googleBtn[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{cursor:inherit;height:18px;font-size:14px;color:rgba(0,0,0,.54);font-weight:600;display:inline-block;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}"]}),Pp),qp=a("wHSu"),Bp=a("Nv++"),Kp=function(){function t(){d(this,t)}return f(t,null,[{key:"drawRect",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#FFFFF",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"#333333";t.fillStyle=o,t.fillRect(e,n,r,i),s>0&&(t.strokeStyle=a,t.lineWidth=s,t.strokeRect(e,n,r,i))}},{key:"drawRoundRect",value:function(t,e,n,r,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#FFFFFF",a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"#333333";r<2*o&&(o=r/2),i<2*o&&(o=i/2),t.fillStyle=s,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.fill(),a>0&&(t.strokeStyle=u,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.stroke())}},{key:"addImage",value:function(t,e,n,r,i,o){var s=new Image;s.onload=function(){t.drawImage(s,n,r,i,o)},s.src=e}},{key:"addImageSource",value:function(t,e,n,r,i,o){t.drawImage(e,n,r,i,o)}},{key:"addText",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#333333",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500;t.font="".concat(s," ").concat(i,"px sans-serif"),t.fillStyle=o,t.fillText(e,n,r+i)}}]),t}(),Gp=f((function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5?arguments[5]:void 0;d(this,t),this.canvas=s,this.x=e,this.y=n,this.width=r,this.height=i,this.scale=o})),zp=function(t){r(n,t);var e=o(n);function n(t,r,i,o){var s,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,u=arguments.length>5?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"#FEFEFE",f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"#333333";return d(this,n),(s=e.call(this,t,r,i,o,a,u)).bgColor=l,s.borderWidth=c,s.borderRadius=h,s.borderColor=f,s.width<2*s.borderRadius&&(s.borderRadius=s.width/2),s.height<2*s.borderRadius&&(s.borderRadius=s.height/2),s}return f(n,[{key:"draw",value:function(){this.borderRadius>0?this.drawRoundRect():this.drawRect()}},{key:"drawRect",value:function(){Kp.drawRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}},{key:"drawRoundRect",value:function(){Kp.drawRoundRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.borderRadius*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}}]),n}(Gp),Qp=function(t){r(n,t);var e=o(n);function n(t,r,i){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000000",c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:12,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:500;return d(this,n),(o=e.call(this,r,i,0,0,s,a)).text=t,o.color=u,o.fontSize=c,o.fontWeight=h,o}return f(n,[{key:"draw",value:function(){Kp.addText(this.canvas,this.text,this.x*this.scale,this.y*this.scale,this.fontSize*this.scale,this.color,this.fontWeight)}}]),n}(Gp),Hp=function(t){r(n,t);var e=o(n);function n(t,r,i,o,s){var a,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,c=arguments.length>6?arguments[6]:void 0;return d(this,n),(a=e.call(this,r,i,o,s,u,c)).src=t,a}return f(n,[{key:"draw",value:function(){Kp.addImage(this.canvas,this.src,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale)}}]),n}(Gp);function Wp(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500;return t.font="".concat(r," ").concat(n,"px sans-serif"),t.measureText(e).width}var Yp,Xp,Jp=function(t){return t[t.default=0]="default",t}({}),$p=function(){var t=f((function t(){d(this,t),this.scale=4,this.titleFont=16,this.detailFont=12,this.footnoteFont=11,this.font={title:{size:16,weight:700},content:{size:12,weight:600},footnote:{size:11,weight:500}},this.card={x:0,y:0,w:320,h:180,borderRadius:12,border:1,padding:{v:12,h:12}},this.greet={x:this.card.padding.h,y:64,w:296,h:88,borderRadius:8,border:0,padding:{v:6,h:8},maxLine:5,lineHeight:16,fontSize:12,fontWeight:600},this.logoText={x:236,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.userIDText={x:this.card.padding.h,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.levelText={x:this.card.padding.h,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.gameIdText={x:this.card.padding.h,y:32,size:this.font.title.size,weight:this.font.title.weight},this.favoriteText={x:125,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.favoriteImg={max:3,x:125,y:32,w:20,h:20},this.logoImg={x:288,y:156,w:20,h:20}}));return t.getLayout=function(e){return new t},t}(),Zp=function(t){return t[t.primary=0]="primary",t[t.secondary=1]="secondary",t[t.skyBlue=2]="skyBlue",t}({}),tg=function(t){return t.black="#333333",t.white="#FFFFFF",t.green="#459C7F",t.light_green="#F0FFFA",t.orange="#E4766A",t.light_orange="#FFE9E7",t.blue="#368FD4",t.light_blue="#DDF1FF",t}({}),eg=function(){var t=f((function t(){d(this,t),this.primaryColor=tg.green,this.secondaryColor=tg.light_green,this.contentColor=tg.black,this.contentBgColor=tg.white}));return t.getTheme=function(e){var n=new t;switch(e){case Zp.primary:n.primaryColor=tg.green,n.secondaryColor=tg.light_green;break;case Zp.secondary:n.primaryColor=tg.orange,n.secondaryColor=tg.light_orange;break;case Zp.skyBlue:n.primaryColor=tg.blue,n.secondaryColor=tg.light_blue;break;default:n.primaryColor=tg.green,n.secondaryColor=tg.light_green}return n},t}(),ng=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jp.default,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zp.primary;d(this,t),this.info=e,this.layout=$p.getLayout(n),this.theme=eg.getTheme(r),this.canvasObjects=[]}return f(t,[{key:"resetCanvas",value:function(){this.canvasObjects=[]}},{key:"genBlocks",value:function(t){var e=this.genCardBlock(t),n=this.genGreetingBlock(t);this.canvasObjects.push(e),this.canvasObjects.push(n)}},{key:"genCardBlock",value:function(t){return new zp(this.layout.card.x,this.layout.card.y,this.layout.card.w,this.layout.card.h,this.layout.scale,t,this.layout.card.border,this.layout.card.borderRadius,this.theme.secondaryColor,this.theme.primaryColor)}},{key:"genGreetingBlock",value:function(t){return new zp(this.layout.greet.x,this.layout.greet.y,this.layout.greet.w,this.layout.greet.h,this.layout.scale,t,this.layout.greet.border,this.layout.greet.borderRadius,this.theme.contentBgColor,this.theme.contentBgColor)}},{key:"genTexts",value:function(t){var e,r=this.genLogoText(t,"Create by"),i=this.genUserText(t,"ID: "+this.info.uid),o=this.genLevelText(t,"Lv. "+this.info.level),s=this.genGameIDText(t,this.info.gid),a=this.genFavoriteText(t,"\u6211\u7684\u6700\u611b"),u=this.genGreetingText(t,this.info.greeting);this.canvasObjects.push(r),this.canvasObjects.push(i),this.canvasObjects.push(o),this.canvasObjects.push(s),this.canvasObjects.push(a),(e=this.canvasObjects).push.apply(e,n(u))}},{key:"genLogoText",value:function(t,e){return new Qp(e,this.layout.logoText.x,this.layout.logoText.y,this.layout.scale,t,this.theme.contentColor,this.layout.logoText.size,this.layout.logoText.weight)}},{key:"genUserText",value:function(t,e){return new Qp(e,this.layout.userIDText.x,this.layout.userIDText.y,this.layout.scale,t,this.theme.contentColor,this.layout.userIDText.size,this.layout.userIDText.weight)}},{key:"genLevelText",value:function(t,e){return new Qp(e,this.layout.levelText.x,this.layout.levelText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.levelText.size,this.layout.levelText.weight)}},{key:"genGameIDText",value:function(t,e){return new Qp(e,this.layout.gameIdText.x,this.layout.gameIdText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.gameIdText.size,this.layout.gameIdText.weight)}},{key:"genFavoriteText",value:function(t,e){return new Qp(e,this.layout.favoriteText.x,this.layout.favoriteText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.favoriteText.size,this.layout.favoriteText.weight)}},{key:"genGreetingText",value:function(t,e){for(var n=this,r=this.layout.greet.maxLine,i=this.layout.greet.x+this.layout.greet.padding.h,o=this.layout.greet.y+this.layout.greet.padding.v,s=this.layout.greet.w-2*this.layout.greet.padding.h,a=this.layout.greet.lineHeight,u=this.layout.font.content.size,c=this.layout.font.content.weight,h=0,l=e.length,f=[],d=0;d<r;d++){var p=e.indexOf("\n",h),g=Math.round((h+l+1)/2),y=e.slice(h,l),v=Wp(t,y,u,c);if(h>=e.length)break;if(v<s)g=l;else{for(y=e.slice(h,g),v=Wp(t,y,u,c);g<l&&v<=s;)g+=1,y=e.slice(h,g),v=Wp(t,y,u,c);for(;g>=0&&v>s;)g-=1,y=e.slice(h,g),v=Wp(t,y,u,c)}-1!=p&&p<g&&(g=p+1),f.push(e.slice(h,g)),h=g}return f.map((function(e,r){return new Qp(e,i,o+r*a,n.layout.scale,t,n.theme.contentColor,u,c)}))}},{key:"genImages",value:function(t,e,r){var i;this.canvasObjects.push(this.genLogoImg(t,e)),(i=this.canvasObjects).push.apply(i,n(this.genFavoriteItemsImg(t,r)))}},{key:"genLogoImg",value:function(t,e){return new Hp(e,this.layout.logoImg.x,this.layout.logoImg.y,this.layout.logoImg.w,this.layout.logoImg.h,this.layout.scale,t)}},{key:"genFavoriteItemsImg",value:function(t,e){var n=this,r=this.layout.favoriteImg.x,i=this.layout.favoriteImg.y,o=this.layout.favoriteImg.w,s=this.layout.favoriteImg.h;return e.map((function(e,a){return new Hp(e,r+a*o,i,o,s,n.layout.scale,t)}))}},{key:"draw",value:function(){this.canvasObjects.forEach((function(t){t.draw()}))}}]),t}(),rg=a("kvnP"),ig=a("m7U+"),og=["cardCanvas"],sg=["downloadButton"],ag=((Xp=function(){function e(t,n,r){d(this,e),this.consumableServ=t,this.cropServ=n,this.document=r,this.layout=Jp.default,this.theme=Zp.primary,this.logoImg="assets/icons/LOGO-71x71.png",this.isEditing=!1,this.onEdit=new g.n,this.onDelete=new g.n,this.closeSettingIcon=qp.tb,this.settingIcon=qp.D,this.editIcon=qp.C,this.shareIcon=qp.kb,this.updateThemeIcon=qp.ab,this.copyIcon=qp.r,this.downloadIcon=qp.B,this.deleteIcon=qp.wb,this.window=this.document.defaultView}return f(e,[{key:"ngOnInit",value:function(){this.isEditing=!1,this.realfarmCard=new ng(this.data,Jp.default,this.theme),this.filename=this.data.gid+"_RealFarm\u5c0f\u5e6b\u624b.png"}},{key:"ngAfterViewInit",value:function(){this.context=this.canvas.nativeElement.getContext("2d"),this.drawCard()}},{key:"drawCard",value:function(){var t=this;this.realfarmCard=new ng(this.data,Jp.default,this.theme),this.realfarmCard.genBlocks(this.context),this.realfarmCard.genTexts(this.context),this.realfarmCard.genImages(this.context,this.logoImg,this.data.favorites.map((function(e,n){return n>=t.realfarmCard.layout.favoriteImg.max?"":t.cropServ.searchSeed(e)?t.cropServ.searchSeed(e).img:t.consumableServ.searchConsumable(e)[0].img}))),this.realfarmCard.draw(),this.link2Canvas()}},{key:"link2Canvas",value:function(){this.downloadBtn.nativeElement.href=this.canvas.nativeElement.toDataURL("image/png")}},{key:"shareCard",value:function(){return Object(Z.b)(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.link2Canvas(),t.next=3,fetch(this.downloadBtn.nativeElement.href);case 3:return t.next=5,t.sent.blob();case 5:return n=t.sent,r=Object({files:[new File([n],this.filename,{type:n.type,lastModified:(new Date).getTime()})]}),t.prev=7,t.next=10,this.window.navigator.share(r);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(7),20!==t.t0.code&&alert("[".concat(t.t0.code,"] \u6b64\u700f\u89bd\u5668\u7248\u672c\u5206\u4eab\u529f\u80fd\u51fa\u4e86\u9ede\u554f\u984c\ud83d\ude25"));case 15:case"end":return t.stop()}}),e,this,[[7,12]])})))}},{key:"copyImage",value:function(){}},{key:"editInfo",value:function(){this.isEditing=!1,this.onEdit.emit(this.data.id)}},{key:"deleteCard",value:function(){this.isEditing=!1,this.onDelete.emit(this.data.id)}},{key:"switchEditButtons",value:function(){this.isEditing=!this.isEditing}},{key:"updateTheme",value:function(){switch(this.theme){case Zp.primary:this.theme=Zp.secondary;break;case Zp.secondary:this.theme=Zp.skyBlue;break;case Zp.skyBlue:this.theme=Zp.primary}this.drawCard()}}]),e}()).\u0275fac=function(t){return new(t||Xp)(g.Ib(rg.a),g.Ib(ig.a),g.Ib(l.d))},Xp.\u0275cmp=g.Cb({type:Xp,selectors:[["app-realfarm-card"]],viewQuery:function(t,e){var n;1&t&&(g.xc(og,!0),g.xc(sg,!0)),2&t&&(g.ic(n=g.Wb())&&(e.canvas=n.first),g.ic(n=g.Wb())&&(e.downloadBtn=n.first))},inputs:{data:"data"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:28,vars:12,consts:[[1,"container"],["id","card-canvas",2,"width","100%",3,"width","height","click"],["cardCanvas",""],[1,"mask",3,"ngClass"],[1,"icon-button","settings",3,"ngClass","click"],[3,"icon"],[1,"wrapper","animation",3,"ngClass"],[1,"icon-button","updateTheme",3,"click"],[1,"icon-button","edit",3,"click"],[1,"icon-button","download",3,"download","click"],["downloadButton",""],[1,"icon-button","delete",3,"click"]],template:function(t,e){1&t&&(g.Ob(0,"div",0),g.Ob(1,"canvas",1,2),g.Vb("click",(function(){return e.editInfo()})),g.Nb(),g.Jb(3,"div",3),g.Ob(4,"div",4),g.Vb("click",(function(){return e.switchEditButtons()})),g.Jb(5,"fa-icon",5),g.Nb(),g.Ob(6,"div",6),g.Ob(7,"a",7),g.Vb("click",(function(){return e.updateTheme()})),g.Jb(8,"fa-icon",5),g.Ob(9,"span"),g.sc(10,"\u66f4\u63db\u4e3b\u984c"),g.Nb(),g.Nb(),g.Ob(11,"a",8),g.Vb("click",(function(){return e.shareCard()})),g.Jb(12,"fa-icon",5),g.Ob(13,"span"),g.sc(14,"\u5206\u4eab\u5361\u7247"),g.Nb(),g.Nb(),g.Ob(15,"a",8),g.Vb("click",(function(){return e.editInfo()})),g.Jb(16,"fa-icon",5),g.Ob(17,"span"),g.sc(18,"\u7de8\u8f2f"),g.Nb(),g.Nb(),g.Ob(19,"a",9,10),g.Vb("click",(function(){return e.link2Canvas()})),g.Jb(21,"fa-icon",5),g.Ob(22,"span"),g.sc(23,"\u5132\u5b58"),g.Nb(),g.Nb(),g.Ob(24,"a",11),g.Vb("click",(function(){return e.deleteCard()})),g.Jb(25,"fa-icon",5),g.Ob(26,"span"),g.sc(27,"\u522a\u9664"),g.Nb(),g.Nb(),g.Nb(),g.Nb()),2&t&&(g.yb(1),g.dc("width",e.realfarmCard.layout.card.w*e.realfarmCard.layout.scale)("height",e.realfarmCard.layout.card.h*e.realfarmCard.layout.scale),g.yb(2),g.dc("ngClass",e.isEditing?"open":""),g.yb(1),g.dc("ngClass",e.isEditing?"closeSettings":""),g.yb(1),g.dc("icon",e.isEditing?e.closeSettingIcon:e.settingIcon),g.yb(1),g.dc("ngClass",e.isEditing?"open":""),g.yb(2),g.dc("icon",e.updateThemeIcon),g.yb(4),g.dc("icon",e.shareIcon),g.yb(4),g.dc("icon",e.editIcon),g.yb(3),g.dc("download",e.filename),g.yb(2),g.dc("icon",e.downloadIcon),g.yb(4),g.dc("icon",e.deleteIcon))},directives:[l.j,Bp.a],styles:[".container[_ngcontent-%COMP%]{min-width:320px;max-width:400px;min-height:180px;max-height:225px;width:80%;height:80%;margin:0 auto;position:relative;aspect-ratio:16/9}.wrapper[_ngcontent-%COMP%]{margin:0 auto;display:flex;align-items:flex-end;justify-content:center;position:absolute;flex-direction:column;right:0;top:28px;transform:translateY(-50%) scaleY(0);z-index:0}.wrapper.open[_ngcontent-%COMP%]{transform:translateY(0) scaleY(1);z-index:5}.icon-button[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;height:28px;margin:4px;padding:4px 12px;border-radius:8px;align-items:center;justify-content:space-around;display:inline-flex;box-shadow:0 2px 8px 4px rgba(0,0,0,.15);background-color:var(--white)}.icon-button[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.icon-button[_ngcontent-%COMP%]:hover, .icon-button[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{cursor:pointer}.icon-button.settings[_ngcontent-%COMP%]{position:absolute;right:0;top:-20px;width:28px;height:28px;padding:4px;border-radius:50%;z-index:4}.icon-button.settings.closeSettings[_ngcontent-%COMP%]{z-index:6}.mask[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;background:rgba(0,0,0,.3);border-radius:12px;transform:scale(0)}.mask.open[_ngcontent-%COMP%]{transform:scale(1)}.animation[_ngcontent-%COMP%]{transition:.2s ease-in}.delete[_ngcontent-%COMP%]{color:var(--danger)}"]}),Xp),ug=((Yp=function(){function t(){d(this,t)}return f(t,[{key:"ngOnInit",value:function(){}}]),t}()).\u0275fac=function(t){return new(t||Yp)},Yp.\u0275cmp=g.Cb({type:Yp,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"wrapper"],[1,"loader"]],template:function(t,e){1&t&&(g.Ob(0,"div",0),g.Jb(1,"span",1),g.Nb())},styles:['.wrapper[_ngcontent-%COMP%]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;display:flex;justify-content:center;align-items:center}.loader[_ngcontent-%COMP%]{width:48px;height:48px;border:10px solid var(--light-gray);border-radius:50%;position:relative;transform:rotate(45deg);box-sizing:border-box}.loader[_ngcontent-%COMP%]:before{content:"";position:absolute;box-sizing:border-box;inset:-10px;border-radius:50%;border:10px solid var(--secondary);-webkit-animation:prixClipFix 2s linear infinite;animation:prixClipFix 2s linear infinite}@-webkit-keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}@keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}']}),Yp),cg=a("0zEo"),hg=function(t){return t[t.Unknown=0]="Unknown",t[t.Male=1]="Male",t[t.Female=2]="Female",t}({}),lg=a("s7LF");function fg(t,e){if(1&t&&(g.Ob(0,"option",23),g.sc(1),g.Nb()),2&t){var n=e.$implicit;g.dc("value",n.name),g.yb(1),g.uc(" ",n.name," ")}}function dg(t,e){if(1&t){var n=g.Pb();g.Ob(0,"div",9),g.Ob(1,"select",20),g.Vb("ngModelChange",(function(t){return g.kc(n),g.Xb().favorite=t})),g.qc(2,fg,2,2,"option",21),g.Nb(),g.Ob(3,"button",22),g.Vb("click",(function(){return g.kc(n),g.Xb().addFavorites()})),g.Jb(4,"fa-icon",18),g.Nb(),g.Nb()}if(2&t){var r=g.Xb();g.yb(1),g.dc("ngModel",r.favorite),g.yb(1),g.dc("ngForOf",r.displayObjs),g.yb(2),g.dc("icon",r.addIcon)}}function pg(t,e){if(1&t){var n=g.Pb();g.Ob(0,"div",24),g.Jb(1,"img",25),g.Ob(2,"fa-icon",26),g.Vb("click",(function(){g.kc(n);var t=e.$implicit;return g.Xb().removeFavorite(t)})),g.Nb(),g.Nb()}if(2&t){var r=e.$implicit,i=g.Xb();g.yb(1),g.dc("src",i.getImg(r),g.mc)("height",28)("alt",r+"\u7684\u5716\u7247"),g.yb(1),g.dc("icon",i.closeIcon)}}var gg,yg=((gg=function(){function t(e,n){d(this,t),this.cs=e,this.is=n,this.done=new g.n,this.cancel=new g.n,this.addIcon=qp.bb,this.closeIcon=qp.ub,this.cancelIcon=qp.tb,this.doneIcon=qp.k}return f(t,[{key:"ngOnInit",value:function(){var t=this.cs.getAllCrops().map((function(t){return{name:t.name,img:t.img,group:"\u4f5c\u7269"}})),e=this.is.getAllConsumables().map((function(t){return{name:t.name,img:t.img,group:t.group}}));this.realfarmObjs=[].concat(n(t),n(e)),null==this.data&&(this.data={id:"",uid:"",gid:"",greeting:"",level:10,gender:hg.Male,is_primary:!1,favorites:[]}),this.updateObjList()}},{key:"isMale",value:function(){return this.data.gender===hg.Male}},{key:"updateGender",value:function(t){this.data.gender=t?hg.Male:hg.Female}},{key:"updateObjList",value:function(){var t=this;this.displayObjs=this.realfarmObjs.filter((function(e){return!t.data.favorites.includes(e.name)})),this.favorite=this.displayObjs[0].name}},{key:"addFavorites",value:function(){console.log(this.data),this.data.favorites=[].concat(n(this.data.favorites),[this.favorite]),this.data=Object.assign({},this.data),this.updateObjList()}},{key:"removeFavorite",value:function(t){this.data.favorites=this.data.favorites.filter((function(e){return e!==t})),this.data=Object.assign({},this.data),this.updateObjList()}},{key:"getImg",value:function(t){var e=this.realfarmObjs.filter((function(e){return e.name===t}));return e.length>0?e[0].img:""}},{key:"doDone",value:function(){this.done.emit(this.data)}},{key:"doCancel",value:function(){this.cancel.emit(!0)}}]),t}()).\u0275fac=function(t){return new(t||gg)(g.Ib(ig.a),g.Ib(rg.a))},gg.\u0275cmp=g.Cb({type:gg,selectors:[["app-realfarm-form"]],inputs:{data:"data"},outputs:{cancel:"cancel",done:"done"},decls:52,vars:11,consts:[[1,"wrapper"],[1,"header"],[1,"info"],[1,"form"],[1,"group"],[1,"title"],[1,"element","horizontal"],["type","text","name","gid",1,"value",3,"ngModel","ngModelChange"],["type","number","step","1","name","level",1,"value",3,"ngModel","ngModelChange"],[1,"value"],["type","radio","name","gender",3,"checked","change"],["class","value",4,"ngIf"],[1,"element","item-list"],["class","item",4,"ngFor","ngForOf"],[1,"element","vertical"],["rows","5","name","greeting","maxlength","200",1,"value",3,"ngModel","ngModelChange"],[1,"actions"],[1,"button","cancel",3,"click"],[3,"icon"],[1,"button","submit",3,"click"],["name","favorite",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"button","add","item",3,"click"],[3,"value"],[1,"item"],[3,"src","height","alt"],[1,"close",3,"icon","click"]],template:function(t,e){1&t&&(g.Ob(0,"section",0),g.Ob(1,"h1",1),g.sc(2),g.Nb(),g.Ob(3,"div",2),g.sc(4,"\u5efa\u7acb/\u7de8\u8f2f\u81ea\u5df1\u7684\u904a\u6232\u8cc7\u8a0a\uff0c\u4e14\u53ef\u4ee5\u4e0b\u8f09\u5716\u7247\u5f8c\u5206\u4eab\u7d66\u5176\u4ed6\u8fb2\u53cb"),g.Nb(),g.Nb(),g.Ob(5,"section",0),g.Ob(6,"form",3),g.Ob(7,"section",4),g.Ob(8,"h2",5),g.sc(9,"\u904a\u6232\u57fa\u672c\u8cc7\u8a0a"),g.Nb(),g.Ob(10,"label",6),g.Ob(11,"span",5),g.sc(12,"\u904a\u6232 ID"),g.Nb(),g.Ob(13,"input",7),g.Vb("ngModelChange",(function(t){return e.data.gid=t})),g.Nb(),g.Nb(),g.Ob(14,"label",6),g.Ob(15,"span",5),g.sc(16,"\u7b49\u7d1a"),g.Nb(),g.Ob(17,"input",8),g.Vb("ngModelChange",(function(t){return e.data.level=t})),g.Nb(),g.Nb(),g.Ob(18,"label",6),g.Ob(19,"span",5),g.sc(20,"\u89d2\u8272\u6027\u5225"),g.Nb(),g.Ob(21,"div",9),g.Ob(22,"label"),g.Ob(23,"input",10),g.Vb("change",(function(){return e.updateGender(!0)})),g.Nb(),g.Ob(24,"span"),g.sc(25,"\u7537"),g.Nb(),g.Nb(),g.Ob(26,"label"),g.Ob(27,"input",10),g.Vb("change",(function(){return e.updateGender(!1)})),g.Nb(),g.Ob(28,"span"),g.sc(29,"\u5973"),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Ob(30,"section",4),g.Ob(31,"h2",5),g.sc(32,"\u5176\u4ed6\u8cc7\u8a0a"),g.Nb(),g.Ob(33,"label",6),g.Ob(34,"div",5),g.Ob(35,"span"),g.sc(36,"\u6211\u7684\u6700\u611b"),g.Nb(),g.Nb(),g.qc(37,dg,5,3,"div",11),g.Nb(),g.Ob(38,"div",12),g.qc(39,pg,3,4,"div",13),g.Nb(),g.Ob(40,"label",14),g.Ob(41,"span",5),g.sc(42),g.Nb(),g.Ob(43,"textarea",15),g.Vb("ngModelChange",(function(t){return e.data.greeting=t})),g.sc(44,"                "),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Ob(45,"div",16),g.Ob(46,"button",17),g.Vb("click",(function(){return e.doCancel()})),g.Jb(47,"fa-icon",18),g.sc(48," \u53d6\u6d88 "),g.Nb(),g.Ob(49,"button",19),g.Vb("click",(function(){return e.doDone()})),g.Jb(50,"fa-icon",18),g.sc(51," \u5b8c\u6210 "),g.Nb(),g.Nb(),g.Nb()),2&t&&(g.yb(2),g.uc("",""!==e.data.id?"\u7de8\u8f2f":"\u5efa\u7acb"," \u5361\u7247\u8cc7\u8a0a"),g.yb(11),g.dc("ngModel",e.data.gid),g.yb(4),g.dc("ngModel",e.data.level),g.yb(6),g.dc("checked",e.isMale()),g.yb(4),g.dc("checked",!e.isMale()),g.yb(10),g.dc("ngIf",e.data.favorites.length<3),g.yb(2),g.dc("ngForOf",e.data.favorites),g.yb(3),g.uc("\u5361\u7247\u5167\u5bb9 (",e.data.greeting.length," / 200)"),g.yb(1),g.dc("ngModel",e.data.greeting),g.yb(4),g.dc("icon",e.cancelIcon),g.yb(3),g.dc("icon",e.doneIcon))},directives:[lg.u,lg.k,lg.l,lg.b,lg.j,lg.m,lg.o,l.l,l.k,lg.i,Bp.a,lg.r,lg.n,lg.t],styles:[".value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:8px}.value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:4px;margin-left:0}.title.favorite[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{display:inline-block;width:40%;line-height:28px}.item-list[_ngcontent-%COMP%]{margin-top:8px}.item[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:inline-block;position:relative;padding:4px 8px}.item[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-4px;width:16px;height:16px}.button.add[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;padding:4px;margin-left:12px}.actions[_ngcontent-%COMP%]{width:100%;margin:8px;display:flex;flex-direction:row;justify-content:center}.button.cancel[_ngcontent-%COMP%], .button.submit[_ngcontent-%COMP%]{flex-grow:1;margin:0 8px;font-size:18px;height:36px;border-radius:4px;border:0}.button.submit[_ngcontent-%COMP%]{background-color:var(--primary);color:var(--white)}"]}),gg);function vg(t,e){if(1&t){var n=g.Pb();g.Ob(0,"div",6),g.Ob(1,"app-realfarm-card",9),g.Vb("onEdit",(function(t){return g.kc(n),g.Xb(2).editCard(t)}))("onDelete",(function(t){return g.kc(n),g.Xb(2).deleteCard(t)})),g.Nb(),g.Nb()}if(2&t){var r=e.$implicit;g.yb(1),g.dc("data",r)}}function mg(t,e){if(1&t){var n=g.Pb();g.Ob(0,"section"),g.Ob(1,"app-header",3),g.Vb("onClickCustomIcon",(function(){return g.kc(n),g.Xb().logout()})),g.Yb(2,"async"),g.Nb(),g.Ob(3,"div",4),g.qc(4,vg,2,1,"div",5),g.Yb(5,"async"),g.Ob(6,"div",6),g.Ob(7,"div",7),g.Vb("click",(function(){return g.kc(n),g.Xb().editCard(void 0)})),g.Jb(8,"fa-icon",8),g.Ob(9,"span"),g.sc(10,"\u65b0\u589e RealFarm \u5361\u7247"),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Nb()}if(2&t){var r,i=g.Xb();g.yb(1),g.dc("title",null==(r=g.Zb(2,8,i.userData))?null:r.name)("subtitle","\u500b\u4eba RealFarm \u8cc7\u8a0a "+i.cardInfos.length+"/5")("showBackIcon",!1)("showCustomIcon",!0)("customIcon",i.logoutIcon)("customString","\u767b\u51fa"),g.yb(3),g.dc("ngForOf",g.Zb(5,10,i.userRealFarm)),g.yb(4),g.dc("icon",i.addIcon)}}function bg(t,e){1&t&&g.Jb(0,"app-loading")}function wg(t,e){if(1&t){var n=g.Pb();g.Ob(0,"app-modal",10),g.Vb("cancel",(function(){return g.kc(n),g.Xb().cancelEdit()})),g.Ob(1,"app-realfarm-form",11),g.Vb("done",(function(t){return g.kc(n),g.Xb().finishEdit(t)}))("cancel",(function(){return g.kc(n),g.Xb().cancelEdit()})),g.Nb(),g.Nb()}if(2&t){var r=g.Xb();g.yb(1),g.dc("data",-1!==r.editIdx?r.cardInfos[r.editIdx]:null)}}var Ig,Og,Tg,Eg=function(){return t=["user","profile"],Object(v.a)(U,Object(m.a)((function(e){return e&&t||!0})));var t},_g=[{path:"",component:Vp,canActivate:[V],data:{authGuardPipe:Eg}},{path:"login",component:Vp,canActivate:[V],data:{authGuardPipe:Eg}},{path:"profile",component:(Ig=function(){function t(e,n,r,i,o){var s=this;d(this,t),this.auth=e,this.store=n,this.us=r,this.title=i,this.meta=o,this.cardNumber=0,this.logoutIcon=qp.lb,this.addIcon=qp.bb,this.auth.user.subscribe((function(t){var e=s.store.collection("users").doc(t.uid);s.userId=t.uid,s.userData=e.valueChanges(),s.userRealFarm=e.collection("realfarms").valueChanges(),e.get().subscribe((function(e){e.exists?s.us.updateUser(e.id,"last_login",s.us.getCurrentTime()):s.us.createUser(t)})),s.userRealFarm.subscribe((function(t){s.cardInfos=t})),s.userData.subscribe((function(t){s.userName=t.name,s.updateHeader()})),s.updateHeader()}))}return f(t,[{key:"ngOnInit",value:function(){this.editMode=0,this.userName=""}},{key:"logout",value:function(){this.us.logout()}},{key:"updateHeader",value:function(){""!==this.userName&&this.title.setTitle(this.userName+" | \u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"),this.meta.updateTag({name:"description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({name:"apple-mobile-web-app-title",content:"\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:title",content:"\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({property:"og:image",content:"https://bobosheep.github.io/farm-tool/assets/DisplayUserInfo.jpg"}),this.meta.updateTag({property:"og:url",content:"https://bobosheep.github.io/farm-tool/user/"})}},{key:"editCard",value:function(t){var e=this;t?(this.cardInfos.forEach((function(n,r){n.id===t&&(e.editIdx=r)})),this.editMode=2):(this.editIdx=-1,this.editMode=1)}},{key:"cancelEdit",value:function(){this.editMode=0}},{key:"finishEdit",value:function(t){1==this.editMode?this.createCard(t):this.updateCard(t),this.editMode=0}},{key:"createCard",value:function(t){this.us.createRealfarmInfo(this.userId,t)}},{key:"updateCard",value:function(t){this.cardInfos[this.editIdx]=t,this.us.upateRealFamrInfo(this.userId,this.cardInfos[this.editIdx])}},{key:"deleteCard",value:function(t){var e=this;if(confirm("\u78ba\u5b9a\u522a\u9664\u6b64\u5361\u7247")&&t)for(var n=0;n<this.cardInfos.length;n++)this.cardInfos[n].id===t&&(this.us.deleteRealFarmInfo(this.userId,this.cardInfos[n]),this.userRealFarm.subscribe((function(t){e.cardInfos=t})))}}]),t}(),Ig.\u0275fac=function(t){return new(t||Ig)(g.Ib(M),g.Ib(Fp),g.Ib(Lp),g.Ib(Mp.d),g.Ib(Mp.c))},Ig.\u0275cmp=g.Cb({type:Ig,selectors:[["app-profile"]],decls:5,vars:5,consts:[[4,"ngIf","ngIfElse"],["loadingTemplate",""],[3,"cancel",4,"ngIf"],[3,"title","subtitle","showBackIcon","showCustomIcon","customIcon","customString","onClickCustomIcon"],[1,"cards"],["class","card wrapper",4,"ngFor","ngForOf"],[1,"card","wrapper"],["id","add-card",3,"click"],[3,"icon"],[3,"data","onEdit","onDelete"],[3,"cancel"],[3,"data","done","cancel"]],template:function(t,e){if(1&t&&(g.qc(0,mg,11,12,"section",0),g.Yb(1,"async"),g.qc(2,bg,1,0,"ng-template",null,1,g.rc),g.qc(4,wg,2,1,"app-modal",2)),2&t){var n=g.jc(3);g.dc("ngIf",g.Zb(1,3,e.userData))("ngIfElse",n),g.yb(4),g.dc("ngIf",0!==e.editMode)}},directives:[l.l,Up.a,l.k,Bp.a,ag,ug,cg.a,yg],pipes:[l.b],styles:[".cards[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;align-items:center;justify-content:flex-start;margin-top:32px}.card[_ngcontent-%COMP%]{width:100%;margin-bottom:12px}#add-card[_ngcontent-%COMP%]{font-size:14px;min-width:320px;max-width:400px;width:80%;margin:0 auto;height:64px;color:var(--gray);display:flex;align-items:center;justify-content:center;background-image:url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23909090' stroke-width='2' stroke-dasharray='14' stroke-dashoffset='14' stroke-linecap='square'/%3e%3c/svg%3e\");border-radius:12px}#add-card[_ngcontent-%COMP%]:hover, #add-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:hover{cursor:pointer}#add-card[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 8px}"]}),Ig),canActivate:[V],data:{authGuardPipe:function(){return t=["user","login"],Object(v.a)(U,Object(m.a)((function(e){return e||t})));var t}}}],Sg=((Og=f((function t(){d(this,t)}))).\u0275mod=g.Gb({type:Og}),Og.\u0275inj=g.Fb({factory:function(t){return new(t||Og)},imports:[[l.c,p.g.forChild(_g)]]}),Og),kg=a("jICo"),xg=((Tg=f((function t(){d(this,t)}))).\u0275mod=g.Gb({type:Tg}),Tg.\u0275inj=g.Fb({factory:function(t){return new(t||Tg)},imports:[[l.c,Sg,kg.a,Bp.b,lg.h,lg.q]]}),Tg)}}])}();