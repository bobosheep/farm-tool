(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"7UCR":function(t,e,n){"use strict";n.r(e),n.d(e,"UserModule",function(){return gg});var r=n("ofXK"),i=n("tyNb"),o=n("fXoL"),s=n("LRne"),a=n("mCNh"),u=n("lJxs"),c=n("IzEk"),h=n("eIep"),l=n("XNiG"),f=n("HDdC"),d=n("Cfvw"),p=n("VRyK"),g=n("pxpQ"),y=n("UXun"),m=n("SxV6"),v=n("aGrj"),b=n("tf+s"),w=n("pLZG"),I=n("spgP");const T=new o.r("angularfire2.auth.use-emulator"),O=new o.r("angularfire2.auth.settings"),E=new o.r("angularfire2.auth.tenant-id"),_=new o.r("angularfire2.auth.langugage-code"),S=new o.r("angularfire2.auth.use-device-language"),x=new o.r("angularfire.auth.persistence");let C=(()=>{class t{constructor(t,e,i,o,a,c,T,O,E,_){const S=new I.d(o),x=Object(I.h)(S),C=new l.a,j=Object(s.a)(void 0).pipe(Object(g.b)(S.outsideAngular),Object(h.a)(()=>o.runOutsideAngular(()=>n.e(20).then(n.bind(null,"6nsN")))),Object(u.a)(()=>Object(I.g)(t,o,e)),Object(u.a)(t=>o.runOutsideAngular(()=>{const e=a,n=c;return Object(I.f)(`${t.name}.auth`,"AngularFireAuth",t,()=>{const r=o.runOutsideAngular(()=>t.auth());if(e&&r.useEmulator(`http://${e.join(":")}`),T&&(r.tenantId=T),r.languageCode=O,E&&r.useDeviceLanguage(),n)for(const[t,e]of Object.entries(n))r.settings[t]=e;return _&&r.setPersistence(_),r},[e,T,O,E,n,_])})),Object(y.a)({bufferSize:1,refCount:!1}));if(Object(r.s)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(s.a)(null);else{j.pipe(Object(m.a)()).subscribe();const t=j.pipe(Object(h.a)(t=>t.getRedirectResult().then(t=>t,()=>null)),x,Object(y.a)({bufferSize:1,refCount:!1})),e=t=>new f.a(e=>({unsubscribe:o.runOutsideAngular(()=>t(e))})),n=j.pipe(Object(h.a)(t=>e(t.onAuthStateChanged.bind(t)))),r=j.pipe(Object(h.a)(t=>e(t.onIdTokenChanged.bind(t))));this.authState=t.pipe(Object(v.a)(n),Object(b.a)(S.outsideAngular),Object(g.b)(S.insideAngular)),this.user=t.pipe(Object(v.a)(r),Object(b.a)(S.outsideAngular),Object(g.b)(S.insideAngular)),this.idToken=this.user.pipe(Object(h.a)(t=>t?Object(d.a)(t.getIdToken()):Object(s.a)(null))),this.idTokenResult=this.user.pipe(Object(h.a)(t=>t?Object(d.a)(t.getIdTokenResult()):Object(s.a)(null))),this.credential=Object(p.a)(t,C,this.authState.pipe(Object(w.a)(t=>!t))).pipe(Object(u.a)(t=>(null==t?void 0:t.user)?t:null),Object(b.a)(S.outsideAngular),Object(g.b)(S.insideAngular))}return Object(I.i)(this,j,o,{spy:{apply:(t,e,n)=>{(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then(t=>C.next(t))}}})}}return t.\u0275fac=function(e){return new(e||t)(o.Vb(I.c),o.Vb(I.b,8),o.Vb(o.C),o.Vb(o.A),o.Vb(T,8),o.Vb(O,8),o.Vb(E,8),o.Vb(_,8),o.Vb(S,8),o.Vb(x,8))},t.\u0275prov=o.Hb({factory:function(){return new t(o.Vb(I.c),o.Vb(I.b,8),o.Vb(o.C),o.Vb(o.A),o.Vb(T,8),o.Vb(O,8),o.Vb(E,8),o.Vb(_,8),o.Vb(S,8),o.Vb(x,8))},token:t,providedIn:"any"}),t})();Object(I.e)(C,[{app:null,applyActionCode:null,checkActionCode:null,confirmPasswordReset:null,createUserWithEmailAndPassword:null,currentUser:null,fetchSignInMethodsForEmail:null,isSignInWithEmailLink:null,getRedirectResult:null,languageCode:null,settings:null,onAuthStateChanged:null,onIdTokenChanged:null,sendSignInLinkToEmail:null,sendPasswordResetEmail:null,setPersistence:null,signInAndRetrieveDataWithCredential:null,signInAnonymously:null,signInWithCredential:null,signInWithCustomToken:null,signInWithEmailAndPassword:null,signInWithPhoneNumber:null,signInWithEmailLink:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,tenantId:null,updateCurrentUser:null,useDeviceLanguage:null,useEmulator:null,verifyPasswordResetCode:null}]);const j=Object(u.a)(t=>!!t);let D=(()=>{class t{constructor(t,e){this.router=t,this.auth=e,this.canActivate=(t,e)=>{const n=t.data.authGuardPipe||(()=>j);return this.auth.user.pipe(Object(c.a)(1),n(t,e),Object(u.a)(t=>"boolean"==typeof t?t:Array.isArray(t)?this.router.createUrlTree(t):this.router.parseUrl(t)))}}}return t.\u0275fac=function(e){return new(e||t)(o.Vb(i.c),o.Vb(C))},t.\u0275prov=o.Hb({factory:function(){return new t(o.Vb(i.c),o.Vb(C))},token:t,providedIn:"any"}),t})();Object(u.a)(t=>!!t&&!t.isAnonymous);const A=Object(h.a)(t=>t?t.getIdTokenResult():Object(s.a)(null));Object(u.a)(t=>!!t&&t.emailVerified),Object(a.a)(A,Object(u.a)(t=>t?t.claims:[]));var k=n("Jgta"),N=function(t){return t[t.Admin=0]="Admin",t[t.Editor=1]="Editor",t[t.ClubAdmin=2]="ClubAdmin",t[t.User=100]="User",t}({}),R=n("D0XW"),P=n("JX91"),F=n("7o/Q");function M(){return t=>t.lift(new L)}class L{call(t,e){return e.subscribe(new V(t))}}class V extends F.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var U=n("Kqap");class q{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new B(t,this.compare,this.keySelector))}}class B extends F.a{constructor(t,e,n){super(t),this.keySelector=n,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:n}=this;e=n?n(t):t}catch(r){return this.destination.error(r)}let n=!1;if(this.hasKey)try{const{compare:t}=this;n=t(this.key,e)}catch(r){return this.destination.error(r)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))}}var Q=n("zIRd"),K=n("mrSG"),G=n("qOnz"),z=n("q/0M"),H=function(t,e){return(H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function W(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var Y,X="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},$=$||{},J=X||self;function Z(){}function tt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function et(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var nt="closure_uid_"+(1e9*Math.random()>>>0),rt=0;function it(t,e,n){return t.call.apply(t.bind,arguments)}function ot(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function st(t,e,n){return(st=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?it:ot).apply(null,arguments)}function at(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function ut(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function ct(){this.s=this.s,this.o=this.o}var ht={};ct.prototype.s=!1,ct.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,nt)&&t[nt]||(t[nt]=++rt)}(this);delete ht[t]}},ct.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var lt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},ft=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function dt(t){return Array.prototype.concat.apply([],arguments)}function pt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function gt(t){return/^[\s\xa0]*$/.test(t)}var yt,mt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function vt(t,e){return-1!=t.indexOf(e)}function bt(t,e){return t<e?-1:t>e?1:0}t:{var wt=J.navigator;if(wt){var It=wt.userAgent;if(It){yt=It;break t}}yt=""}function Tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ot(t){var e={};for(var n in t)e[n]=t[n];return e}var Et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _t(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Et.length;o++)n=Et[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function St(t){return St[" "](t),t}St[" "]=Z;var xt,Ct,jt=vt(yt,"Opera"),Dt=vt(yt,"Trident")||vt(yt,"MSIE"),At=vt(yt,"Edge"),kt=At||Dt,Nt=vt(yt,"Gecko")&&!(vt(yt.toLowerCase(),"webkit")&&!vt(yt,"Edge"))&&!(vt(yt,"Trident")||vt(yt,"MSIE"))&&!vt(yt,"Edge"),Rt=vt(yt.toLowerCase(),"webkit")&&!vt(yt,"Edge");function Pt(){var t=J.document;return t?t.documentMode:void 0}t:{var Ft="",Mt=(Ct=yt,Nt?/rv:([^\);]+)(\)|;)/.exec(Ct):At?/Edge\/([\d\.]+)/.exec(Ct):Dt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ct):Rt?/WebKit\/(\S+)/.exec(Ct):jt?/(?:Version)[ \/]?(\S+)/.exec(Ct):void 0);if(Mt&&(Ft=Mt?Mt[1]:""),Dt){var Lt=Pt();if(null!=Lt&&Lt>parseFloat(Ft)){xt=String(Lt);break t}}xt=Ft}var Vt={};var Ut=J.document&&Dt&&(Pt()||parseInt(xt,10))||void 0,qt=function(){if(!J.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{J.addEventListener("test",Z,e),J.removeEventListener("test",Z,e)}catch(n){}return t}();function Bt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Qt(t,e){if(Bt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Nt){t:{try{St(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Kt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Qt.Z.h.call(this)}}Bt.prototype.h=function(){this.defaultPrevented=!0},ut(Qt,Bt);var Kt={2:"touch",3:"pen",4:"mouse"};Qt.prototype.h=function(){Qt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Gt="closure_listenable_"+(1e6*Math.random()|0),zt=0;function Ht(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++zt,this.ca=this.fa=!1}function Wt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Yt(t){this.src=t,this.g={},this.h=0}function Xt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=lt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Wt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $t(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Yt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=$t(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Ht(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Jt="closure_lm_"+(1e6*Math.random()|0),Zt={};function te(t,e,n,r,i){if(r&&r.once)return ne(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)te(t,e[o],n,r,i);return null}return n=ce(n),t&&t[Gt]?t.N(e,n,et(r)?!!r.capture:!!r,i):ee(t,e,n,!1,r,i)}function ee(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=et(i)?!!i.capture:!!i,a=ae(t);if(a||(t[Jt]=a=new Yt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=se;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)qt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(oe(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ne(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)ne(t,e[o],n,r,i);return null}return n=ce(n),t&&t[Gt]?t.O(e,n,et(r)?!!r.capture:!!r,i):ee(t,e,n,!0,r,i)}function re(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)re(t,e[o],n,r,i);else r=et(r)?!!r.capture:!!r,n=ce(n),t&&t[Gt]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=$t(o=t.g[e],n,r,i))&&(Wt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=ae(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$t(e,n,r,i)),(n=-1<t?e[t]:null)&&ie(n))}function ie(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Gt])Xt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(oe(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ae(e))?(Xt(n,t),0==n.h&&(n.src=null,e[Jt]=null)):Wt(t)}}}function oe(t){return t in Zt?Zt[t]:Zt[t]="on"+t}function se(t,e){if(t.ca)t=!0;else{e=new Qt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&ie(t),t=n.call(r,e)}return t}function ae(t){return(t=t[Jt])instanceof Yt?t:null}var ue="__closure_events_fn_"+(1e9*Math.random()>>>0);function ce(t){return"function"==typeof t?t:(t[ue]||(t[ue]=function(e){return t.handleEvent(e)}),t[ue])}function he(){ct.call(this),this.i=new Yt(this),this.P=this,this.I=null}function le(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Bt(e,t);else if(e instanceof Bt)e.target=e.target||t;else{var i=e;_t(e=new Bt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=fe(s,r,!0,e)&&i}if(i=fe(s=e.g=t,r,!0,e)&&i,i=fe(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=fe(s=e.g=n[o],r,!1,e)&&i}function fe(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&Xt(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ut(he,ct),he.prototype[Gt]=!0,he.prototype.removeEventListener=function(t,e,n,r){re(this,t,e,n,r)},he.prototype.M=function(){if(he.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Wt(n[r]);delete e.g[t],e.h--}}this.I=null},he.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},he.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var de=J.JSON.stringify;function pe(){var t=Te,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var ge,ye=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=me.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),me=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new ve},function(t){return t.reset()}),ve=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function be(t){J.setTimeout(function(){throw t},0)}function we(t,e){ge||function(){var t=J.Promise.resolve(void 0);ge=function(){t.then(Oe)}}(),Ie||(ge(),Ie=!0),Te.add(t,e)}var Ie=!1,Te=new ye;function Oe(){for(var t;t=pe();){try{t.h.call(t.g)}catch(n){be(n)}var e=me;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ie=!1}function Ee(t,e){he.call(this),this.h=t||1,this.g=e||J,this.j=st(this.kb,this),this.l=Date.now()}function _e(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Se(t,e,n){if("function"==typeof t)n&&(t=st(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=st(t.handleEvent,t)}return 2147483647<Number(e)?-1:J.setTimeout(t,e||0)}function xe(t){t.g=Se(function(){t.g=null,t.i&&(t.i=!1,xe(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}ut(Ee,he),(Y=Ee.prototype).da=!1,Y.S=null,Y.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),le(this,"tick"),this.da&&(_e(this),this.start()))}},Y.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Y.M=function(){Ee.Z.M.call(this),_e(this),delete this.g};var Ce=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}H(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:xe(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(J.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(ct);function je(t){ct.call(this),this.h=t,this.g={}}ut(je,ct);var De=[];function Ae(t,e,n,r){Array.isArray(n)||(n&&(De[0]=n.toString()),n=De);for(var i=0;i<n.length;i++){var o=te(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function ke(t){Tt(t.g,function(t,e){this.g.hasOwnProperty(e)&&ie(t)},t),t.g={}}function Ne(){this.g=!0}function Re(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return de(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}je.prototype.M=function(){je.Z.M.call(this),ke(this)},je.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ne.prototype.Aa=function(){this.g=!1},Ne.prototype.info=function(){};var Pe={},Fe=null;function Me(){return Fe=Fe||new he}function Le(t){Bt.call(this,Pe.Ma,t)}function Ve(t){var e=Me();le(e,new Le(e,t))}function Ue(t,e){Bt.call(this,Pe.STAT_EVENT,t),this.stat=e}function qe(t){var e=Me();le(e,new Ue(e,t))}function Be(t,e){Bt.call(this,Pe.Na,t),this.size=e}function Qe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return J.setTimeout(function(){t()},e)}Pe.Ma="serverreachability",ut(Le,Bt),Pe.STAT_EVENT="statevent",ut(Ue,Bt),Pe.Na="timingevent",ut(Be,Bt);var Ke={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ge={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ze(){}function He(){}ze.prototype.h=null;var We,Ye={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Xe(){Bt.call(this,"d")}function $e(){Bt.call(this,"c")}function Je(){}function Ze(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new je(this),this.P=en,this.W=new Ee(t=kt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new tn}function tn(){this.i=null,this.g="",this.h=!1}ut(Xe,Bt),ut($e,Bt),ut(Je,ze),Je.prototype.g=function(){return new XMLHttpRequest},Je.prototype.i=function(){return{}},We=new Je;var en=45e3,nn={},rn={};function on(t,e,n){t.K=1,t.v=Cn(Tn(e)),t.s=n,t.U=!0,sn(t,null)}function sn(t,e){t.F=Date.now(),hn(t),t.A=Tn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),qn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new tn,t.g=Br(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Ce(st(t.Ia,t,t.g),t.O)),Ae(t.V,t.g,"readystatechange",t.gb),e=t.H?Ot(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ve(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function an(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function un(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=cn(t,n))==rn){4==e&&(t.o=4,qe(14),i=!1),Re(t.j,t.m,null,"[Incomplete Response]");break}if(r==nn){t.o=4,qe(15),Re(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Re(t.j,t.m,r,null),gn(t,r)}an(t)&&r!=rn&&r!=nn&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,qe(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Rr(e),e.L=!0,qe(11))):(Re(t.j,t.m,n,"[Invalid Chunked Response]"),pn(t),dn(t))}function cn(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?rn:(n=Number(e.substring(n,r)),isNaN(n)?nn:(r+=1)+n>e.length?rn:(e=e.substr(r,n),t.C=r+n,e))}function hn(t){t.Y=Date.now()+t.P,ln(t,t.P)}function ln(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Qe(st(t.eb,t),e)}function fn(t){t.B&&(J.clearTimeout(t.B),t.B=null)}function dn(t){0==t.l.G||t.I||Mr(t.l,t)}function pn(t){fn(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,_e(t.W),ke(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function gn(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Wn(n.i,t)))if(n.I=t.N,!t.J&&Wn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Fr(n),_r(n)}Nr(n),qe(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Qe(st(n.ab,n),6e3));if(1>=Hn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Vr(n,11)}else if((t.J||n.g==t)&&Fr(n),!gt(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(vt(h,"spdy")||vt(h,"quic")||vt(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Yn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,xn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=qr(r,r.H?r.la:null,r.W),d.J){Xn(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(fn(p),hn(p)),r.g=d}else kr(r);0<n.l.length&&Cr(n)}else"stop"!=o[0]&&"close"!=o[0]||Vr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Vr(n,7):Er(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Ve(4)}catch(o){}}function yn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(tt(t)||"string"==typeof t)ft(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(tt(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(tt(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function mn(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof mn)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function vn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];bn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)bn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function bn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Y=Ze.prototype).setTimeout=function(t){this.P=t},Y.gb=function(t){t=t.target;var e=this.L;e&&3==br(t)?e.l():this.Ia(t)},Y.Ia=function(t){try{if(t==this.g)t:{var e=br(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||kt||this.g&&(this.h.h||this.g.ga()||wr(this.g)))){this.I||4!=e||7==n||Ve(8==n||0>=r?3:2),fn(this);var i=this.g.ba();this.N=i;e:if(an(this)){var o=wr(this.g);t="";var s=o.length,a=4==br(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){pn(this),dn(this);var u="";break e}this.h.i=new J.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!gt(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,qe(12),pn(this),dn(this);break t}Re(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,gn(this,i)}this.U?(un(this,e,u),kt&&this.i&&3==e&&(Ae(this.V,this.W,"tick",this.fb),this.W.start())):(Re(this.j,this.m,u,null),gn(this,u)),4==e&&pn(this),this.i&&!this.I&&(4==e?Mr(this.l,this):(this.i=!1,hn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,qe(12)):(this.o=0,qe(13)),pn(this),dn(this)}}}catch(e){}},Y.fb=function(){if(this.g){var t=br(this.g),e=this.g.ga();this.C<e.length&&(fn(this),un(this,t,e),this.i&&4!=t&&hn(this))}},Y.cancel=function(){this.I=!0,pn(this)},Y.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Ve(3),qe(17)),pn(this),this.o=2,dn(this)):ln(this,this.Y-t)},(Y=mn.prototype).R=function(){vn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},Y.T=function(){return vn(this),this.g.concat()},Y.get=function(t,e){return bn(this.h,t)?this.h[t]:e},Y.set=function(t,e){bn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},Y.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var wn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function In(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof In){this.g=void 0!==e?e:t.g,On(this,t.j),this.s=t.s,En(this,t.i),_n(this,t.m),this.l=t.l,e=t.h;var n=new Mn;n.i=e.i,e.g&&(n.g=new mn(e.g),n.h=e.h),Sn(this,n),this.o=t.o}else t&&(n=String(t).match(wn))?(this.g=!!e,On(this,n[1]||"",!0),this.s=jn(n[2]||""),En(this,n[3]||"",!0),_n(this,n[4]),this.l=jn(n[5]||"",!0),Sn(this,n[6]||"",!0),this.o=jn(n[7]||"")):(this.g=!!e,this.h=new Mn(null,this.g))}function Tn(t){return new In(t)}function On(t,e,n){t.j=n?jn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function En(t,e,n){t.i=n?jn(e,!0):e}function _n(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Sn(t,e,n){e instanceof Mn?(t.h=e,function(t,e){e&&!t.j&&(Ln(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Vn(this,e),qn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=Dn(e,Pn)),t.h=new Mn(e,t.g))}function xn(t,e,n){t.h.set(e,n)}function Cn(t){return xn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function jn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Dn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,An),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function An(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}In.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Dn(e,kn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Dn(e,kn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Dn(n,"/"==n.charAt(0)?Rn:Nn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Dn(n,Fn)),t.join("")};var kn=/[#\/\?@]/g,Nn=/[#\?:]/g,Rn=/[#\?]/g,Pn=/[#\?@]/g,Fn=/#/g;function Mn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ln(t){t.g||(t.g=new mn,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Vn(t,e){Ln(t),e=Bn(t,e),bn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,bn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&vn(t)))}function Un(t,e){return Ln(t),e=Bn(t,e),bn(t.g.h,e)}function qn(t,e,n){Vn(t,e),0<n.length&&(t.i=null,t.g.set(Bn(t,e),pt(n)),t.h+=n.length)}function Bn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(Y=Mn.prototype).add=function(t,e){Ln(this),this.i=null,t=Bn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Y.forEach=function(t,e){Ln(this),this.g.forEach(function(n,r){ft(n,function(n){t.call(e,n,r,this)},this)},this)},Y.T=function(){Ln(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Y.R=function(t){Ln(this);var e=[];if("string"==typeof t)Un(this,t)&&(e=dt(e,this.g.get(Bn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=dt(e,t[n])}return e},Y.set=function(t,e){return Ln(this),this.i=null,Un(this,t=Bn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Y.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},Y.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Qn=function(){return function(t,e){this.h=t,this.g=e}}();function Kn(t){this.l=t||Gn,t=J.PerformanceNavigationTiming?0<(t=J.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(J.g&&J.g.Ea&&J.g.Ea()&&J.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Gn=10;function zn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Hn(t){return t.h?1:t.g?t.g.size:0}function Wn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Yn(t,e){t.g?t.g.add(e):t.h=e}function Xn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function $n(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=W(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return pt(t.i)}function Jn(){}function Zn(){this.g=new Jn}function tr(t,e,n){var r=n||"";try{yn(t,function(t,n){var i=t;et(t)&&(i=de(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(hp){throw e.push(r+"type="+encodeURIComponent("_badmap")),hp}}function er(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function nr(t){this.l=t.$b||null,this.j=t.ib||!1}function rr(t,e){he.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=ir,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Kn.prototype.cancel=function(){var t,e;if(this.i=$n(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=W(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Jn.prototype.stringify=function(t){return J.JSON.stringify(t,void 0)},Jn.prototype.parse=function(t){return J.JSON.parse(t,void 0)},ut(nr,ze),nr.prototype.g=function(){return new rr(this.l,this.j)},nr.prototype.i=function(t){return function(){return t}}({}),ut(rr,he);var ir=0;function or(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function sr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ar(t)}function ar(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Y=rr.prototype).open=function(t,e){if(this.readyState!=ir)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ar(this)},Y.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||J).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},Y.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,sr(this)),this.readyState=ir},Y.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ar(this)),this.g&&(this.readyState=3,ar(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==J.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;or(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},Y.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?sr(this):ar(this),3==this.readyState&&or(this)}},Y.Ua=function(t){this.g&&(this.response=this.responseText=t,sr(this))},Y.Ta=function(t){this.g&&(this.response=t,sr(this))},Y.ha=function(){this.g&&sr(this)},Y.setRequestHeader=function(t,e){this.v.append(t,e)},Y.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Y.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(rr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var ur=J.JSON.parse;function cr(t){he.call(this),this.headers=new mn,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=hr,this.K=this.L=!1}ut(cr,he);var hr="",lr=/^https?$/i,fr=["POST","PUT"];function dr(t){return"content-type"==t.toLowerCase()}function pr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,gr(t),mr(t)}function gr(t){t.D||(t.D=!0,le(t,"complete"),le(t,"error"))}function yr(t){if(t.h&&void 0!==$&&(!t.C[1]||4!=br(t)||2!=t.ba()))if(t.v&&4==br(t))Se(t.Fa,0,t);else if(le(t,"readystatechange"),4==br(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(wn)[1]||null;if(!o&&J.self&&J.self.location){var s=J.self.location.protocol;o=s.substr(0,s.length-1)}i=!lr.test(o?o.toLowerCase():"")}e=i}if(e)le(t,"complete"),le(t,"success");else{t.m=6;try{var a=2<br(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",gr(t)}}finally{mr(t)}}}function mr(t,e){if(t.g){vr(t);var n=t.g,r=t.C[0]?Z:null;t.g=null,t.C=null,e||le(t,"ready");try{n.onreadystatechange=r}catch(hp){}}}function vr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(J.clearTimeout(t.A),t.A=null)}function br(t){return t.g?t.g.readyState:0}function wr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case hr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ir(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Tt(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):xn(t,e,n))}function Tr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Or(t){this.za=0,this.l=[],this.h=new Ne,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Tr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Tr("baseRetryDelayMs",5e3,t),this.$a=Tr("retryDelaySeedMs",1e4,t),this.Ya=Tr("forwardChannelMaxRetries",2,t),this.ra=Tr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Kn(t&&t.concurrentRequestLimit),this.Ca=new Zn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Er(t){if(Sr(t),3==t.G){var e=t.V++,n=Tn(t.F);xn(n,"SID",t.J),xn(n,"RID",e),xn(n,"TYPE","terminate"),Dr(t,n),(e=new Ze(t,t.h,e,void 0)).K=2,e.v=Cn(Tn(n)),n=!1,J.navigator&&J.navigator.sendBeacon&&(n=J.navigator.sendBeacon(e.v.toString(),"")),!n&&J.Image&&((new Image).src=e.v,n=!0),n||(e.g=Br(e.l,null),e.g.ea(e.v)),e.F=Date.now(),hn(e)}Ur(t)}function _r(t){t.g&&(Rr(t),t.g.cancel(),t.g=null)}function Sr(t){_r(t),t.u&&(J.clearTimeout(t.u),t.u=null),Fr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&J.clearTimeout(t.m),t.m=null)}function xr(t,e){t.l.push(new Qn(t.Za++,e)),3==t.G&&Cr(t)}function Cr(t){zn(t.i)||t.m||(t.m=!0,we(t.Ha,t),t.C=0)}function jr(t,e){var n;n=e?e.m:t.V++;var r=Tn(t.F);xn(r,"SID",t.J),xn(r,"RID",n),xn(r,"AID",t.U),Dr(t,r),t.o&&t.s&&Ir(r,t.o,t.s),n=new Ze(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Ar(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Yn(t.i,n),on(n,r,e)}function Dr(t,e){t.j&&yn({},function(t,n){xn(e,n,t)})}function Ar(t,e,n){n=Math.min(t.l.length,n);var r=t.j?st(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{tr(h,s,"req"+c+"_")}catch(wi){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function kr(t){t.g||t.u||(t.Y=1,we(t.Ga,t),t.A=0)}function Nr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Qe(st(t.Ga,t),Lr(t,t.A)),t.A++,0))}function Rr(t){null!=t.B&&(J.clearTimeout(t.B),t.B=null)}function Pr(t){t.g=new Ze(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Tn(t.oa);xn(e,"RID","rpc"),xn(e,"SID",t.J),xn(e,"CI",t.N?"0":"1"),xn(e,"AID",t.U),Dr(t,e),xn(e,"TYPE","xmlhttp"),t.o&&t.s&&Ir(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Cn(Tn(e)),n.s=null,n.U=!0,sn(n,t)}function Fr(t){null!=t.v&&(J.clearTimeout(t.v),t.v=null)}function Mr(t,e){var n=null;if(t.g==e){Fr(t),Rr(t),t.g=null;var r=2}else{if(!Wn(t.i,e))return;n=e.D,Xn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;le(r=Me(),new Be(r,n,e,i)),Cr(t)}else kr(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Hn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Qe(st(t.Ha,t,e),Lr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Nr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Vr(t,5);break;case 4:Vr(t,10);break;case 3:Vr(t,6);break;default:Vr(t,2)}}function Lr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Vr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=st(t.jb,t);n||(n=new In("//www.google.com/images/cleardot.gif"),J.location&&"http"==J.location.protocol||On(n,"https"),Cn(n)),function(t,e){var n=new Ne;if(J.Image){var r=new Image;r.onload=at(er,n,r,"TestLoadImage: loaded",!0,e),r.onerror=at(er,n,r,"TestLoadImage: error",!1,e),r.onabort=at(er,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=at(er,n,r,"TestLoadImage: timeout",!1,e),J.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else qe(2);t.G=0,t.j&&t.j.va(e),Ur(t),Sr(t)}function Ur(t){t.G=0,t.I=-1,t.j&&(0==$n(t.i).length&&0==t.l.length||(t.i.i.length=0,pt(t.l),t.l.length=0),t.j.ua())}function qr(t,e,n){var r=function(t){return t instanceof In?Tn(t):new In(t,void 0)}(n);if(""!=r.i)e&&En(r,e+"."+r.i),_n(r,r.m);else{var i=J.location;r=function(t,e,n,r){var i=new In(null,void 0);return t&&On(i,t),e&&En(i,e),n&&_n(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&Tt(t.aa,function(t,e){xn(r,e,t)}),n=t.sa,(e=t.D)&&n&&xn(r,e,n),xn(r,"VER",t.ma),Dr(t,r),r}function Br(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new cr(n&&t.Ba&&!t.qa?new nr({ib:!0}):t.qa)).L=t.H,e}function Qr(){}function Kr(){if(Dt&&!(10<=Number(Ut)))throw Error("Environmental error: no available transport.")}function Gr(t,e){he.call(this),this.g=new Or(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!gt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!gt(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Wr(this)}function zr(t){Xe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Hr(){$e.call(this),this.status=1}function Wr(t){this.g=t}(Y=cr.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():We.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:We),this.g.onreadystatechange=st(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void pr(this,o)}t=n||"";var i=new mn(this.headers);r&&yn(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=dr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=J.FormData&&t instanceof J.FormData,!(0<=lt(fr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{vr(this),0<this.B&&((this.K=function(t){return Dt&&function(){return t=Vt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=mt(String(xt)).split("."),n=mt("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=bt(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||bt(0==o[2].length,0==s[2].length)||bt(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=st(this.pa,this)):this.A=Se(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){pr(this,o)}},Y.pa=function(){void 0!==$&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,le(this,"timeout"),this.abort(8))},Y.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,le(this,"complete"),le(this,"abort"),mr(this))},Y.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),mr(this,!0)),cr.Z.M.call(this)},Y.Fa=function(){this.s||(this.F||this.v||this.l?yr(this):this.cb())},Y.cb=function(){yr(this)},Y.ba=function(){try{return 2<br(this)?this.g.status:-1}catch(Ct){return-1}},Y.ga=function(){try{return this.g?this.g.responseText:""}catch(Ct){return""}},Y.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ur(e)}},Y.Da=function(){return this.m},Y.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Y=Or.prototype).ma=8,Y.G=1,Y.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},Y.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ze(this,this.h,t,void 0),n=this.s;if(this.P&&(n?_t(n=Ot(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Ar(this,e,r),xn(i=Tn(this.F),"RID",t),xn(i,"CVER",22),this.D&&xn(i,"X-HTTP-Session-Id",this.D),Dr(this,i),this.o&&n&&Ir(i,this.o,n),Yn(this.i,e),this.Ra&&xn(i,"TYPE","init"),this.ja?(xn(i,"$req",r),xn(i,"SID","null"),e.$=!0,on(e,i,null)):on(e,i,r),this.G=2}}else 3==this.G&&(t?jr(this,t):0==this.l.length||zn(this.i)||jr(this))},Y.Ga=function(){if(this.u=null,Pr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Qe(st(this.bb,this),t)}},Y.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,qe(10),_r(this),Pr(this))},Y.ab=function(){null!=this.v&&(this.v=null,_r(this),Nr(this),qe(19))},Y.jb=function(t){t?(this.h.info("Successfully pinged google.com"),qe(2)):(this.h.info("Failed to ping google.com"),qe(1))},(Y=Qr.prototype).xa=function(){},Y.wa=function(){},Y.va=function(){},Y.ua=function(){},Y.Oa=function(){},Kr.prototype.g=function(t,e){return new Gr(t,e)},ut(Gr,he),Gr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),we(st(t.hb,t,e))),qe(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=qr(t,null,t.W),Cr(t)},Gr.prototype.close=function(){Er(this.g)},Gr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,xr(this.g,e)}else this.v?((e={}).__data__=de(t),xr(this.g,e)):xr(this.g,t)},Gr.prototype.M=function(){this.g.j=null,delete this.j,Er(this.g),delete this.g,Gr.Z.M.call(this)},ut(zr,Xe),ut(Hr,$e),ut(Wr,Qr),Wr.prototype.xa=function(){le(this.g,"a")},Wr.prototype.wa=function(t){le(this.g,new zr(t))},Wr.prototype.va=function(t){le(this.g,new Hr(t))},Wr.prototype.ua=function(){le(this.g,"b")},Kr.prototype.createWebChannel=Kr.prototype.g,Gr.prototype.send=Gr.prototype.u,Gr.prototype.open=Gr.prototype.m,Gr.prototype.close=Gr.prototype.close,Ke.NO_ERROR=0,Ke.TIMEOUT=8,Ke.HTTP_ERROR=6,Ge.COMPLETE="complete",He.EventType=Ye,Ye.OPEN="a",Ye.CLOSE="b",Ye.ERROR="c",Ye.MESSAGE="d",he.prototype.listen=he.prototype.N,cr.prototype.listenOnce=cr.prototype.O,cr.prototype.getLastError=cr.prototype.La,cr.prototype.getLastErrorCode=cr.prototype.Da,cr.prototype.getStatus=cr.prototype.ba,cr.prototype.getResponseJson=cr.prototype.Qa,cr.prototype.getResponseText=cr.prototype.ga,cr.prototype.send=cr.prototype.ea;var Yr=Ke,Xr=Ge,$r=Pe,Jr=nr,Zr=He,ti=cr,ei=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();ei.o=-1;var ni={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ri=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(K.c)(e,t),e}(Error),ii=new z.b("@firebase/firestore");function oi(){return ii.logLevel}function si(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ii.logLevel<=z.a.DEBUG){var r=e.map(ci);ii.debug.apply(ii,Object(K.f)(["Firestore (8.10.1): "+t],r))}}function ai(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ii.logLevel<=z.a.ERROR){var r=e.map(ci);ii.error.apply(ii,Object(K.f)(["Firestore (8.10.1): "+t],r))}}function ui(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ii.logLevel<=z.a.WARN){var r=e.map(ci);ii.warn.apply(ii,Object(K.f)(["Firestore (8.10.1): "+t],r))}}function ci(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(hp){return t}}function hi(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw ai(e),new Error(e)}function li(t,e){t||hi()}function fi(t,e){return t}function di(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var pi=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=di(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function gi(t,e){return t<e?-1:t>e?1:0}function yi(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function mi(t){return t+"\0"}var vi=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ri(ni.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ri(ni.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ri(ni.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ri(ni.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?gi(this.nanoseconds,t.nanoseconds):gi(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),bi=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new vi(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function wi(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ii(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ti(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Oi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&hi(),void 0===n?n=t.length-e:n>t.length-e&&hi(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Ei=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new ri(ni.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Oi),_i=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return _i.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new ri(ni.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new ri(ni.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ri(ni.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new ri(ni.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Oi),xi=function(){function t(t){this.fields=t,t.sort(Si.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return yi(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),Ci=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return gi(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Ci.EMPTY_BYTE_STRING=new Ci("");var ji=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Di(t){if(li(!!t),"string"==typeof t){var e=0,n=ji.exec(t);if(li(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ai(t.seconds),nanos:Ai(t.nanos)}}function Ai(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ki(t){return"string"==typeof t?Ci.fromBase64String(t):Ci.fromUint8Array(t)}function Ni(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ri(t){var e=t.mapValue.fields.__previous_value__;return Ni(e)?Ri(e):e}function Pi(t){var e=Di(t.mapValue.fields.__local_write_time__.timestampValue);return new vi(e.seconds,e.nanos)}function Fi(t){return null==t}function Mi(t){return 0===t&&1/t==-1/0}function Li(t){return"number"==typeof t&&Number.isInteger(t)&&!Mi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Vi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Ei.fromString(e))},t.fromName=function(e){return new t(Ei.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Ei.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Ei.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Ei(e.slice()))},t}();function Ui(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ni(t)?4:10:hi()}function qi(t,e){var n=Ui(t);if(n!==Ui(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Pi(t).isEqual(Pi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Di(t.timestampValue),r=Di(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ki(t.bytesValue).isEqual(ki(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ai(t.geoPointValue.latitude)===Ai(e.geoPointValue.latitude)&&Ai(t.geoPointValue.longitude)===Ai(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ai(t.integerValue)===Ai(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ai(t.doubleValue),r=Ai(e.doubleValue);return n===r?Mi(n)===Mi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return yi(t.arrayValue.values||[],e.arrayValue.values||[],qi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(wi(n)!==wi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!qi(n[i],r[i])))return!1;return!0}(t,e);default:return hi()}}function Bi(t,e){return void 0!==(t.values||[]).find(function(t){return qi(t,e)})}function Qi(t,e){var n=Ui(t),r=Ui(e);if(n!==r)return gi(n,r);switch(n){case 0:return 0;case 1:return gi(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ai(t.integerValue||t.doubleValue),r=Ai(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ki(t.timestampValue,e.timestampValue);case 4:return Ki(Pi(t),Pi(e));case 5:return gi(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ki(t),r=ki(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=gi(n[i],r[i]);if(0!==o)return o}return gi(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=gi(Ai(t.latitude),Ai(e.latitude));return 0!==n?n:gi(Ai(t.longitude),Ai(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Qi(n[i],r[i]);if(o)return o}return gi(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=gi(r[s],o[s]);if(0!==a)return a;var u=Qi(n[r[s]],i[o[s]]);if(0!==u)return u}return gi(r.length,o.length)}(t.mapValue,e.mapValue);default:throw hi()}}function Ki(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return gi(t,e);var n=Di(t),r=Di(e),i=gi(n.seconds,r.seconds);return 0!==i?i:gi(n.nanos,r.nanos)}function Gi(t){return zi(t)}function zi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Di(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ki(t.bytesValue).toBase64():"referenceValue"in t?Vi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=zi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+zi(t.fields[o])}return e+"}"}(t.mapValue):hi();var e}function Hi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Wi(t){return!!t&&"integerValue"in t}function Yi(t){return!!t&&"arrayValue"in t}function Xi(t){return!!t&&"nullValue"in t}function $i(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ji(t){return!!t&&"mapValue"in t}function Zi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Ii(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Zi(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Zi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var to=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ji(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Zi(e)},t.prototype.setAll=function(t){var e=this,n=Si.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Zi(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ji(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return qi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ji(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Ii(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Zi(this.value))},t}();function eo(t){var e=[];return Ii(t.fields,function(t,n){var r=new Si([t]);if(Ji(n)){var i=eo(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new xi(e)}var no=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,bi.min(),to.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,to.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,to.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=to.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=to.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),ro=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function io(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new ro(t,e,n,r,i,o,s)}function oo(t){var e=fi(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Gi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Fi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=bo(e.startAt)),e.endAt&&(n+="|ub:",n+=bo(e.endAt)),e.h=n}return e.h}function so(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Io(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!qi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Oo(t.startAt,e.startAt)&&Oo(t.endAt,e.endAt)}function ao(t){return Vi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var uo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(K.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new co(t,n,r):"array-contains"===n?new po(t,r):"in"===n?new go(t,r):"not-in"===n?new yo(t,r):"array-contains-any"===n?new mo(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new ho(t,n):new lo(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Qi(e,this.value)):null!==e&&Ui(this.value)===Ui(e)&&this.m(Qi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return hi()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),co=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Vi.fromName(r.referenceValue),i}return Object(K.c)(e,t),e.prototype.matches=function(t){var e=Vi.comparator(t.key,this.key);return this.m(e)},e}(uo),ho=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=fo(0,n),r}return Object(K.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(uo),lo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=fo(0,n),r}return Object(K.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(uo);function fo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Vi.fromName(t.referenceValue)})}var po=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(K.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Yi(e)&&Bi(e.arrayValue,this.value)},e}(uo),go=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(K.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Bi(this.value.arrayValue,e)},e}(uo),yo=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(K.c)(e,t),e.prototype.matches=function(t){if(Bi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Bi(this.value.arrayValue,e)},e}(uo),mo=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(K.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Yi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Bi(e.value.arrayValue,t)})},e}(uo),vo=function(t,e){this.position=t,this.before=e};function bo(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Gi(t)}).join(",")}var wo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Io(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function To(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Vi.comparator(Vi.fromName(s.referenceValue),n.key):Qi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Oo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!qi(t.position[n],e.position[n]))return!1;return!0}var Eo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function _o(t,e,n,r,i,o,s,a){return new Eo(t,e,n,r,i,o,s,a)}function So(t){return new Eo(t)}function xo(t){return!Fi(t.limit)&&"F"===t.limitType}function Co(t){return!Fi(t.limit)&&"L"===t.limitType}function jo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Do(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Ao(t){return null!==t.collectionGroup}function ko(t){var e=fi(t);if(null===e.p){e.p=[];var n=Do(e),r=jo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new wo(n)),e.p.push(new wo(Si.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new wo(Si.keyField(),u))}}}return e.p}function No(t){var e=fi(t);if(!e.T)if("F"===e.limitType)e.T=io(e.path,e.collectionGroup,ko(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ko(e);r<i.length;r++){var o=i[r];n.push(new wo(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new vo(e.endAt.position,!e.endAt.before):null,a=e.startAt?new vo(e.startAt.position,!e.startAt.before):null;e.T=io(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Ro(t,e,n){return new Eo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Po(t,e){return so(No(t),No(e))&&t.limitType===e.limitType}function Fo(t){return oo(No(t))+"|lt:"+t.limitType}function Mo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Gi(e.value);var e}).join(", ")+"]"),Fi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+bo(t.startAt)),t.endAt&&(e+=", endAt: "+bo(t.endAt)),"Target("+e+")"}(No(t))+"; limitType="+t.limitType+")"}function Lo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Vi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!To(t.startAt,ko(t),e)||t.endAt&&To(t.endAt,ko(t),e))}(t,e)}function Vo(t){return function(e,n){for(var r=!1,i=0,o=ko(t);i<o.length;i++){var s=o[i],a=Uo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Uo(t,e,n){var r=t.field.isKeyField()?Vi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Qi(r,i):hi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return hi()}}function qo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mi(e)?"-0":e}}function Bo(t){return{integerValue:""+t}}function Qo(t,e){return Li(e)?Bo(e):qo(t,e)}var Ko=function(){this._=void 0};function Go(t,e,n){return t instanceof Wo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Yo?Xo(t,e):t instanceof $o?Jo(t,e):function(t,e){var n=Ho(t,e),r=ts(n)+ts(t.A);return Wi(n)&&Wi(t.A)?Bo(r):qo(t.R,r)}(t,e)}function zo(t,e,n){return t instanceof Yo?Xo(t,e):t instanceof $o?Jo(t,e):n}function Ho(t,e){return t instanceof Zo?Wi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Wo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e}(Ko),Yo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(K.c)(e,t),e}(Ko);function Xo(t,e){for(var n=es(e),r=function(t){n.some(function(e){return qi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var $o=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(K.c)(e,t),e}(Ko);function Jo(t,e){for(var n=es(e),r=function(t){n=n.filter(function(e){return!qi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Zo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(K.c)(e,t),e}(Ko);function ts(t){return Ai(t.integerValue||t.doubleValue)}function es(t){return Yi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var ns=function(t,e){this.field=t,this.transform=e},rs=function(t,e){this.version=t,this.transformResults=e},is=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function os(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var ss=function(){};function as(t,e,n){t instanceof fs?function(t,e,n){var r=t.value.clone(),i=gs(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ds?function(t,e,n){if(os(t.precondition,e)){var r=gs(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ps(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function us(t,e,n){t instanceof fs?function(t,e,n){if(os(t.precondition,e)){var r=t.value.clone(),i=ys(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ls(e),r).setHasLocalMutations()}}(t,e,n):t instanceof ds?function(t,e,n){if(os(t.precondition,e)){var r=ys(t.fieldTransforms,n,e),i=e.data;i.setAll(ps(t)),i.setAll(r),e.convertToFoundDocument(ls(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){os(t.precondition,e)&&e.convertToNoDocument(bi.min())}(t,e)}function cs(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Ho(o.transform,s||null);null!=a&&(null==n&&(n=to.empty()),n.set(o.field,a))}return n||null}function hs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&yi(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Yo&&e instanceof Yo||t instanceof $o&&e instanceof $o?yi(t.elements,e.elements,qi):t instanceof Zo&&e instanceof Zo?qi(t.A,e.A):t instanceof Wo&&e instanceof Wo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ls(t){return t.isFoundDocument()?t.version:bi.min()}var fs=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(K.c)(e,t),e}(ss),ds=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(K.c)(e,t),e}(ss);function ps(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function gs(t,e,n){var r=new Map;li(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,zo(s,a,n[i]))}return r}function ys(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Go(a,u,e))}return r}var ms,vs,bs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(K.c)(e,t),e}(ss),ws=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(K.c)(e,t),e}(ss),Is=function(t){this.count=t};function Ts(t){switch(t){case ni.OK:return hi();case ni.CANCELLED:case ni.UNKNOWN:case ni.DEADLINE_EXCEEDED:case ni.RESOURCE_EXHAUSTED:case ni.INTERNAL:case ni.UNAVAILABLE:case ni.UNAUTHENTICATED:return!1;case ni.INVALID_ARGUMENT:case ni.NOT_FOUND:case ni.ALREADY_EXISTS:case ni.PERMISSION_DENIED:case ni.FAILED_PRECONDITION:case ni.ABORTED:case ni.OUT_OF_RANGE:case ni.UNIMPLEMENTED:case ni.DATA_LOSS:return!0;default:return hi()}}function Os(t){if(void 0===t)return ai("GRPC error has no .code"),ni.UNKNOWN;switch(t){case ms.OK:return ni.OK;case ms.CANCELLED:return ni.CANCELLED;case ms.UNKNOWN:return ni.UNKNOWN;case ms.DEADLINE_EXCEEDED:return ni.DEADLINE_EXCEEDED;case ms.RESOURCE_EXHAUSTED:return ni.RESOURCE_EXHAUSTED;case ms.INTERNAL:return ni.INTERNAL;case ms.UNAVAILABLE:return ni.UNAVAILABLE;case ms.UNAUTHENTICATED:return ni.UNAUTHENTICATED;case ms.INVALID_ARGUMENT:return ni.INVALID_ARGUMENT;case ms.NOT_FOUND:return ni.NOT_FOUND;case ms.ALREADY_EXISTS:return ni.ALREADY_EXISTS;case ms.PERMISSION_DENIED:return ni.PERMISSION_DENIED;case ms.FAILED_PRECONDITION:return ni.FAILED_PRECONDITION;case ms.ABORTED:return ni.ABORTED;case ms.OUT_OF_RANGE:return ni.OUT_OF_RANGE;case ms.UNIMPLEMENTED:return ni.UNIMPLEMENTED;case ms.DATA_LOSS:return ni.DATA_LOSS;default:return hi()}}(vs=ms||(ms={}))[vs.OK=0]="OK",vs[vs.CANCELLED=1]="CANCELLED",vs[vs.UNKNOWN=2]="UNKNOWN",vs[vs.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vs[vs.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vs[vs.NOT_FOUND=5]="NOT_FOUND",vs[vs.ALREADY_EXISTS=6]="ALREADY_EXISTS",vs[vs.PERMISSION_DENIED=7]="PERMISSION_DENIED",vs[vs.UNAUTHENTICATED=16]="UNAUTHENTICATED",vs[vs.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vs[vs.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vs[vs.ABORTED=10]="ABORTED",vs[vs.OUT_OF_RANGE=11]="OUT_OF_RANGE",vs[vs.UNIMPLEMENTED=12]="UNIMPLEMENTED",vs[vs.INTERNAL=13]="INTERNAL",vs[vs.UNAVAILABLE=14]="UNAVAILABLE",vs[vs.DATA_LOSS=15]="DATA_LOSS";var Es=function(){function t(t,e){this.comparator=t,this.root=e||Ss.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ss.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ss.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new _s(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new _s(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new _s(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new _s(this.root,t,this.comparator,!0)},t}(),_s=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Ss=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw hi();if(this.right.isRed())throw hi();var t=this.left.check();if(t!==this.right.check())throw hi();return t+(this.isRed()?0:1)},t}();Ss.EMPTY=null,Ss.RED=!0,Ss.BLACK=!1,Ss.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw hi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw hi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw hi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw hi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw hi()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Ss(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var xs=function(){function t(t){this.comparator=t,this.data=new Es(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Cs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Cs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Cs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),js=new Es(Vi.comparator);function Ds(){return js}var As=new Es(Vi.comparator);function ks(){return As}var Ns=new Es(Vi.comparator);function Rs(){return Ns}var Ps=new xs(Vi.comparator);function Fs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ps,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ms=new xs(gi);function Ls(){return Ms}var Vs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Us.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(bi.min(),r,Ls(),Ds(),Fs())},t}(),Us=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Ci.EMPTY_BYTE_STRING,n,Fs(),Fs(),Fs())},t}(),qs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Bs=function(t,e){this.targetId=t,this.V=e},Qs=function(t,e,n,r){void 0===n&&(n=Ci.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ks=function(){function t(){this.S=0,this.D=Hs(),this.C=Ci.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=Fs(),e=Fs(),n=Fs();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:hi()}}),new Us(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=Hs()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),Gs=function(){function t(t){this.W=t,this.G=new Map,this.H=Ds(),this.J=zs(),this.Y=new xs(gi)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:hi()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(ao(i))if(0===n){var o=new Vi(i.path);this.tt(e,o,no.newNoDocument(o,bi.min()))}else li(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&ao(o.target)){var s=new Vi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,no.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Fs();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Vs(t,n,this.Y,this.H,r);return this.H=Ds(),this.J=zs(),this.Y=new xs(gi),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Ks,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new xs(gi),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||si("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Ks),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function zs(){return new Es(Vi.comparator)}function Hs(){return new Es(Vi.comparator)}var Ws={asc:"ASCENDING",desc:"DESCENDING"},Ys={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Xs=function(t,e){this.databaseId=t,this.I=e};function $s(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Js(t,e){return t.I?e.toBase64():e.toUint8Array()}function Zs(t,e){return $s(t,e.toTimestamp())}function ta(t){return li(!!t),bi.fromTimestamp(function(t){var e=Di(t);return new vi(e.seconds,e.nanos)}(t))}function ea(t,e){return function(t){return new Ei(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function na(t){var e=Ei.fromString(t);return li(Sa(e)),e}function ra(t,e){return ea(t.databaseId,e.path)}function ia(t,e){var n=na(e);if(n.get(1)!==t.databaseId.projectId)throw new ri(ni.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ri(ni.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Vi(ua(n))}function oa(t,e){return ea(t.databaseId,e)}function sa(t){var e=na(t);return 4===e.length?Ei.emptyPath():ua(e)}function aa(t){return new Ei(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ua(t){return li(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ca(t,e,n){return{name:ra(t,e),fields:n.value.mapValue.fields}}function ha(t,e,n){var r=ia(t,e.name),i=ta(e.updateTime),o=new to({mapValue:{fields:e.fields}}),s=no.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function la(t,e){var n;if(e instanceof fs)n={update:ca(t,e.key,e.value)};else if(e instanceof bs)n={delete:ra(t,e.key)};else if(e instanceof ds)n={update:ca(t,e.key,e.data),updateMask:_a(e.fieldMask)};else{if(!(e instanceof ws))return hi();n={verify:ra(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Wo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Yo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof $o)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Zo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw hi()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Zs(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:hi()}(t,e.precondition)),n}function fa(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?is.updateTime(ta(t.updateTime)):void 0!==t.exists?is.exists(t.exists):is.none()}(e.currentDocument):is.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(li("REQUEST_TIME"===e.setToServerValue),n=new Wo):"appendMissingElements"in e?n=new Yo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new $o(e.removeAllFromArray.values||[]):"increment"in e?n=new Zo(t,e.increment):hi();var r=Si.fromServerFormat(e.fieldPath);return new ns(r,n)}(t,e)}):[];if(e.update){var i=ia(t,e.update.name),o=new to({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new xi((t.fieldPaths||[]).map(function(t){return Si.fromServerFormat(t)}))}(e.updateMask);return new ds(i,o,s,n,r)}return new fs(i,o,n,r)}if(e.delete){var a=ia(t,e.delete);return new bs(a,n)}if(e.verify){var u=ia(t,e.verify);return new ws(u,n)}return hi()}function da(t,e){return{documents:[oa(t,e.path)]}}function pa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=oa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=oa(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if($i(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NAN"}};if(Xi(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NULL"}}}else if("!="===t.op){if($i(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NOT_NAN"}};if(Xi(t.value))return{unaryFilter:{field:Ia(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ia(t.field),op:wa(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Ia(t.field),direction:ba(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Fi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=ma(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ma(e.endAt)),n}function ga(t){var e=sa(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){li(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=ya(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new wo(Ta(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return Fi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=va(n.startAt));var h=null;return n.endAt&&(h=va(n.endAt)),_o(e,i,a,s,u,"F",c,h)}function ya(t){return t?void 0!==t.unaryFilter?[Ea(t)]:void 0!==t.fieldFilter?[Oa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return ya(t)}).reduce(function(t,e){return t.concat(e)}):hi():[]}function ma(t){return{before:t.before,values:t.position}}function va(t){return new vo(t.values||[],!!t.before)}function ba(t){return Ws[t]}function wa(t){return Ys[t]}function Ia(t){return{fieldPath:t.canonicalString()}}function Ta(t){return Si.fromServerFormat(t.fieldPath)}function Oa(t){return uo.create(Ta(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return hi()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ea(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ta(t.unaryFilter.field);return uo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ta(t.unaryFilter.field);return uo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ta(t.unaryFilter.field);return uo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ta(t.unaryFilter.field);return uo.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return hi()}}function _a(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function Sa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function xa(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ja(e)),e=Ca(t.get(n),e);return ja(e)}function Ca(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ja(t){return t+"\x01\x01"}function Da(t){var e=t.length;if(li(e>=2),2===e)return li("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Ei.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&hi(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:hi()}o=s+2}return new Ei(r)}var Aa=function(t,e){this.seconds=t,this.nanoseconds=e},ka=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};ka.store="owner",ka.key="owner";var Na=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Na.store="mutationQueues",Na.keyPath="userId";var Ra=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ra.store="mutations",Ra.keyPath="batchId",Ra.userMutationsIndex="userMutationsIndex",Ra.userMutationsKeyPath=["userId","batchId"];var Pa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,xa(e)]},t.key=function(t,e,n){return[t,xa(e),n]},t}();Pa.store="documentMutations",Pa.PLACEHOLDER=new Pa;var Fa=function(t,e){this.path=t,this.readTime=e},Ma=function(t,e){this.path=t,this.version=e},La=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};La.store="remoteDocuments",La.readTimeIndex="readTimeIndex",La.readTimeIndexPath="readTime",La.collectionReadTimeIndex="collectionReadTimeIndex",La.collectionReadTimeIndexPath=["parentPath","readTime"];var Va=function(t){this.byteSize=t};Va.store="remoteDocumentGlobal",Va.key="remoteDocumentGlobalKey";var Ua=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ua.store="targets",Ua.keyPath="targetId",Ua.queryTargetsIndexName="queryTargetsIndex",Ua.queryTargetsKeyPath=["canonicalId","targetId"];var qa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};qa.store="targetDocuments",qa.keyPath=["targetId","path"],qa.documentTargetsIndex="documentTargetsIndex",qa.documentTargetsKeyPath=["path","targetId"];var Ba=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ba.key="targetGlobalKey",Ba.store="targetGlobal";var Qa=function(t,e){this.collectionId=t,this.parent=e};Qa.store="collectionParents",Qa.keyPath=["collectionId","parent"];var Ka=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ka.store="clientMetadata",Ka.keyPath="clientId";var Ga=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ga.store="bundles",Ga.keyPath="bundleId";var za=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};za.store="namedQueries",za.keyPath="name";var Ha=Object(K.f)(Object(K.f)([],Object(K.f)(Object(K.f)([],Object(K.f)(Object(K.f)([],Object(K.f)(Object(K.f)([],[Na.store,Ra.store,Pa.store,La.store,Ua.store,ka.store,Ba.store,qa.store]),[Ka.store])),[Va.store])),[Qa.store])),[Ga.store,za.store]),Wa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ya=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Xa=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},$a=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&hi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Ja=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Xa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new eu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=su(e.target.error);n.ft.reject(new eu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new eu(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(si("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ru(e)},t}(),Za=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(G.j)())&&ai("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return si("SimpleDb","Removing database:",t),iu(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(G.j)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(K.b)(this,void 0,void 0,function(){var e,n=this;return Object(K.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(si("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new eu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new ri(ni.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new eu(t,n))},i.onupgradeneeded=function(t){si("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){si("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(K.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(K.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(K.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Ja.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),$a.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return si("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),tu=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return iu(this.Pt.delete())},t}(),eu=function(t){function e(e,n){var r=this;return(r=t.call(this,ni.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(K.c)(e,t),e}(ri);function nu(t){return"IndexedDbTransactionError"===t.name}var ru=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(si("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(si("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),iu(n)},t.prototype.add=function(t){return si("SimpleDb","ADD",this.store.name,t,t),iu(this.store.add(t))},t.prototype.get=function(t){var e=this;return iu(this.store.get(t)).next(function(n){return void 0===n&&(n=null),si("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return si("SimpleDb","DELETE",this.store.name,t),iu(this.store.delete(t))},t.prototype.count=function(){return si("SimpleDb","COUNT",this.store.name),iu(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.kt=function(t,e){si("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new $a(function(n,r){e.onerror=function(t){var e=su(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new $a(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new tu(i),s=e(i.primaryKey,i.value,o);if(s instanceof $a){var a=s.catch(function(t){return o.done(),$a.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return $a.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function iu(t){return new $a(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=su(t.target.error);n(e)}})}var ou=!1;function su(t){var e=Za._t(Object(G.j)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new ri("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ou||(ou=!0,setTimeout(function(){throw r},0)),r}}return t}var au=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(K.c)(e,t),e}(Ya);function uu(t,e){var n=fi(t);return Za.It(n.Mt,e)}var cu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&as(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&us(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&us(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(bi.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Fs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&yi(this.mutations,t.mutations,function(t,e){return hs(t,e)})&&yi(this.baseMutations,t.baseMutations,function(t,e){return hs(t,e)})},t}(),hu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){li(e.mutations.length===r.length);for(var i=Rs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),lu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=bi.min()),void 0===o&&(o=bi.min()),void 0===s&&(s=Ci.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),fu=function(t){this.Lt=t};function du(t,e){if(e.document)return ha(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Vi.fromSegments(e.noDocument.path),r=vu(e.noDocument.readTime),i=no.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Vi.fromSegments(e.unknownDocument.path);return r=vu(e.unknownDocument.version),no.newUnknownDocument(o,r)}return hi()}function pu(t,e,n){var r=gu(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:ra(t,e.key),fields:e.data.value.mapValue.fields,updateTime:$s(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new La(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=mu(e.version);return s=e.hasCommittedMutations,new La(null,new Fa(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=mu(e.version);return new La(new Ma(c,h),null,null,!0,r,i)}return hi()}function gu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function yu(t){var e=new vi(t[0],t[1]);return bi.fromTimestamp(e)}function mu(t){var e=t.toTimestamp();return new Aa(e.seconds,e.nanoseconds)}function vu(t){var e=new vi(t.seconds,t.nanoseconds);return bi.fromTimestamp(e)}function bu(t,e){for(var n=(e.baseMutations||[]).map(function(e){return fa(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return fa(t.Lt,e)}),o=vi.fromMillis(e.localWriteTimeMs);return new cu(e.batchId,o,n,i)}function wu(t){var e,n,r=vu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?vu(t.lastLimboFreeSnapshotVersion):bi.min();return void 0!==t.query.documents?(li(1===(n=t.query).documents.length),e=No(So(sa(n.documents[0])))):e=function(t){return No(ga(t))}(t.query),new lu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Ci.fromBase64String(t.resumeToken))}function Iu(t,e){var n,r=mu(e.snapshotVersion),i=mu(e.lastLimboFreeSnapshotVersion);n=ao(e.target)?da(t.Lt,e.target):pa(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Ua(e.targetId,oo(e.target),r,o,e.sequenceNumber,i,n)}function Tu(t){var e=ga({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ro(e,e.limit,"L"):e}var Ou=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Eu(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:vu(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Eu(t).put({bundleId:(n=e).id,createTime:mu(ta(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return _u(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Tu(e.bundledQuery),readTime:vu(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return _u(t).put(function(t){return{name:t.name,readTime:mu(ta(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Eu(t){return uu(t,Ga.store)}function _u(t){return uu(t,za.store)}var Su=function(){function t(){this.Bt=new xu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),$a.resolve()},t.prototype.getCollectionParents=function(t,e){return $a.resolve(this.Bt.getEntries(e))},t}(),xu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new xs(Ei.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new xs(Ei.comparator)).toArray()},t}(),Cu=function(){function t(){this.qt=new xu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:xa(i)};return ju(t).put(o)}return $a.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[mi(e),""],!1,!0);return ju(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Da(o.parent))}return n})},t}();function ju(t){return uu(t,Qa.store)}var Du={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Au=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function ku(t,e,n){var r=t.store(Ra.store),i=t.store(Pa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){li(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Pa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return $a.waitFor(o).next(function(){return c})}function Nu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw hi();e=t.noDocument}return JSON.stringify(e).length}Au.DEFAULT_COLLECTION_PERCENTILE=10,Au.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Au.DEFAULT=new Au(41943040,Au.DEFAULT_COLLECTION_PERCENTILE,Au.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Au.DISABLED=new Au(-1,0,0);var Ru=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return li(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Fu(t).$t({index:Ra.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Mu(t),s=Fu(t);return s.add({}).next(function(a){li("number"==typeof a);for(var u=new cu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return la(t.Lt,e)}),i=n.mutations.map(function(e){return la(t.Lt,e)});return new Ra(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new xs(function(t,e){return gi(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],g=Pa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Pa.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),$a.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Fu(t).get(e).next(function(t){return t?(li(t.userId===n.userId),bu(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?$a.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Fu(t).$t({index:Ra.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(li(e.batchId>=r),o=bu(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Fu(t).$t({index:Ra.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Fu(t).Nt(Ra.userMutationsIndex,n).next(function(t){return t.map(function(t){return bu(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Pa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Mu(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=Da(r[1]);if(a===n.userId&&e.path.isEqual(c))return Fu(t).get(u).next(function(t){if(!t)throw hi();li(t.userId===n.userId),o.push(bu(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new xs(gi),i=[];return e.forEach(function(e){var o=Pa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Mu(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=Da(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),$a.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Pa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new xs(gi);return Mu(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=Da(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Fu(t).get(e).next(function(t){if(null===t)throw hi();li(t.userId===n.userId),r.push(bu(n.R,t))}))}),$a.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return ku(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),$a.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return $a.resolve();var r=IDBKeyRange.lowerBound(Pa.prefixForUser(e.userId)),i=[];return Mu(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Da(t[1]);i.push(o)}else r.done()}).next(function(){li(0===i.length)})})},t.prototype.containsKey=function(t,e){return Pu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Lu(t).get(this.userId).next(function(t){return t||new Na(e.userId,-1,"")})},t}();function Pu(t,e,n){var r=Pa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Mu(t).$t({range:o,Ft:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function Fu(t){return uu(t,Ra.store)}function Mu(t){return uu(t,Pa.store)}function Lu(t){return uu(t,Na.store)}var Vu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Uu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Vu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return bi.fromTimestamp(new vi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return qu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return li(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return qu(t).$t(function(s,a){var u=wu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return $a.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return qu(t).$t(function(t,n){var r=wu(n);e(r)})},t.prototype.Xt=function(t){return Bu(t).get(Ba.key).next(function(t){return li(null!==t),t})},t.prototype.Zt=function(t,e){return Bu(t).put(Ba.key,e)},t.prototype.te=function(t,e){return qu(t).put(Iu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=oo(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return qu(t).$t({range:r,index:Ua.queryTargetsIndexName},function(t,n,r){var o=wu(n);so(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Qu(t);return e.forEach(function(e){var s=xa(e.path);i.push(o.put(new qa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),$a.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Qu(t);return $a.forEach(e,function(e){var o=xa(e.path);return $a.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Qu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Qu(t),i=Fs();return r.$t({range:n,Ft:!0},function(t,e,n){var r=Da(t[1]),o=new Vi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=xa(e.path),r=IDBKeyRange.bound([n],[mi(n)],!1,!0),i=0;return Qu(t).$t({index:qa.documentTargetsIndex,Ft:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return qu(t).get(e).next(function(t){return t?wu(t):null})},t}();function qu(t){return uu(t,Ua.store)}function Bu(t){return uu(t,Ba.store)}function Qu(t){return uu(t,qa.store)}function Ku(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){if(t.code!==ni.FAILED_PRECONDITION||t.message!==Wa)throw t;return si("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Gu(t,e){var n=t[1],r=e[1],i=gi(t[0],e[0]);return 0===i?gi(n,r):i}var zu=function(){function t(t){this.ne=t,this.buffer=new xs(Gu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Gu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Hu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;si("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(K.b)(e,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return nu(e=n.sent())?(si("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ku(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Wu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return $a.resolve(ei.o);var r=new zu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(si("LruGarbageCollector","Garbage collection skipped; disabled"),$a.resolve(Du)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(si("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Du):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(si("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),oi()<=z.a.DEBUG&&si("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),$a.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Yu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Wu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Xu(t,n)},t.prototype.removeReference=function(t,e,n){return Xu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Xu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Lu(t).Ot(function(r){return Pu(t,r,e).next(function(t){return t&&(n=!0),$a.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Qu(t).delete([0,xa(s.path)])})});i.push(u)}}).next(function(){return $a.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Xu(t,e)},t.prototype.we=function(t,e){var n,r=Qu(t),i=ei.o;return r.$t({index:qa.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==ei.o&&e(new Vi(Da(n)),i),i=s,n=o):i=ei.o}).next(function(){i!==ei.o&&e(new Vi(Da(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Xu(t,e){return Qu(t).put(function(t,e){return new qa(0,xa(t.path),e)}(e,t.currentSequenceNumber))}var $u=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Ii(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return Ti(this.inner)},t}(),Ju=function(){function t(){this.changes=new $u(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:bi.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:no.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?$a.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Zu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return nc(t).put(rc(e),n)},t.prototype.removeEntry=function(t,e){var n=nc(t),r=rc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return nc(t).get(rc(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return nc(t).get(rc(e)).next(function(t){return{document:n.ye(e,t),size:Nu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Ds();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Ds(),i=new Es(Vi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Nu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return $a.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return nc(t).$t({range:r},function(t,e,r){for(var s=Vi.fromSegments(t);o&&Vi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Ds(),o=e.path.length+1,s={};if(n.isEqual(bi.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=gu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=La.collectionReadTimeIndex}return nc(t).$t(s,function(t,n,s){if(t.length===o){var a=du(r.R,n);e.path.isPrefixOf(a.key.path)?Lo(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new tc(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return ec(t).get(Va.key).next(function(t){return li(!!t),t})},t.prototype.me=function(t,e){return ec(t).put(Va.key,e)},t.prototype.ye=function(t,e){if(e){var n=du(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(bi.min()))return n}return no.newInvalidDocument(t)},t}(),tc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new $u(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(K.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new xs(function(t,e){return gi(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=pu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Nu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=pu(e.Ie.R,no.newNoDocument(o,bi.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),$a.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Ju);function ec(t){return uu(t,Va.store)}function nc(t){return uu(t,La.store)}function rc(t){return t.path.toArray()}var ic=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;li(n<r&&n>=0&&r<=11);var o=new Ja("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(ka.store)}(t),function(t){t.createObjectStore(Na.store,{keyPath:Na.keyPath}),t.createObjectStore(Ra.store,{keyPath:Ra.keyPath,autoIncrement:!0}).createIndex(Ra.userMutationsIndex,Ra.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Pa.store)}(t),oc(t),function(t){t.createObjectStore(La.store)}(t));var s=$a.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(qa.store),t.deleteObjectStore(Ua.store),t.deleteObjectStore(Ba.store)}(t),oc(t)),s=s.next(function(){return function(t){var e=t.store(Ba.store),n=new Ba(0,0,bi.min().toTimestamp(),0);return e.put(Ba.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Ra.store).Nt().next(function(n){t.deleteObjectStore(Ra.store),t.createObjectStore(Ra.store,{keyPath:Ra.keyPath,autoIncrement:!0}).createIndex(Ra.userMutationsIndex,Ra.userMutationsKeyPath,{unique:!0});var r=e.store(Ra.store),i=n.map(function(t){return r.put(t)});return $a.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Ka.store,{keyPath:Ka.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Va.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(La.store);e.createIndex(La.readTimeIndex,La.readTimeIndexPath,{unique:!1}),e.createIndex(La.collectionReadTimeIndex,La.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Ga.store,{keyPath:Ga.keyPath})}(t),function(t){t.createObjectStore(za.store,{keyPath:za.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(La.store).$t(function(t,n){e+=Nu(n)}).next(function(){var n=new Va(e);return t.store(Va.store).put(Va.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Na.store),r=t.store(Ra.store);return n.Nt().next(function(n){return $a.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Ra.userMutationsIndex,i).next(function(r){return $a.forEach(r,function(r){li(r.userId===n.userId);var i=bu(e.R,r);return ku(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(qa.store),n=t.store(La.store);return t.store(Ba.store).get(Ba.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new Ei(n),s=function(t){return[0,xa(t)]}(o);r.push(e.get(s).next(function(n){return n?$a.resolve():function(n){return e.put(new qa(0,xa(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return $a.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath});var n=e.store(Qa.store),r=new xu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:xa(i)})}};return e.store(La.store).$t({Ft:!0},function(t,e){var n=new Ei(t);return i(n.popLast())}).next(function(){return e.store(Pa.store).$t({Ft:!0},function(t,e){var n=Da(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Ua.store);return n.$t(function(t,r){var i=wu(r),o=Iu(e.R,i);return n.put(o)})},t}();function oc(t){t.createObjectStore(qa.store,{keyPath:qa.keyPath}).createIndex(qa.documentTargetsIndex,qa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ua.store,{keyPath:Ua.keyPath}).createIndex(Ua.queryTargetsIndexName,Ua.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ba.store)}var sc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ac=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new ri(ni.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Yu(this,i),this.Le=n+"main",this.R=new fu(u),this.Be=new Za(this.Le,11,new ic(this.R)),this.qe=new Uu(this.referenceDelegate,this.R),this.Ut=new Cu,this.Ue=function(t,e){return new Zu(t,e)}(this.R,this.Ut),this.Ke=new Ou,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&ai("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new ri(ni.FAILED_PRECONDITION,sc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new ei(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(K.b)(e,void 0,void 0,function(){return Object(K.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(K.b)(e,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(K.b)(e,void 0,void 0,function(){return Object(K.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return cc(e).put(new Ka(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(nu(e))return si("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return si("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return uc(t).get(ka.key).next(function(t){return $a.resolve(e.tn(t))})},t.prototype.en=function(t){return cc(t).delete(this.clientId)},t.prototype.nn=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(K.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=uu(t,Ka.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return $a.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?$a.resolve(!0):uc(t).get(ka.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new ri(ni.FAILED_PRECONDITION,sc);return!1}}return!(!e.networkEnabled||!e.inForeground)||cc(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&si("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(K.b)(this,void 0,void 0,function(){var t=this;return Object(K.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[ka.store,Ka.store],function(e){var n=new au(e,ei.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return cc(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Ru.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return si("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ha,function(o){return r=new au(o,i.Ne?i.Ne.next():ei.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw ai("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new ri(ni.FAILED_PRECONDITION,Wa);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return uc(t).get(ka.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new ri(ni.FAILED_PRECONDITION,sc)})},t.prototype.Ze=function(t){var e=new ka(this.clientId,this.allowTabSynchronization,Date.now());return uc(t).put(ka.key,e)},t.yt=function(){return Za.yt()},t.prototype.Xe=function(t){var e=this,n=uc(t);return n.get(ka.key).next(function(t){return e.tn(t)?(si("IndexedDbPersistence","Releasing primary lease."),n.delete(ka.key)):$a.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(ai("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),Object(G.r)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return si("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return ai("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){ai("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function uc(t){return uu(t,ka.store)}function cc(t){return uu(t,Ka.store)}function hc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var lc=function(t,e){this.progress=t,this.wn=e},fc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Vi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Ao(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Vi(e)).next(function(t){var e=ks();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=ks();return this.Ut.getCollectionParents(t,i).next(function(s){return $a.forEach(s,function(s){var a=function(t,e){return new Eo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=no.newInvalidDocument(c),r=r.insert(c,h)),us(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){Lo(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Fs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ds&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),dc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Fs(),i=Fs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),pc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(bi.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(xo(e)||Co(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(oi()<=z.a.DEBUG&&si("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Mo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new xs(Vo(t));return e.forEach(function(e,r){Lo(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return oi()<=z.a.DEBUG&&si("QueryEngine","Using full collection scan to execute query:",Mo(e)),this.Sn.getDocumentsMatchingQuery(t,e,bi.min())},t}(),gc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Es(gi),this.Fn=new $u(function(t){return oo(t)},so),this.$n=bi.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new fc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.kn)})},t}();function yc(t,e,n,r){return new gc(t,e,n,r)}function mc(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(K.d)(this,function(s){switch(s.label){case 0:return n=fi(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new fc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=Fs(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function vc(t,e){var n=fi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=$a.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);li(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function bc(t){var e=fi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function wc(t,e){var n=fi(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return li(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=Ds();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Ic(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(bi.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return $a.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.kn=i,t})}function Ic(t,e,n,r,i){var o=Fs();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Ds();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(bi.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):si("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Tc(t,e){var n=fi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Oc(t,e){var n=fi(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?$a.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new lu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t})}function Ec(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(K.d)(this,function(a){switch(a.label){case 0:r=fi(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!nu(s=a.sent()))throw s;return si("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}})})}function _c(t,e,n){var r=fi(t),i=bi.min(),o=Fs();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=fi(t),i=r.Fn.get(n);return void 0!==i?$a.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,No(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:bi.min(),n?o:Fs())}).next(function(t){return{documents:t,Bn:o}})})}function Sc(t,e){var n=fi(t),r=fi(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function xc(t){var e=fi(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=fi(t),i=Ds(),o=gu(n),s=nc(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:La.readTimeIndex,range:a},function(t,e){var n=du(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:yu(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function Cc(t){return Object(K.b)(this,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){return[2,(e=fi(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=nc(t),n=bi.min();return e.$t({index:La.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=yu(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function jc(t,e,n,r){return Object(K.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(K.d)(this,function(p){switch(p.label){case 0:for(i=fi(t),o=Fs(),s=Ds(),a=Rs(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,Oc(i,function(t){return No(So(Ei.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Ic(t,f,s,bi.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Dc(t,e,n){return void 0===n&&(n=Fs()),Object(K.b)(this,void 0,void 0,function(){var r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:return[4,Oc(t,No(Tu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=fi(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=ta(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Ci.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var Ac=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return $a.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:ta(n.createTime)}),$a.resolve()},t.prototype.getNamedQuery=function(t,e){return $a.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Tu(t.bundledQuery),readTime:ta(t.readTime)}}(e)),$a.resolve()},t}(),kc=function(){function t(){this.Wn=new xs(Nc.Gn),this.zn=new xs(Nc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Nc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Nc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Vi(new Ei([])),r=new Nc(n,t),i=new Nc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Vi(new Ei([])),n=new Nc(e,t),r=new Nc(e,t+1),i=Fs();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Nc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Nc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Vi.comparator(t.key,e.key)||gi(t.ns,e.ns)},t.Hn=function(t,e){return gi(t.ns,e.ns)||Vi.comparator(t.key,e.key)},t}(),Rc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new xs(Nc.Gn)}return t.prototype.checkEmpty=function(t){return $a.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new cu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Nc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return $a.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return $a.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return $a.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return $a.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return $a.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Nc(e,0),i=new Nc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),$a.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new xs(gi);return e.forEach(function(t){var e=new Nc(t,0),i=new Nc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),$a.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Vi.isDocumentKey(i)||(i=i.child(""));var o=new Nc(new Vi(i),0),s=new xs(gi);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),$a.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;li(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return $a.forEach(e.mutations,function(i){var o=new Nc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Nc(e,0),r=this.rs.firstAfterOrEqual(n);return $a.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return $a.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Pc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Es(Vi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return $a.resolve(n?n.document.clone():no.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ds();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():no.newInvalidDocument(t))}),$a.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ds(),i=new Vi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Lo(e,u)&&(r=r.insert(u.key,u.clone()))}return $a.resolve(r)},t.prototype.fs=function(t,e){return $a.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Fc(this)},t.prototype.getSize=function(t){return $a.resolve(this.size)},t}(),Fc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(K.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),$a.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Ju),Mc=function(){function t(t){this.persistence=t,this.ds=new $u(function(t){return oo(t)},so),this.lastRemoteSnapshotVersion=bi.min(),this.highestTargetId=0,this.ws=0,this._s=new kc,this.targetCount=0,this.ys=Vu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),$a.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return $a.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return $a.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),$a.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),$a.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Vu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,$a.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),$a.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,$a.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),$a.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return $a.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return $a.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),$a.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),$a.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),$a.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return $a.resolve(n)},t.prototype.containsKey=function(t,e){return $a.resolve(this._s.containsKey(e))},t}(),Lc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new ei(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Mc(this),this.Ut=new Su,this.Ue=function(t,e){return new Pc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new fu(e),this.Ke=new Ac(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Rc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;si("MemoryPersistence","Starting transaction:",t);var i=new Vc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return $a.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Vc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(K.c)(e,t),e}(Ya),Uc=function(){function t(t){this.persistence=t,this.As=new kc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw hi()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),$a.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),$a.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),$a.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $a.forEach(this.vs,function(r){var i=Vi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return $a.or([function(){return $a.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),qc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Bc(t,e){return"firestore_clients_"+t+"_"+e}function Qc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Kc(t,e){return"firestore_targets_"+t+"_"+e}qc.UNAUTHENTICATED=new qc(null),qc.GOOGLE_CREDENTIALS=new qc("google-credentials-uid"),qc.FIRST_PARTY=new qc("first-party-uid"),qc.MOCK_USER=new qc("mock-user");var Gc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new ri(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(ai("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),zc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new ri(i.error.code,i.error.message)),o?new t(e,i.state,r):(ai("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Hc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ls(),s=0;i&&s<r.activeTargetIds.length;++s)i=Li(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(ai("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Wc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(ai("SharedClientState","Failed to parse online state: "+e),null)},t}(),Yc=function(){function t(){this.activeTargetIds=Ls()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Xc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Es(gi),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Bc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new Yc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(K.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Bc(this.persistenceKey,r)))&&(o=Hc.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.ks(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Kc(this.persistenceKey,t));if(n){var r=zc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Kc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return si("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){si("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){si("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(si("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void ai("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(K.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(K.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=ei.o;if(null!=t)try{var n=JSON.parse(t);li("number"==typeof n),e=n}catch(t){ai("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==ei.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Gc(this.currentUser,t,e,n),i=Qc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Qc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Kc(this.persistenceKey,t),i=new zc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Hc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Gc.Vs(new qc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return zc.Vs(r,e)},t.prototype.js=function(t){return Wc.Vs(t)},t.prototype.ii=function(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(si("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.Fs=r})},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Ls();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),$c=function(){function t(){this.li=new Yc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Yc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Jc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Zc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){si("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){si("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),th={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},eh=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),nh=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(K.c)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise(function(i,o){var s=new ti;s.listenOnce(Xr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Yr.NO_ERROR:var e=s.getResponseJson();si("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Yr.TIMEOUT:si("Connection",'RPC "'+t+'" timed out'),o(new ri(ni.DEADLINE_EXCEEDED,"Request time out"));break;case Yr.HTTP_ERROR:var n=s.getStatus();if(si("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(ni).indexOf(e)>=0?e:ni.UNKNOWN}(r.status);o(new ri(a,r.message))}else o(new ri(ni.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new ri(ni.UNAVAILABLE,"Connection failed."));break;default:hi()}}finally{si("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Kr,i=Me(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Jr({})),this.ki(o.initMessageHeaders,e),Object(G.o)()||Object(G.q)()||Object(G.m)()||Object(G.n)()||Object(G.s)()||Object(G.l)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");si("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new eh({Ei:function(t){c?si("Connection","Not sending because WebChannel is closed:",t):(u||(si("Connection","Opening WebChannel transport."),a.open(),u=!0),si("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Zr.EventType.OPEN,function(){c||si("Connection","WebChannel transport opened.")}),l(a,Zr.EventType.CLOSE,function(){c||(c=!0,si("Connection","WebChannel transport closed"),h.Vi())}),l(a,Zr.EventType.ERROR,function(t){c||(c=!0,ui("Connection","WebChannel transport errored:",t),h.Vi(new ri(ni.UNAVAILABLE,"The operation could not be completed")))}),l(a,Zr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];li(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){si("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=ms[t];if(void 0!==e)return Os(e)}(i),s=r.message;void 0===o&&(o=ni.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new ri(o,s)),a.close()}else si("Connection","WebChannel received:",n),h.Si(n)}}),l(i,$r.STAT_EVENT,function(t){10===t.stat?si("Connection","Detected buffering proxy"):11===t.stat&&si("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);si("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then(function(t){return si("RestConnection","Received: ",t),t},function(e){throw ui("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+th[t]},t}());function rh(){return"undefined"!=typeof window?window:null}function ih(){return"undefined"!=typeof document?document:null}function oh(t){return new Xs(t,!0)}var sh=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&si("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),ah=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new sh(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===ni.RESOURCE_EXHAUSTED?(ai(e.toString()),ai("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===ni.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new ri(ni.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(K.b)(t,void 0,void 0,function(){return Object(K.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return si("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(si("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),uh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(K.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:hi()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(li(void 0===e||"string"==typeof e),Ci.fromBase64String(e||"")):(li(void 0===e||e instanceof Uint8Array),Ci.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?ni.UNKNOWN:Os(t.code);return new ri(e,t.message||"")}(a);n=new Qs(r,i,o,s||null)}else if("documentChange"in e){i=ia(t,(r=e.documentChange).document.name),o=ta(r.document.updateTime);var a=new to({mapValue:{fields:r.document.fields}}),u=(s=no.newFoundDocument(i,o,a),r.targetIds||[]);n=new qs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=ia(t,(r=e.documentDelete).document),o=r.readTime?ta(r.readTime):bi.min(),a=no.newNoDocument(i,o),n=new qs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=ia(t,(r=e.documentRemove).document),n=new qs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return hi();var c=e.filter;i=new Is(r=c.count||0),n=new Bs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return bi.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?bi.min():e.readTime?ta(e.readTime):bi.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=aa(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=ao(r)?{documents:da(t,r)}:{query:pa(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Js(t,e.resumeToken):e.snapshotVersion.compareTo(bi.min())>0&&(n.readTime=$s(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return hi()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=aa(this.R),e.removeTarget=t,this.cr(e)},e}(ah),ch=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(K.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(li(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(li(void 0!==e),t.map(function(t){return function(t,e){var n=ta(t.updateTime?t.updateTime:e);return n.isEqual(bi.min())&&(n=ta(e)),new rs(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=ta(t.commitTime);return this.listener.Tr(n,e)}return li(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=aa(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return la(e.R,t)})};this.cr(n)},e}(ah),hh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(K.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new ri(ni.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===ni.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ri(ni.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===ni.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ri(ni.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),lh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(ai(e),this.Vr=!1):si("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),fh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(K.b)(o,void 0,void 0,function(){return Object(K.d)(this,function(t){switch(t.label){case 0:return Ih(this)?(si("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(K.b)(this,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return(e=fi(t)).Or.add(4),[4,ph(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,dh(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new lh(n,r)};function dh(t){return Object(K.b)(this,void 0,void 0,function(){var e,n;return Object(K.d)(this,function(r){switch(r.label){case 0:if(!Ih(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ph(t){return Object(K.b)(this,void 0,void 0,function(){var e,n;return Object(K.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function gh(t,e){var n=fi(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),wh(n)?bh(n):Fh(n).er()&&mh(n,e))}function yh(t,e){var n=fi(t),r=Fh(n);n.$r.delete(e),r.er()&&vh(n,e),0===n.$r.size&&(r.er()?r.ir():Ih(n)&&n.Br.set("Unknown"))}function mh(t,e){t.qr.U(e.targetId),Fh(t).mr(e)}function vh(t,e){t.qr.U(e),Fh(t).yr(e)}function bh(t){t.qr=new Gs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Fh(t).start(),t.Br.Sr()}function wh(t){return Ih(t)&&!Fh(t).tr()&&t.$r.size>0}function Ih(t){return 0===fi(t).Or.size}function Th(t){t.qr=void 0}function Oh(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){return t.$r.forEach(function(e,n){mh(t,e)}),[2]})})}function Eh(t,e){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(n){return Th(t),wh(t)?(t.Br.Nr(e),bh(t)):t.Br.set("Unknown"),[2]})})}function _h(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i,o;return Object(K.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Qs&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(K.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),si("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Sh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof qs?t.qr.X(e):e instanceof Bs?t.qr.rt(e):t.qr.et(e),n.isEqual(bi.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,bc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Ci.EMPTY_BYTE_STRING,n.snapshotVersion)),vh(t,e);var r=new lu(n.target,e,1,n.sequenceNumber);mh(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return si("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Sh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Sh(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r=this;return Object(K.d)(this,function(i){switch(i.label){case 0:if(!nu(e))throw e;return t.Or.add(1),[4,ph(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return bc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(K.b)(r,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return si("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,dh(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function xh(t,e){return e().catch(function(n){return Sh(t,n,e)})}function Ch(t){return Object(K.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(K.d)(this,function(s){switch(s.label){case 0:e=fi(t),n=Mh(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Ih(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Tc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=Mh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Sh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return jh(e)&&Dh(e),[2]}})})}function jh(t){return Ih(t)&&!Mh(t).tr()&&t.Fr.length>0}function Dh(t){Mh(t).start()}function Ah(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){return Mh(t).Ar(),[2]})})}function kh(t){return Object(K.b)(this,void 0,void 0,function(){var e,n,r;return Object(K.d)(this,function(i){for(e=Mh(t),n=0,r=t.Fr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function Nh(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=hu.from(r,e,n),[4,xh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,Ch(t)];case 2:return o.sent(),[2]}})})}function Rh(t,e){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(n){switch(n.label){case 0:return e&&Mh(t).pr?[4,function(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r;return Object(K.d)(this,function(i){switch(i.label){case 0:return Ts(r=e.code)&&r!==ni.ABORTED?(n=t.Fr.shift(),Mh(t).sr(),[4,xh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,Ch(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return jh(t)&&Dh(t),[2]}})})}function Ph(t,e){return Object(K.b)(this,void 0,void 0,function(){var n;return Object(K.d)(this,function(r){switch(r.label){case 0:return n=fi(t),e?(n.Or.delete(2),[4,dh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,ph(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function Fh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=fi(t);return r.br(),new uh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Oh.bind(null,t),Ri:Eh.bind(null,t),_r:_h.bind(null,t)}),t.Mr.push(function(n){return Object(K.b)(e,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),wh(t)?bh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Th(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Mh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=fi(t);return r.br(),new ch(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ah.bind(null,t),Ri:Rh.bind(null,t),Ir:kh.bind(null,t),Tr:Nh.bind(null,t)}),t.Mr.push(function(n){return Object(K.b)(e,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Ch(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(si("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Lh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Xa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ri(ni.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Vh(t,e){if(ai("AsyncQueue",e+": "+t),nu(t))return new ri(ni.UNAVAILABLE,e+": "+t);throw t}var Uh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Vi.comparator(e.key,n.key)}:function(t,e){return Vi.comparator(t.key,e.key)},this.keyedMap=ks(),this.sortedSet=new Es(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),qh=function(){function t(){this.Qr=new Es(Vi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):hi():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Bh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Uh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Po(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Qh=function(){this.Wr=void 0,this.listeners=[]},Kh=function(){this.queries=new $u(function(t){return Fo(t)},Po),this.onlineState="Unknown",this.Gr=new Set};function Gh(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(K.d)(this,function(c){switch(c.label){case 0:if(n=fi(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Qh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Vh(a,"Initialization of query '"+Mo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Yh(n),[2]}})})}function zh(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(K.d)(this,function(a){return n=fi(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Hh(t,e){for(var n=fi(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Yh(n)}function Wh(t,e,n){var r=fi(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Yh(t){t.Gr.forEach(function(t){t.next()})}var Xh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Bh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Bh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),$h=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Jh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return ia(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?ha(this.R,t.document,!1):no.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return ta(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Jh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Fs()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:return[4,jc(this.localStore,new Jh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Dc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new lc(Object.assign({},this.progress),t))]}})})}}();var Zh=function(t){this.key=t},tl=function(t){this.key=t},el=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Fs(),this.mutatedKeys=Fs(),this.lo=Vo(t),this.fo=new Uh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new qh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=xo(this.query)&&i.size===this.query.limit?i.last():null,c=Co(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=Lo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),xo(this.query)||Co(this.query))for(;s.size>this.query.limit;){var h=xo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return hi()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Bh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new qh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Fs(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new tl(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Zh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Fs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Bh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),nl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},rl=function(t){this.key=t,this.bo=!1},il=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new $u(function(t){return Fo(t)},Po),this.Vo=new Map,this.So=new Set,this.Do=new Es(Vi.comparator),this.Co=new Map,this.No=new kc,this.xo={},this.ko=new Map,this.Fo=Vu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function ol(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(K.d)(this,function(a){switch(a.label){case 0:return n=Rl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Oc(n.localStore,No(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,sl(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&gh(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function sl(t,e,n,r){return Object(K.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(K.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(K.b)(this,void 0,void 0,function(){var i,o,s;return Object(K.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,_c(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(bl(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,_c(t.localStore,e,!0)];case 1:return i=h.sent(),o=new el(e,i.Bn),s=o._o(i.documents),a=Us.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),bl(t,n,u.To),c=new nl(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function al(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:return n=fi(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!Po(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Ec(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),yh(n.remoteStore,r.targetId),ml(n,r.targetId)}).catch(Ku)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return ml(n,r.targetId),[4,Ec(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function ul(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(K.d)(this,function(a){switch(a.label){case 0:r=Pl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=fi(t),i=vi.now(),o=e.reduce(function(t,e){return t.add(e.key)},Fs());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=cs(c,n.get(c.key));null!=h&&s.push(new ds(c.key,h,eo(h.value.mapValue),is.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Es(gi)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Tl(r,i.changes)];case 3:return a.sent(),[4,Ch(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Vh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function cl(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r;return Object(K.d)(this,function(i){switch(i.label){case 0:n=fi(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,wc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(li(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?li(r.bo):t.removedDocuments.size>0&&(li(r.bo),r.bo=!1))}),[4,Tl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Ku(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function hl(t,e,n){var r=fi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=fi(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Yh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function ll(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(K.d)(this,function(c){switch(c.label){case 0:return(r=fi(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Es(Vi.comparator)).insert(o,no.newNoDocument(o,bi.min())),a=Fs().add(o),u=new Vs(bi.min(),new Map,new xs(gi),s,a),[4,cl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Il(r),[3,4];case 2:return[4,Ec(r.localStore,e,!1).then(function(){return ml(r,e,n)}).catch(Ku)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function fl(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:n=fi(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,vc(n.localStore,e)];case 2:return i=o.sent(),yl(n,r,null),gl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Tl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ku(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function dl(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:r=fi(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=fi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return li(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),yl(r,e,n),gl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Tl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ku(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function pl(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(K.d)(this,function(a){switch(a.label){case 0:Ih((n=fi(t)).remoteStore)||si("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=fi(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=Vh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function gl(t,e){(t.ko.get(e)||[]).forEach(function(t){t.resolve()}),t.ko.delete(e)}function yl(t,e,n){var r=fi(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function ml(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||vl(t,e)})}function vl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(yh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Il(t))}function bl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Zh?(t.No.addReference(o.key,e),wl(t,o)):o instanceof tl?(si("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||vl(t,o.key)):hi()}}function wl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(si("SyncEngine","New document in limbo: "+n),t.So.add(r),Il(t))}function Il(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Vi(Ei.fromString(e)),r=t.Fo.next();t.Co.set(r,new rl(n)),t.Do=t.Do.insert(n,r),gh(t.remoteStore,new lu(No(So(n.path)),r,2,ei.o))}}function Tl(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(K.d)(this,function(a){switch(a.label){case 0:return r=fi(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=dc.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(K.d)(this,function(h){switch(h.label){case 0:n=fi(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return $a.forEach(e,function(e){return $a.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return $a.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!nu(r=h.sent()))throw r;return si("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.kn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.kn=n.kn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Ol(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r;return Object(K.d)(this,function(i){switch(i.label){case 0:return(n=fi(t)).currentUser.isEqual(e)?[3,3]:(si("SyncEngine","User change. New user:",e.toKey()),[4,mc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach(function(t){t.forEach(function(t){t.reject(new ri(ni.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Tl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function El(t,e){var n=fi(t),r=n.Co.get(e);if(r&&r.bo)return Fs().add(r.key);var i=Fs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function _l(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:return[4,_c((n=fi(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&bl(n,e.targetId,i.To),i)]}})})}function Sl(t){return Object(K.b)(this,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){return[2,xc((e=fi(t)).localStore).then(function(t){return Tl(e,t)})]})})}function xl(t,e,n,r){return Object(K.b)(this,void 0,void 0,function(){var i,o;return Object(K.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=fi(t),r=fi(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):$a.resolve(null)})})}((i=fi(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Ch(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(yl(i,e,r||null),gl(i,e),function(t,e){fi(fi(t)._n).Gt(e)}(i.localStore,e)):hi(),s.label=4;case 4:return[4,Tl(i,o)];case 5:return s.sent(),[3,7];case 6:si("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function Cl(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(K.d)(this,function(c){switch(c.label){case 0:return Rl(n=fi(t)),Pl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,jl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Ph(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)gh(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return ml(n,e),Ec(n.localStore,e,!0)}),yh(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,jl(n,a)];case 5:return c.sent(),function(t){var e=fi(t);e.Co.forEach(function(t,n){yh(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Es(Vi.comparator)}(n),n.$o=!1,[4,Ph(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function jl(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(K.d)(this,function(g){switch(g.label){case 0:n=fi(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Oc(n.localStore,No(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,_l(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Sc(n.localStore,a)];case 8:return p=g.sent(),[4,Oc(n.localStore,p)];case 9:return u=g.sent(),[4,sl(n,Dl(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function Dl(t){return _o(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Al(t){var e=fi(t);return fi(fi(e.localStore).persistence).fn()}function kl(t,e,n,r){return Object(K.b)(this,void 0,void 0,function(){var i,o,s;return Object(K.d)(this,function(a){switch(a.label){case 0:return(i=fi(t)).$o?(si("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,xc(i.localStore)];case 3:return o=a.sent(),s=Vs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Tl(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Ec(i.localStore,e,!0)];case 6:return a.sent(),ml(i,e,r),[3,8];case 7:hi(),a.label=8;case 8:return[2]}})})}function Nl(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(K.d)(this,function(f){switch(f.label){case 0:if(!(r=Rl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(si("SyncEngine","Adding an already active target "+s),[3,5]):[4,Sc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Oc(r.localStore,a)];case 3:return u=f.sent(),[4,sl(r,Dl(a),u.targetId,!1)];case 4:f.sent(),gh(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(K.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Ec(r.localStore,t,!1).then(function(){yh(r.remoteStore,t),ml(r,t)}).catch(Ku)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function Rl(t){var e=fi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=cl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=El.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ll.bind(null,e),e.vo._r=Hh.bind(null,e.eventManager),e.vo.Mo=Wh.bind(null,e.eventManager),e}function Pl(t){var e=fi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=dl.bind(null,e),e}var Fl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return this.R=oh(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return yc(this.persistence,new pc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Lc(Uc.bs,this.R)},t.prototype.Bo=function(t){return new $c},t.prototype.terminate=function(){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Ml=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(K.c)(e,t),e.prototype.initialize=function(e){return Object(K.b)(this,void 0,void 0,function(){var n=this;return Object(K.d)(this,function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,Cc(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,Pl(this.Qo.syncEngine)];case 4:return r.sent(),[4,Ch(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He(function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()})];case 6:return r.sent(),[2]}})})},e.prototype.Ko=function(t){return yc(this.persistence,new pc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Hu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=hc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Au.withCacheSize(this.cacheSizeBytes):Au.DEFAULT;return new ac(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,rh(),ih(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new $c},e}(Fl),Ll=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(K.c)(e,t),e.prototype.initialize=function(e){return Object(K.b)(this,void 0,void 0,function(){var n,r=this;return Object(K.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Xc?(this.sharedClientState.syncEngine={ui:xl.bind(null,n),ai:kl.bind(null,n),hi:Nl.bind(null,n),fn:Al.bind(null,n),ci:Sl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(K.b)(r,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return[4,Cl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=rh();if(!Xc.yt(e))throw new ri(ni.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=hc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Xc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Ml),Vl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(K.b)(this,void 0,void 0,function(){var n=this;return Object(K.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return hl(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Ol.bind(null,this.syncEngine),[4,Ph(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Kh},t.prototype.createDatastore=function(t){var e=oh(t.databaseInfo.databaseId),n=new nh(t.databaseInfo);return function(t,e,n){return new hh(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return hl(s.syncEngine,t,0)},o=Zc.yt()?new Zc:new Jc,new fh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new il(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(K.b)(this,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return e=fi(t),si("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,ph(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Ul=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),ql=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Xa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(K.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new $h(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e;return Object(K.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(K.b)(this,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e;return Object(K.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(K.b)(this,void 0,void 0,function(){var e,n=this;return Object(K.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new ri(ni.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(K.d)(this,function(u){switch(u.label){case 0:return n=fi(t),r=aa(n.R)+"/documents",i={documents:e.map(function(t){return ra(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){li(!!e.found);var n=ia(t,e.found.name),r=ta(e.found.updateTime),i=new to({mapValue:{fields:e.found.fields}});return no.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){li(!!e.missing),li(!!e.readTime);var n=ia(t,e.missing),r=ta(e.readTime);return no.newNoDocument(n,r)}(t,e):hi()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());li(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new bs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e=this;return Object(K.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Vi.fromPath(n);e.mutations.push(new ws(r,e.precondition(r)))}),[4,function(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:return n=fi(t),r=aa(n.R)+"/documents",i={writes:e.map(function(t){return la(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw hi();e=bi.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new ri(ni.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?is.updateTime(e):is.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(bi.min()))throw new ri(ni.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return is.updateTime(e)}return is.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Bl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new sh(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(K.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(K.d)(this,function(r){return t=new ql(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Fi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ts(e)}return!1},t}(),Ql=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=qc.UNAUTHENTICATED,this.clientId=pi.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(K.b)(r,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return si("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new ri(ni.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Xa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(K.b)(t,void 0,void 0,function(){var t,n;return Object(K.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Vh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Kl(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(K.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),si("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(K.b)(i,void 0,void 0,function(){return Object(K.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,mc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Gl(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r;return Object(K.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,zl(t)];case 1:return n=i.sent(),si("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(K.b)(this,void 0,void 0,function(){var n,r;return Object(K.d)(this,function(i){switch(i.label){case 0:return(n=fi(t)).asyncQueue.verifyOperationInProgress(),si("RemoteStore","RemoteStore received new credentials"),r=Ih(n),n.Or.add(3),[4,ph(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,dh(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function zl(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(si("FirestoreClient","Using default OfflineComponentProvider"),[4,Kl(t,new Fl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Hl(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(si("FirestoreClient","Using default OnlineComponentProvider"),[4,Gl(t,new Vl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Wl(t){return zl(t).then(function(t){return t.persistence})}function Yl(t){return zl(t).then(function(t){return t.localStore})}function Xl(t){return Hl(t).then(function(t){return t.remoteStore})}function $l(t){return Hl(t).then(function(t){return t.syncEngine})}function Jl(t){return Object(K.b)(this,void 0,void 0,function(){var e,n;return Object(K.d)(this,function(r){switch(r.label){case 0:return[4,Hl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=ol.bind(null,e.syncEngine),n.onUnlisten=al.bind(null,e.syncEngine),n)]}})})}function Zl(t,e,n){var r=this;void 0===n&&(n={});var i=new Xa;return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(r,void 0,void 0,function(){var r;return Object(K.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Ul({next:function(o){e.enqueueAndForget(function(){return zh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new ri(ni.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new ri(ni.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Xh(So(n.path),o,{includeMetadataChanges:!0,so:!0});return Gh(t,s)},[4,Jl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function tf(t,e,n){var r=this;void 0===n&&(n={});var i=new Xa;return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(r,void 0,void 0,function(){var r;return Object(K.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Ul({next:function(n){e.enqueueAndForget(function(){return zh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new ri(ni.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Xh(n,o,{includeMetadataChanges:!0,so:!0});return Gh(t,s)},[4,Jl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var ef=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},nf=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),rf=new Map,of=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},sf=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(qc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),af=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),uf=function(){function t(t){var e=this;this.currentUser=qc.UNAUTHENTICATED,this.oc=new Xa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){si("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(si("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(si("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(li("string"==typeof n.accessToken),new of(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(K.b)(n,void 0,void 0,function(){return Object(K.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return li(null===t||"string"==typeof t),new qc(t)},t}(),cf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=qc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),hf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new cf(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(qc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function lf(t,e,n){if(!n)throw new ri(ni.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function ff(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new ri(ni.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function df(t,e,n,r){if(!0===e&&!0===r)throw new ri(ni.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function pf(t){if(!Vi.isDocumentKey(t))throw new ri(ni.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function gf(t){if(Vi.isDocumentKey(t))throw new ri(ni.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function yf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":hi()}function mf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ri(ni.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=yf(t);throw new ri(ni.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function vf(t,e){if(e<=0)throw new ri(ni.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var bf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new ri(ni.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ri(ni.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,df("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),wf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bf({}),this._settingsFrozen=!1,t instanceof nf?(this._databaseId=t,this._credentials=new sf):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ri(ni.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nf(t.options.projectId)}(t),this._credentials=new uf(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new ri(ni.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new ri(ni.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new sf;switch(t.type){case"gapi":var e=t.client;return li(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new hf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new ri(ni.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=rf.get(this))&&(si("ComponentProvider","Removing Datastore"),rf.delete(this),t.terminate()),Promise.resolve();var t},t}(),If=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Of(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Tf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Of=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,So(r))||this)._path=r,i.type="collection",i}return Object(K.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new If(this.firestore,null,new Vi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Tf);function Ef(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(G.i)(t),lf("collection","path",e),t instanceof wf)return gf(n=Ei.fromString.apply(Ei,Object(K.f)([e],r))),new Of(t,null,n);if(!(t instanceof If||t instanceof Of))throw new ri(ni.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return gf(n=Ei.fromString.apply(Ei,Object(K.f)([t.path],r)).child(Ei.fromString(e))),new Of(t.firestore,null,n)}function _f(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(G.i)(t),1===arguments.length&&(e=pi.u()),lf("doc","path",e),t instanceof wf)return pf(n=Ei.fromString.apply(Ei,Object(K.f)([e],r))),new If(t,null,new Vi(n));if(!(t instanceof If||t instanceof Of))throw new ri(ni.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return pf(n=t._path.child(Ei.fromString.apply(Ei,Object(K.f)([e],r)))),new If(t.firestore,t instanceof Of?t.converter:null,new Vi(n))}function Sf(t,e){return t=Object(G.i)(t),e=Object(G.i)(e),(t instanceof If||t instanceof Of)&&(e instanceof If||e instanceof Of)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function xf(t,e){return t=Object(G.i)(t),e=Object(G.i)(e),t instanceof Tf&&e instanceof Tf&&t.firestore===e.firestore&&Po(t._query,e._query)&&t.converter===e.converter}var Cf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new sh(this,"async_queue_retry"),this.Ic=function(){var e=ih();e&&si("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=ih();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=ih();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new Xa;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return Object(K.b)(this,void 0,void 0,function(){var t,e=this;return Object(K.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!nu(t=n.sent()))throw t;return si("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,ai("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Lh.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&hi()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(K.b)(this,void 0,void 0,function(){var t;return Object(K.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function jf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Xa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Df=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Cf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(K.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||kf(this),this._firestoreClient.terminate()},e}(wf);function Af(t){return t._firestoreClient||kf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function kf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new ef(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Ql(t._credentials,t._queue,r)}function Nf(t,e,n){var r=this,i=new Xa;return t.asyncQueue.enqueue(function(){return Object(K.b)(r,void 0,void 0,function(){var r;return Object(K.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Kl(t,n)];case 1:return o.sent(),[4,Gl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===ni.FAILED_PRECONDITION||t.code===ni.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Rf(t){if(t._initialized||t._terminated)throw new ri(ni.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Pf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new ri(ni.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Si(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Ff=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Ci.fromBase64String(e))}catch(e){throw new ri(ni.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Ci.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Mf=function(t){this._methodName=t},Lf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new ri(ni.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ri(ni.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return gi(this._lat,t._lat)||gi(this._long,t._long)},t}(),Vf=/^__.*__$/,Uf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ds(t,this.data,this.fieldMask,e,this.fieldTransforms):new fs(t,this.data,e,this.fieldTransforms)},t}(),qf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new ds(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Bf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw hi()}}var Qf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return cd(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Bf(this.Nc)&&Vf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),Kf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||oh(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new Qf({Nc:t,methodName:e,qc:n,path:Si.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Gf(t){var e=t._freezeSettings(),n=oh(t._databaseId);return new Kf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function zf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);od("Data must be an object, but it was:",s,r);var a,u,c=rd(r,s);if(o.merge)a=new xi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=sd(e,f[l],n);if(!s.contains(d))throw new ri(ni.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");hd(h,d)||h.push(d)}a=new xi(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Uf(new to(c),a,u)}var Hf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Mf);function Wf(t,e,n){return new Qf({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Yf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e.prototype._toFieldTransform=function(t){return new ns(t.path,new Wo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Mf),Xf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(K.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Wf(this,t,!0),n=this.Kc.map(function(t){return nd(t,e)}),r=new Yo(n);return new ns(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Mf),$f=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(K.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Wf(this,t,!0),n=this.Kc.map(function(t){return nd(t,e)}),r=new $o(n);return new ns(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Mf),Jf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(K.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new Zo(t.R,Qo(t.R,this.Qc));return new ns(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Mf);function Zf(t,e,n,r){var i=t.Uc(1,e,n);od("Data must be an object, but it was:",i,r);var o=[],s=to.empty();Ii(r,function(t,r){var a=ud(e,t,n);r=Object(G.i)(r);var u=i.Oc(a);if(r instanceof Hf)o.push(a);else{var c=nd(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new xi(o);return new qf(s,a,i.fieldTransforms)}function td(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[sd(e,r,n)],u=[i];if(o.length%2!=0)throw new ri(ni.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(sd(e,o[c])),u.push(o[c+1]);for(var h=[],l=to.empty(),f=a.length-1;f>=0;--f)if(!hd(h,a[f])){var d=a[f],p=u[f];p=Object(G.i)(p);var g=s.Oc(d);if(p instanceof Hf)h.push(d);else{var y=nd(p,g);null!=y&&(h.push(d),l.set(d,y))}}var m=new xi(h);return new qf(l,m,s.fieldTransforms)}function ed(t,e,n,r){return void 0===r&&(r=!1),nd(n,t.Uc(r?4:3,e))}function nd(t,e){if(id(t=Object(G.i)(t)))return od("Unsupported field value:",e,t),rd(t,e);if(t instanceof Mf)return function(t,e){if(!Bf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=nd(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(G.i)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Qo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=vi.fromDate(t);return{timestampValue:$s(e.R,n)}}if(t instanceof vi)return n=new vi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:$s(e.R,n)};if(t instanceof Lf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ff)return{bytesValue:Js(e.R,t._byteString)};if(t instanceof If){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ea(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+yf(t))}(t,e)}function rd(t,e){var n={};return Ti(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ii(t,function(t,r){var i=nd(r,e.kc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function id(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof vi||t instanceof Lf||t instanceof Ff||t instanceof If||t instanceof Mf)}function od(t,e,n){if(!id(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=yf(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function sd(t,e,n){if((e=Object(G.i)(e))instanceof Pf)return e._internalPath;if("string"==typeof e)return ud(t,e);throw cd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ad=new RegExp("[~\\*/\\[\\]]");function ud(t,e,n){if(e.search(ad)>=0)throw cd("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Pf.bind.apply(Pf,Object(K.f)([void 0],e.split(".")))))._internalPath}catch(hp){throw cd("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function cd(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new ri(ni.INVALID_ARGUMENT,(a+=". ")+t+u)}function hd(t,e){return t.some(function(t){return t.isEqual(e)})}var ld=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new If(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new fd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(dd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),fd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(ld);function dd(t,e){return"string"==typeof e?ud(t,e):e instanceof Pf?e._internalPath:e._delegate._internalPath}var pd=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),gd=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(K.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new yd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(dd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(ld),yd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(gd),md=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new pd(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new yd(n._firestore,n._userDataWriter,r.key,r,new pd(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ri(ni.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new yd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new pd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new yd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new pd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:vd(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function vd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return hi()}}function bd(t,e){return t instanceof gd&&e instanceof gd?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof md&&e instanceof md&&t._firestore===e._firestore&&xf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function wd(t){if(Co(t)&&0===t.explicitOrderBy.length)throw new ri(ni.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Id=function(){};function Td(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Od=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(K.c)(e,t),e.prototype._apply=function(t){var e=Gf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new ri(ni.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Dd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(jd(r,t,h[c]));a={arrayValue:{values:u}}}else a=jd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Dd(s,o),a=ed(n,"where",s,"in"===o||"not-in"===o);var l=uo.create(i,o,a);return function(t,e){if(e.g()){var n=Do(t);if(null!==n&&!n.isEqual(e.field))throw new ri(ni.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=jo(t);null!==r&&Ad(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new ri(ni.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Tf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Eo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Id),Ed=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(K.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new ri(ni.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new ri(ni.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new wo(e,n);return function(t,e){if(null===jo(t)){var n=Do(t);null!==n&&Ad(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Tf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Eo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Id),_d=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(K.c)(e,t),e.prototype._apply=function(t){return new Tf(t.firestore,t.converter,Ro(t._query,this.Hc,this.Jc))},e}(Id),Sd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(K.c)(e,t),e.prototype._apply=function(t){var e=Cd(t,this.type,this.Yc,this.Xc);return new Tf(t.firestore,t.converter,function(t,e){return new Eo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Id),xd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(K.c)(e,t),e.prototype._apply=function(t){var e=Cd(t,this.type,this.Yc,this.Xc);return new Tf(t.firestore,t.converter,function(t,e){return new Eo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Id);function Cd(t,e,n,r){if(n[0]=Object(G.i)(n[0]),n[0]instanceof ld)return function(t,e,n,r,i){if(!r)throw new ri(ni.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=ko(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Hi(e,r.key));else{var c=r.data.field(u.field);if(Ni(c))throw new ri(ni.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new ri(ni.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new vo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Gf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new ri(ni.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new ri(ni.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ao(t)&&-1!==c.indexOf("/"))throw new ri(ni.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Ei.fromString(c));if(!Vi.isDocumentKey(h))throw new ri(ni.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Vi(h);a.push(Hi(e,l))}else{var f=ed(n,r,c);a.push(f)}}return new vo(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function jd(t,e,n){if("string"==typeof(n=Object(G.i)(n))){if(""===n)throw new ri(ni.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ao(e)&&-1!==n.indexOf("/"))throw new ri(ni.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Ei.fromString(n));if(!Vi.isDocumentKey(r))throw new ri(ni.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Hi(t,new Vi(r))}if(n instanceof If)return Hi(t,n._key);throw new ri(ni.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+yf(n)+".")}function Dd(t,e){if(!Array.isArray(t)||0===t.length)throw new ri(ni.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new ri(ni.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ad(t,e,n){if(!n.isEqual(e))throw new ri(ni.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var kd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ui(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ai(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ki(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw hi()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Ii(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Lf(Ai(t.latitude),Ai(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Ri(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Pi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Di(t);return new vi(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Ei.fromString(t);li(Sa(n));var r=new nf(n.get(1),n.get(3)),i=new Vi(n.popFirst(5));return r.isEqual(e)||ai("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Nd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Rd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(K.c)(e,t),e.prototype.convertBytes=function(t){return new Ff(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new If(this.firestore,null,e)},e}(kd),Pd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Gf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Fd(t,this._firestore),i=Nd(r.converter,e,n),o=zf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,is.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Fd(t,this._firestore);return o="string"==typeof(e=Object(G.i)(e))||e instanceof Pf?td(this._dataReader,"WriteBatch.update",s._key,e,n,r):Zf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,is.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Fd(t,this._firestore);return this._mutations=this._mutations.concat(new bs(e._key,is.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new ri(ni.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Fd(t,e){if((t=Object(G.i)(t)).firestore!==e)throw new ri(ni.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Md=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(K.c)(e,t),e.prototype.convertBytes=function(t){return new Ff(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new If(this.firestore,null,e)},e}(kd);function Ld(t,e,n){t=mf(t,If);var r=mf(t.firestore,Df),i=Nd(t.converter,e,n);return qd(r,[zf(Gf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,is.none())])}function Vd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=mf(t,If);var o=mf(t.firestore,Df),s=Gf(o);return qd(o,[("string"==typeof(e=Object(G.i)(e))||e instanceof Pf?td(s,"updateDoc",t._key,e,n,r):Zf(s,"updateDoc",t._key,e)).toMutation(t._key,is.exists(!0))])}function Ud(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(G.i)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||jf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(jf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof If)c=mf(t.firestore,Df),h=So(t._key.path),u={next:function(e){i[a]&&i[a](Bd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=mf(t,Tf);c=mf(d.firestore,Df),h=d._query;var p=new Md(c);u={next:function(t){i[a]&&i[a](new md(c,p,d,t))},error:i[a+1],complete:i[a+2]},wd(t._query)}return function(t,e,n,r){var i=this,o=new Ul(r),s=new Xh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(i,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return e=Gh,[4,Jl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(i,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return e=zh,[4,Jl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(Af(c),h,l,u)}function qd(t,e){return function(t,e){var n=this,r=new Xa;return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(n,void 0,void 0,function(){var n;return Object(K.d)(this,function(i){switch(i.label){case 0:return n=ul,[4,$l(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(Af(t),e)}function Bd(t,e,n){var r=n.docs.get(e._key),i=new Md(t);return new gd(t,i,e._key,r,new pd(n.hasPendingWrites,n.fromCache),e.converter)}var Qd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(K.c)(e,t),e.prototype.get=function(e){var n=this,r=Fd(e,this._firestore),i=new Md(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new gd(n._firestore,i,r._key,t._document,new pd(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Gf(t)}return t.prototype.get=function(t){var e=this,n=Fd(t,this._firestore),r=new Rd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return hi();var i=t[0];if(i.isFoundDocument())return new ld(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new ld(e._firestore,r,n._key,null,n.converter);throw hi()})},t.prototype.set=function(t,e,n){var r=Fd(t,this._firestore),i=Nd(r.converter,e,n),o=zf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Fd(t,this._firestore);return o="string"==typeof(e=Object(G.i)(e))||e instanceof Pf?td(this._dataReader,"Transaction.update",s._key,e,n,r):Zf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Fd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Kd(){if("undefined"==typeof Uint8Array)throw new ri(ni.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Gd(){if("undefined"==typeof atob)throw new ri(ni.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var zd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Gd(),new t(Ff.fromBase64String(e))},t.fromUint8Array=function(e){return Kd(),new t(Ff.fromUint8Array(e))},t.prototype.toBase64=function(){return Gd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Kd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Hd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Rf(t=mf(t,Df));var n=Af(t),r=t._freezeSettings(),i=new Vl;return Nf(n,i,new Ml(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Rf(t=mf(t,Df));var e=Af(t),n=t._freezeSettings(),r=new Vl;return Nf(e,r,new Ll(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new ri(ni.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Xa;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(K.b)(e,void 0,void 0,function(){var e;return Object(K.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(K.b)(this,void 0,void 0,function(){return Object(K.d)(this,function(e){switch(e.label){case 0:return Za.yt()?[4,Za.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(hc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Wd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof nf||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||ui("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=mf(t,wf))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&ui("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=qc.MOCK_USER;else{s=Object(G.e)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new ri(ni.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new qc(u)}t._credentials=new af(new of(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(K.b)(e,void 0,void 0,function(){var e,n;return Object(K.d)(this,function(r){switch(r.label){case 0:return[4,Wl(t)];case 1:return e=r.sent(),[4,Xl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=fi(t);return e.Or.delete(0),dh(e)}(n))]}})})})}(Af(mf(this._delegate,Df)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(K.b)(e,void 0,void 0,function(){var e,n;return Object(K.d)(this,function(r){switch(r.label){case 0:return[4,Wl(t)];case 1:return e=r.sent(),[4,Xl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(K.b)(this,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return(e=fi(t)).Or.add(0),[4,ph(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Af(mf(this._delegate,Df)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&df("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Xa;return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(e,void 0,void 0,function(){var e;return Object(K.d)(this,function(r){switch(r.label){case 0:return e=pl,[4,$l(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(Af(mf(this._delegate,Df)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Ul(e);return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(n,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){fi(t).Gr.add(e),e.next()},[4,Jl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(n,void 0,void 0,function(){var e;return Object(K.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){fi(t).Gr.delete(e)},[4,Jl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(Af(t=mf(t,Df)),jf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new ri(ni.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new up(this,Ef(this._delegate,t))}catch(t){throw tp(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Zd(this,_f(this._delegate,t))}catch(t){throw tp(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new op(this,function(t,e){if(t=mf(t,wf),lf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ri(ni.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Tf(t,null,function(t){return new Eo(Ei.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw tp(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Xa;return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(n,void 0,void 0,function(){var n;return Object(K.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Hl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new Bl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(Af(t),function(n){return e(new Qd(t,n))})}(this._delegate,function(n){return t(new Xd(e,n))})},t.prototype.batch=function(){var t=this;return Af(this._delegate),new $d(new Pd(this._delegate,function(e){return qd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new ri(ni.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new ri(ni.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Yd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(K.c)(e,t),e.prototype.convertBytes=function(t){return new zd(new Ff(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Zd.eu(e,this.firestore,null)},e}(kd),Xd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Yd(t)}return t.prototype.get=function(t){var e=this,n=cp(t);return this._delegate.get(n).then(function(t){return new rp(e._firestore,new gd(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=cp(t);return n?(ff("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=cp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(K.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=cp(t);return this._delegate.delete(e),this},t}(),$d=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=cp(t);return n?(ff("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=cp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(K.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=cp(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Jd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new yd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new ip(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Yd(e),n),i.set(n,o)),o},t}();Jd.su=new WeakMap;var Zd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Yd(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new ri(ni.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new If(n._delegate,r,new Vi(e)))},t.eu=function(e,n,r){return new t(n,new If(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new up(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new up(this.firestore,Ef(this._delegate,t))}catch(t){throw tp(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(G.i)(t))instanceof If&&Sf(this._delegate,t)},t.prototype.set=function(t,e){e=ff("DocumentReference.set",e);try{return e?Ld(this._delegate,t,e):Ld(this._delegate,t)}catch(t){throw tp(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Vd(this._delegate,t):Vd.apply(void 0,Object(K.f)([this._delegate,t,e],n))}catch(t){throw tp(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return qd(mf((t=this._delegate).firestore,Df),[new bs(t._key,is.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ep(e),i=np(e,function(e){return new rp(t.firestore,new gd(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Ud(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=mf(t,If);var e=mf(t.firestore,Df),n=Af(e),r=new Md(e);return function(t,e){var n=this,r=new Xa;return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(n,void 0,void 0,function(){var n;return Object(K.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i;return Object(K.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=fi(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new ri(ni.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Vh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Yl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new gd(e,r,t._key,n,new pd(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=mf(t,If);var e=mf(t.firestore,Df);return Zl(Af(e),t._key,{source:"server"}).then(function(n){return Bd(e,t,n)})}(this._delegate):function(t){t=mf(t,If);var e=mf(t.firestore,Df);return Zl(Af(e),t._key).then(function(n){return Bd(e,t,n)})}(this._delegate)).then(function(t){return new rp(e.firestore,new gd(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Jd.nu(this.firestore,e):null))},t}();function tp(t,e,n){return t.message=t.message.replace(e,n),t}function ep(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!jf(r))return r}return{}}function np(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=jf(t[0])?t[0]:jf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var rp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Zd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return bd(this._delegate,t._delegate)},t}(),ip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(K.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(rp),op=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Yd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Td(this._delegate,function(t,e,n){var r=e,i=dd("where",t);return new Od(i,r,n)}(e,n,r)))}catch(e){throw tp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Td(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=dd("orderBy",t);return new Ed(r,n)}(e,n)))}catch(e){throw tp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Td(this._delegate,function(t){return vf("limit",t),new _d("limit",t,"F")}(e)))}catch(e){throw tp(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Td(this._delegate,function(t){return vf("limitToLast",t),new _d("limitToLast",t,"L")}(e)))}catch(e){throw tp(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Td(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Sd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw tp(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Td(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Sd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw tp(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Td(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw tp(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Td(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw tp(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return xf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=mf(t,Tf);var e=mf(t.firestore,Df),n=Af(e),r=new Md(e);return function(t,e){var n=this,r=new Xa;return t.asyncQueue.enqueueAndForget(function(){return Object(K.b)(n,void 0,void 0,function(){var n;return Object(K.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(K.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(K.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,_c(t,e,!0)];case 1:return a=u.sent(),r=new el(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Vh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Yl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new md(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=mf(t,Tf);var e=mf(t.firestore,Df),n=Af(e),r=new Md(e);return tf(n,t._query,{source:"server"}).then(function(n){return new md(e,r,t,n)})}(this._delegate):function(t){t=mf(t,Tf);var e=mf(t.firestore,Df),n=Af(e),r=new Md(e);return wd(t._query),tf(n,t._query).then(function(n){return new md(e,r,t,n)})}(this._delegate)).then(function(t){return new ap(e.firestore,new md(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ep(e),i=np(e,function(e){return new ap(t.firestore,new md(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Ud(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Jd.nu(this.firestore,e):null))},t}(),sp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new ip(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),ap=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new op(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new ip(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new sp(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new ip(n._firestore,r))})},t.prototype.isEqual=function(t){return bd(this._delegate,t._delegate)},t}(),up=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(K.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Zd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Zd(this.firestore,void 0===t?_f(this._delegate):_f(this._delegate,t))}catch(t){throw tp(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=mf(t.firestore,Df),r=_f(t),i=Nd(t.converter,e);return qd(n,[zf(Gf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,is.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Zd(e.firestore,t)})},e.prototype.isEqual=function(t){return Sf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Jd.nu(this.firestore,t):null))},e}(op);function cp(t){return mf(t,If)}var hp,lp=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Pf.bind.apply(Pf,Object(K.f)([void 0],t)))}return t.documentId=function(){return new t(Si.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(G.i)(t))instanceof Pf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),fp=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Yf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Hf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Xf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $f("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Jf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),dp=n("/6Yf"),pp={Firestore:Wd,GeoPoint:Lf,Timestamp:vi,Blob:zd,Transaction:Xd,WriteBatch:$d,DocumentReference:Zd,DocumentSnapshot:rp,Query:op,QueryDocumentSnapshot:ip,QuerySnapshot:ap,CollectionReference:up,FieldPath:lp,FieldValue:fp,setLogLevel:function(t){ii.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function gp(t,e){return function(t,e=R.b){return new f.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function yp(t,e){return gp(t,e).pipe(Object(u.a)(t=>({payload:t,type:"query"})))}function mp(t,e){return yp(t,e).pipe(Object(P.a)(void 0),M(),Object(u.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function vp(t,e,n){return mp(t,n).pipe(Object(U.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return bp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return bp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return bp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),t=>t.lift(new q(void 0,void 0)),Object(u.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function bp(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function wp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}(function(t,e){t.INTERNAL.registerComponent(new dp.a("firestore",function(t){return function(t,e){return new Wd(t,new Df(t,e),new Hd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},pp)))})(hp=Q.a),hp.registerVersion("@firebase/firestore","2.4.1");class Ip{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=mp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(u.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(P.a)(void 0),M(),Object(w.a)(([t,e])=>e.length>0||!t),Object(u.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(U.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=wp(t);return vp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return yp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(d.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Tp(this.ref.doc(t),this.afs)}}class Tp{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Cp(n,e);return new Ip(r,i,this.afs)}snapshotChanges(){return gp(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(P.a)(void 0),M(),Object(u.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(u.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(d.a)(this.ref.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}class Op{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?mp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(w.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):mp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(U.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=wp(t);return vp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return yp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(d.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}const Ep=new o.r("angularfire2.enableFirestorePersistence"),_p=new o.r("angularfire2.firestore.persistenceSettings"),Sp=new o.r("angularfire2.firestore.settings"),xp=new o.r("angularfire2.firestore.use-emulator");function Cp(t,e=(t=>t)){return{query:e(t),ref:t}}let jp=(()=>{class t{constructor(t,e,n,i,o,a,u,c,h){this.schedulers=new I.d(a),this.keepUnstableUntilFirst=Object(I.h)(this.schedulers);const l=Object(I.g)(t,a,e);!k.a.auth&&h&&Object(I.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(I.f)(`${l.name}.firestore`,"AngularFirestore",l,()=>{const t=a.runOutsideAngular(()=>l.firestore());if(i&&t.settings(i),f&&t.useEmulator(...f),n&&!Object(r.s)(o)){const e=()=>{try{return Object(d.a)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(hp){return"undefined"!=typeof console&&console.warn(hp),Object(s.a)(!1)}};return[t,a.runOutsideAngular(e)]}return[t,Object(s.a)(!1)]},[i,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Cp(n,e),o=this.schedulers.ngZone.run(()=>r);return new Ip(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Op(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Tp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(o.Vb(I.c),o.Vb(I.b,8),o.Vb(Ep,8),o.Vb(Sp,8),o.Vb(o.C),o.Vb(o.A),o.Vb(_p,8),o.Vb(xp,8),o.Vb(T,8))},t.\u0275prov=o.Hb({factory:function(){return new t(o.Vb(I.c),o.Vb(I.b,8),o.Vb(Ep,8),o.Vb(Sp,8),o.Vb(o.C),o.Vb(o.A),o.Vb(_p,8),o.Vb(xp,8),o.Vb(T,8))},token:t,providedIn:"any"}),t})(),Dp=(()=>{class t{constructor(t,e,n){this.auth=t,this.router=e,this.firestore=n,this.db=this.firestore.collection("users"),this.authUser=this.auth.user}login(){return this.auth.signInWithPopup(new k.a.auth.GoogleAuthProvider).then(t=>{this.authUser=this.auth.user,this.router.navigateByUrl("/user/profile")})}logout(){this.auth.signOut().then(t=>{this.router.navigateByUrl("/")})}createUser(t){const e=this.db.doc(t.uid);let n=this.getCurrentTime(),r=N.User,i={id:t.uid,name:t.displayName,auth_data:[Object.assign({},t.providerData[0])],email:t.email,image_url:t.photoURL,level:r,created_time:n,last_login:n,max_card_limit:5,max_card_edit_limit:1e3,total_card:0,total_card_edit:0};e.set(i)}createRealfarmInfo(t,e){this.db.doc(t).get().subscribe(n=>{const r=n.data();if(r.total_card<r.max_card_limit&&r.total_card_edit<r.max_card_edit_limit){const n=this.getUID(),i=this.getCurrentTime();let o=Object.assign(Object.assign({},e),{id:n,uid:r.name,last_update:i,created_time:i});this.db.doc(t).collection("realfarms").doc(n).set(o),this.updateUser(t,"total_card",r.total_card+1)}})}updateUser(t,e,n){const r=this.db.doc(t);let i={};i[e]=n,r.update(i)}upateRealFamrInfo(t,e){this.db.doc(t).get().subscribe(n=>{const r=n.data();if(r.total_card_edit<r.max_card_edit_limit){this.getUID();const n=this.getCurrentTime();let i=Object.assign(Object.assign({},e),{id:e.id,uid:e.uid,last_update:n,created_time:e.created_time});this.db.doc(t).collection("realfarms").doc(e.id).update(i),this.updateUser(t,"total_card_edit",r.total_card_edit+1)}})}deleteRealFarmInfo(t,e){this.db.doc(t).get().subscribe(n=>{const r=n.data();this.db.doc(t).collection("realfarms").doc(e.id).delete(),this.updateUser(t,"total_card",r.total_card-1)})}updateUserCollection(t,e,n){this.db.doc(t).collection(e).doc(n.id).update(n)}getCurrentTime(){let t=new Date;return t.toDateString()+" "+t.toTimeString()}getUID(){return Date.now().toString(36)+Math.random().toString(36).slice(2)}}return t.\u0275fac=function(e){return new(e||t)(o.Vb(C),o.Vb(i.c),o.Vb(jp))},t.\u0275prov=o.Hb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var Ap=n("jhN1"),kp=n("320Y");let Np=(()=>{class t{constructor(t,e,n){this.user=t,this.title=e,this.meta=n}ngOnInit(){this.updateHeader()}login(){this.user.login()}updateHeader(){this.title.setTitle("\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"),this.meta.updateTag({name:"description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({name:"apple-mobile-web-app-title",content:"\u500b\u4eba\u8cc7\u8a0a  | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:title",content:"\u500b\u4eba\u8cc7\u8a0a  | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({property:"og:image",content:"https://bobosheep.github.io/farm-tool/assets/DisplayRealFarmCard.jpg"}),this.meta.updateTag({property:"og:url",content:"https://bobosheep.github.io/farm-tool/user/"})}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(Dp),o.Lb(Ap.d),o.Lb(Ap.c))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-login"]],decls:6,vars:4,consts:[["title","\u6b61\u8fce\u4f86\u5230\u500b\u4eba\u9801\u9762","subtitle","\u8acb\u767b\u5165\u4ee5\u7e7c\u7e8c\u4f7f\u7528",3,"showBackIcon","showCustomIcon"],[1,"container"],["id","googleBtn",1,"button",3,"click"],["src","/assets/others/g-logo.png",3,"width","height"]],template:function(t,e){1&t&&(o.Mb(0,"app-header",0),o.Rb(1,"section",1),o.Rb(2,"button",2),o.Yb("click",function(){return e.login()}),o.Mb(3,"img",3),o.Rb(4,"span"),o.vc(5,"\u4f7f\u7528 Google \u767b\u5165"),o.Qb(),o.Qb(),o.Qb()),2&t&&(o.gc("showBackIcon",!1)("showCustomIcon",!1),o.Bb(3),o.gc("width",18)("height",18))},directives:[kp.a],styles:[".container[_ngcontent-%COMP%]{display:flex;width:90%;margin:16px auto;justify-content:center}#googleBtn[_ngcontent-%COMP%]{display:flex;width:-moz-fit-content;width:fit-content;border:0;border-radius:2px;padding:11px 8px}#googleBtn[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{height:18px;width:18px;padding-right:24px}#googleBtn[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{cursor:inherit;height:18px;font-size:14px;color:rgba(0,0,0,.54);font-weight:600;display:inline-block;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}"]}),t})();var Rp=n("wHSu"),Pp=n("6NWb");class Fp{static drawRect(t,e,n,r,i,o="#FFFFF",s=0,a="#333333"){t.fillStyle=o,t.fillRect(e,n,r,i),s>0&&(t.strokeStyle=a,t.lineWidth=s,t.strokeRect(e,n,r,i))}static drawRoundRect(t,e,n,r,i,o,s="#FFFFFF",a=0,u="#333333"){r<2*o&&(o=r/2),i<2*o&&(o=i/2),t.fillStyle=s,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.fill(),a>0&&(t.strokeStyle=u,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.stroke())}static addImage(t,e,n,r,i,o){let s=new Image;s.onload=()=>{t.drawImage(s,n,r,i,o)},s.src=e}static addImageSource(t,e,n,r,i,o){t.drawImage(e,n,r,i,o)}static addText(t,e,n,r,i=14,o="#333333",s=500){t.font=`${s} ${i}px sans-serif`,t.fillStyle=o,t.fillText(e,n,r+i)}}class Mp{constructor(t,e,n,r,i=2,o){this.canvas=o,this.x=t,this.y=e,this.width=n,this.height=r,this.scale=i}}class Lp extends Mp{constructor(t,e,n,r,i=2,o,s=0,a=0,u="#FEFEFE",c="#333333"){super(t,e,n,r,i,o),this.bgColor=u,this.borderWidth=s,this.borderRadius=a,this.borderColor=c,this.width<2*this.borderRadius&&(this.borderRadius=this.width/2),this.height<2*this.borderRadius&&(this.borderRadius=this.height/2)}draw(){this.borderRadius>0?this.drawRoundRect():this.drawRect()}drawRect(){Fp.drawRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}drawRoundRect(){Fp.drawRoundRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.borderRadius*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}}class Vp extends Mp{constructor(t,e,n,r=2,i,o="#000000",s=12,a=500){super(e,n,0,0,r,i),this.text=t,this.color=o,this.fontSize=s,this.fontWeight=a}draw(){Fp.addText(this.canvas,this.text,this.x*this.scale,this.y*this.scale,this.fontSize*this.scale,this.color,this.fontWeight)}}class Up extends Mp{constructor(t,e,n,r,i,o=2,s){super(e,n,r,i,o,s),this.src=t}draw(){Fp.addImage(this.canvas,this.src,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale)}}function qp(t,e,n,r=500){return t.font=`${r} ${n}px sans-serif`,t.measureText(e).width}var Bp=function(t){return t[t.default=0]="default",t}({});let Qp=(()=>{class t{constructor(){this.scale=4,this.titleFont=16,this.detailFont=12,this.footnoteFont=11,this.font={title:{size:16,weight:700},content:{size:12,weight:600},footnote:{size:11,weight:500}},this.card={x:0,y:0,w:320,h:180,borderRadius:12,border:1,padding:{v:12,h:12}},this.greet={x:this.card.padding.h,y:64,w:296,h:88,borderRadius:8,border:0,padding:{v:6,h:8},maxLine:5,lineHeight:16,fontSize:12,fontWeight:600},this.logoText={x:236,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.userIDText={x:this.card.padding.h,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.levelText={x:this.card.padding.h,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.gameIdText={x:this.card.padding.h,y:32,size:this.font.title.size,weight:this.font.title.weight},this.favoriteText={x:125,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.favoriteImg={max:3,x:125,y:32,w:20,h:20},this.logoImg={x:288,y:156,w:20,h:20}}}return t.getLayout=e=>new t,t})();var Kp=function(t){return t[t.primary=0]="primary",t[t.secondary=1]="secondary",t[t.skyBlue=2]="skyBlue",t}({}),Gp=function(t){return t.black="#333333",t.white="#FFFFFF",t.green="#459C7F",t.light_green="#F0FFFA",t.orange="#E4766A",t.light_orange="#FFE9E7",t.blue="#368FD4",t.light_blue="#DDF1FF",t}({});let zp=(()=>{class t{constructor(){this.primaryColor=Gp.green,this.secondaryColor=Gp.light_green,this.contentColor=Gp.black,this.contentBgColor=Gp.white}}return t.getTheme=e=>{const n=new t;switch(e){case Kp.primary:n.primaryColor=Gp.green,n.secondaryColor=Gp.light_green;break;case Kp.secondary:n.primaryColor=Gp.orange,n.secondaryColor=Gp.light_orange;break;case Kp.skyBlue:n.primaryColor=Gp.blue,n.secondaryColor=Gp.light_blue;break;default:n.primaryColor=Gp.green,n.secondaryColor=Gp.light_green}return n},t})();class Hp{constructor(t,e=Bp.default,n=Kp.primary){this.info=t,this.layout=Qp.getLayout(e),this.theme=zp.getTheme(n),this.canvasObjects=[]}resetCanvas(){this.canvasObjects=[]}genBlocks(t){let e=this.genCardBlock(t),n=this.genGreetingBlock(t);this.canvasObjects.push(e),this.canvasObjects.push(n)}genCardBlock(t){return new Lp(this.layout.card.x,this.layout.card.y,this.layout.card.w,this.layout.card.h,this.layout.scale,t,this.layout.card.border,this.layout.card.borderRadius,this.theme.secondaryColor,this.theme.primaryColor)}genGreetingBlock(t){return new Lp(this.layout.greet.x,this.layout.greet.y,this.layout.greet.w,this.layout.greet.h,this.layout.scale,t,this.layout.greet.border,this.layout.greet.borderRadius,this.theme.contentBgColor,this.theme.contentBgColor)}genTexts(t){let e=this.genLogoText(t,"Create by"),n=this.genUserText(t,`ID: ${this.info.uid}`),r=this.genLevelText(t,`Lv. ${this.info.level}`),i=this.genGameIDText(t,this.info.gid),o=this.genFavoriteText(t,"\u6211\u7684\u6700\u611b"),s=this.genGreetingText(t,this.info.greeting);this.canvasObjects.push(e),this.canvasObjects.push(n),this.canvasObjects.push(r),this.canvasObjects.push(i),this.canvasObjects.push(o),this.canvasObjects.push(...s)}genLogoText(t,e){return new Vp(e,this.layout.logoText.x,this.layout.logoText.y,this.layout.scale,t,this.theme.contentColor,this.layout.logoText.size,this.layout.logoText.weight)}genUserText(t,e){return new Vp(e,this.layout.userIDText.x,this.layout.userIDText.y,this.layout.scale,t,this.theme.contentColor,this.layout.userIDText.size,this.layout.userIDText.weight)}genLevelText(t,e){return new Vp(e,this.layout.levelText.x,this.layout.levelText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.levelText.size,this.layout.levelText.weight)}genGameIDText(t,e){return new Vp(e,this.layout.gameIdText.x,this.layout.gameIdText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.gameIdText.size,this.layout.gameIdText.weight)}genFavoriteText(t,e){return new Vp(e,this.layout.favoriteText.x,this.layout.favoriteText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.favoriteText.size,this.layout.favoriteText.weight)}genGreetingText(t,e){const n=this.layout.greet.maxLine,r=this.layout.greet.x+this.layout.greet.padding.h,i=this.layout.greet.y+this.layout.greet.padding.v,o=this.layout.greet.w-2*this.layout.greet.padding.h,s=this.layout.greet.lineHeight,a=this.layout.font.content.size,u=this.layout.font.content.weight;let c=0,h=e.length,l=[];for(let f=0;f<n;f++){const n=e.indexOf("\n",c);let r=Math.round((c+h+1)/2),i=e.slice(c,h),s=qp(t,i,a,u);if(c>=e.length)break;if(s<o)r=h;else{for(i=e.slice(c,r),s=qp(t,i,a,u);r<h&&s<=o;)r+=1,i=e.slice(c,r),s=qp(t,i,a,u);for(;r>=0&&s>o;)r-=1,i=e.slice(c,r),s=qp(t,i,a,u)}-1!=n&&n<r&&(r=n+1),l.push(e.slice(c,r)),c=r}return l.map((e,n)=>new Vp(e,r,i+n*s,this.layout.scale,t,this.theme.contentColor,a,u))}genImages(t,e,n){this.canvasObjects.push(this.genLogoImg(t,e)),this.canvasObjects.push(...this.genFavoriteItemsImg(t,n))}genLogoImg(t,e){return new Up(e,this.layout.logoImg.x,this.layout.logoImg.y,this.layout.logoImg.w,this.layout.logoImg.h,this.layout.scale,t)}genFavoriteItemsImg(t,e){let n=this.layout.favoriteImg.x,r=this.layout.favoriteImg.y,i=this.layout.favoriteImg.w,o=this.layout.favoriteImg.h;return e.map((e,s)=>new Up(e,n+s*i,r,i,o,this.layout.scale,t))}draw(){this.canvasObjects.forEach(t=>{t.draw()})}}var Wp=n("kvnP"),Yp=n("m7U+");const Xp=["cardCanvas"],$p=["downloadButton"];let Jp=(()=>{class t{constructor(t,e,n){this.consumableServ=t,this.cropServ=e,this.document=n,this.layout=Bp.default,this.theme=Kp.primary,this.logoImg="assets/icons/LOGO-71x71.png",this.isEditing=!1,this.onEdit=new o.n,this.onDelete=new o.n,this.closeSettingIcon=Rp.tb,this.settingIcon=Rp.D,this.editIcon=Rp.C,this.shareIcon=Rp.kb,this.updateThemeIcon=Rp.ab,this.copyIcon=Rp.r,this.downloadIcon=Rp.B,this.deleteIcon=Rp.wb,this.window=this.document.defaultView}ngOnInit(){this.isEditing=!1,this.realfarmCard=new Hp(this.data,Bp.default,this.theme),this.filename=this.data.gid+"_RealFarm\u5c0f\u5e6b\u624b.png"}ngAfterViewInit(){this.context=this.canvas.nativeElement.getContext("2d"),this.drawCard()}drawCard(){this.realfarmCard=new Hp(this.data,Bp.default,this.theme),this.realfarmCard.genBlocks(this.context),this.realfarmCard.genTexts(this.context),this.realfarmCard.genImages(this.context,this.logoImg,this.data.favorites.map((t,e)=>{let n="";return e>=this.realfarmCard.layout.favoriteImg.max?"":(n=this.cropServ.searchSeed(t)?this.cropServ.searchSeed(t).img:this.consumableServ.searchConsumable(t)[0].img,n)})),this.realfarmCard.draw(),this.link2Canvas()}link2Canvas(){this.downloadBtn.nativeElement.href=this.canvas.nativeElement.toDataURL("image/png")}shareCard(){return Object(K.b)(this,void 0,void 0,function*(){this.link2Canvas();const t=yield(yield fetch(this.downloadBtn.nativeElement.href)).blob(),e=Object({files:[new File([t],this.filename,{type:t.type,lastModified:(new Date).getTime()})]});try{yield this.window.navigator.share(e)}catch(n){20!==n.code&&alert(`[${n.code}] \u6b64\u700f\u89bd\u5668\u7248\u672c\u5206\u4eab\u529f\u80fd\u51fa\u4e86\u9ede\u554f\u984c\ud83d\ude25`)}})}copyImage(){}editInfo(){this.isEditing=!1,this.onEdit.emit(this.data.id)}deleteCard(){this.isEditing=!1,this.onDelete.emit(this.data.id)}switchEditButtons(){this.isEditing=!this.isEditing}updateTheme(){switch(this.theme){case Kp.primary:this.theme=Kp.secondary;break;case Kp.secondary:this.theme=Kp.skyBlue;break;case Kp.skyBlue:this.theme=Kp.primary}this.drawCard()}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(Wp.a),o.Lb(Yp.a),o.Lb(r.d))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-realfarm-card"]],viewQuery:function(t,e){if(1&t&&(o.Ac(Xp,1),o.Ac($p,1)),2&t){let t;o.lc(t=o.Zb())&&(e.canvas=t.first),o.lc(t=o.Zb())&&(e.downloadBtn=t.first)}},inputs:{data:"data"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:28,vars:12,consts:[[1,"container"],["id","card-canvas",2,"width","100%",3,"width","height","click"],["cardCanvas",""],[1,"mask",3,"ngClass"],[1,"icon-button","settings",3,"ngClass","click"],[3,"icon"],[1,"wrapper","animation",3,"ngClass"],[1,"icon-button","updateTheme",3,"click"],[1,"icon-button","edit",3,"click"],[1,"icon-button","download",3,"download","click"],["downloadButton",""],[1,"icon-button","delete",3,"click"]],template:function(t,e){1&t&&(o.Rb(0,"div",0),o.Rb(1,"canvas",1,2),o.Yb("click",function(){return e.editInfo()}),o.Qb(),o.Mb(3,"div",3),o.Rb(4,"div",4),o.Yb("click",function(){return e.switchEditButtons()}),o.Mb(5,"fa-icon",5),o.Qb(),o.Rb(6,"div",6),o.Rb(7,"a",7),o.Yb("click",function(){return e.updateTheme()}),o.Mb(8,"fa-icon",5),o.Rb(9,"span"),o.vc(10,"\u66f4\u63db\u4e3b\u984c"),o.Qb(),o.Qb(),o.Rb(11,"a",8),o.Yb("click",function(){return e.shareCard()}),o.Mb(12,"fa-icon",5),o.Rb(13,"span"),o.vc(14,"\u5206\u4eab\u5361\u7247"),o.Qb(),o.Qb(),o.Rb(15,"a",8),o.Yb("click",function(){return e.editInfo()}),o.Mb(16,"fa-icon",5),o.Rb(17,"span"),o.vc(18,"\u7de8\u8f2f"),o.Qb(),o.Qb(),o.Rb(19,"a",9,10),o.Yb("click",function(){return e.link2Canvas()}),o.Mb(21,"fa-icon",5),o.Rb(22,"span"),o.vc(23,"\u5132\u5b58"),o.Qb(),o.Qb(),o.Rb(24,"a",11),o.Yb("click",function(){return e.deleteCard()}),o.Mb(25,"fa-icon",5),o.Rb(26,"span"),o.vc(27,"\u522a\u9664"),o.Qb(),o.Qb(),o.Qb(),o.Qb()),2&t&&(o.Bb(1),o.gc("width",e.realfarmCard.layout.card.w*e.realfarmCard.layout.scale)("height",e.realfarmCard.layout.card.h*e.realfarmCard.layout.scale),o.Bb(2),o.gc("ngClass",e.isEditing?"open":""),o.Bb(1),o.gc("ngClass",e.isEditing?"closeSettings":""),o.Bb(1),o.gc("icon",e.isEditing?e.closeSettingIcon:e.settingIcon),o.Bb(1),o.gc("ngClass",e.isEditing?"open":""),o.Bb(2),o.gc("icon",e.updateThemeIcon),o.Bb(4),o.gc("icon",e.shareIcon),o.Bb(4),o.gc("icon",e.editIcon),o.Bb(3),o.gc("download",e.filename),o.Bb(2),o.gc("icon",e.downloadIcon),o.Bb(4),o.gc("icon",e.deleteIcon))},directives:[r.j,Pp.a],styles:[".container[_ngcontent-%COMP%]{min-width:320px;max-width:400px;min-height:180px;max-height:225px;width:80%;height:80%;margin:0 auto;position:relative;aspect-ratio:16/9}.wrapper[_ngcontent-%COMP%]{margin:0 auto;display:flex;align-items:flex-end;justify-content:center;position:absolute;flex-direction:column;right:0;top:28px;transform:translateY(-50%) scaleY(0);z-index:0}.wrapper.open[_ngcontent-%COMP%]{transform:translateY(0) scaleY(1);z-index:5}.icon-button[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:28px;margin:4px;padding:4px 12px;border-radius:8px;align-items:center;justify-content:space-around;display:inline-flex;box-shadow:0 2px 8px 4px rgba(0,0,0,.15);background-color:var(--white)}.icon-button[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.icon-button[_ngcontent-%COMP%]:hover, .icon-button[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{cursor:pointer}.icon-button.settings[_ngcontent-%COMP%]{position:absolute;right:0;top:-20px;width:28px;height:28px;padding:4px;border-radius:50%;z-index:4}.icon-button.settings.closeSettings[_ngcontent-%COMP%]{z-index:6}.mask[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;background:rgba(0,0,0,.3);border-radius:12px;transform:scale(0)}.mask.open[_ngcontent-%COMP%]{transform:scale(1)}.animation[_ngcontent-%COMP%]{transition:.2s ease-in}.delete[_ngcontent-%COMP%]{color:var(--danger)}"]}),t})(),Zp=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Fb({type:t,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"wrapper"],[1,"loader"]],template:function(t,e){1&t&&(o.Rb(0,"div",0),o.Mb(1,"span",1),o.Qb())},styles:['.wrapper[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;display:flex;justify-content:center;align-items:center}.loader[_ngcontent-%COMP%]{width:48px;height:48px;border:10px solid var(--light-gray);position:relative;transform:rotate(45deg)}.loader[_ngcontent-%COMP%], .loader[_ngcontent-%COMP%]:before{border-radius:50%;box-sizing:border-box}.loader[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:-10px;border:10px solid var(--secondary);animation:prixClipFix 2s linear infinite}@keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}']}),t})();var tg=n("0zEo"),eg=function(t){return t[t.Unknown=0]="Unknown",t[t.Male=1]="Male",t[t.Female=2]="Female",t}({}),ng=n("3Pt+");function rg(t,e){if(1&t&&(o.Rb(0,"option",23),o.vc(1),o.Qb()),2&t){const t=e.$implicit;o.gc("value",t.name),o.Bb(1),o.xc(" ",t.name," ")}}function ig(t,e){if(1&t){const t=o.Sb();o.Rb(0,"div",9),o.Rb(1,"select",20),o.Yb("ngModelChange",function(e){return o.nc(t),o.ac().favorite=e}),o.tc(2,rg,2,2,"option",21),o.Qb(),o.Rb(3,"button",22),o.Yb("click",function(){return o.nc(t),o.ac().addFavorites()}),o.Mb(4,"fa-icon",18),o.Qb(),o.Qb()}if(2&t){const t=o.ac();o.Bb(1),o.gc("ngModel",t.favorite),o.Bb(1),o.gc("ngForOf",t.displayObjs),o.Bb(2),o.gc("icon",t.addIcon)}}function og(t,e){if(1&t){const t=o.Sb();o.Rb(0,"div",24),o.Mb(1,"img",25),o.Rb(2,"fa-icon",26),o.Yb("click",function(){o.nc(t);const n=e.$implicit;return o.ac().removeFavorite(n)}),o.Qb(),o.Qb()}if(2&t){const t=e.$implicit,n=o.ac();o.Bb(1),o.gc("src",n.getImg(t),o.pc)("height",28)("alt",t+"\u7684\u5716\u7247"),o.Bb(1),o.gc("icon",n.closeIcon)}}let sg=(()=>{class t{constructor(t,e){this.cs=t,this.is=e,this.done=new o.n,this.cancel=new o.n,this.addIcon=Rp.bb,this.closeIcon=Rp.ub,this.cancelIcon=Rp.tb,this.doneIcon=Rp.k}ngOnInit(){const t=this.cs.getAllCrops().map(t=>({name:t.name,img:t.img,group:"\u4f5c\u7269"})),e=this.is.getAllConsumables().map(t=>({name:t.name,img:t.img,group:t.group}));this.realfarmObjs=[...t,...e],null==this.data&&(this.data={id:"",uid:"",gid:"",greeting:"",level:10,gender:eg.Male,is_primary:!1,favorites:[]}),this.updateObjList()}isMale(){return this.data.gender===eg.Male}updateGender(t){this.data.gender=t?eg.Male:eg.Female}updateObjList(){this.displayObjs=this.realfarmObjs.filter(t=>!this.data.favorites.includes(t.name)),this.favorite=this.displayObjs[0].name}addFavorites(){console.log(this.data),this.data.favorites=[...this.data.favorites,this.favorite],this.data=Object.assign({},this.data),this.updateObjList()}removeFavorite(t){this.data.favorites=this.data.favorites.filter(e=>e!==t),this.data=Object.assign({},this.data),this.updateObjList()}getImg(t){const e=this.realfarmObjs.filter(e=>e.name===t);return e.length>0?e[0].img:""}doDone(){this.done.emit(this.data)}doCancel(){this.cancel.emit(!0)}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(Yp.a),o.Lb(Wp.a))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-realfarm-form"]],inputs:{data:"data"},outputs:{cancel:"cancel",done:"done"},decls:52,vars:11,consts:[[1,"wrapper"],[1,"header"],[1,"info"],[1,"form"],[1,"group"],[1,"title"],[1,"element","horizontal"],["type","text","name","gid",1,"value",3,"ngModel","ngModelChange"],["type","number","step","1","name","level",1,"value",3,"ngModel","ngModelChange"],[1,"value"],["type","radio","name","gender",3,"checked","change"],["class","value",4,"ngIf"],[1,"element","item-list"],["class","item",4,"ngFor","ngForOf"],[1,"element","vertical"],["rows","5","name","greeting","maxlength","200",1,"value",3,"ngModel","ngModelChange"],[1,"actions"],[1,"button","cancel",3,"click"],[3,"icon"],[1,"button","submit",3,"click"],["name","favorite",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"button","add","item",3,"click"],[3,"value"],[1,"item"],[3,"src","height","alt"],[1,"close",3,"icon","click"]],template:function(t,e){1&t&&(o.Rb(0,"section",0),o.Rb(1,"h1",1),o.vc(2),o.Qb(),o.Rb(3,"div",2),o.vc(4,"\u5efa\u7acb/\u7de8\u8f2f\u81ea\u5df1\u7684\u904a\u6232\u8cc7\u8a0a\uff0c\u4e14\u53ef\u4ee5\u4e0b\u8f09\u5716\u7247\u5f8c\u5206\u4eab\u7d66\u5176\u4ed6\u8fb2\u53cb"),o.Qb(),o.Qb(),o.Rb(5,"section",0),o.Rb(6,"form",3),o.Rb(7,"section",4),o.Rb(8,"h2",5),o.vc(9,"\u904a\u6232\u57fa\u672c\u8cc7\u8a0a"),o.Qb(),o.Rb(10,"label",6),o.Rb(11,"span",5),o.vc(12,"\u904a\u6232 ID"),o.Qb(),o.Rb(13,"input",7),o.Yb("ngModelChange",function(t){return e.data.gid=t}),o.Qb(),o.Qb(),o.Rb(14,"label",6),o.Rb(15,"span",5),o.vc(16,"\u7b49\u7d1a"),o.Qb(),o.Rb(17,"input",8),o.Yb("ngModelChange",function(t){return e.data.level=t}),o.Qb(),o.Qb(),o.Rb(18,"label",6),o.Rb(19,"span",5),o.vc(20,"\u89d2\u8272\u6027\u5225"),o.Qb(),o.Rb(21,"div",9),o.Rb(22,"label"),o.Rb(23,"input",10),o.Yb("change",function(){return e.updateGender(!0)}),o.Qb(),o.Rb(24,"span"),o.vc(25,"\u7537"),o.Qb(),o.Qb(),o.Rb(26,"label"),o.Rb(27,"input",10),o.Yb("change",function(){return e.updateGender(!1)}),o.Qb(),o.Rb(28,"span"),o.vc(29,"\u5973"),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Rb(30,"section",4),o.Rb(31,"h2",5),o.vc(32,"\u5176\u4ed6\u8cc7\u8a0a"),o.Qb(),o.Rb(33,"label",6),o.Rb(34,"div",5),o.Rb(35,"span"),o.vc(36,"\u6211\u7684\u6700\u611b"),o.Qb(),o.Qb(),o.tc(37,ig,5,3,"div",11),o.Qb(),o.Rb(38,"div",12),o.tc(39,og,3,4,"div",13),o.Qb(),o.Rb(40,"label",14),o.Rb(41,"span",5),o.vc(42),o.Qb(),o.Rb(43,"textarea",15),o.Yb("ngModelChange",function(t){return e.data.greeting=t}),o.vc(44,"                "),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Rb(45,"div",16),o.Rb(46,"button",17),o.Yb("click",function(){return e.doCancel()}),o.Mb(47,"fa-icon",18),o.vc(48," \u53d6\u6d88 "),o.Qb(),o.Rb(49,"button",19),o.Yb("click",function(){return e.doDone()}),o.Mb(50,"fa-icon",18),o.vc(51," \u5b8c\u6210 "),o.Qb(),o.Qb(),o.Qb()),2&t&&(o.Bb(2),o.xc("",""!==e.data.id?"\u7de8\u8f2f":"\u5efa\u7acb"," \u5361\u7247\u8cc7\u8a0a"),o.Bb(11),o.gc("ngModel",e.data.gid),o.Bb(4),o.gc("ngModel",e.data.level),o.Bb(6),o.gc("checked",e.isMale()),o.Bb(4),o.gc("checked",!e.isMale()),o.Bb(10),o.gc("ngIf",e.data.favorites.length<3),o.Bb(2),o.gc("ngForOf",e.data.favorites),o.Bb(3),o.xc("\u5361\u7247\u5167\u5bb9 (",e.data.greeting.length," / 200)"),o.Bb(1),o.gc("ngModel",e.data.greeting),o.Bb(4),o.gc("icon",e.cancelIcon),o.Bb(3),o.gc("icon",e.doneIcon))},directives:[ng.t,ng.k,ng.l,ng.b,ng.j,ng.m,ng.o,r.l,r.k,ng.i,Pp.a,ng.r,ng.n,ng.u],styles:[".value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:8px}.value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:4px;margin-left:0}.title.favorite[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{display:inline-block;width:40%;line-height:28px}.item-list[_ngcontent-%COMP%]{margin-top:8px}.item[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;display:inline-block;position:relative;padding:4px 8px}.item[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-4px;width:16px;height:16px}.button.add[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;padding:4px;margin-left:12px}.actions[_ngcontent-%COMP%]{width:100%;margin:8px;display:flex;flex-direction:row;justify-content:center}.button.cancel[_ngcontent-%COMP%], .button.submit[_ngcontent-%COMP%]{flex-grow:1;margin:0 8px;font-size:18px;height:36px;border-radius:4px;border:0}.button.submit[_ngcontent-%COMP%]{background-color:var(--primary);color:var(--white)}"]}),t})();function ag(t,e){if(1&t){const t=o.Sb();o.Rb(0,"div",6),o.Rb(1,"app-realfarm-card",9),o.Yb("onEdit",function(e){return o.nc(t),o.ac(2).editCard(e)})("onDelete",function(e){return o.nc(t),o.ac(2).deleteCard(e)}),o.Qb(),o.Qb()}if(2&t){const t=e.$implicit;o.Bb(1),o.gc("data",t)}}function ug(t,e){if(1&t){const t=o.Sb();o.Rb(0,"section"),o.Rb(1,"app-header",3),o.Yb("onClickCustomIcon",function(){return o.nc(t),o.ac().logout()}),o.bc(2,"async"),o.Qb(),o.Rb(3,"div",4),o.tc(4,ag,2,1,"div",5),o.bc(5,"async"),o.Rb(6,"div",6),o.Rb(7,"div",7),o.Yb("click",function(){return o.nc(t),o.ac().editCard(void 0)}),o.Mb(8,"fa-icon",8),o.Rb(9,"span"),o.vc(10,"\u65b0\u589e RealFarm \u5361\u7247"),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Qb()}if(2&t){const t=o.ac();let e=null;o.Bb(1),o.gc("title",null==(e=o.cc(2,8,t.userData))?null:e.name)("subtitle","\u500b\u4eba RealFarm \u8cc7\u8a0a "+t.cardInfos.length+"/5")("showBackIcon",!1)("showCustomIcon",!0)("customIcon",t.logoutIcon)("customString","\u767b\u51fa"),o.Bb(3),o.gc("ngForOf",o.cc(5,10,t.userRealFarm)),o.Bb(4),o.gc("icon",t.addIcon)}}function cg(t,e){1&t&&o.Mb(0,"app-loading")}function hg(t,e){if(1&t){const t=o.Sb();o.Rb(0,"app-modal",10),o.Yb("cancel",function(){return o.nc(t),o.ac().cancelEdit()}),o.Rb(1,"app-realfarm-form",11),o.Yb("done",function(e){return o.nc(t),o.ac().finishEdit(e)})("cancel",function(){return o.nc(t),o.ac().cancelEdit()}),o.Qb(),o.Qb()}if(2&t){const t=o.ac();o.Bb(1),o.gc("data",-1!==t.editIdx?t.cardInfos[t.editIdx]:null)}}const lg=()=>{return t=["user","profile"],Object(a.a)(j,Object(u.a)(e=>e&&t||!0));var t},fg=[{path:"",component:Np,canActivate:[D],data:{authGuardPipe:lg}},{path:"login",component:Np,canActivate:[D],data:{authGuardPipe:lg}},{path:"profile",component:(()=>{class t{constructor(t,e,n,r,i){this.auth=t,this.store=e,this.us=n,this.title=r,this.meta=i,this.cardNumber=0,this.logoutIcon=Rp.lb,this.addIcon=Rp.bb,this.auth.user.subscribe(t=>{const e=this.store.collection("users").doc(t.uid);this.userId=t.uid,this.userData=e.valueChanges(),this.userRealFarm=e.collection("realfarms").valueChanges(),e.get().subscribe(e=>{e.exists?this.us.updateUser(e.id,"last_login",this.us.getCurrentTime()):this.us.createUser(t)}),this.userRealFarm.subscribe(t=>{this.cardInfos=t}),this.userData.subscribe(t=>{this.userName=t.name,this.updateHeader()}),this.updateHeader()})}ngOnInit(){this.editMode=0,this.userName=""}logout(){this.us.logout()}updateHeader(){""!==this.userName&&this.title.setTitle(`${this.userName} | \u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b`),this.meta.updateTag({name:"description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({name:"apple-mobile-web-app-title",content:"\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:title",content:"\u500b\u4eba\u8cc7\u8a0a | RealFarm \u5c0f\u5e6b\u624b"}),this.meta.updateTag({property:"og:description",content:"\u4f7f\u7528\u8005\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684 RealFarm \u5c0f\u5361\u7247\uff0c\u4e26\u4e14\u53ef\u4ee5\u5206\u4eab\u5230\u793e\u7fa4\u6216\u662f\u81ea\u884c\u5132\u5b58\u3002"}),this.meta.updateTag({property:"og:image",content:"https://bobosheep.github.io/farm-tool/assets/DisplayUserInfo.jpg"}),this.meta.updateTag({property:"og:url",content:"https://bobosheep.github.io/farm-tool/user/"})}editCard(t){t?(this.cardInfos.forEach((e,n)=>{e.id===t&&(this.editIdx=n)}),this.editMode=2):(this.editIdx=-1,this.editMode=1)}cancelEdit(){this.editMode=0}finishEdit(t){1==this.editMode?this.createCard(t):this.updateCard(t),this.editMode=0}createCard(t){this.us.createRealfarmInfo(this.userId,t)}updateCard(t){this.cardInfos[this.editIdx]=t,this.us.upateRealFamrInfo(this.userId,this.cardInfos[this.editIdx])}deleteCard(t){if(confirm("\u78ba\u5b9a\u522a\u9664\u6b64\u5361\u7247")&&t)for(let e=0;e<this.cardInfos.length;e++)this.cardInfos[e].id===t&&(this.us.deleteRealFarmInfo(this.userId,this.cardInfos[e]),this.userRealFarm.subscribe(t=>{this.cardInfos=t}))}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(C),o.Lb(jp),o.Lb(Dp),o.Lb(Ap.d),o.Lb(Ap.c))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-profile"]],decls:5,vars:5,consts:[[4,"ngIf","ngIfElse"],["loadingTemplate",""],[3,"cancel",4,"ngIf"],[3,"title","subtitle","showBackIcon","showCustomIcon","customIcon","customString","onClickCustomIcon"],[1,"cards"],["class","card wrapper",4,"ngFor","ngForOf"],[1,"card","wrapper"],["id","add-card",3,"click"],[3,"icon"],[3,"data","onEdit","onDelete"],[3,"cancel"],[3,"data","done","cancel"]],template:function(t,e){if(1&t&&(o.tc(0,ug,11,12,"section",0),o.bc(1,"async"),o.tc(2,cg,1,0,"ng-template",null,1,o.uc),o.tc(4,hg,2,1,"app-modal",2)),2&t){const t=o.mc(3);o.gc("ngIf",o.cc(1,3,e.userData))("ngIfElse",t),o.Bb(4),o.gc("ngIf",0!==e.editMode)}},directives:[r.l,kp.a,r.k,Pp.a,Jp,Zp,tg.a,sg],pipes:[r.b],styles:[".cards[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;align-items:center;justify-content:flex-start;margin-top:32px}.card[_ngcontent-%COMP%]{width:100%;margin-bottom:12px}#add-card[_ngcontent-%COMP%]{font-size:14px;min-width:320px;max-width:400px;width:80%;margin:0 auto;height:64px;color:var(--gray);display:flex;align-items:center;justify-content:center;background-image:url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23909090' stroke-width='2' stroke-dasharray='14' stroke-dashoffset='14' stroke-linecap='square'/%3e%3c/svg%3e\");border-radius:12px}#add-card[_ngcontent-%COMP%]:hover, #add-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:hover{cursor:pointer}#add-card[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 8px}"]}),t})(),canActivate:[D],data:{authGuardPipe:()=>{return t=["user","login"],Object(a.a)(j,Object(u.a)(e=>e||t));var t}}}];let dg=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({imports:[[r.c,i.g.forChild(fg)]]}),t})();var pg=n("jICo");let gg=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({imports:[[r.c,dg,pg.a,Pp.b,ng.h,ng.q]]}),t})()}}]);