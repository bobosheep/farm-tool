!function(){function t(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t=function(){return e};var e={},n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(k){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),s=new E(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=I(s,n);if(a){if(a===l)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=h(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,s),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(k){return{type:"throw",arg:k}}}e.wrap=c;var l={};function f(){}function d(){}function p(){}var g={};u(g,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(_([])));v&&v!==n&&r.call(v,o)&&(g=v);var m=p.prototype=f.prototype=Object.create(g);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(i,o){function s(){return new e((function(n,s){!function n(i,o,s,a){var u=h(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,a)}))}a(u.arg)}(i,o,n,s)}))}return n=n?n.then(s,s):s()}}function I(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,I(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=h(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function _(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=p,u(m,"constructor",p),u(p,"constructor",d),d.displayName=u(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,s,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new w(c(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},b(m),u(m,a,"Generator"),u(m,o,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=_,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);s=!0);}catch(u){a=!0,i=u}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=h(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}function h(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}function f(t,e){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g(t);if(e){var i=g(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"7UCR":function(i,o,a){"use strict";a.r(o),a.d(o,"UserModule",(function(){return Pg}));var h=a("SVse"),f=a("iInd"),p=a("8Y7J"),y=a("LRne"),v=a("mCNh"),m=a("lJxs"),b=a("IzEk"),w=a("eIep"),I=a("XNiG"),O=a("HDdC"),T=a("Cfvw"),E=a("VRyK"),_=a("pxpQ"),S=a("qgXg"),k=a("quSY"),x=a("9ppp"),N=a("Ylt2"),C=function(t){l(n,t);var e=d(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,o=arguments.length>2?arguments[2]:void 0;return s(this,n),(t=e.call(this)).scheduler=o,t._events=[],t._infiniteTimeWindow=!1,t._bufferSize=r<1?1:r,t._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(t._infiniteTimeWindow=!0,t.next=t.nextInfiniteTimeWindow):t.next=t.nextTimeWindow,t}return u(n,[{key:"nextInfiniteTimeWindow",value:function(t){if(!this.isStopped){var e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}c(g(n.prototype),"next",this).call(this,t)}},{key:"nextTimeWindow",value:function(t){this.isStopped||(this._events.push(new j(this._getNow(),t)),this._trimBufferThenGetEvents()),c(g(n.prototype),"next",this).call(this,t)}},{key:"_subscribe",value:function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new x.a;if(this.isStopped||this.hasError?e=k.a.EMPTY:(this.observers.push(t),e=new N.a(this,t)),i&&t.add(t=new _.a(t,i)),n)for(var s=0;s<o&&!t.closed;s++)t.next(r[s]);else for(var a=0;a<o&&!t.closed;a++)t.next(r[a].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e}},{key:"_getNow",value:function(){return(this.scheduler||S.a).now()}},{key:"_trimBufferThenGetEvents",value:function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r}}]),n}(I.a),j=u((function t(e,n){s(this,t),this.time=e,this.value=n}));function D(t,e,n){var r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},function(t){return t.lift(function(t){var e,n,r=t.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=t.windowTime,s=void 0===o?Number.POSITIVE_INFINITY:o,a=t.refCount,u=t.scheduler,c=0,h=!1,l=!1;return function(t){var r;c++,!e||h?(h=!1,e=new C(i,s,u),r=e.subscribe(this),n=t.subscribe({next:function(t){e.next(t)},error:function(t){h=!0,e.error(t)},complete:function(){l=!0,n=void 0,e.complete()}}),l&&(n=void 0)):r=e.subscribe(this),this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!l&&a&&0===c&&(n.unsubscribe(),n=void 0,e=void 0)}))}}(r))}}var A=a("SxV6");function R(t,e){return e?Object(w.a)((function(){return t}),e):Object(w.a)((function(){return t}))}var P,L,F=a("tf+s"),M=a("pLZG"),V=a("jmUF"),U=new p.q("angularfire2.auth.use-emulator"),q=new p.q("angularfire2.auth.settings"),B=new p.q("angularfire2.auth.tenant-id"),K=new p.q("angularfire2.auth.langugage-code"),G=new p.q("angularfire2.auth.use-device-language"),z=new p.q("angularfire.auth.persistence"),Q=((P=u((function t(e,n,i,o,u,c,l,f,d,p){s(this,t);var g=new V.d(o),v=Object(V.h)(g),b=new I.a,S=Object(y.a)(void 0).pipe(Object(_.b)(g.outsideAngular),Object(w.a)((function(){return o.runOutsideAngular((function(){return a.e(19).then(a.bind(null,"6nsN"))}))})),Object(m.a)((function(){return Object(V.g)(e,o,n)})),Object(m.a)((function(t){return o.runOutsideAngular((function(){var e=u,n=c;return Object(V.f)(t.name+".auth","AngularFireAuth",t,(function(){var i=o.runOutsideAngular((function(){return t.auth()}));if(e&&i.useEmulator("http://"+e.join(":")),l&&(i.tenantId=l),i.languageCode=f,d&&i.useDeviceLanguage(),n)for(var s=0,a=Object.entries(n);s<a.length;s++){var u=r(a[s],2),c=u[0],h=u[1];i.settings[c]=h}return p&&i.setPersistence(p),i}),[e,l,f,d,n,p])}))})),D({bufferSize:1,refCount:!1}));if(Object(h.s)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(y.a)(null);else{S.pipe(Object(A.a)()).subscribe();var k=S.pipe(Object(w.a)((function(t){return t.getRedirectResult().then((function(t){return t}),(function(){return null}))})),v,D({bufferSize:1,refCount:!1})),x=function(t){return new O.a((function(e){return{unsubscribe:o.runOutsideAngular((function(){return t(e)}))}}))},N=S.pipe(Object(w.a)((function(t){return x(t.onAuthStateChanged.bind(t))}))),C=S.pipe(Object(w.a)((function(t){return x(t.onIdTokenChanged.bind(t))})));this.authState=k.pipe(R(N),Object(F.a)(g.outsideAngular),Object(_.b)(g.insideAngular)),this.user=k.pipe(R(C),Object(F.a)(g.outsideAngular),Object(_.b)(g.insideAngular)),this.idToken=this.user.pipe(Object(w.a)((function(t){return t?Object(T.a)(t.getIdToken()):Object(y.a)(null)}))),this.idTokenResult=this.user.pipe(Object(w.a)((function(t){return t?Object(T.a)(t.getIdTokenResult()):Object(y.a)(null)}))),this.credential=Object(E.a)(k,b,this.authState.pipe(Object(M.a)((function(t){return!t})))).pipe(Object(m.a)((function(t){return(null==t?void 0:t.user)?t:null})),Object(F.a)(g.outsideAngular),Object(_.b)(g.insideAngular))}return Object(V.i)(this,S,o,{spy:{apply:function(t,e,n){(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then((function(t){return b.next(t)}))}}})}))).\u0275fac=function(t){return new(t||P)(p.Sb(V.c),p.Sb(V.b,8),p.Sb(p.B),p.Sb(p.z),p.Sb(U,8),p.Sb(q,8),p.Sb(B,8),p.Sb(K,8),p.Sb(G,8),p.Sb(z,8))},P.\u0275prov=p.Eb({factory:function(){return new P(p.Sb(V.c),p.Sb(V.b,8),p.Sb(p.B),p.Sb(p.z),p.Sb(U,8),p.Sb(q,8),p.Sb(B,8),p.Sb(K,8),p.Sb(G,8),p.Sb(z,8))},token:P,providedIn:"any"}),P),W=Object(m.a)((function(t){return!!t})),H=((L=u((function t(e,n){var r=this;s(this,t),this.router=e,this.auth=n,this.canActivate=function(t,e){var n=t.data.authGuardPipe||function(){return W};return r.auth.user.pipe(Object(b.a)(1),n(t,e),Object(m.a)((function(t){return"boolean"==typeof t?t:Array.isArray(t)?r.router.createUrlTree(t):r.router.parseUrl(t)})))}}))).\u0275fac=function(t){return new(t||L)(p.Sb(f.c),p.Sb(Q))},L.\u0275prov=p.Eb({factory:function(){return new L(p.Sb(f.c),p.Sb(Q))},token:L,providedIn:"any"}),L),Y=a("Jgta"),X=function(t){return t[t.Admin=0]="Admin",t[t.Editor=1]="Editor",t[t.ClubAdmin=2]="ClubAdmin",t[t.User=100]="User",t}({}),J=a("D0XW"),$=a("JX91"),Z=a("7o/Q");function tt(){return function(t){return t.lift(new et)}}var et=function(){function t(){s(this,t)}return u(t,[{key:"call",value:function(t,e){return e.subscribe(new nt(t))}}]),t}(),nt=function(t){l(n,t);var e=d(n);function n(t){var r;return s(this,n),(r=e.call(this,t)).hasPrev=!1,r}return u(n,[{key:"_next",value:function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}]),n}(Z.a),rt=a("Kqap"),it=function(){function t(e,n){s(this,t),this.compare=e,this.keySelector=n}return u(t,[{key:"call",value:function(t,e){return e.subscribe(new ot(t,this.compare,this.keySelector))}}]),t}(),ot=function(t){l(n,t);var e=d(n);function n(t,r,i){var o;return s(this,n),(o=e.call(this,t)).keySelector=i,o.hasKey=!1,"function"==typeof r&&(o.compare=r),o}return u(n,[{key:"compare",value:function(t,e){return t===e}},{key:"_next",value:function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(i){return this.destination.error(i)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(i){return this.destination.error(i)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))}}]),n}(Z.a),st=a("zIRd"),at=a("mrSG"),ut=a("qOnz"),ct=a("q/0M"),ht=function(t,e){return(ht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function lt(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var ft,dt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},pt=pt||{},gt=dt||self;function yt(){}function vt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function mt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var bt="closure_uid_"+(1e9*Math.random()>>>0),wt=0;function It(t,e,n){return t.call.apply(t.bind,arguments)}function Ot(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Tt(t,e,n){return(Tt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?It:Ot).apply(null,arguments)}function Et(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function _t(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function St(){this.s=this.s,this.o=this.o}var kt={};St.prototype.s=!1,St.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,bt)&&t[bt]||(t[bt]=++wt)}(this);delete kt[t]}},St.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var xt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Nt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Ct(t){return Array.prototype.concat.apply([],arguments)}function jt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Dt(t){return/^[\s\xa0]*$/.test(t)}var At,Rt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Pt(t,e){return-1!=t.indexOf(e)}function Lt(t,e){return t<e?-1:t>e?1:0}t:{var Ft=gt.navigator;if(Ft){var Mt=Ft.userAgent;if(Mt){At=Mt;break t}}At=""}function Vt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ut(t){var e={};for(var n in t)e[n]=t[n];return e}var qt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Bt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<qt.length;o++)n=qt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Kt(t){return Kt[" "](t),t}Kt[" "]=yt;var Gt,zt,Qt=Pt(At,"Opera"),Wt=Pt(At,"Trident")||Pt(At,"MSIE"),Ht=Pt(At,"Edge"),Yt=Ht||Wt,Xt=Pt(At,"Gecko")&&!(Pt(At.toLowerCase(),"webkit")&&!Pt(At,"Edge"))&&!(Pt(At,"Trident")||Pt(At,"MSIE"))&&!Pt(At,"Edge"),Jt=Pt(At.toLowerCase(),"webkit")&&!Pt(At,"Edge");function $t(){var t=gt.document;return t?t.documentMode:void 0}t:{var Zt="",te=(zt=At,Xt?/rv:([^\);]+)(\)|;)/.exec(zt):Ht?/Edge\/([\d\.]+)/.exec(zt):Wt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(zt):Jt?/WebKit\/(\S+)/.exec(zt):Qt?/(?:Version)[ \/]?(\S+)/.exec(zt):void 0);if(te&&(Zt=te?te[1]:""),Wt){var ee=$t();if(null!=ee&&ee>parseFloat(Zt)){Gt=String(ee);break t}}Gt=Zt}var ne={},re=gt.document&&Wt&&($t()||parseInt(Gt,10))||void 0,ie=function(){if(!gt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{gt.addEventListener("test",yt,e),gt.removeEventListener("test",yt,e)}catch(n){}return t}();function oe(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function se(t,e){if(oe.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Xt){t:{try{Kt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ae[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&se.Z.h.call(this)}}oe.prototype.h=function(){this.defaultPrevented=!0},_t(se,oe);var ae={2:"touch",3:"pen",4:"mouse"};se.prototype.h=function(){se.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),ce=0;function he(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++ce,this.ca=this.fa=!1}function le(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function fe(t){this.src=t,this.g={},this.h=0}function de(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=xt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(le(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function pe(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}fe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=pe(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new he(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var ge="closure_lm_"+(1e6*Math.random()|0),ye={};function ve(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ee(r),e&&e[ue]?e.O(n,r,mt(i)?!!i.capture:!!i,o):me(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)ve(t,e[o],n,r,i);return null}return n=Ee(n),t&&t[ue]?t.N(e,n,mt(r)?!!r.capture:!!r,i):me(t,e,n,!1,r,i)}function me(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=mt(i)?!!i.capture:!!i,a=Oe(t);if(a||(t[ge]=a=new fe(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Ie;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ie||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(we(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function be(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[ue])de(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(we(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Oe(e))?(de(n,t),0==n.h&&(n.src=null,e[ge]=null)):le(t)}}}function we(t){return t in ye?ye[t]:ye[t]="on"+t}function Ie(t,e){if(t.ca)t=!0;else{e=new se(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&be(t),t=n.call(r,e)}return t}function Oe(t){return(t=t[ge])instanceof fe?t:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ee(t){return"function"==typeof t?t:(t[Te]||(t[Te]=function(e){return t.handleEvent(e)}),t[Te])}function _e(){St.call(this),this.i=new fe(this),this.P=this,this.I=null}function Se(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new oe(e,t);else if(e instanceof oe)e.target=e.target||t;else{var i=e;Bt(e=new oe(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=ke(s,r,!0,e)&&i}if(i=ke(s=e.g=t,r,!0,e)&&i,i=ke(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=ke(s=e.g=n[o],r,!1,e)&&i}function ke(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&de(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}_t(_e,St),_e.prototype[ue]=!0,_e.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=mt(i)?!!i.capture:!!i,r=Ee(r),e&&e[ue]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=pe(s=e.g[n],r,i,o))&&(le(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):e&&(e=Oe(e))&&(n=e.g[n.toString()],e=-1,n&&(e=pe(n,r,i,o)),(r=-1<e?n[e]:null)&&be(r))}(this,t,e,n,r)},_e.prototype.M=function(){if(_e.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)le(n[r]);delete e.g[t],e.h--}}this.I=null},_e.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},_e.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var xe=gt.JSON.stringify;function Ne(){var t=Fe,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ce,je=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=De.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),De=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())((function(){return new Ae}),(function(t){return t.reset()})),Ae=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Re(t){gt.setTimeout((function(){throw t}),0)}function Pe(t,e){Ce||function(){var t=gt.Promise.resolve(void 0);Ce=function(){t.then(Me)}}(),Le||(Ce(),Le=!0),Fe.add(t,e)}var Le=!1,Fe=new je;function Me(){for(var t;t=Ne();){try{t.h.call(t.g)}catch(n){Re(n)}var e=De;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Le=!1}function Ve(t,e){_e.call(this),this.h=t||1,this.g=e||gt,this.j=Tt(this.kb,this),this.l=Date.now()}function Ue(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function qe(t,e,n){if("function"==typeof t)n&&(t=Tt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Tt(t.handleEvent,t)}return 2147483647<Number(e)?-1:gt.setTimeout(t,e||0)}function Be(t){t.g=qe((function(){t.g=null,t.i&&(t.i=!1,Be(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}_t(Ve,_e),(ft=Ve.prototype).da=!1,ft.S=null,ft.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Se(this,"tick"),this.da&&(Ue(this),this.start()))}},ft.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ft.M=function(){Ve.Z.M.call(this),Ue(this),delete this.g};var Ke=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}ht(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Be(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(gt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(St);function Ge(t){St.call(this),this.h=t,this.g={}}_t(Ge,St);var ze=[];function Qe(t,e,n,r){Array.isArray(n)||(n&&(ze[0]=n.toString()),n=ze);for(var i=0;i<n.length;i++){var o=ve(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function We(t){Vt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&be(t)}),t),t.g={}}function He(){this.g=!0}function Ye(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return xe(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Ge.prototype.M=function(){Ge.Z.M.call(this),We(this)},Ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},He.prototype.Aa=function(){this.g=!1},He.prototype.info=function(){};var Xe={},Je=null;function $e(){return Je=Je||new _e}function Ze(t){oe.call(this,Xe.Ma,t)}function tn(t){var e=$e();Se(e,new Ze(e,t))}function en(t,e){oe.call(this,Xe.STAT_EVENT,t),this.stat=e}function nn(t){var e=$e();Se(e,new en(e,t))}function rn(t,e){oe.call(this,Xe.Na,t),this.size=e}function on(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return gt.setTimeout((function(){t()}),e)}Xe.Ma="serverreachability",_t(Ze,oe),Xe.STAT_EVENT="statevent",_t(en,oe),Xe.Na="timingevent",_t(rn,oe);var sn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},an={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function un(){}function cn(){}un.prototype.h=null;var hn,ln={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function fn(){oe.call(this,"d")}function dn(){oe.call(this,"c")}function pn(){}function gn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Ge(this),this.P=vn,this.W=new Ve(t=Yt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new yn}function yn(){this.i=null,this.g="",this.h=!1}_t(fn,oe),_t(dn,oe),_t(pn,un),pn.prototype.g=function(){return new XMLHttpRequest},pn.prototype.i=function(){return{}},hn=new pn;var vn=45e3,mn={},bn={};function wn(t,e,n){t.K=1,t.v=Kn(Fn(e)),t.s=n,t.U=!0,In(t,null)}function In(t,e){t.F=Date.now(),_n(t),t.A=Fn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),nr(n.h,"t",r),t.C=0,n=t.l.H,t.h=new yn,t.g=ri(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Ke(Tt(t.Ia,t,t.g),t.O)),Qe(t.V,t.g,"readystatechange",t.gb),e=t.H?Ut(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),tn(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function On(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Tn(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=En(t,n))==bn){4==e&&(t.o=4,nn(14),i=!1),Ye(t.j,t.m,null,"[Incomplete Response]");break}if(r==mn){t.o=4,nn(15),Ye(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Ye(t.j,t.m,r,null),Cn(t,r)}On(t)&&r!=bn&&r!=mn&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,nn(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Yr(e),e.L=!0,nn(11))):(Ye(t.j,t.m,n,"[Invalid Chunked Response]"),Nn(t),xn(t))}function En(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?bn:(n=Number(e.substring(n,r)),isNaN(n)?mn:(r+=1)+n>e.length?bn:(e=e.substr(r,n),t.C=r+n,e))}function _n(t){t.Y=Date.now()+t.P,Sn(t,t.P)}function Sn(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=on(Tt(t.eb,t),e)}function kn(t){t.B&&(gt.clearTimeout(t.B),t.B=null)}function xn(t){0==t.l.G||t.I||$r(t.l,t)}function Nn(t){kn(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Ue(t.W),We(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Cn(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||cr(n.i,t)))if(n.I=t.N,!t.J&&cr(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Jr(n),Ur(n)}Hr(n),nn(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=on(Tt(n.ab,n),6e3));if(1>=ur(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else ti(n,11)}else if((t.J||n.g==t)&&Jr(n),!Dt(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Pt(h,"spdy")||Pt(h,"quic")||Pt(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(hr(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Bn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=ni(r,r.H?r.la:null,r.W),d.J){lr(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(kn(p),_n(p)),r.g=d}else Wr(r);0<n.l.length&&Kr(n)}else"stop"!=o[0]&&"close"!=o[0]||ti(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?ti(n,7):Vr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}tn(4)}catch(o){}}function jn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(vt(t)||"string"==typeof t)Nt(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(vt(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(vt(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Dn(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Dn)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function An(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Rn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Rn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Rn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(ft=gn.prototype).setTimeout=function(t){this.P=t},ft.gb=function(t){t=t.target;var e=this.L;e&&3==Rr(t)?e.l():this.Ia(t)},ft.Ia=function(t){try{if(t==this.g)t:{var e=Rr(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||Yt||this.g&&(this.h.h||this.g.ga()||Pr(this.g)))){this.I||4!=e||7==n||tn(8==n||0>=r?3:2),kn(this);var i=this.g.ba();this.N=i;e:if(On(this)){var o=Pr(this.g);t="";var s=o.length,a=4==Rr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Nn(this),xn(this);var u="";break e}this.h.i=new gt.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Dt(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,nn(12),Nn(this),xn(this);break t}Ye(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Cn(this,i)}this.U?(Tn(this,e,u),Yt&&this.i&&3==e&&(Qe(this.V,this.W,"tick",this.fb),this.W.start())):(Ye(this.j,this.m,u,null),Cn(this,u)),4==e&&Nn(this),this.i&&!this.I&&(4==e?$r(this.l,this):(this.i=!1,_n(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,nn(12)):(this.o=0,nn(13)),Nn(this),xn(this)}}}catch(e){}},ft.fb=function(){if(this.g){var t=Rr(this.g),e=this.g.ga();this.C<e.length&&(kn(this),Tn(this,t,e),this.i&&4!=t&&_n(this))}},ft.cancel=function(){this.I=!0,Nn(this)},ft.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(tn(3),nn(17)),Nn(this),this.o=2,xn(this)):Sn(this,this.Y-t)},(ft=Dn.prototype).R=function(){An(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},ft.T=function(){return An(this),this.g.concat()},ft.get=function(t,e){return Rn(this.h,t)?this.h[t]:e},ft.set=function(t,e){Rn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},ft.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Pn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ln(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Ln){this.g=void 0!==e?e:t.g,Mn(this,t.j),this.s=t.s,Vn(this,t.i),Un(this,t.m),this.l=t.l,e=t.h;var n=new $n;n.i=e.i,e.g&&(n.g=new Dn(e.g),n.h=e.h),qn(this,n),this.o=t.o}else t&&(n=String(t).match(Pn))?(this.g=!!e,Mn(this,n[1]||"",!0),this.s=Gn(n[2]||""),Vn(this,n[3]||"",!0),Un(this,n[4]),this.l=Gn(n[5]||"",!0),qn(this,n[6]||"",!0),this.o=Gn(n[7]||"")):(this.g=!!e,this.h=new $n(null,this.g))}function Fn(t){return new Ln(t)}function Mn(t,e,n){t.j=n?Gn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Vn(t,e,n){t.i=n?Gn(e,!0):e}function Un(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function qn(t,e,n){e instanceof $n?(t.h=e,function(t,e){e&&!t.j&&(Zn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(tr(this,e),nr(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=zn(e,Xn)),t.h=new $n(e,t.g))}function Bn(t,e,n){t.h.set(e,n)}function Kn(t){return Bn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Gn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function zn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Qn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Qn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ln.prototype.toString=function(){var t=[],e=this.j;e&&t.push(zn(e,Wn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(zn(e,Wn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(zn(n,"/"==n.charAt(0)?Yn:Hn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",zn(n,Jn)),t.join("")};var Wn=/[#\/\?@]/g,Hn=/[#\?:]/g,Yn=/[#\?]/g,Xn=/[#\?@]/g,Jn=/#/g;function $n(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Zn(t){t.g||(t.g=new Dn,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function tr(t,e){Zn(t),e=rr(t,e),Rn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Rn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&An(t)))}function er(t,e){return Zn(t),e=rr(t,e),Rn(t.g.h,e)}function nr(t,e,n){tr(t,e),0<n.length&&(t.i=null,t.g.set(rr(t,e),jt(n)),t.h+=n.length)}function rr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(ft=$n.prototype).add=function(t,e){Zn(this),this.i=null,t=rr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},ft.forEach=function(t,e){Zn(this),this.g.forEach((function(n,r){Nt(n,(function(n){t.call(e,n,r,this)}),this)}),this)},ft.T=function(){Zn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},ft.R=function(t){Zn(this);var e=[];if("string"==typeof t)er(this,t)&&(e=Ct(e,this.g.get(rr(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Ct(e,t[n])}return e},ft.set=function(t,e){return Zn(this),this.i=null,er(this,t=rr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},ft.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},ft.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var ir=function(t,e){this.h=t,this.g=e};function or(t){this.l=t||sr,t=gt.PerformanceNavigationTiming?0<(t=gt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(gt.g&&gt.g.Ea&&gt.g.Ea()&&gt.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var sr=10;function ar(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ur(t){return t.h?1:t.g?t.g.size:0}function cr(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function hr(t,e){t.g?t.g.add(e):t.h=e}function lr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function fr(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=lt(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return jt(t.i)}function dr(){}function pr(){this.g=new dr}function gr(t,e,n){var r=n||"";try{jn(t,(function(t,n){var i=t;mt(t)&&(i=xe(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(Op){throw e.push(r+"type="+encodeURIComponent("_badmap")),Op}}function yr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function vr(t){this.l=t.$b||null,this.j=t.ib||!1}function mr(t,e){_e.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=br,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}or.prototype.cancel=function(){var t,e;if(this.i=fr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=lt(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},dr.prototype.stringify=function(t){return gt.JSON.stringify(t,void 0)},dr.prototype.parse=function(t){return gt.JSON.parse(t,void 0)},_t(vr,un),vr.prototype.g=function(){return new mr(this.l,this.j)},vr.prototype.i=function(t){return function(){return t}}({}),_t(mr,_e);var br=0;function wr(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Ir(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Or(t)}function Or(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(ft=mr.prototype).open=function(t,e){if(this.readyState!=br)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Or(this)},ft.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||gt).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},ft.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ir(this)),this.readyState=br},ft.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Or(this)),this.g&&(this.readyState=3,Or(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==gt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;wr(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},ft.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ir(this):Or(this),3==this.readyState&&wr(this)}},ft.Ua=function(t){this.g&&(this.response=this.responseText=t,Ir(this))},ft.Ta=function(t){this.g&&(this.response=t,Ir(this))},ft.ha=function(){this.g&&Ir(this)},ft.setRequestHeader=function(t,e){this.v.append(t,e)},ft.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},ft.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(mr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Tr=gt.JSON.parse;function Er(t){_e.call(this),this.headers=new Dn,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=_r,this.K=this.L=!1}_t(Er,_e);var _r="",Sr=/^https?$/i,kr=["POST","PUT"];function xr(t){return"content-type"==t.toLowerCase()}function Nr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Cr(t),Dr(t)}function Cr(t){t.D||(t.D=!0,Se(t,"complete"),Se(t,"error"))}function jr(t){if(t.h&&void 0!==pt&&(!t.C[1]||4!=Rr(t)||2!=t.ba()))if(t.v&&4==Rr(t))qe(t.Fa,0,t);else if(Se(t,"readystatechange"),4==Rr(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(Pn)[1]||null;if(!o&&gt.self&&gt.self.location){var s=gt.self.location.protocol;o=s.substr(0,s.length-1)}i=!Sr.test(o?o.toLowerCase():"")}e=i}if(e)Se(t,"complete"),Se(t,"success");else{t.m=6;try{var a=2<Rr(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",Cr(t)}}finally{Dr(t)}}}function Dr(t,e){if(t.g){Ar(t);var n=t.g,r=t.C[0]?yt:null;t.g=null,t.C=null,e||Se(t,"ready");try{n.onreadystatechange=r}catch(Op){}}}function Ar(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(gt.clearTimeout(t.A),t.A=null)}function Rr(t){return t.g?t.g.readyState:0}function Pr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case _r:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Lr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Vt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Bn(t,e,n))}function Fr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Mr(t){this.za=0,this.l=[],this.h=new He,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Fr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Fr("baseRetryDelayMs",5e3,t),this.$a=Fr("retryDelaySeedMs",1e4,t),this.Ya=Fr("forwardChannelMaxRetries",2,t),this.ra=Fr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new or(t&&t.concurrentRequestLimit),this.Ca=new pr,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Vr(t){if(qr(t),3==t.G){var e=t.V++,n=Fn(t.F);Bn(n,"SID",t.J),Bn(n,"RID",e),Bn(n,"TYPE","terminate"),zr(t,n),(e=new gn(t,t.h,e,void 0)).K=2,e.v=Kn(Fn(n)),n=!1,gt.navigator&&gt.navigator.sendBeacon&&(n=gt.navigator.sendBeacon(e.v.toString(),"")),!n&&gt.Image&&((new Image).src=e.v,n=!0),n||(e.g=ri(e.l,null),e.g.ea(e.v)),e.F=Date.now(),_n(e)}ei(t)}function Ur(t){t.g&&(Yr(t),t.g.cancel(),t.g=null)}function qr(t){Ur(t),t.u&&(gt.clearTimeout(t.u),t.u=null),Jr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&gt.clearTimeout(t.m),t.m=null)}function Br(t,e){t.l.push(new ir(t.Za++,e)),3==t.G&&Kr(t)}function Kr(t){ar(t.i)||t.m||(t.m=!0,Pe(t.Ha,t),t.C=0)}function Gr(t,e){var n;n=e?e.m:t.V++;var r=Fn(t.F);Bn(r,"SID",t.J),Bn(r,"RID",n),Bn(r,"AID",t.U),zr(t,r),t.o&&t.s&&Lr(r,t.o,t.s),n=new gn(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Qr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),hr(t.i,n),wn(n,r,e)}function zr(t,e){t.j&&jn({},(function(t,n){Bn(e,n,t)}))}function Qr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?Tt(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{gr(h,s,"req"+c+"_")}catch(Pi){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Wr(t){t.g||t.u||(t.Y=1,Pe(t.Ga,t),t.A=0)}function Hr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=on(Tt(t.Ga,t),Zr(t,t.A)),t.A++,0))}function Yr(t){null!=t.B&&(gt.clearTimeout(t.B),t.B=null)}function Xr(t){t.g=new gn(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Fn(t.oa);Bn(e,"RID","rpc"),Bn(e,"SID",t.J),Bn(e,"CI",t.N?"0":"1"),Bn(e,"AID",t.U),zr(t,e),Bn(e,"TYPE","xmlhttp"),t.o&&t.s&&Lr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Kn(Fn(e)),n.s=null,n.U=!0,In(n,t)}function Jr(t){null!=t.v&&(gt.clearTimeout(t.v),t.v=null)}function $r(t,e){var n=null;if(t.g==e){Jr(t),Yr(t),t.g=null;var r=2}else{if(!cr(t.i,e))return;n=e.D,lr(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Se(r=$e(),new rn(r,n,e,i)),Kr(t)}else Wr(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(ur(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=on(Tt(t.Ha,t,e),Zr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Hr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:ti(t,5);break;case 4:ti(t,10);break;case 3:ti(t,6);break;default:ti(t,2)}}function Zr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function ti(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=Tt(t.jb,t);n||(n=new Ln("//www.google.com/images/cleardot.gif"),gt.location&&"http"==gt.location.protocol||Mn(n,"https"),Kn(n)),function(t,e){var n=new He;if(gt.Image){var r=new Image;r.onload=Et(yr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Et(yr,n,r,"TestLoadImage: error",!1,e),r.onabort=Et(yr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Et(yr,n,r,"TestLoadImage: timeout",!1,e),gt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else nn(2);t.G=0,t.j&&t.j.va(e),ei(t),qr(t)}function ei(t){t.G=0,t.I=-1,t.j&&(0==fr(t.i).length&&0==t.l.length||(t.i.i.length=0,jt(t.l),t.l.length=0),t.j.ua())}function ni(t,e,n){var r=function(t){return t instanceof Ln?Fn(t):new Ln(t,void 0)}(n);if(""!=r.i)e&&Vn(r,e+"."+r.i),Un(r,r.m);else{var i=gt.location;r=function(t,e,n,r){var i=new Ln(null,void 0);return t&&Mn(i,t),e&&Vn(i,e),n&&Un(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&Vt(t.aa,(function(t,e){Bn(r,e,t)})),n=t.sa,(e=t.D)&&n&&Bn(r,e,n),Bn(r,"VER",t.ma),zr(t,r),r}function ri(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Er(n&&t.Ba&&!t.qa?new vr({ib:!0}):t.qa)).L=t.H,e}function ii(){}function oi(){if(Wt&&!(10<=Number(re)))throw Error("Environmental error: no available transport.")}function si(t,e){_e.call(this),this.g=new Mr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Dt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Dt(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new ci(this)}function ai(t){fn.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ui(){dn.call(this),this.status=1}function ci(t){this.g=t}(ft=Er.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():hn.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:hn),this.g.onreadystatechange=Tt(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Nr(this,o)}t=n||"";var i=new Dn(this.headers);r&&jn(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=xr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=gt.FormData&&t instanceof gt.FormData,!(0<=xt(kr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ar(this),0<this.B&&((this.K=function(t){return Wt&&function(){return t=ne,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=Rt(String(Gt)).split("."),n=Rt("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Lt(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Lt(0==o[2].length,0==s[2].length)||Lt(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Tt(this.pa,this)):this.A=qe(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Nr(this,o)}},ft.pa=function(){void 0!==pt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Se(this,"timeout"),this.abort(8))},ft.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Se(this,"complete"),Se(this,"abort"),Dr(this))},ft.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Dr(this,!0)),Er.Z.M.call(this)},ft.Fa=function(){this.s||(this.F||this.v||this.l?jr(this):this.cb())},ft.cb=function(){jr(this)},ft.ba=function(){try{return 2<Rr(this)?this.g.status:-1}catch(zt){return-1}},ft.ga=function(){try{return this.g?this.g.responseText:""}catch(zt){return""}},ft.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Tr(e)}},ft.Da=function(){return this.m},ft.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(ft=Mr.prototype).ma=8,ft.G=1,ft.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},ft.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new gn(this,this.h,t,void 0),n=this.s;if(this.P&&(n?Bt(n=Ut(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Qr(this,e,r),Bn(i=Fn(this.F),"RID",t),Bn(i,"CVER",22),this.D&&Bn(i,"X-HTTP-Session-Id",this.D),zr(this,i),this.o&&n&&Lr(i,this.o,n),hr(this.i,e),this.Ra&&Bn(i,"TYPE","init"),this.ja?(Bn(i,"$req",r),Bn(i,"SID","null"),e.$=!0,wn(e,i,null)):wn(e,i,r),this.G=2}}else 3==this.G&&(t?Gr(this,t):0==this.l.length||ar(this.i)||Gr(this))},ft.Ga=function(){if(this.u=null,Xr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=on(Tt(this.bb,this),t)}},ft.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,nn(10),Ur(this),Xr(this))},ft.ab=function(){null!=this.v&&(this.v=null,Ur(this),Hr(this),nn(19))},ft.jb=function(t){t?(this.h.info("Successfully pinged google.com"),nn(2)):(this.h.info("Failed to ping google.com"),nn(1))},(ft=ii.prototype).xa=function(){},ft.wa=function(){},ft.va=function(){},ft.ua=function(){},ft.Oa=function(){},oi.prototype.g=function(t,e){return new si(t,e)},_t(si,_e),si.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Pe(Tt(t.hb,t,e))),nn(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=ni(t,null,t.W),Kr(t)},si.prototype.close=function(){Vr(this.g)},si.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Br(this.g,e)}else this.v?((e={}).__data__=xe(t),Br(this.g,e)):Br(this.g,t)},si.prototype.M=function(){this.g.j=null,delete this.j,Vr(this.g),delete this.g,si.Z.M.call(this)},_t(ai,fn),_t(ui,dn),_t(ci,ii),ci.prototype.xa=function(){Se(this.g,"a")},ci.prototype.wa=function(t){Se(this.g,new ai(t))},ci.prototype.va=function(t){Se(this.g,new ui(t))},ci.prototype.ua=function(){Se(this.g,"b")},oi.prototype.createWebChannel=oi.prototype.g,si.prototype.send=si.prototype.u,si.prototype.open=si.prototype.m,si.prototype.close=si.prototype.close,sn.NO_ERROR=0,sn.TIMEOUT=8,sn.HTTP_ERROR=6,an.COMPLETE="complete",cn.EventType=ln,ln.OPEN="a",ln.CLOSE="b",ln.ERROR="c",ln.MESSAGE="d",_e.prototype.listen=_e.prototype.N,Er.prototype.listenOnce=Er.prototype.O,Er.prototype.getLastError=Er.prototype.La,Er.prototype.getLastErrorCode=Er.prototype.Da,Er.prototype.getStatus=Er.prototype.ba,Er.prototype.getResponseJson=Er.prototype.Qa,Er.prototype.getResponseText=Er.prototype.ga,Er.prototype.send=Er.prototype.ea;var hi=sn,li=an,fi=Xe,di=vr,pi=cn,gi=Er,yi=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();yi.o=-1;var vi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},mi=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(at.c)(e,t),e}(Error),bi=new ct.b("@firebase/firestore");function wi(){return bi.logLevel}function Ii(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(bi.logLevel<=ct.a.DEBUG){var r=e.map(Ei);bi.debug.apply(bi,Object(at.f)(["Firestore (8.10.1): "+t],r))}}function Oi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(bi.logLevel<=ct.a.ERROR){var r=e.map(Ei);bi.error.apply(bi,Object(at.f)(["Firestore (8.10.1): "+t],r))}}function Ti(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(bi.logLevel<=ct.a.WARN){var r=e.map(Ei);bi.warn.apply(bi,Object(at.f)(["Firestore (8.10.1): "+t],r))}}function Ei(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Op){return t}}function _i(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw Oi(e),new Error(e)}function Si(t,e){t||_i()}function ki(t,e){return t}function xi(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Ni=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=xi(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Ci(t,e){return t<e?-1:t>e?1:0}function ji(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Di(t){return t+"\0"}var Ai=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new mi(vi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new mi(vi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new mi(vi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new mi(vi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Ci(this.nanoseconds,t.nanoseconds):Ci(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Ri=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Ai(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Pi(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Li(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Fi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Mi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&_i(),void 0===n?n=t.length-e:n>t.length-e&&_i(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Vi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new mi(vi.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Mi),Ui=/^[_a-zA-Z][_a-zA-Z0-9]*$/,qi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Ui.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new mi(vi.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new mi(vi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new mi(vi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new mi(vi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Mi),Bi=function(){function t(t){this.fields=t,t.sort(qi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return ji(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Ki=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Ci(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Ki.EMPTY_BYTE_STRING=new Ki("");var Gi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zi(t){if(Si(!!t),"string"==typeof t){var e=0,n=Gi.exec(t);if(Si(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Qi(t.seconds),nanos:Qi(t.nanos)}}function Qi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Wi(t){return"string"==typeof t?Ki.fromBase64String(t):Ki.fromUint8Array(t)}function Hi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Yi(t){var e=zi(t.mapValue.fields.__local_write_time__.timestampValue);return new Ai(e.seconds,e.nanos)}function Xi(t){return null==t}function Ji(t){return 0===t&&1/t==-1/0}function $i(t){return"number"==typeof t&&Number.isInteger(t)&&!Ji(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Zi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Vi.fromString(e))},t.fromName=function(e){return new t(Vi.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Vi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Vi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Vi(e.slice()))},t}();function to(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Hi(t)?4:10:_i()}function eo(t,e){var n=to(t);if(n!==to(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Yi(t).isEqual(Yi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=zi(t.timestampValue),r=zi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Wi(t.bytesValue).isEqual(Wi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Qi(t.geoPointValue.latitude)===Qi(e.geoPointValue.latitude)&&Qi(t.geoPointValue.longitude)===Qi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Qi(t.integerValue)===Qi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Qi(t.doubleValue),r=Qi(e.doubleValue);return n===r?Ji(n)===Ji(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ji(t.arrayValue.values||[],e.arrayValue.values||[],eo);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Pi(n)!==Pi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!eo(n[i],r[i])))return!1;return!0}(t,e);default:return _i()}}function no(t,e){return void 0!==(t.values||[]).find((function(t){return eo(t,e)}))}function ro(t,e){var n=to(t),r=to(e);if(n!==r)return Ci(n,r);switch(n){case 0:return 0;case 1:return Ci(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Qi(t.integerValue||t.doubleValue),r=Qi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return io(t.timestampValue,e.timestampValue);case 4:return io(Yi(t),Yi(e));case 5:return Ci(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Wi(t),r=Wi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ci(n[i],r[i]);if(0!==o)return o}return Ci(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Ci(Qi(t.latitude),Qi(e.latitude));return 0!==n?n:Ci(Qi(t.longitude),Qi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ro(n[i],r[i]);if(o)return o}return Ci(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Ci(r[s],o[s]);if(0!==a)return a;var u=ro(n[r[s]],i[o[s]]);if(0!==u)return u}return Ci(r.length,o.length)}(t.mapValue,e.mapValue);default:throw _i()}}function io(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ci(t,e);var n=zi(t),r=zi(e),i=Ci(n.seconds,r.seconds);return 0!==i?i:Ci(n.nanos,r.nanos)}function oo(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=zi(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Wi(e.bytesValue).toBase64():"referenceValue"in e?Zi.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):_i();var n}(t)}function so(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function ao(t){return!!t&&"integerValue"in t}function uo(t){return!!t&&"arrayValue"in t}function co(t){return!!t&&"nullValue"in t}function ho(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function lo(t){return!!t&&"mapValue"in t}function fo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Li(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=fo(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=fo(t.arrayValue.values[r]);return n}return Object.assign({},t)}var po=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!lo(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=fo(e)},t.prototype.setAll=function(t){var e=this,n=qi.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=fo(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());lo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return eo(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];lo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Li(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(fo(this.value))},t}();function go(t){var e=[];return Li(t.fields,(function(t,n){var r=new qi([t]);if(lo(n)){var i=go(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)})),new Bi(e)}var yo=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Ri.min(),po.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,po.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,po.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=po.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=po.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),vo=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function mo(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new vo(t,e,n,r,i,o,s)}function bo(t){var e=ki(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+oo(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),Xi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Do(e.startAt)),e.endAt&&(n+="|ub:",n+=Do(e.endAt)),e.h=n}return e.h}function wo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ro(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!eo(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Lo(t.startAt,e.startAt)&&Lo(t.endAt,e.endAt)}function Io(t){return Zi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Oo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(at.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new To(t,n,r):"array-contains"===n?new ko(t,r):"in"===n?new xo(t,r):"not-in"===n?new No(t,r):"array-contains-any"===n?new Co(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Eo(t,n):new _o(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(ro(e,this.value)):null!==e&&to(this.value)===to(e)&&this.m(ro(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _i()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),To=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Zi.fromName(r.referenceValue),i}return Object(at.c)(e,t),e.prototype.matches=function(t){var e=Zi.comparator(t.key,this.key);return this.m(e)},e}(Oo),Eo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=So(0,n),r}return Object(at.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Oo),_o=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=So(0,n),r}return Object(at.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Oo);function So(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Zi.fromName(t.referenceValue)}))}var ko=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(at.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return uo(e)&&no(e.arrayValue,this.value)},e}(Oo),xo=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(at.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&no(this.value.arrayValue,e)},e}(Oo),No=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(at.c)(e,t),e.prototype.matches=function(t){if(no(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!no(this.value.arrayValue,e)},e}(Oo),Co=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(at.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!uo(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return no(e.value.arrayValue,t)}))},e}(Oo),jo=function(t,e){this.position=t,this.before=e};function Do(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return oo(t)})).join(",")}var Ao=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ro(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Po(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Zi.comparator(Zi.fromName(s.referenceValue),n.key):ro(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Lo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!eo(t.position[n],e.position[n]))return!1;return!0}var Fo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Mo(t,e,n,r,i,o,s,a){return new Fo(t,e,n,r,i,o,s,a)}function Vo(t){return new Fo(t)}function Uo(t){return!Xi(t.limit)&&"F"===t.limitType}function qo(t){return!Xi(t.limit)&&"L"===t.limitType}function Bo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ko(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Go(t){return null!==t.collectionGroup}function zo(t){var e=ki(t);if(null===e.p){e.p=[];var n=Ko(e),r=Bo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Ao(n)),e.p.push(new Ao(qi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Ao(qi.keyField(),u))}}}return e.p}function Qo(t){var e=ki(t);if(!e.T)if("F"===e.limitType)e.T=mo(e.path,e.collectionGroup,zo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=zo(e);r<i.length;r++){var o=i[r];n.push(new Ao(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new jo(e.endAt.position,!e.endAt.before):null,a=e.startAt?new jo(e.startAt.position,!e.startAt.before):null;e.T=mo(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Wo(t,e,n){return new Fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ho(t,e){return wo(Qo(t),Qo(e))&&t.limitType===e.limitType}function Yo(t){return bo(Qo(t))+"|lt:"+t.limitType}function Xo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+oo(e.value);var e})).join(", ")+"]"),Xi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Do(t.startAt)),t.endAt&&(e+=", endAt: "+Do(t.endAt)),"Target("+e+")"}(Qo(t))+"; limitType="+t.limitType+")"}function Jo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Zi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Po(t.startAt,zo(t),e)||t.endAt&&Po(t.endAt,zo(t),e))}(t,e)}function $o(t){return function(e,n){for(var r=!1,i=0,o=zo(t);i<o.length;i++){var s=o[i],a=Zo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Zo(t,e,n){var r=t.field.isKeyField()?Zi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?ro(r,i):_i()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return _i()}}function ts(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ji(e)?"-0":e}}function es(t){return{integerValue:""+t}}function ns(t,e){return $i(e)?es(e):ts(t,e)}var rs=function(){this._=void 0};function is(t,e,n){return t instanceof as?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof us?cs(t,e):t instanceof hs?ls(t,e):function(t,e){var n=ss(t,e),r=ds(n)+ds(t.A);return ao(n)&&ao(t.A)?es(r):ts(t.R,r)}(t,e)}function os(t,e,n){return t instanceof us?cs(t,e):t instanceof hs?ls(t,e):n}function ss(t,e){return t instanceof fs?ao(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var as=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e}(rs),us=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(at.c)(e,t),e}(rs);function cs(t,e){for(var n=ps(e),r=function(t){n.some((function(e){return eo(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var hs=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(at.c)(e,t),e}(rs);function ls(t,e){for(var n=ps(e),r=function(t){n=n.filter((function(e){return!eo(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var fs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(at.c)(e,t),e}(rs);function ds(t){return Qi(t.integerValue||t.doubleValue)}function ps(t){return uo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var gs=function(t,e){this.field=t,this.transform=e},ys=function(t,e){this.version=t,this.transformResults=e},vs=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ms(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var bs=function(){};function ws(t,e,n){t instanceof _s?function(t,e,n){var r=t.value.clone(),i=xs(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ss?function(t,e,n){if(ms(t.precondition,e)){var r=xs(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ks(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Is(t,e,n){t instanceof _s?function(t,e,n){if(ms(t.precondition,e)){var r=t.value.clone(),i=Ns(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Es(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Ss?function(t,e,n){if(ms(t.precondition,e)){var r=Ns(t.fieldTransforms,n,e),i=e.data;i.setAll(ks(t)),i.setAll(r),e.convertToFoundDocument(Es(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){ms(t.precondition,e)&&e.convertToNoDocument(Ri.min())}(t,e)}function Os(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=ss(o.transform,s||null);null!=a&&(null==n&&(n=po.empty()),n.set(o.field,a))}return n||null}function Ts(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ji(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof us&&e instanceof us||t instanceof hs&&e instanceof hs?ji(t.elements,e.elements,eo):t instanceof fs&&e instanceof fs?eo(t.A,e.A):t instanceof as&&e instanceof as}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Es(t){return t.isFoundDocument()?t.version:Ri.min()}var _s=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(at.c)(e,t),e}(bs),Ss=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(at.c)(e,t),e}(bs);function ks(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function xs(t,e,n){var r=new Map;Si(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,os(s,a,n[i]))}return r}function Ns(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,is(a,u,e))}return r}var Cs,js,Ds=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(at.c)(e,t),e}(bs),As=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(at.c)(e,t),e}(bs),Rs=function(t){this.count=t};function Ps(t){switch(t){case vi.OK:return _i();case vi.CANCELLED:case vi.UNKNOWN:case vi.DEADLINE_EXCEEDED:case vi.RESOURCE_EXHAUSTED:case vi.INTERNAL:case vi.UNAVAILABLE:case vi.UNAUTHENTICATED:return!1;case vi.INVALID_ARGUMENT:case vi.NOT_FOUND:case vi.ALREADY_EXISTS:case vi.PERMISSION_DENIED:case vi.FAILED_PRECONDITION:case vi.ABORTED:case vi.OUT_OF_RANGE:case vi.UNIMPLEMENTED:case vi.DATA_LOSS:return!0;default:return _i()}}function Ls(t){if(void 0===t)return Oi("GRPC error has no .code"),vi.UNKNOWN;switch(t){case Cs.OK:return vi.OK;case Cs.CANCELLED:return vi.CANCELLED;case Cs.UNKNOWN:return vi.UNKNOWN;case Cs.DEADLINE_EXCEEDED:return vi.DEADLINE_EXCEEDED;case Cs.RESOURCE_EXHAUSTED:return vi.RESOURCE_EXHAUSTED;case Cs.INTERNAL:return vi.INTERNAL;case Cs.UNAVAILABLE:return vi.UNAVAILABLE;case Cs.UNAUTHENTICATED:return vi.UNAUTHENTICATED;case Cs.INVALID_ARGUMENT:return vi.INVALID_ARGUMENT;case Cs.NOT_FOUND:return vi.NOT_FOUND;case Cs.ALREADY_EXISTS:return vi.ALREADY_EXISTS;case Cs.PERMISSION_DENIED:return vi.PERMISSION_DENIED;case Cs.FAILED_PRECONDITION:return vi.FAILED_PRECONDITION;case Cs.ABORTED:return vi.ABORTED;case Cs.OUT_OF_RANGE:return vi.OUT_OF_RANGE;case Cs.UNIMPLEMENTED:return vi.UNIMPLEMENTED;case Cs.DATA_LOSS:return vi.DATA_LOSS;default:return _i()}}(js=Cs||(Cs={}))[js.OK=0]="OK",js[js.CANCELLED=1]="CANCELLED",js[js.UNKNOWN=2]="UNKNOWN",js[js.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",js[js.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",js[js.NOT_FOUND=5]="NOT_FOUND",js[js.ALREADY_EXISTS=6]="ALREADY_EXISTS",js[js.PERMISSION_DENIED=7]="PERMISSION_DENIED",js[js.UNAUTHENTICATED=16]="UNAUTHENTICATED",js[js.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",js[js.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",js[js.ABORTED=10]="ABORTED",js[js.OUT_OF_RANGE=11]="OUT_OF_RANGE",js[js.UNIMPLEMENTED=12]="UNIMPLEMENTED",js[js.INTERNAL=13]="INTERNAL",js[js.UNAVAILABLE=14]="UNAVAILABLE",js[js.DATA_LOSS=15]="DATA_LOSS";var Fs=function(){function t(t,e){this.comparator=t,this.root=e||Vs.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Vs.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vs.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ms(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ms(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ms(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ms(this.root,t,this.comparator,!0)},t}(),Ms=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Vs=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw _i();if(this.right.isRed())throw _i();var t=this.left.check();if(t!==this.right.check())throw _i();return t+(this.isRed()?0:1)},t}();Vs.EMPTY=null,Vs.RED=!0,Vs.BLACK=!1,Vs.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw _i()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw _i()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw _i()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw _i()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw _i()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Vs(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Us=function(){function t(t){this.comparator=t,this.data=new Fs(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new qs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new qs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),qs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Bs=new Fs(Zi.comparator);function Ks(){return Bs}var Gs=new Fs(Zi.comparator);function zs(){return Gs}var Qs=new Fs(Zi.comparator);function Ws(){return Qs}var Hs=new Us(Zi.comparator);function Ys(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Hs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Xs=new Us(Ci);function Js(){return Xs}var $s=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Zs.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Ri.min(),r,Js(),Ks(),Ys())},t}(),Zs=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Ki.EMPTY_BYTE_STRING,n,Ys(),Ys(),Ys())},t}(),ta=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ea=function(t,e){this.targetId=t,this.V=e},na=function(t,e,n,r){void 0===n&&(n=Ki.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ra=function(){function t(){this.S=0,this.D=sa(),this.C=Ki.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=Ys(),e=Ys(),n=Ys();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:_i()}})),new Zs(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=sa()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),ia=function(){function t(t){this.W=t,this.G=new Map,this.H=Ks(),this.J=oa(),this.Y=new Us(Ci)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:_i()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Io(i))if(0===n){var o=new Zi(i.path);this.tt(e,o,yo.newNoDocument(o,Ri.min()))}else Si(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&Io(o.target)){var s=new Zi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,yo.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=Ys();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new $s(t,n,this.Y,this.H,r);return this.H=Ks(),this.J=oa(),this.Y=new Us(Ci),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ra,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Us(Ci),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Ii("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ra),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function oa(){return new Fs(Zi.comparator)}function sa(){return new Fs(Zi.comparator)}var aa={asc:"ASCENDING",desc:"DESCENDING"},ua={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ca=function(t,e){this.databaseId=t,this.I=e};function ha(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function la(t,e){return t.I?e.toBase64():e.toUint8Array()}function fa(t,e){return ha(t,e.toTimestamp())}function da(t){return Si(!!t),Ri.fromTimestamp(function(t){var e=zi(t);return new Ai(e.seconds,e.nanos)}(t))}function pa(t,e){return function(t){return new Vi(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function ga(t){var e=Vi.fromString(t);return Si(Ma(e)),e}function ya(t,e){return pa(t.databaseId,e.path)}function va(t,e){var n=ga(e);if(n.get(1)!==t.databaseId.projectId)throw new mi(vi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new mi(vi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Zi(Ia(n))}function ma(t,e){return pa(t.databaseId,e)}function ba(t){var e=ga(t);return 4===e.length?Vi.emptyPath():Ia(e)}function wa(t){return new Vi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ia(t){return Si(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Oa(t,e,n){return{name:ya(t,e),fields:n.value.mapValue.fields}}function Ta(t,e,n){var r=va(t,e.name),i=da(e.updateTime),o=new po({mapValue:{fields:e.fields}}),s=yo.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Ea(t,e){var n;if(e instanceof _s)n={update:Oa(t,e.key,e.value)};else if(e instanceof Ds)n={delete:ya(t,e.key)};else if(e instanceof Ss)n={update:Oa(t,e.key,e.data),updateMask:Fa(e.fieldMask)};else{if(!(e instanceof As))return _i();n={verify:ya(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof as)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof us)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof hs)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof fs)return{fieldPath:e.field.canonicalString(),increment:n.A};throw _i()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:fa(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_i()}(t,e.precondition)),n}function _a(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?vs.updateTime(da(t.updateTime)):void 0!==t.exists?vs.exists(t.exists):vs.none()}(e.currentDocument):vs.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;"setToServerValue"in e?(Si("REQUEST_TIME"===e.setToServerValue),n=new as):"appendMissingElements"in e?n=new us(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new hs(e.removeAllFromArray.values||[]):"increment"in e?n=new fs(t,e.increment):_i();var r=qi.fromServerFormat(e.fieldPath);return new gs(r,n)}(t,e)})):[];if(e.update){var i=va(t,e.update.name),o=new po({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new Bi((t.fieldPaths||[]).map((function(t){return qi.fromServerFormat(t)})))}(e.updateMask);return new Ss(i,o,s,n,r)}return new _s(i,o,n,r)}if(e.delete){var a=va(t,e.delete);return new Ds(a,n)}if(e.verify){var u=va(t,e.verify);return new As(u,n)}return _i()}function Sa(t,e){return{documents:[ma(t,e.path)]}}function ka(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ma(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ma(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(ho(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NAN"}};if(co(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ho(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NAN"}};if(co(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Aa(t.field),op:Da(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Aa(t.field),direction:ja(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Xi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Na(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Na(e.endAt)),n}function xa(t){var e=ba(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Si(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[La(e)]:void 0!==e.fieldFilter?[Pa(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):_i():[]}(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new Ao(Ra(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return Xi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Ca(n.startAt));var h=null;return n.endAt&&(h=Ca(n.endAt)),Mo(e,i,a,s,u,"F",c,h)}function Na(t){return{before:t.before,values:t.position}}function Ca(t){return new jo(t.values||[],!!t.before)}function ja(t){return aa[t]}function Da(t){return ua[t]}function Aa(t){return{fieldPath:t.canonicalString()}}function Ra(t){return qi.fromServerFormat(t.fieldPath)}function Pa(t){return Oo.create(Ra(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return _i()}}(t.fieldFilter.op),t.fieldFilter.value)}function La(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ra(t.unaryFilter.field);return Oo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ra(t.unaryFilter.field);return Oo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ra(t.unaryFilter.field);return Oo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ra(t.unaryFilter.field);return Oo.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return _i()}}function Fa(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Ma(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Va(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=qa(e)),e=Ua(t.get(n),e);return qa(e)}function Ua(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function qa(t){return t+"\x01\x01"}function Ba(t){var e=t.length;if(Si(e>=2),2===e)return Si("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Vi.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&_i(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:_i()}o=s+2}return new Vi(r)}var Ka=function(t,e){this.seconds=t,this.nanoseconds=e},Ga=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ga.store="owner",Ga.key="owner";var za=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};za.store="mutationQueues",za.keyPath="userId";var Qa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Qa.store="mutations",Qa.keyPath="batchId",Qa.userMutationsIndex="userMutationsIndex",Qa.userMutationsKeyPath=["userId","batchId"];var Wa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Va(e)]},t.key=function(t,e,n){return[t,Va(e),n]},t}();Wa.store="documentMutations",Wa.PLACEHOLDER=new Wa;var Ha=function(t,e){this.path=t,this.readTime=e},Ya=function(t,e){this.path=t,this.version=e},Xa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Xa.store="remoteDocuments",Xa.readTimeIndex="readTimeIndex",Xa.readTimeIndexPath="readTime",Xa.collectionReadTimeIndex="collectionReadTimeIndex",Xa.collectionReadTimeIndexPath=["parentPath","readTime"];var Ja=function(t){this.byteSize=t};Ja.store="remoteDocumentGlobal",Ja.key="remoteDocumentGlobalKey";var $a=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};$a.store="targets",$a.keyPath="targetId",$a.queryTargetsIndexName="queryTargetsIndex",$a.queryTargetsKeyPath=["canonicalId","targetId"];var Za=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Za.store="targetDocuments",Za.keyPath=["targetId","path"],Za.documentTargetsIndex="documentTargetsIndex",Za.documentTargetsKeyPath=["path","targetId"];var tu=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};tu.key="targetGlobalKey",tu.store="targetGlobal";var eu=function(t,e){this.collectionId=t,this.parent=e};eu.store="collectionParents",eu.keyPath=["collectionId","parent"];var nu=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};nu.store="clientMetadata",nu.keyPath="clientId";var ru=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ru.store="bundles",ru.keyPath="bundleId";var iu=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};iu.store="namedQueries",iu.keyPath="name";var ou=Object(at.f)(Object(at.f)([],Object(at.f)(Object(at.f)([],Object(at.f)(Object(at.f)([],Object(at.f)(Object(at.f)([],[za.store,Qa.store,Wa.store,Xa.store,$a.store,Ga.store,tu.store,Za.store]),[nu.store])),[Ja.store])),[eu.store])),[ru.store,iu.store]),su="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",au=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),uu=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},cu=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&_i(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),hu=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new uu,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new du(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=mu(e.target.error);n.ft.reject(new du(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new du(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Ii("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new gu(e)},t}(),lu=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(ut.i)())&&Oi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Ii("SimpleDb","Removing database:",t),yu(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(ut.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(at.b)(this,void 0,void 0,(function(){var e,n=this;return Object(at.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(Ii("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new du(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new mi(vi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new du(t,n))},i.onupgradeneeded=function(t){Ii("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next((function(){Ii("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(at.b)(this,void 0,void 0,(function(){var i,o,s,a,u;return Object(at.d)(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(at.d)(this,(function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=hu.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),cu.reject(t)})).toPromise(),u={},s.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Ii("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),fu=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return yu(this.Pt.delete())},t}(),du=function(t){function e(e,n){var r=this;return(r=t.call(this,vi.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(at.c)(e,t),e}(mi);function pu(t){return"IndexedDbTransactionError"===t.name}var gu=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Ii("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Ii("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),yu(n)},t.prototype.add=function(t){return Ii("SimpleDb","ADD",this.store.name,t,t),yu(this.store.add(t))},t.prototype.get=function(t){var e=this;return yu(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Ii("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return Ii("SimpleDb","DELETE",this.store.name,t),yu(this.store.delete(t))},t.prototype.count=function(){return Ii("SimpleDb","COUNT",this.store.name),yu(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.kt=function(t,e){Ii("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new cu((function(n,r){e.onerror=function(t){var e=mu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new cu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new fu(i),s=e(i.primaryKey,i.value,o);if(s instanceof cu){var a=s.catch((function(t){return o.done(),cu.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return cu.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function yu(t){return new cu((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=mu(t.target.error);n(e)}}))}var vu=!1;function mu(t){var e=lu._t(Object(ut.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new mi("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return vu||(vu=!0,setTimeout((function(){throw r}),0)),r}}return t}var bu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(at.c)(e,t),e}(au);function wu(t,e){var n=ki(t);return lu.It(n.Mt,e)}var Iu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&ws(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Is(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Is(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Ri.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Ys())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ji(this.mutations,t.mutations,(function(t,e){return Ts(t,e)}))&&ji(this.baseMutations,t.baseMutations,(function(t,e){return Ts(t,e)}))},t}(),Ou=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Si(e.mutations.length===r.length);for(var i=Ws(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Tu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Ri.min()),void 0===o&&(o=Ri.min()),void 0===s&&(s=Ki.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Eu=function(t){this.Lt=t};function _u(t,e){if(e.document)return Ta(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Zi.fromSegments(e.noDocument.path),r=Cu(e.noDocument.readTime),i=yo.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Zi.fromSegments(e.unknownDocument.path);return r=Cu(e.unknownDocument.version),yo.newUnknownDocument(o,r)}return _i()}function Su(t,e,n){var r=ku(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:ya(t,e.key),fields:e.data.value.mapValue.fields,updateTime:ha(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Xa(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Nu(e.version);return s=e.hasCommittedMutations,new Xa(null,new Ha(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Nu(e.version);return new Xa(new Ya(c,h),null,null,!0,r,i)}return _i()}function ku(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function xu(t){var e=new Ai(t[0],t[1]);return Ri.fromTimestamp(e)}function Nu(t){var e=t.toTimestamp();return new Ka(e.seconds,e.nanoseconds)}function Cu(t){var e=new Ai(t.seconds,t.nanoseconds);return Ri.fromTimestamp(e)}function ju(t,e){for(var n=(e.baseMutations||[]).map((function(e){return _a(t.Lt,e)})),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map((function(e){return _a(t.Lt,e)})),o=Ai.fromMillis(e.localWriteTimeMs);return new Iu(e.batchId,o,n,i)}function Du(t){var e,n,r=Cu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Cu(t.lastLimboFreeSnapshotVersion):Ri.min();return void 0!==t.query.documents?(Si(1===(n=t.query).documents.length),e=Qo(Vo(ba(n.documents[0])))):e=function(t){return Qo(xa(t))}(t.query),new Tu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Ki.fromBase64String(t.resumeToken))}function Au(t,e){var n,r=Nu(e.snapshotVersion),i=Nu(e.lastLimboFreeSnapshotVersion);n=Io(e.target)?Sa(t.Lt,e.target):ka(t.Lt,e.target);var o=e.resumeToken.toBase64();return new $a(e.targetId,bo(e.target),r,o,e.sequenceNumber,i,n)}function Ru(t){var e=xa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Wo(e,e.limit,"L"):e}var Pu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Lu(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Cu(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Lu(t).put({bundleId:(n=e).id,createTime:Nu(da(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Fu(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Ru(e.bundledQuery),readTime:Cu(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Fu(t).put(function(t){return{name:t.name,readTime:Nu(da(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Lu(t){return wu(t,ru.store)}function Fu(t){return wu(t,iu.store)}var Mu=function(){function t(){this.Bt=new Vu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),cu.resolve()},t.prototype.getCollectionParents=function(t,e){return cu.resolve(this.Bt.getEntries(e))},t}(),Vu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Us(Vi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Us(Vi.comparator)).toArray()},t}(),Uu=function(){function t(){this.qt=new Vu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Va(i)};return qu(t).put(o)}return cu.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Di(e),""],!1,!0);return qu(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ba(o.parent))}return n}))},t}();function qu(t){return wu(t,eu.store)}var Bu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ku=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Gu(t,e,n){var r=t.store(Qa.store),i=t.store(Wa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Si(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Wa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return cu.waitFor(o).next((function(){return c}))}function zu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _i();e=t.noDocument}return JSON.stringify(e).length}Ku.DEFAULT_COLLECTION_PERCENTILE=10,Ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ku.DEFAULT=new Ku(41943040,Ku.DEFAULT_COLLECTION_PERCENTILE,Ku.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ku.DISABLED=new Ku(-1,0,0);var Qu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Si(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hu(t).$t({index:Qa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Yu(t),s=Hu(t);return s.add({}).next((function(a){Si("number"==typeof a);for(var u=new Iu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Ea(t.Lt,e)})),i=n.mutations.map((function(e){return Ea(t.Lt,e)}));return new Qa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Us((function(t,e){return Ci(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],g=Wa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Wa.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),cu.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Hu(t).get(e).next((function(t){return t?(Si(t.userId===n.userId),ju(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?cu.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Hu(t).$t({index:Qa.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Si(e.batchId>=r),o=ju(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Hu(t).$t({index:Qa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Hu(t).Nt(Qa.userMutationsIndex,n).next((function(t){return t.map((function(t){return ju(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Wa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Yu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[2],c=Ba(r[1]);if(a===n.userId&&e.path.isEqual(c))return Hu(t).get(u).next((function(t){if(!t)throw _i();Si(t.userId===n.userId),o.push(ju(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Us(Ci),i=[];return e.forEach((function(e){var o=Wa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Yu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[2],u=Ba(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()}));i.push(a)})),cu.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Wa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Us(Ci);return Yu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[2],c=Ba(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Hu(t).get(e).next((function(t){if(null===t)throw _i();Si(t.userId===n.userId),r.push(ju(n.R,t))})))})),cu.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Gu(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),cu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return cu.resolve();var r=IDBKeyRange.lowerBound(Wa.prefixForUser(e.userId)),i=[];return Yu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Ba(t[1]);i.push(o)}else r.done()})).next((function(){Si(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Wu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Xu(t).get(this.userId).next((function(t){return t||new za(e.userId,-1,"")}))},t}();function Wu(t,e,n){var r=Wa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Yu(t).$t({range:o,Ft:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()})).next((function(){return s}))}function Hu(t){return wu(t,Qa.store)}function Yu(t){return wu(t,Wa.store)}function Xu(t){return wu(t,za.store)}var Ju=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),$u=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Ju(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Ri.fromTimestamp(new Ai(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Zu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Si(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Zu(t).$t((function(s,a){var u=Du(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return cu.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return Zu(t).$t((function(t,n){var r=Du(n);e(r)}))},t.prototype.Xt=function(t){return tc(t).get(tu.key).next((function(t){return Si(null!==t),t}))},t.prototype.Zt=function(t,e){return tc(t).put(tu.key,e)},t.prototype.te=function(t,e){return Zu(t).put(Au(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=bo(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Zu(t).$t({range:r,index:$a.queryTargetsIndexName},(function(t,n,r){var o=Du(n);wo(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ec(t);return e.forEach((function(e){var s=Va(e.path);i.push(o.put(new Za(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),cu.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ec(t);return cu.forEach(e,(function(e){var o=Va(e.path);return cu.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ec(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ec(t),i=Ys();return r.$t({range:n,Ft:!0},(function(t,e,n){var r=Ba(t[1]),o=new Zi(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Va(e.path),r=IDBKeyRange.bound([n],[Di(n)],!1,!0),i=0;return ec(t).$t({index:Za.documentTargetsIndex,Ft:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return Zu(t).get(e).next((function(t){return t?Du(t):null}))},t}();function Zu(t){return wu(t,$a.store)}function tc(t){return wu(t,tu.store)}function ec(t){return wu(t,Za.store)}function nc(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){if(t.code!==vi.FAILED_PRECONDITION||t.message!==su)throw t;return Ii("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function rc(t,e){var n=t[1],r=e[1],i=Ci(t[0],e[0]);return 0===i?Ci(n,r):i}var ic=function(){function t(t){this.ne=t,this.buffer=new Us(rc),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();rc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),oc=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Ii("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return Object(at.b)(e,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return pu(e=n.sent())?(Ii("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,nc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),sc=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return cu.resolve(yi.o);var r=new ic(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Ii("LruGarbageCollector","Garbage collection skipped; disabled"),cu.resolve(Bu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Ii("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Bu):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(Ii("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),wi()<=ct.a.DEBUG&&Ii("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),cu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),ac=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new sc(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return uc(t,n)},t.prototype.removeReference=function(t,e,n){return uc(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return uc(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Xu(t).Ot((function(r){return Wu(t,r,e).next((function(t){return t&&(n=!0),cu.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),ec(t).delete([0,Va(s.path)])}))}));i.push(u)}})).next((function(){return cu.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return uc(t,e)},t.prototype.we=function(t,e){var n,r=ec(t),i=yi.o;return r.$t({index:Za.documentTargetsIndex},(function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==yi.o&&e(new Zi(Ba(n)),i),i=s,n=o):i=yi.o})).next((function(){i!==yi.o&&e(new Zi(Ba(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function uc(t,e){return ec(t).put(function(t,e){return new Za(0,Va(t.path),e)}(e,t.currentSequenceNumber))}var cc=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Li(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},t.prototype.isEmpty=function(){return Fi(this.inner)},t}(),hc=function(){function t(){this.changes=new cc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Ri.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:yo.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?cu.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),lc=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return pc(t).put(gc(e),n)},t.prototype.removeEntry=function(t,e){var n=pc(t),r=gc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return pc(t).get(gc(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return pc(t).get(gc(e)).next((function(t){return{document:n.ye(e,t),size:zu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Ks();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Ks(),i=new Fs(Zi.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,zu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return cu.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return pc(t).$t({range:r},(function(t,e,r){for(var s=Zi.fromSegments(t);o&&Zi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Ks(),o=e.path.length+1,s={};if(n.isEqual(Ri.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=ku(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Xa.collectionReadTimeIndex}return pc(t).$t(s,(function(t,n,s){if(t.length===o){var a=_u(r.R,n);e.path.isPrefixOf(a.key.path)?Jo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new fc(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return dc(t).get(Ja.key).next((function(t){return Si(!!t),t}))},t.prototype.me=function(t,e){return dc(t).put(Ja.key,e)},t.prototype.ye=function(t,e){if(e){var n=_u(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Ri.min()))return n}return yo.newInvalidDocument(t)},t}(),fc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new cc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(at.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Us((function(t,e){return Ci(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Su(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=zu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Su(e.Ie.R,yo.newNoDocument(o,Ri.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),cu.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(hc);function dc(t){return wu(t,Ja.store)}function pc(t){return wu(t,Xa.store)}function gc(t){return t.path.toArray()}var yc=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Si(n<r&&n>=0&&r<=11);var o=new hu("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ga.store)}(t),function(t){t.createObjectStore(za.store,{keyPath:za.keyPath}),t.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Wa.store)}(t),vc(t),function(t){t.createObjectStore(Xa.store)}(t));var s=cu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Za.store),t.deleteObjectStore($a.store),t.deleteObjectStore(tu.store)}(t),vc(t)),s=s.next((function(){return function(t){var e=t.store(tu.store),n=new tu(0,0,Ri.min().toTimestamp(),0);return e.put(tu.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Qa.store).Nt().next((function(n){t.deleteObjectStore(Qa.store),t.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0});var r=e.store(Qa.store),i=n.map((function(t){return r.put(t)}));return cu.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(nu.store,{keyPath:nu.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Ja.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Xa.store);e.createIndex(Xa.readTimeIndex,Xa.readTimeIndexPath,{unique:!1}),e.createIndex(Xa.collectionReadTimeIndex,Xa.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(ru.store,{keyPath:ru.keyPath})}(t),function(t){t.createObjectStore(iu.store,{keyPath:iu.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Xa.store).$t((function(t,n){e+=zu(n)})).next((function(){var n=new Ja(e);return t.store(Ja.store).put(Ja.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(za.store),r=t.store(Qa.store);return n.Nt().next((function(n){return cu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Qa.userMutationsIndex,i).next((function(r){return cu.forEach(r,(function(r){Si(r.userId===n.userId);var i=ju(e.R,r);return Gu(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(Za.store),n=t.store(Xa.store);return t.store(tu.store).get(tu.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new Vi(n),s=function(t){return[0,Va(t)]}(o);r.push(e.get(s).next((function(n){return n?cu.resolve():function(n){return e.put(new Za(0,Va(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return cu.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(eu.store,{keyPath:eu.keyPath});var n=e.store(eu.store),r=new Vu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Va(i)})}};return e.store(Xa.store).$t({Ft:!0},(function(t,e){var n=new Vi(t);return i(n.popLast())})).next((function(){return e.store(Wa.store).$t({Ft:!0},(function(t,e){var n=Ba(t[1]);return i(n.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store($a.store);return n.$t((function(t,r){var i=Du(r),o=Au(e.R,i);return n.put(o)}))},t}();function vc(t){t.createObjectStore(Za.store,{keyPath:Za.keyPath}).createIndex(Za.documentTargetsIndex,Za.documentTargetsKeyPath,{unique:!0}),t.createObjectStore($a.store,{keyPath:$a.keyPath}).createIndex($a.queryTargetsIndexName,$a.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(tu.store)}var mc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",bc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new mi(vi.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ac(this,i),this.Le=n+"main",this.R=new Eu(u),this.Be=new lu(this.Le,11,new yc(this.R)),this.qe=new $u(this.referenceDelegate,this.R),this.Ut=new Uu,this.Ue=function(t,e){return new lc(t,e)}(this.R,this.Ut),this.Ke=new Pu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Oi("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new mi(vi.FAILED_PRECONDITION,mc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new yi(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(at.b)(e,void 0,void 0,(function(){return Object(at.d)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return Object(at.b)(e,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return Object(at.b)(e,void 0,void 0,(function(){return Object(at.d)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Ic(e).put(new nu(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(pu(e))return Ii("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Ii("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return wc(t).get(Ga.key).next((function(t){return cu.resolve(e.tn(t))}))},t.prototype.en=function(t){return Ic(t).delete(this.clientId)},t.prototype.nn=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(at.d)(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=wu(t,nu.store);return e.Nt().next((function(t){var n=r.rn(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return cu.forEach(i,(function(t){return e.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?cu.resolve(!0):wc(t).get(Ga.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new mi(vi.FAILED_PRECONDITION,mc);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ic(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&Ii("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Object(at.b)(this,void 0,void 0,(function(){var t=this;return Object(at.d)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ga.store,nu.store],(function(e){var n=new bu(e,yi.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Ic(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Qu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Ii("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",ou,(function(o){return r=new bu(o,i.Ne?i.Ne.next():yi.o),"readwrite-primary"===e?i.Je(r).next((function(t){return!!t||i.Ye(r)})).next((function(e){if(!e)throw Oi("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable((function(){return i.Me(!1)})),new mi(vi.FAILED_PRECONDITION,su);return n(r)})).next((function(t){return i.Ze(r).next((function(){return t}))})):i.dn(r).next((function(){return n(r)}))})).then((function(t){return r.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return wc(t).get(Ga.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new mi(vi.FAILED_PRECONDITION,mc)}))},t.prototype.Ze=function(t){var e=new Ga(this.clientId,this.allowTabSynchronization,Date.now());return wc(t).put(Ga.key,e)},t.yt=function(){return lu.yt()},t.prototype.Xe=function(t){var e=this,n=wc(t);return n.get(Ga.key).next((function(t){return e.tn(t)?(Ii("IndexedDbPersistence","Releasing primary lease."),n.delete(Ga.key)):cu.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Oi("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),Object(ut.q)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Ii("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Oi("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Oi("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function wc(t){return wu(t,Ga.store)}function Ic(t){return wu(t,nu.store)}function Oc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Tc=function(t,e){this.progress=t,this.wn=e},Ec=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Zi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Go(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Zi(e)).next((function(t){var e=zs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=zs();return this.Ut.getCollectionParents(t,i).next((function(s){return cu.forEach(s,(function(s){var a=function(t,e){return new Fo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o.Rn(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=yo.newInvalidDocument(c),r=r.insert(c,h)),Is(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Jo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Ys(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Ss&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),_c=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ys(),i=Ys(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Sc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Ri.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return(Uo(e)||qo(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(wi()<=ct.a.DEBUG&&Ii("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Xo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Us($o(t));return e.forEach((function(e,r){Jo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return wi()<=ct.a.DEBUG&&Ii("QueryEngine","Using full collection scan to execute query:",Xo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Ri.min())},t}(),kc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Fs(Ci),this.Fn=new cc((function(t){return bo(t)}),wo),this.$n=Ri.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Ec(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},t}();function xc(t,e,n,r){return new kc(t,e,n,r)}function Nc(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(at.d)(this,(function(s){switch(s.label){case 0:return n=ki(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Ec(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Ys(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Cc(t,e){var n=ki(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=cu.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);Si(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function jc(t){var e=ki(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Dc(t,e){var n=ki(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Si(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=Ks();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Ac(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Ri.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return cu.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.kn=i,t}))}function Ac(t,e,n,r,i){var o=Ys();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Ks();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Ri.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Ii("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Rc(t,e){var n=ki(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Pc(t,e){var n=ki(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?cu.resolve(r=i):n.qe.allocateTargetId(t).next((function(i){return r=new Tu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t}))}function Lc(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(at.d)(this,(function(a){switch(a.label){case 0:r=ki(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!pu(s=a.sent()))throw s;return Ii("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}}))}))}function Fc(t,e,n){var r=ki(t),i=Ri.min(),o=Ys();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=ki(t),i=r.Fn.get(n);return void 0!==i?cu.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,Qo(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Ri.min(),n?o:Ys())})).next((function(t){return{documents:t,Bn:o}}))}))}function Mc(t,e){var n=ki(t),r=ki(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Vc(t){var e=ki(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=ki(t),i=Ks(),o=ku(n),s=pc(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Xa.readTimeIndex,range:a},(function(t,e){var n=_u(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:xu(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn;return e.$n=t.readTime,n}))}function Uc(t){return Object(at.b)(this,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){return[2,(e=ki(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=pc(t),n=Ri.min();return e.$t({index:Xa.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=xu(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}function qc(t,e,n,r){return Object(at.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return Object(at.d)(this,(function(p){switch(p.label){case 0:for(i=ki(t),o=Ys(),s=Ks(),a=Ws(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,Pc(i,function(t){return Qo(Vo(Vi.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Ac(t,f,s,Ri.min(),a).next((function(e){return f.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Bc(t,e,n){return void 0===n&&(n=Ys()),Object(at.b)(this,void 0,void 0,(function(){var r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:return[4,Pc(t,Qo(Ru(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=ki(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=da(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Ki.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Ke.saveNamedQuery(t,e)}))}))]}}))}))}var Kc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return cu.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:da(n.createTime)}),cu.resolve()},t.prototype.getNamedQuery=function(t,e){return cu.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Ru(t.bundledQuery),readTime:da(t.readTime)}}(e)),cu.resolve()},t}(),Gc=function(){function t(){this.Wn=new Us(zc.Gn),this.zn=new Us(zc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new zc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new zc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new Zi(new Vi([])),r=new zc(n,t),i=new zc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Zi(new Vi([])),n=new zc(e,t),r=new zc(e,t+1),i=Ys();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new zc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),zc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Zi.comparator(t.key,e.key)||Ci(t.ns,e.ns)},t.Hn=function(t,e){return Ci(t.ns,e.ns)||Zi.comparator(t.key,e.key)},t}(),Qc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Us(zc.Gn)}return t.prototype.checkEmpty=function(t){return cu.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Iu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new zc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return cu.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return cu.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return cu.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return cu.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return cu.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new zc(e,0),i=new zc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),cu.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Us(Ci);return e.forEach((function(t){var e=new zc(t,0),i=new zc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),cu.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Zi.isDocumentKey(i)||(i=i.child(""));var o=new zc(new Zi(i),0),s=new Us(Ci);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),cu.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Si(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return cu.forEach(e.mutations,(function(i){var o=new zc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new zc(e,0),r=this.rs.firstAfterOrEqual(n);return cu.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return cu.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Wc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Fs(Zi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return cu.resolve(n?n.document.clone():yo.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ks();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():yo.newInvalidDocument(t))})),cu.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ks(),i=new Zi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Jo(e,u)&&(r=r.insert(u.key,u.clone()))}return cu.resolve(r)},t.prototype.fs=function(t,e){return cu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Hc(this)},t.prototype.getSize=function(t){return cu.resolve(this.size)},t}(),Hc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(at.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),cu.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(hc),Yc=function(){function t(t){this.persistence=t,this.ds=new cc((function(t){return bo(t)}),wo),this.lastRemoteSnapshotVersion=Ri.min(),this.highestTargetId=0,this.ws=0,this._s=new Gc,this.targetCount=0,this.ys=Ju.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),cu.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return cu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return cu.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),cu.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),cu.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Ju(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,cu.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),cu.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,cu.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),cu.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return cu.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return cu.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),cu.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),cu.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),cu.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return cu.resolve(n)},t.prototype.containsKey=function(t,e){return cu.resolve(this._s.containsKey(e))},t}(),Xc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new yi(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Yc(this),this.Ut=new Mu,this.Ue=function(t,e){return new Wc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Eu(e),this.Ke=new Kc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Qc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Ii("MemoryPersistence","Starting transaction:",t);var i=new Jc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return cu.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),Jc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(at.c)(e,t),e}(au),$c=function(){function t(t){this.persistence=t,this.As=new Gc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw _i()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),cu.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),cu.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),cu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return cu.forEach(this.vs,(function(r){var i=Zi.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return cu.or([function(){return cu.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Zc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function th(t,e){return"firestore_clients_"+t+"_"+e}function eh(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function nh(t,e){return"firestore_targets_"+t+"_"+e}Zc.UNAUTHENTICATED=new Zc(null),Zc.GOOGLE_CREDENTIALS=new Zc("google-credentials-uid"),Zc.FIRST_PARTY=new Zc("first-party-uid"),Zc.MOCK_USER=new Zc("mock-user");var rh=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new mi(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Oi("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ih=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new mi(i.error.code,i.error.message)),o?new t(e,i.state,r):(Oi("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),oh=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Js(),s=0;i&&s<r.activeTargetIds.length;++s)i=$i(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Oi("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),sh=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Oi("SharedClientState","Failed to parse online state: "+e),null)},t}(),ah=function(){function t(){this.activeTargetIds=Js()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),uh=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Fs(Ci),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=th(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new ah),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(at.d)(this,(function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(th(this.persistenceKey,r)))&&(o=oh.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.ks(c[u]);return this.$s=[],this.window.addEventListener("pagehide",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(nh(this.persistenceKey,t));if(n){var r=ih.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(nh(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ii("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Ii("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Ii("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Ii("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Oi("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return Object(at.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(at.d)(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=yi.o;if(null!=t)try{var n=JSON.parse(t);Si("number"==typeof n),e=n}catch(t){Oi("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==yi.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new rh(this.currentUser,t,e,n),i=eh(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=eh(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=nh(this.persistenceKey,t),i=new ih(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return oh.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return rh.Vs(new Zc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return ih.Vs(r,e)},t.prototype.js=function(t){return sh.Vs(t)},t.prototype.ii=function(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Ii("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Js();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),ch=function(){function t(){this.li=new ah,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new ah,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),hh=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),lh=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Ii("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Ii("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),fh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},dh=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),ph=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(at.c)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise((function(i,o){var s=new gi;s.listenOnce(li.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case hi.NO_ERROR:var e=s.getResponseJson();Ii("Connection","XHR received:",JSON.stringify(e)),i(e);break;case hi.TIMEOUT:Ii("Connection",'RPC "'+t+'" timed out'),o(new mi(vi.DEADLINE_EXCEEDED,"Request time out"));break;case hi.HTTP_ERROR:var n=s.getStatus();if(Ii("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(vi).indexOf(e)>=0?e:vi.UNKNOWN}(r.status);o(new mi(a,r.message))}else o(new mi(vi.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new mi(vi.UNAVAILABLE,"Connection failed."));break;default:_i()}}finally{Ii("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new oi,i=$e(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new di({})),this.ki(o.initMessageHeaders,e),Object(ut.n)()||Object(ut.p)()||Object(ut.l)()||Object(ut.m)()||Object(ut.r)()||Object(ut.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Ii("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new dh({Ei:function(t){c?Ii("Connection","Not sending because WebChannel is closed:",t):(u||(Ii("Connection","Opening WebChannel transport."),a.open(),u=!0),Ii("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return l(a,pi.EventType.OPEN,(function(){c||Ii("Connection","WebChannel transport opened.")})),l(a,pi.EventType.CLOSE,(function(){c||(c=!0,Ii("Connection","WebChannel transport closed"),h.Vi())})),l(a,pi.EventType.ERROR,(function(t){c||(c=!0,Ti("Connection","WebChannel transport errored:",t),h.Vi(new mi(vi.UNAVAILABLE,"The operation could not be completed")))})),l(a,pi.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];Si(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Ii("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Cs[t];if(void 0!==e)return Ls(e)}(i),s=r.message;void 0===o&&(o=vi.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new mi(o,s)),a.close()}else Ii("Connection","WebChannel received:",n),h.Si(n)}})),l(i,fi.STAT_EVENT,(function(t){10===t.stat?Ii("Connection","Detected buffering proxy"):11===t.stat&&Ii("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Pi()}),0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Ii("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then((function(t){return Ii("RestConnection","Received: ",t),t}),(function(e){throw Ti("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+fh[t]},t}());function gh(){return"undefined"!=typeof window?window:null}function yh(){return"undefined"!=typeof document?document:null}function vh(t){return new ca(t,!0)}var mh=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Ii("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),bh=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new mh(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===vi.RESOURCE_EXHAUSTED?(Oi(e.toString()),Oi("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===vi.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new mi(vi.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return Object(at.b)(t,void 0,void 0,(function(){return Object(at.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return Ii("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(Ii("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),wh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(at.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_i()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Si(void 0===e||"string"==typeof e),Ki.fromBase64String(e||"")):(Si(void 0===e||e instanceof Uint8Array),Ki.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?vi.UNKNOWN:Ls(t.code);return new mi(e,t.message||"")}(a);n=new na(r,i,o,s||null)}else if("documentChange"in e){i=va(t,(r=e.documentChange).document.name),o=da(r.document.updateTime);var a=new po({mapValue:{fields:r.document.fields}}),u=(s=yo.newFoundDocument(i,o,a),r.targetIds||[]);n=new ta(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=va(t,(r=e.documentDelete).document),o=r.readTime?da(r.readTime):Ri.min(),a=yo.newNoDocument(i,o),n=new ta([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=va(t,(r=e.documentRemove).document),n=new ta([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return _i();var c=e.filter;i=new Rs(r=c.count||0),n=new ea(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Ri.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ri.min():e.readTime?da(e.readTime):Ri.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=wa(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Io(r)?{documents:Sa(t,r)}:{query:ka(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=la(t,e.resumeToken):e.snapshotVersion.compareTo(Ri.min())>0&&(n.readTime=ha(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _i()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=wa(this.R),e.removeTarget=t,this.cr(e)},e}(bh),Ih=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(at.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Si(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Si(void 0!==e),t.map((function(t){return function(t,e){var n=da(t.updateTime?t.updateTime:e);return n.isEqual(Ri.min())&&(n=da(e)),new ys(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=da(t.commitTime);return this.listener.Tr(n,e)}return Si(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=wa(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Ea(e.R,t)}))};this.cr(n)},e}(bh),Oh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(at.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new mi(vi.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===vi.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new mi(vi.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===vi.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new mi(vi.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),Th=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Oi(e),this.Vr=!1):Ii("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Eh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return Object(at.b)(o,void 0,void 0,(function(){return Object(at.d)(this,(function(t){switch(t.label){case 0:return Ah(this)?(Ii("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(at.b)(this,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return(e=ki(t)).Or.add(4),[4,Sh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,_h(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Th(n,r)};function _h(t){return Object(at.b)(this,void 0,void 0,(function(){var e,n;return Object(at.d)(this,(function(r){switch(r.label){case 0:if(!Ah(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Sh(t){return Object(at.b)(this,void 0,void 0,(function(){var e,n;return Object(at.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function kh(t,e){var n=ki(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Dh(n)?jh(n):Hh(n).er()&&Nh(n,e))}function xh(t,e){var n=ki(t),r=Hh(n);n.$r.delete(e),r.er()&&Ch(n,e),0===n.$r.size&&(r.er()?r.ir():Ah(n)&&n.Br.set("Unknown"))}function Nh(t,e){t.qr.U(e.targetId),Hh(t).mr(e)}function Ch(t,e){t.qr.U(e),Hh(t).yr(e)}function jh(t){t.qr=new ia({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Hh(t).start(),t.Br.Sr()}function Dh(t){return Ah(t)&&!Hh(t).tr()&&t.$r.size>0}function Ah(t){return 0===ki(t).Or.size}function Rh(t){t.qr=void 0}function Ph(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){return t.$r.forEach((function(e,n){Nh(t,e)})),[2]}))}))}function Lh(t,e){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(n){return Rh(t),Dh(t)?(t.Br.Nr(e),jh(t)):t.Br.set("Unknown"),[2]}))}))}function Fh(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i,o;return Object(at.d)(this,(function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof na&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(at.d)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Ii("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Mh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof ta?t.qr.X(e):e instanceof ea?t.qr.rt(e):t.qr.et(e),n.isEqual(Ri.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,jc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Ki.EMPTY_BYTE_STRING,n.snapshotVersion)),Ch(t,e);var r=new Tu(n.target,e,1,n.sequenceNumber);Nh(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Ii("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Mh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Mh(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r=this;return Object(at.d)(this,(function(i){switch(i.label){case 0:if(!pu(e))throw e;return t.Or.add(1),[4,Sh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return jc(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return Object(at.b)(r,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return Ii("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,_h(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Vh(t,e){return e().catch((function(n){return Mh(t,n,e)}))}function Uh(t){return Object(at.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(at.d)(this,(function(s){switch(s.label){case 0:e=ki(t),n=Yh(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Ah(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Rc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=Yh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Mh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return qh(e)&&Bh(e),[2]}}))}))}function qh(t){return Ah(t)&&!Yh(t).tr()&&t.Fr.length>0}function Bh(t){Yh(t).start()}function Kh(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){return Yh(t).Ar(),[2]}))}))}function Gh(t){return Object(at.b)(this,void 0,void 0,(function(){var e,n,r;return Object(at.d)(this,(function(i){for(e=Yh(t),n=0,r=t.Fr;n<r.length;n++)e.Er(r[n].mutations);return[2]}))}))}function zh(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=Ou.from(r,e,n),[4,Vh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Uh(t)];case 2:return o.sent(),[2]}}))}))}function Qh(t,e){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(n){switch(n.label){case 0:return e&&Yh(t).pr?[4,function(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r;return Object(at.d)(this,(function(i){switch(i.label){case 0:return Ps(r=e.code)&&r!==vi.ABORTED?(n=t.Fr.shift(),Yh(t).sr(),[4,Vh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Uh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return qh(t)&&Bh(t),[2]}}))}))}function Wh(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n;return Object(at.d)(this,(function(r){switch(r.label){case 0:return n=ki(t),e?(n.Or.delete(2),[4,_h(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Sh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Hh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=ki(t);return r.br(),new wh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ph.bind(null,t),Ri:Lh.bind(null,t),_r:Fh.bind(null,t)}),t.Mr.push((function(n){return Object(at.b)(e,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Dh(t)?jh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Rh(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function Yh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=ki(t);return r.br(),new Ih(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Kh.bind(null,t),Ri:Qh.bind(null,t),Ir:Gh.bind(null,t),Tr:zh.bind(null,t)}),t.Mr.push((function(n){return Object(at.b)(e,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Uh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(Ii("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var Xh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new uu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new mi(vi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Jh(t,e){if(Oi("AsyncQueue",e+": "+t),pu(t))return new mi(vi.UNAVAILABLE,e+": "+t);throw t}var $h=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Zi.comparator(e.key,n.key)}:function(t,e){return Zi.comparator(t.key,e.key)},this.keyedMap=zs(),this.sortedSet=new Fs(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Zh=function(){function t(){this.Qr=new Fs(Zi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):_i():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),tl=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,$h.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ho(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),el=function(){this.Wr=void 0,this.listeners=[]},nl=function(){this.queries=new cc((function(t){return Yo(t)}),Ho),this.onlineState="Unknown",this.Gr=new Set};function rl(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(at.d)(this,(function(c){switch(c.label){case 0:if(n=ki(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new el),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Jh(a,"Initialization of query '"+Xo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&al(n),[2]}}))}))}function il(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(at.d)(this,(function(a){return n=ki(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function ol(t,e){for(var n=ki(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&al(n)}function sl(t,e,n){var r=ki(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function al(t){t.Gr.forEach((function(t){t.next()}))}var ul=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new tl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=tl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),cl=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),hl=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return va(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ta(this.R,t.document,!1):yo.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return da(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new hl(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ys()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:return[4,qc(this.localStore,new hl(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Bc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Tc(Object.assign({},this.progress),t))]}}))}))}}();var ll=function(t){this.key=t},fl=function(t){this.key=t},dl=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ys(),this.mutatedKeys=Ys(),this.lo=$o(t),this.fo=new $h(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Zh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Uo(this.query)&&i.size===this.query.limit?i.last():null,c=qo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Jo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Uo(this.query)||qo(this.query))for(;s.size>this.query.limit;){var h=Uo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _i()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new tl(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Zh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ys(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new fl(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new ll(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ys();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return tl.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),pl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},gl=function(t){this.key=t,this.bo=!1},yl=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new cc((function(t){return Yo(t)}),Ho),this.Vo=new Map,this.So=new Set,this.Do=new Fs(Zi.comparator),this.Co=new Map,this.No=new Gc,this.xo={},this.ko=new Map,this.Fo=Ju.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function vl(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(at.d)(this,(function(a){switch(a.label){case 0:return n=Ql(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Pc(n.localStore,Qo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,ml(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&kh(n.remoteStore,o),a.label=4;case 4:return[2,r]}}))}))}function ml(t,e,n,r){return Object(at.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c;return Object(at.d)(this,(function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(at.b)(this,void 0,void 0,(function(){var i,o,s;return Object(at.d)(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Fc(t.localStore,e.query,!1).then((function(t){return e.view._o(t.documents,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(jl(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Fc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new dl(e,i.Bn),s=o._o(i.documents),a=Zs.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),jl(t,n,u.To),c=new pl(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}}))}))}function bl(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:return n=ki(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!Ho(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Lc(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),xh(n.remoteStore,r.targetId),Nl(n,r.targetId)})).catch(nc)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Nl(n,r.targetId),[4,Lc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function wl(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(at.d)(this,(function(a){switch(a.label){case 0:r=Wl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=ki(t),i=Ai.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Ys());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Os(c,n.get(c.key));null!=h&&s.push(new Ss(c.key,h,go(h.value.mapValue),vs.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Fs(Ci)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Rl(r,i.changes)];case 3:return a.sent(),[4,Uh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Jh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function Il(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r;return Object(at.d)(this,(function(i){switch(i.label){case 0:n=ki(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Dc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Si(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Si(r.bo):t.removedDocuments.size>0&&(Si(r.bo),r.bo=!1))})),[4,Rl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,nc(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Ol(t,e,n){var r=ki(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=ki(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&al(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Tl(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u;return Object(at.d)(this,(function(c){switch(c.label){case 0:return(r=ki(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Fs(Zi.comparator)).insert(o,yo.newNoDocument(o,Ri.min())),a=Ys().add(o),u=new $s(Ri.min(),new Map,new Us(Ci),s,a),[4,Il(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Al(r),[3,4];case 2:return[4,Lc(r.localStore,e,!1).then((function(){return Nl(r,e,n)})).catch(nc)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function El(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:n=ki(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Cc(n.localStore,e)];case 2:return i=o.sent(),xl(n,r,null),kl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Rl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,nc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function _l(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:r=ki(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=ki(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return Si(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),xl(r,e,n),kl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Rl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,nc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Sl(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(at.d)(this,(function(a){switch(a.label){case 0:Ah((n=ki(t)).remoteStore)||Ii("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=ki(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=Jh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function kl(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function xl(t,e,n){var r=ki(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Nl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Cl(t,e)}))}function Cl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(xh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Al(t))}function jl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ll?(t.No.addReference(o.key,e),Dl(t,o)):o instanceof fl?(Ii("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Cl(t,o.key)):_i()}}function Dl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Ii("SyncEngine","New document in limbo: "+n),t.So.add(r),Al(t))}function Al(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Zi(Vi.fromString(e)),r=t.Fo.next();t.Co.set(r,new gl(n)),t.Do=t.Do.insert(n,r),kh(t.remoteStore,new Tu(Qo(Vo(n.path)),r,2,yi.o))}}function Rl(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(at.d)(this,(function(a){switch(a.label){case 0:return r=ki(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.Oo(a,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=_c.Pn(a.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return Object(at.d)(this,(function(h){switch(h.label){case 0:n=ki(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return cu.forEach(e,(function(e){return cu.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return cu.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!pu(r=h.sent()))throw r;return Ii("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.kn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.kn=n.kn.insert(a,c));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Pl(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r;return Object(at.d)(this,(function(i){switch(i.label){case 0:return(n=ki(t)).currentUser.isEqual(e)?[3,3]:(Ii("SyncEngine","User change. New user:",e.toKey()),[4,Nc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach((function(t){t.forEach((function(t){t.reject(new mi(vi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Rl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Ll(t,e){var n=ki(t),r=n.Co.get(e);if(r&&r.bo)return Ys().add(r.key);var i=Ys(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Fl(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:return[4,Fc((n=ki(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&jl(n,e.targetId,i.To),i)]}}))}))}function Ml(t){return Object(at.b)(this,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){return[2,Vc((e=ki(t)).localStore).then((function(t){return Rl(e,t)}))]}))}))}function Vl(t,e,n,r){return Object(at.b)(this,void 0,void 0,(function(){var i,o;return Object(at.d)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=ki(t),r=ki(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):cu.resolve(null)}))}))}((i=ki(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Uh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(xl(i,e,r||null),kl(i,e),function(t,e){ki(ki(t)._n).Gt(e)}(i.localStore,e)):_i(),s.label=4;case 4:return[4,Rl(i,o)];case 5:return s.sent(),[3,7];case 6:Ii("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Ul(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(at.d)(this,(function(c){switch(c.label){case 0:return Ql(n=ki(t)),Wl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,ql(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Wh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)kh(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then((function(){return Nl(n,e),Lc(n.localStore,e,!0)})),xh(n.remoteStore,e)})),[4,u]);case 4:return c.sent(),[4,ql(n,a)];case 5:return c.sent(),function(t){var e=ki(t);e.Co.forEach((function(t,n){xh(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Fs(Zi.comparator)}(n),n.$o=!1,[4,Wh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))}function ql(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(at.d)(this,(function(g){switch(g.label){case 0:n=ki(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Pc(n.localStore,Qo(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Fl(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Mc(n.localStore,a)];case 8:return p=g.sent(),[4,Pc(n.localStore,p)];case 9:return u=g.sent(),[4,ml(n,Bl(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function Bl(t){return Mo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Kl(t){var e=ki(t);return ki(ki(e.localStore).persistence).fn()}function Gl(t,e,n,r){return Object(at.b)(this,void 0,void 0,(function(){var i,o,s;return Object(at.d)(this,(function(a){switch(a.label){case 0:return(i=ki(t)).$o?(Ii("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Vc(i.localStore)];case 3:return o=a.sent(),s=$s.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Rl(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Lc(i.localStore,e,!0)];case 6:return a.sent(),Nl(i,e,r),[3,8];case 7:_i(),a.label=8;case 8:return[2]}}))}))}function zl(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,h,l;return Object(at.d)(this,(function(f){switch(f.label){case 0:if(!(r=Ql(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Ii("SyncEngine","Adding an already active target "+s),[3,5]):[4,Mc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Pc(r.localStore,a)];case 3:return u=f.sent(),[4,ml(r,Bl(a),u.targetId,!1)];case 4:f.sent(),kh(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(at.d)(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Lc(r.localStore,t,!1).then((function(){xh(r.remoteStore,t),Nl(r,t)})).catch(nc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function Ql(t){var e=ki(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Il.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ll.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Tl.bind(null,e),e.vo._r=ol.bind(null,e.eventManager),e.vo.Mo=sl.bind(null,e.eventManager),e}function Wl(t){var e=ki(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=El.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_l.bind(null,e),e}var Hl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return this.R=vh(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return xc(this.persistence,new Sc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Xc($c.bs,this.R)},t.prototype.Bo=function(t){return new ch},t.prototype.terminate=function(){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),Yl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(at.c)(e,t),e.prototype.initialize=function(e){return Object(at.b)(this,void 0,void 0,(function(){var n=this;return Object(at.d)(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,Uc(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,Wl(this.Qo.syncEngine)];case 4:return r.sent(),[4,Uh(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}))];case 6:return r.sent(),[2]}}))}))},e.prototype.Ko=function(t){return xc(this.persistence,new Sc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new oc(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Oc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ku.withCacheSize(this.cacheSizeBytes):Ku.DEFAULT;return new bc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,gh(),yh(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new ch},e}(Hl),Xl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(at.c)(e,t),e.prototype.initialize=function(e){return Object(at.b)(this,void 0,void 0,(function(){var n,r=this;return Object(at.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof uh?(this.sharedClientState.syncEngine={ui:Vl.bind(null,n),ai:Gl.bind(null,n),hi:zl.bind(null,n),fn:Kl.bind(null,n),ci:Ml.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return Object(at.b)(r,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return[4,Ul(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=gh();if(!uh.yt(e))throw new mi(vi.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Oc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new uh(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Yl),Jl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n=this;return Object(at.d)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Ol(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Pl.bind(null,this.syncEngine),[4,Wh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new nl},t.prototype.createDatastore=function(t){var e=vh(t.databaseInfo.databaseId),n=new ph(t.databaseInfo);return function(t,e,n){return new Oh(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Ol(s.syncEngine,t,0)},o=lh.yt()?new lh:new hh,new Eh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new yl(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(at.b)(this,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return e=ki(t),Ii("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Sh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),$l=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),Zl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new uu,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(at.d)(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new cl(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return Object(at.b)(this,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(at.b)(this,void 0,void 0,(function(){var e,n=this;return Object(at.d)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new mi(vi.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(at.d)(this,(function(u){switch(u.label){case 0:return n=ki(t),r=wa(n.R)+"/documents",i={documents:e.map((function(t){return ya(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Si(!!e.found);var n=va(t,e.found.name),r=da(e.found.updateTime),i=new po({mapValue:{fields:e.found.fields}});return yo.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Si(!!e.missing),Si(!!e.readTime);var n=va(t,e.missing),r=da(e.readTime);return yo.newNoDocument(n,r)}(t,e):_i()}(n.R,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Si(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Ds(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e=this;return Object(at.d)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Zi.fromPath(n);e.mutations.push(new As(r,e.precondition(r)))})),[4,function(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:return n=ki(t),r=wa(n.R)+"/documents",i={writes:e.map((function(t){return Ea(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw _i();e=Ri.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new mi(vi.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?vs.updateTime(e):vs.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Ri.min()))throw new mi(vi.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return vs.updateTime(e)}return vs.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),tf=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new mh(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return Object(at.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(at.d)(this,(function(r){return t=new Zl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Xi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ps(e)}return!1},t}(),ef=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Zc.UNAUTHENTICATED,this.clientId=Ni.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return Object(at.b)(r,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return Ii("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new mi(vi.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new uu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return Object(at.b)(t,void 0,void 0,(function(){var t,n;return Object(at.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Jh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function nf(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(at.d)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Ii("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return Object(at.b)(i,void 0,void 0,(function(){return Object(at.d)(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Nc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function rf(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r;return Object(at.d)(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,of(t)];case 1:return n=i.sent(),Ii("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return Object(at.b)(this,void 0,void 0,(function(){var n,r;return Object(at.d)(this,(function(i){switch(i.label){case 0:return(n=ki(t)).asyncQueue.verifyOperationInProgress(),Ii("RemoteStore","RemoteStore received new credentials"),r=Ah(n),n.Or.add(3),[4,Sh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,_h(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function of(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Ii("FirestoreClient","Using default OfflineComponentProvider"),[4,nf(t,new Hl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function sf(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Ii("FirestoreClient","Using default OnlineComponentProvider"),[4,rf(t,new Jl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function af(t){return of(t).then((function(t){return t.persistence}))}function uf(t){return of(t).then((function(t){return t.localStore}))}function cf(t){return sf(t).then((function(t){return t.remoteStore}))}function hf(t){return sf(t).then((function(t){return t.syncEngine}))}function lf(t){return Object(at.b)(this,void 0,void 0,(function(){var e,n;return Object(at.d)(this,(function(r){switch(r.label){case 0:return[4,sf(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=vl.bind(null,e.syncEngine),n.onUnlisten=bl.bind(null,e.syncEngine),n)]}}))}))}function ff(t,e,n){var r=this;void 0===n&&(n={});var i=new uu;return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(r,void 0,void 0,(function(){var r;return Object(at.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new $l({next:function(o){e.enqueueAndForget((function(){return il(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new mi(vi.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new mi(vi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new ul(Vo(n.path),o,{includeMetadataChanges:!0,so:!0});return rl(t,s)},[4,lf(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function df(t,e,n){var r=this;void 0===n&&(n={});var i=new uu;return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(r,void 0,void 0,(function(){var r;return Object(at.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new $l({next:function(n){e.enqueueAndForget((function(){return il(t,s)})),n.fromCache&&"server"===r.source?i.reject(new mi(vi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new ul(n,o,{includeMetadataChanges:!0,so:!0});return rl(t,s)},[4,lf(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var pf=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},gf=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),yf=new Map,vf=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},mf=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(Zc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),bf=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),wf=function(){function t(t){var e=this;this.currentUser=Zc.UNAUTHENTICATED,this.oc=new uu,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){Ii("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Ii("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(Ii("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Si("string"==typeof n.accessToken),new vf(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return Object(at.b)(n,void 0,void 0,(function(){return Object(at.d)(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Si(null===t||"string"==typeof t),new Zc(t)},t}(),If=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Zc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Of=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new If(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(Zc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Tf(t,e,n){if(!n)throw new mi(vi.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ef(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new mi(vi.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function _f(t,e,n,r){if(!0===e&&!0===r)throw new mi(vi.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Sf(t){if(!Zi.isDocumentKey(t))throw new mi(vi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function kf(t){if(Zi.isDocumentKey(t))throw new mi(vi.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function xf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":_i()}function Nf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new mi(vi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=xf(t);throw new mi(vi.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Cf(t,e){if(e<=0)throw new mi(vi.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var jf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new mi(vi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new mi(vi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,_f("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Df=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jf({}),this._settingsFrozen=!1,t instanceof gf?(this._databaseId=t,this._credentials=new mf):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new mi(vi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gf(t.options.projectId)}(t),this._credentials=new wf(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new mi(vi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new mi(vi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new mf;switch(t.type){case"gapi":var e=t.client;return Si(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Of(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new mi(vi.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=yf.get(this))&&(Ii("ComponentProvider","Removing Datastore"),yf.delete(this),t.terminate()),Promise.resolve();var t},t}(),Af=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Pf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Rf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Pf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Vo(r))||this)._path=r,i.type="collection",i}return Object(at.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Af(this.firestore,null,new Zi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Rf);function Lf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(ut.h)(t),Tf("collection","path",e),t instanceof Df)return kf(n=Vi.fromString.apply(Vi,Object(at.f)([e],r))),new Pf(t,null,n);if(!(t instanceof Af||t instanceof Pf))throw new mi(vi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return kf(n=Vi.fromString.apply(Vi,Object(at.f)([t.path],r)).child(Vi.fromString(e))),new Pf(t.firestore,null,n)}function Ff(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(ut.h)(t),1===arguments.length&&(e=Ni.u()),Tf("doc","path",e),t instanceof Df)return Sf(n=Vi.fromString.apply(Vi,Object(at.f)([e],r))),new Af(t,null,new Zi(n));if(!(t instanceof Af||t instanceof Pf))throw new mi(vi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Sf(n=t._path.child(Vi.fromString.apply(Vi,Object(at.f)([e],r)))),new Af(t.firestore,t instanceof Pf?t.converter:null,new Zi(n))}function Mf(t,e){return t=Object(ut.h)(t),e=Object(ut.h)(e),(t instanceof Af||t instanceof Pf)&&(e instanceof Af||e instanceof Pf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Vf(t,e){return t=Object(ut.h)(t),e=Object(ut.h)(e),t instanceof Rf&&e instanceof Rf&&t.firestore===e.firestore&&Ho(t._query,e._query)&&t.converter===e.converter}var Uf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new mh(this,"async_queue_retry"),this.Ic=function(){var e=yh();e&&Ii("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=yh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=yh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new uu;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return Object(at.b)(this,void 0,void 0,(function(){var t,e=this;return Object(at.d)(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!pu(t=n.sent()))throw t;return Ii("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,Oi("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Xh.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&_i()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(at.b)(this,void 0,void 0,(function(){var t;return Object(at.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function qf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new uu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Bf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Uf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(at.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Gf(this),this._firestoreClient.terminate()},e}(Df);function Kf(t){return t._firestoreClient||Gf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Gf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new pf(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ef(t._credentials,t._queue,r)}function zf(t,e,n){var r=this,i=new uu;return t.asyncQueue.enqueue((function(){return Object(at.b)(r,void 0,void 0,(function(){var r;return Object(at.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,nf(t,n)];case 1:return o.sent(),[4,rf(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===vi.FAILED_PRECONDITION||t.code===vi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Qf(t){if(t._initialized||t._terminated)throw new mi(vi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Wf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new mi(vi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Hf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Ki.fromBase64String(e))}catch(e){throw new mi(vi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Ki.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Yf=function(t){this._methodName=t},Xf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new mi(vi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new mi(vi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Ci(this._lat,t._lat)||Ci(this._long,t._long)},t}(),Jf=/^__.*__$/,$f=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Ss(t,this.data,this.fieldMask,e,this.fieldTransforms):new _s(t,this.data,e,this.fieldTransforms)},t}(),Zf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Ss(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function td(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _i()}}var ed=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return Id(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(td(this.Nc)&&Jf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),nd=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||vh(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new ed({Nc:t,methodName:e,qc:n,path:qi.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function rd(t){var e=t._freezeSettings(),n=vh(t._databaseId);return new nd(t._databaseId,!!e.ignoreUndefinedProperties,n)}function id(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);vd("Data must be an object, but it was:",s,r);var a,u,c=gd(r,s);if(o.merge)a=new Bi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=md(e,f[l],n);if(!s.contains(d))throw new mi(vi.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Od(h,d)||h.push(d)}a=new Bi(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new $f(new po(c),a,u)}var od=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Yf);function sd(t,e,n){return new ed({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var ad=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e.prototype._toFieldTransform=function(t){return new gs(t.path,new as)},e.prototype.isEqual=function(t){return t instanceof e},e}(Yf),ud=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(at.c)(e,t),e.prototype._toFieldTransform=function(t){var e=sd(this,t,!0),n=this.Kc.map((function(t){return pd(t,e)})),r=new us(n);return new gs(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Yf),cd=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(at.c)(e,t),e.prototype._toFieldTransform=function(t){var e=sd(this,t,!0),n=this.Kc.map((function(t){return pd(t,e)})),r=new hs(n);return new gs(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Yf),hd=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(at.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new fs(t.R,ns(t.R,this.Qc));return new gs(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Yf);function ld(t,e,n,r){var i=t.Uc(1,e,n);vd("Data must be an object, but it was:",i,r);var o=[],s=po.empty();Li(r,(function(t,r){var a=wd(e,t,n);r=Object(ut.h)(r);var u=i.Oc(a);if(r instanceof od)o.push(a);else{var c=pd(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Bi(o);return new Zf(s,a,i.fieldTransforms)}function fd(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[md(e,r,n)],u=[i];if(o.length%2!=0)throw new mi(vi.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(md(e,o[c])),u.push(o[c+1]);for(var h=[],l=po.empty(),f=a.length-1;f>=0;--f)if(!Od(h,a[f])){var d=a[f],p=u[f];p=Object(ut.h)(p);var g=s.Oc(d);if(p instanceof od)h.push(d);else{var y=pd(p,g);null!=y&&(h.push(d),l.set(d,y))}}var v=new Bi(h);return new Zf(l,v,s.fieldTransforms)}function dd(t,e,n,r){return void 0===r&&(r=!1),pd(n,t.Uc(r?4:3,e))}function pd(t,e){if(yd(t=Object(ut.h)(t)))return vd("Unsupported field value:",e,t),gd(t,e);if(t instanceof Yf)return function(t,e){if(!td(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=pd(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(ut.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ns(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ai.fromDate(t);return{timestampValue:ha(e.R,n)}}if(t instanceof Ai)return n=new Ai(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ha(e.R,n)};if(t instanceof Xf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Hf)return{bytesValue:la(e.R,t._byteString)};if(t instanceof Af){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:pa(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+xf(t))}(t,e)}function gd(t,e){var n={};return Fi(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Li(t,(function(t,r){var i=pd(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function yd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ai||t instanceof Xf||t instanceof Hf||t instanceof Af||t instanceof Yf)}function vd(t,e,n){if(!yd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=xf(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function md(t,e,n){if((e=Object(ut.h)(e))instanceof Wf)return e._internalPath;if("string"==typeof e)return wd(t,e);throw Id("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var bd=new RegExp("[~\\*/\\[\\]]");function wd(t,e,n){if(e.search(bd)>=0)throw Id("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Wf.bind.apply(Wf,Object(at.f)([void 0],e.split(".")))))._internalPath}catch(Op){throw Id("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Id(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new mi(vi.INVALID_ARGUMENT,(a+=". ")+t+u)}function Od(t,e){return t.some((function(t){return t.isEqual(e)}))}var Td=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Af(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Ed(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(_d("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Ed=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Td);function _d(t,e){return"string"==typeof e?wd(t,e):e instanceof Wf?e._internalPath:e._delegate._internalPath}var Sd=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),kd=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(at.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new xd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(_d("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Td),xd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(kd),Nd=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Sd(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new xd(n._firestore,n._userDataWriter,r.key,r,new Sd(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new mi(vi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new xd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Sd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new xd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Sd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Cd(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Cd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _i()}}function jd(t,e){return t instanceof kd&&e instanceof kd?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Nd&&e instanceof Nd&&t._firestore===e._firestore&&Vf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Dd(t){if(qo(t)&&0===t.explicitOrderBy.length)throw new mi(vi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ad=function(){};function Rd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Pd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(at.c)(e,t),e.prototype._apply=function(t){var e=rd(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new mi(vi.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Bd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(qd(r,t,h[c]));a={arrayValue:{values:u}}}else a=qd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Bd(s,o),a=dd(n,"where",s,"in"===o||"not-in"===o);var l=Oo.create(i,o,a);return function(t,e){if(e.g()){var n=Ko(t);if(null!==n&&!n.isEqual(e.field))throw new mi(vi.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Bo(t);null!==r&&Kd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new mi(vi.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Rf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Ad),Ld=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(at.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new mi(vi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new mi(vi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ao(e,n);return function(t,e){if(null===Bo(t)){var n=Ko(t);null!==n&&Kd(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Rf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Fo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Ad),Fd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(at.c)(e,t),e.prototype._apply=function(t){return new Rf(t.firestore,t.converter,Wo(t._query,this.Hc,this.Jc))},e}(Ad),Md=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(at.c)(e,t),e.prototype._apply=function(t){var e=Ud(t,this.type,this.Yc,this.Xc);return new Rf(t.firestore,t.converter,function(t,e){return new Fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Ad),Vd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(at.c)(e,t),e.prototype._apply=function(t){var e=Ud(t,this.type,this.Yc,this.Xc);return new Rf(t.firestore,t.converter,function(t,e){return new Fo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Ad);function Ud(t,e,n,r){if(n[0]=Object(ut.h)(n[0]),n[0]instanceof Td)return function(t,e,n,r,i){if(!r)throw new mi(vi.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=zo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(so(e,r.key));else{var c=r.data.field(u.field);if(Hi(c))throw new mi(vi.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new mi(vi.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new jo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=rd(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new mi(vi.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new mi(vi.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Go(t)&&-1!==c.indexOf("/"))throw new mi(vi.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Vi.fromString(c));if(!Zi.isDocumentKey(h))throw new mi(vi.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Zi(h);a.push(so(e,l))}else{var f=dd(n,r,c);a.push(f)}}return new jo(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function qd(t,e,n){if("string"==typeof(n=Object(ut.h)(n))){if(""===n)throw new mi(vi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Go(e)&&-1!==n.indexOf("/"))throw new mi(vi.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Vi.fromString(n));if(!Zi.isDocumentKey(r))throw new mi(vi.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return so(t,new Zi(r))}if(n instanceof Af)return so(t,n._key);throw new mi(vi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+xf(n)+".")}function Bd(t,e){if(!Array.isArray(t)||0===t.length)throw new mi(vi.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new mi(vi.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Kd(t,e,n){if(!n.isEqual(e))throw new mi(vi.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Gd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),to(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Qi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Wi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw _i()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Li(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Xf(Qi(t.latitude),Qi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return Hi(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Yi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=zi(t);return new Ai(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Vi.fromString(t);Si(Ma(n));var r=new gf(n.get(1),n.get(3)),i=new Zi(n.popFirst(5));return r.isEqual(e)||Oi("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function zd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Qd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(at.c)(e,t),e.prototype.convertBytes=function(t){return new Hf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Af(this.firestore,null,e)},e}(Gd),Wd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=rd(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Hd(t,this._firestore),i=zd(r.converter,e,n),o=id(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,vs.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Hd(t,this._firestore);return o="string"==typeof(e=Object(ut.h)(e))||e instanceof Wf?fd(this._dataReader,"WriteBatch.update",s._key,e,n,r):ld(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,vs.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Hd(t,this._firestore);return this._mutations=this._mutations.concat(new Ds(e._key,vs.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new mi(vi.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Hd(t,e){if((t=Object(ut.h)(t)).firestore!==e)throw new mi(vi.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Yd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(at.c)(e,t),e.prototype.convertBytes=function(t){return new Hf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Af(this.firestore,null,e)},e}(Gd);function Xd(t,e,n){t=Nf(t,Af);var r=Nf(t.firestore,Bf),i=zd(t.converter,e,n);return Zd(r,[id(rd(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,vs.none())])}function Jd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Nf(t,Af);var o=Nf(t.firestore,Bf),s=rd(o);return Zd(o,[("string"==typeof(e=Object(ut.h)(e))||e instanceof Wf?fd(s,"updateDoc",t._key,e,n,r):ld(s,"updateDoc",t._key,e)).toMutation(t._key,vs.exists(!0))])}function $d(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(ut.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||qf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(qf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Af)c=Nf(t.firestore,Bf),h=Vo(t._key.path),u={next:function(e){i[a]&&i[a](tp(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Nf(t,Rf);c=Nf(d.firestore,Bf),h=d._query;var p=new Yd(c);u={next:function(t){i[a]&&i[a](new Nd(c,p,d,t))},error:i[a+1],complete:i[a+2]},Dd(t._query)}return function(t,e,n,r){var i=this,o=new $l(r),s=new ul(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(i,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return e=rl,[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(i,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return e=il,[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(Kf(c),h,l,u)}function Zd(t,e){return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(n,void 0,void 0,(function(){var n;return Object(at.d)(this,(function(i){switch(i.label){case 0:return n=wl,[4,hf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Kf(t),e)}function tp(t,e,n){var r=n.docs.get(e._key),i=new Yd(t);return new kd(t,i,e._key,r,new Sd(n.hasPendingWrites,n.fromCache),e.converter)}var ep=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(at.c)(e,t),e.prototype.get=function(e){var n=this,r=Hd(e,this._firestore),i=new Yd(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new kd(n._firestore,i,r._key,t._document,new Sd(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=rd(t)}return t.prototype.get=function(t){var e=this,n=Hd(t,this._firestore),r=new Qd(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return _i();var i=t[0];if(i.isFoundDocument())return new Td(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Td(e._firestore,r,n._key,null,n.converter);throw _i()}))},t.prototype.set=function(t,e,n){var r=Hd(t,this._firestore),i=zd(r.converter,e,n),o=id(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Hd(t,this._firestore);return o="string"==typeof(e=Object(ut.h)(e))||e instanceof Wf?fd(this._dataReader,"Transaction.update",s._key,e,n,r):ld(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Hd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function np(){if("undefined"==typeof Uint8Array)throw new mi(vi.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function rp(){if("undefined"==typeof atob)throw new mi(vi.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ip=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return rp(),new t(Hf.fromBase64String(e))},t.fromUint8Array=function(e){return np(),new t(Hf.fromUint8Array(e))},t.prototype.toBase64=function(){return rp(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return np(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),op=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Qf(t=Nf(t,Bf));var n=Kf(t),r=t._freezeSettings(),i=new Jl;return zf(n,i,new Yl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Qf(t=Nf(t,Bf));var e=Kf(t),n=t._freezeSettings(),r=new Jl;return zf(e,r,new Xl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new mi(vi.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new uu;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return Object(at.b)(e,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(at.b)(this,void 0,void 0,(function(){return Object(at.d)(this,(function(e){switch(e.label){case 0:return lu.yt()?[4,lu.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(Oc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),sp=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof gf||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Ti("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=Nf(t,Df))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Ti("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=Zc.MOCK_USER;else{s=Object(ut.d)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new mi(vi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Zc(u)}t._credentials=new bf(new vf(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(at.b)(e,void 0,void 0,(function(){var e,n;return Object(at.d)(this,(function(r){switch(r.label){case 0:return[4,af(t)];case 1:return e=r.sent(),[4,cf(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=ki(t);return e.Or.delete(0),_h(e)}(n))]}}))}))}))}(Kf(Nf(this._delegate,Bf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(at.b)(e,void 0,void 0,(function(){var e,n;return Object(at.d)(this,(function(r){switch(r.label){case 0:return[4,af(t)];case 1:return e=r.sent(),[4,cf(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(at.b)(this,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return(e=ki(t)).Or.add(0),[4,Sh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Kf(Nf(this._delegate,Bf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&_f("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new uu;return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(e,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(r){switch(r.label){case 0:return e=Sl,[4,hf(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Kf(Nf(this._delegate,Bf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new $l(e);return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(n,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){ki(t).Gr.add(e),e.next()},[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(n,void 0,void 0,(function(){var e;return Object(at.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){ki(t).Gr.delete(e)},[4,lf(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Kf(t=Nf(t,Bf)),qf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new mi(vi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wp(this,Lf(this._delegate,t))}catch(t){throw fp(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new lp(this,Ff(this._delegate,t))}catch(t){throw fp(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new vp(this,function(t,e){if(t=Nf(t,Df),Tf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new mi(vi.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Rf(t,null,function(t){return new Fo(Vi.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw fp(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(n,void 0,void 0,(function(){var n;return Object(at.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return sf(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new tf(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Kf(t),(function(n){return e(new ep(t,n))}))}(this._delegate,(function(n){return t(new up(e,n))}))},t.prototype.batch=function(){var t=this;return Kf(this._delegate),new cp(new Wd(this._delegate,(function(e){return Zd(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new mi(vi.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new mi(vi.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),ap=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(at.c)(e,t),e.prototype.convertBytes=function(t){return new ip(new Hf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return lp.eu(e,this.firestore,null)},e}(Gd),up=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new ap(t)}return t.prototype.get=function(t){var e=this,n=Ip(t);return this._delegate.get(n).then((function(t){return new gp(e._firestore,new kd(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=Ip(t);return n?(Ef("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ip(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(at.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ip(t);return this._delegate.delete(e),this},t}(),cp=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ip(t);return n?(Ef("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ip(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(at.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ip(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),hp=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new xd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new yp(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new ap(e),n),i.set(n,o)),o},t}();hp.su=new WeakMap;var lp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new ap(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new mi(vi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Af(n._delegate,r,new Zi(e)))},t.eu=function(e,n,r){return new t(n,new Af(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new wp(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wp(this.firestore,Lf(this._delegate,t))}catch(t){throw fp(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(ut.h)(t))instanceof Af&&Mf(this._delegate,t)},t.prototype.set=function(t,e){e=Ef("DocumentReference.set",e);try{return e?Xd(this._delegate,t,e):Xd(this._delegate,t)}catch(t){throw fp(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Jd(this._delegate,t):Jd.apply(void 0,Object(at.f)([this._delegate,t,e],n))}catch(t){throw fp(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Zd(Nf((t=this._delegate).firestore,Bf),[new Ds(t._key,vs.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=dp(e),i=pp(e,(function(e){return new gp(t.firestore,new kd(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return $d(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Nf(t,Af);var e=Nf(t.firestore,Bf),n=Kf(e),r=new Yd(e);return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(n,void 0,void 0,(function(){var n;return Object(at.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i;return Object(at.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=ki(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new mi(vi.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Jh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,uf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new kd(e,r,t._key,n,new Sd(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Nf(t,Af);var e=Nf(t.firestore,Bf);return ff(Kf(e),t._key,{source:"server"}).then((function(n){return tp(e,t,n)}))}(this._delegate):function(t){t=Nf(t,Af);var e=Nf(t.firestore,Bf);return ff(Kf(e),t._key).then((function(n){return tp(e,t,n)}))}(this._delegate)).then((function(t){return new gp(e.firestore,new kd(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?hp.nu(this.firestore,e):null))},t}();function fp(t,e,n){return t.message=t.message.replace(e,n),t}function dp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!qf(r))return r}return{}}function pp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=qf(t[0])?t[0]:qf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var gp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new lp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return jd(this._delegate,t._delegate)},t}(),yp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(at.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(gp),vp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new ap(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Rd(this._delegate,function(t,e,n){var r=e,i=_d("where",t);return new Pd(i,r,n)}(e,n,r)))}catch(e){throw fp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Rd(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=_d("orderBy",t);return new Ld(r,n)}(e,n)))}catch(e){throw fp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Rd(this._delegate,function(t){return Cf("limit",t),new Fd("limit",t,"F")}(e)))}catch(e){throw fp(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Rd(this._delegate,function(t){return Cf("limitToLast",t),new Fd("limitToLast",t,"L")}(e)))}catch(e){throw fp(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Rd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Md("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw fp(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Rd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Md("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw fp(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Rd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw fp(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Rd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw fp(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Vf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Nf(t,Rf);var e=Nf(t.firestore,Bf),n=Kf(e),r=new Yd(e);return function(t,e){var n=this,r=new uu;return t.asyncQueue.enqueueAndForget((function(){return Object(at.b)(n,void 0,void 0,(function(){var n;return Object(at.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(at.b)(this,void 0,void 0,(function(){var r,i,o,s,a;return Object(at.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Fc(t,e,!0)];case 1:return a=u.sent(),r=new dl(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Jh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,uf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Nd(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Nf(t,Rf);var e=Nf(t.firestore,Bf),n=Kf(e),r=new Yd(e);return df(n,t._query,{source:"server"}).then((function(n){return new Nd(e,r,t,n)}))}(this._delegate):function(t){t=Nf(t,Rf);var e=Nf(t.firestore,Bf),n=Kf(e),r=new Yd(e);return Dd(t._query),df(n,t._query).then((function(n){return new Nd(e,r,t,n)}))}(this._delegate)).then((function(t){return new bp(e.firestore,new Nd(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=dp(e),i=pp(e,(function(e){return new bp(t.firestore,new Nd(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return $d(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?hp.nu(this.firestore,e):null))},t}(),mp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new yp(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),bp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new vp(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new yp(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new mp(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new yp(n._firestore,r))}))},t.prototype.isEqual=function(t){return jd(this._delegate,t._delegate)},t}(),wp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(at.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new lp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new lp(this.firestore,void 0===t?Ff(this._delegate):Ff(this._delegate,t))}catch(t){throw fp(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Nf(t.firestore,Bf),r=Ff(t),i=zd(t.converter,e);return Zd(n,[id(rd(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,vs.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new lp(e.firestore,t)}))},e.prototype.isEqual=function(t){return Mf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?hp.nu(this.firestore,t):null))},e}(vp);function Ip(t){return Nf(t,Af)}var Op,Tp=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Wf.bind.apply(Wf,Object(at.f)([void 0],t)))}return t.documentId=function(){return new t(qi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(ut.h)(t))instanceof Wf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Ep=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new ad("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new od("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ud("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cd("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new hd("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),_p=a("/6Yf"),Sp={Firestore:sp,GeoPoint:Xf,Timestamp:Ai,Blob:ip,Transaction:up,WriteBatch:cp,DocumentReference:lp,DocumentSnapshot:gp,Query:vp,QueryDocumentSnapshot:yp,QuerySnapshot:bp,CollectionReference:wp,FieldPath:Tp,FieldValue:Ep,setLogLevel:function(t){bi.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function kp(t,e){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.b;return new O.a((function(n){var r;return null!=e?e.schedule((function(){r=t.onSnapshot({includeMetadataChanges:!0},n)})):r=t.onSnapshot({includeMetadataChanges:!0},n),function(){null!=r&&r()}}))}(t,e)}function xp(t,e){return kp(t,e).pipe(Object(m.a)((function(t){return{payload:t,type:"query"}})))}function Np(t,e){return xp(t,e).pipe(Object($.a)(void 0),tt(),Object(m.a)((function(t){var e=r(t,2),n=e[0],i=e[1],o=i.payload.docChanges(),s=o.map((function(t){return{type:t.type,payload:t}}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((function(t,e){var r=o.find((function(e){return e.doc.ref.isEqual(t.ref)})),i=null==n?void 0:n.payload.docs.find((function(e){return e.ref.isEqual(t.ref)}));r&&JSON.stringify(r.doc.metadata)===JSON.stringify(t.metadata)||!r&&i&&JSON.stringify(i.metadata)===JSON.stringify(t.metadata)||s.push({type:"modified",payload:{oldIndex:e,newIndex:e,type:"modified",doc:t}})})),s})))}function Cp(t,e,n){return Np(t,n).pipe(Object(rt.a)((function(t,n){return function(t,e,n){return e.forEach((function(e){n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return jp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){var n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return jp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return jp(t,e.oldIndex,1)}return t}(t,e))})),t}(t,n.map((function(t){return t.payload})),e)}),[]),(function(t){return t.lift(new it(void 0,void 0))}),Object(m.a)((function(t){return t.map((function(t){return{type:t.type,payload:t}}))})))}function jp(t,e,n){for(var r=t.slice(),i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return r.splice.apply(r,[e,n].concat(o)),r}function Dp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}(function(t,e){t.INTERNAL.registerComponent(new _p.a("firestore",(function(t){return function(t,e){return new sp(t,new Bf(t,e),new op)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Sp)))})(Op=st.a),Op.registerVersion("@firebase/firestore","2.4.1");var Ap=function(){function t(e,n,r){s(this,t),this.ref=e,this.query=n,this.afs=r}return u(t,[{key:"stateChanges",value:function(t){var e=Np(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(m.a)((function(e){return e.filter((function(e){return t.indexOf(e.type)>-1}))})))),e.pipe(Object($.a)(void 0),tt(),Object(M.a)((function(t){var e=r(t,2),n=e[0];return e[1].length>0||!n})),Object(m.a)((function(t){var e=r(t,2);e[0];return e[1]})),this.afs.keepUnstableUntilFirst)}},{key:"auditTrail",value:function(t){return this.stateChanges(t).pipe(Object(rt.a)((function(t,e){return[].concat(n(t),n(e))}),[]))}},{key:"snapshotChanges",value:function(t){var e=Dp(t);return Cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return xp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)((function(n){return n.payload.docs.map((function(n){return t.idField?Object.assign(Object.assign({},n.data()),e({},t.idField,n.id)):n.data()}))})),this.afs.keepUnstableUntilFirst)}},{key:"get",value:function(t){return Object(T.a)(this.query.get(t)).pipe(Object(_.b)(this.afs.schedulers.insideAngular))}},{key:"add",value:function(t){return this.ref.add(t)}},{key:"doc",value:function(t){return new Rp(this.ref.doc(t),this.afs)}}]),t}(),Rp=function(){function t(e,n){s(this,t),this.ref=e,this.afs=n}return u(t,[{key:"set",value:function(t,e){return this.ref.set(t,e)}},{key:"update",value:function(t){return this.ref.update(t)}},{key:"delete",value:function(){return this.ref.delete()}},{key:"collection",value:function(t,e){var n=Up(this.ref.collection(t),e),r=n.ref,i=n.query;return new Ap(r,i,this.afs)}},{key:"snapshotChanges",value:function(){return kp(this.ref,this.afs.schedulers.outsideAngular).pipe(Object($.a)(void 0),tt(),Object(m.a)((function(t){var e=r(t,2),n=e[0],i=e[1];return i.exists?(null==n?void 0:n.exists)?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.snapshotChanges().pipe(Object(m.a)((function(n){var r=n.payload;return t.idField?Object.assign(Object.assign({},r.data()),e({},t.idField,r.id)):r.data()})))}},{key:"get",value:function(t){return Object(T.a)(this.ref.get(t)).pipe(Object(_.b)(this.afs.schedulers.insideAngular))}}]),t}(),Pp=function(){function t(e,n){s(this,t),this.query=e,this.afs=n}return u(t,[{key:"stateChanges",value:function(t){return t&&0!==t.length?Np(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)((function(e){return e.filter((function(e){return t.indexOf(e.type)>-1}))})),Object(M.a)((function(t){return t.length>0})),this.afs.keepUnstableUntilFirst):Np(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"auditTrail",value:function(t){return this.stateChanges(t).pipe(Object(rt.a)((function(t,e){return[].concat(n(t),n(e))}),[]))}},{key:"snapshotChanges",value:function(t){var e=Dp(t);return Cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}},{key:"valueChanges",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return xp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(m.a)((function(n){return n.payload.docs.map((function(n){return t.idField?Object.assign(e({},t.idField,n.id),n.data()):n.data()}))})),this.afs.keepUnstableUntilFirst)}},{key:"get",value:function(t){return Object(T.a)(this.query.get(t)).pipe(Object(_.b)(this.afs.schedulers.insideAngular))}}]),t}(),Lp=new p.q("angularfire2.enableFirestorePersistence"),Fp=new p.q("angularfire2.firestore.persistenceSettings"),Mp=new p.q("angularfire2.firestore.settings"),Vp=new p.q("angularfire2.firestore.use-emulator");function Up(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t};return{query:e(t),ref:t}}var qp,Bp,Kp,Gp=((Bp=function(){function t(e,i,o,a,u,c,l,f,d){s(this,t),this.schedulers=new V.d(c),this.keepUnstableUntilFirst=Object(V.h)(this.schedulers);var p=Object(V.g)(e,c,i);!Y.a.auth&&d&&Object(V.j)();var g=f,v=r(Object(V.f)(p.name+".firestore","AngularFirestore",p,(function(){var t=c.runOutsideAngular((function(){return p.firestore()}));return a&&t.settings(a),g&&t.useEmulator.apply(t,n(g)),o&&!Object(h.s)(u)?[t,c.runOutsideAngular((function(){try{return Object(T.a)(t.enablePersistence(l||void 0).then((function(){return!0}),(function(){return!1})))}catch(Op){return"undefined"!=typeof console&&console.warn(Op),Object(y.a)(!1)}}))]:[t,Object(y.a)(!1)]}),[a,g,o]),2);this.firestore=v[0],this.persistenceEnabled$=v[1]}return u(t,[{key:"collection",value:function(t,e){var n=Up("string"==typeof t?this.firestore.collection(t):t,e),r=n.ref,i=n.query,o=this.schedulers.ngZone.run((function(){return r}));return new Ap(o,i,this)}},{key:"collectionGroup",value:function(t,e){var n=e||function(t){return t},r=this.firestore.collectionGroup(t);return new Pp(n(r),this)}},{key:"doc",value:function(t){var e;e="string"==typeof t?this.firestore.doc(t):t;var n=this.schedulers.ngZone.run((function(){return e}));return new Rp(n,this)}},{key:"createId",value:function(){return this.firestore.collection("_").doc().id}}]),t}()).\u0275fac=function(t){return new(t||Bp)(p.Sb(V.c),p.Sb(V.b,8),p.Sb(Lp,8),p.Sb(Mp,8),p.Sb(p.B),p.Sb(p.z),p.Sb(Fp,8),p.Sb(Vp,8),p.Sb(U,8))},Bp.\u0275prov=p.Eb({factory:function(){return new Bp(p.Sb(V.c),p.Sb(V.b,8),p.Sb(Lp,8),p.Sb(Mp,8),p.Sb(p.B),p.Sb(p.z),p.Sb(Fp,8),p.Sb(Vp,8),p.Sb(U,8))},token:Bp,providedIn:"any"}),Bp),zp=((qp=function(){function t(e,n,r){s(this,t),this.auth=e,this.router=n,this.firestore=r,this.db=this.firestore.collection("users"),this.authUser=this.auth.user}return u(t,[{key:"login",value:function(){var t=this;return this.auth.signInWithPopup(new Y.a.auth.GoogleAuthProvider).then((function(e){t.authUser=t.auth.user,t.router.navigateByUrl("/user/profile")}))}},{key:"logout",value:function(){var t=this;this.auth.signOut().then((function(e){t.router.navigateByUrl("/")}))}},{key:"createUser",value:function(t){var e=this.db.doc(t.uid),n=this.getCurrentTime(),r=X.User,i={id:t.uid,name:t.displayName,auth_data:[Object.assign({},t.providerData[0])],email:t.email,image_url:t.photoURL,level:r,created_time:n,last_login:n,max_card_limit:5,max_card_edit_limit:1e3,total_card:0,total_card_edit:0};e.set(i)}},{key:"createRealfarmInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe((function(r){var i=r.data();if(i.total_card<i.max_card_limit&&i.total_card_edit<i.max_card_edit_limit){var o=n.getUID(),s=n.getCurrentTime(),a=Object.assign(Object.assign({},e),{id:o,uid:i.name,last_update:s,created_time:s});n.db.doc(t).collection("realfarms").doc(o).set(a),n.updateUser(t,"total_card",i.total_card+1)}}))}},{key:"updateUser",value:function(t,e,n){var r=this.db.doc(t),i={};i[e]=n,r.update(i)}},{key:"upateRealFamrInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe((function(r){var i=r.data();if(i.total_card_edit<i.max_card_edit_limit){n.getUID();var o=n.getCurrentTime(),s=Object.assign(Object.assign({},e),{id:e.id,uid:e.uid,last_update:o,created_time:e.created_time});n.db.doc(t).collection("realfarms").doc(e.id).update(s),n.updateUser(t,"total_card_edit",i.total_card_edit+1)}}))}},{key:"deleteRealFarmInfo",value:function(t,e){var n=this;this.db.doc(t).get().subscribe((function(r){var i=r.data();n.db.doc(t).collection("realfarms").doc(e.id).delete(),n.updateUser(t,"total_card",i.total_card-1)}))}},{key:"updateUserCollection",value:function(t,e,n){this.db.doc(t).collection(e).doc(n.id).update(n)}},{key:"getCurrentTime",value:function(){var t=new Date;return t.toDateString()+" "+t.toTimeString()}},{key:"getUID",value:function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)}}]),t}()).\u0275fac=function(t){return new(t||qp)(p.Sb(Q),p.Sb(f.c),p.Sb(Gp))},qp.\u0275prov=p.Eb({token:qp,factory:qp.\u0275fac,providedIn:"any"}),qp),Qp=a("320Y"),Wp=((Kp=function(){function t(e){s(this,t),this.user=e}return u(t,[{key:"ngOnInit",value:function(){}},{key:"login",value:function(){this.user.login()}}]),t}()).\u0275fac=function(t){return new(t||Kp)(p.Ib(zp))},Kp.\u0275cmp=p.Cb({type:Kp,selectors:[["app-login"]],decls:6,vars:4,consts:[["title","\u6b61\u8fce\u4f86\u5230\u500b\u4eba\u9801\u9762","subtitle","\u8acb\u767b\u5165\u4ee5\u7e7c\u7e8c\u4f7f\u7528",3,"showBackIcon","showCustomIcon"],[1,"container"],["id","googleBtn",1,"button",3,"click"],["src","/assets/others/g-logo.png",3,"width","height"]],template:function(t,e){1&t&&(p.Jb(0,"app-header",0),p.Ob(1,"section",1),p.Ob(2,"button",2),p.Vb("click",(function(){return e.login()})),p.Jb(3,"img",3),p.Ob(4,"span"),p.sc(5,"\u4f7f\u7528 Google \u767b\u5165"),p.Nb(),p.Nb(),p.Nb()),2&t&&(p.dc("showBackIcon",!1)("showCustomIcon",!1),p.yb(3),p.dc("width",18)("height",18))},directives:[Qp.a],styles:[".container[_ngcontent-%COMP%]{display:flex;width:90%;margin:16px auto;justify-content:center}#googleBtn[_ngcontent-%COMP%]{display:flex;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;border:0;border-radius:2px;padding:11px 8px}#googleBtn[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{height:18px;width:18px;padding-right:24px}#googleBtn[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{cursor:inherit;height:18px;font-size:14px;color:rgba(0,0,0,.54);font-weight:600;display:inline-block;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}"]}),Kp),Hp=a("wHSu"),Yp=a("Nv++"),Xp=function(){function t(){s(this,t)}return u(t,null,[{key:"drawRect",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#FFFFF",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"#333333";t.fillStyle=o,t.fillRect(e,n,r,i),s>0&&(t.strokeStyle=a,t.lineWidth=s,t.strokeRect(e,n,r,i))}},{key:"drawRoundRect",value:function(t,e,n,r,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#FFFFFF",a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"#333333";r<2*o&&(o=r/2),i<2*o&&(o=i/2),t.fillStyle=s,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.fill(),a>0&&(t.strokeStyle=u,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.stroke())}},{key:"addImage",value:function(t,e,n,r,i,o){var s=new Image;s.onload=function(){t.drawImage(s,n,r,i,o)},s.src=e}},{key:"addImageSource",value:function(t,e,n,r,i,o){t.drawImage(e,n,r,i,o)}},{key:"addText",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#333333",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500;t.font="".concat(s," ").concat(i,"px sans-serif"),t.fillStyle=o,t.fillText(e,n,r+i)}}]),t}(),Jp=u((function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5?arguments[5]:void 0;s(this,t),this.canvas=a,this.x=e,this.y=n,this.width=r,this.height=i,this.scale=o})),$p=function(t){l(n,t);var e=d(n);function n(t,r,i,o){var a,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,c=arguments.length>5?arguments[5]:void 0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"#FEFEFE",d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"#333333";return s(this,n),(a=e.call(this,t,r,i,o,u,c)).bgColor=f,a.borderWidth=h,a.borderRadius=l,a.borderColor=d,a.width<2*a.borderRadius&&(a.borderRadius=a.width/2),a.height<2*a.borderRadius&&(a.borderRadius=a.height/2),a}return u(n,[{key:"draw",value:function(){this.borderRadius>0?this.drawRoundRect():this.drawRect()}},{key:"drawRect",value:function(){Xp.drawRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}},{key:"drawRoundRect",value:function(){Xp.drawRoundRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.borderRadius*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}}]),n}(Jp),Zp=function(t){l(n,t);var e=d(n);function n(t,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,u=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000000",h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:12,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:500;return s(this,n),(o=e.call(this,r,i,0,0,a,u)).text=t,o.color=c,o.fontSize=h,o.fontWeight=l,o}return u(n,[{key:"draw",value:function(){Xp.addText(this.canvas,this.text,this.x*this.scale,this.y*this.scale,this.fontSize*this.scale,this.color,this.fontWeight)}}]),n}(Jp),tg=function(t){l(n,t);var e=d(n);function n(t,r,i,o,a){var u,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,h=arguments.length>6?arguments[6]:void 0;return s(this,n),(u=e.call(this,r,i,o,a,c,h)).src=t,u}return u(n,[{key:"draw",value:function(){Xp.addImage(this.canvas,this.src,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale)}}]),n}(Jp);function eg(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500;return t.font="".concat(r," ").concat(n,"px sans-serif"),t.measureText(e).width}var ng,rg,ig=function(t){return t[t.default=0]="default",t}({}),og=function(){var t=u((function t(){s(this,t),this.scale=4,this.titleFont=16,this.detailFont=12,this.footnoteFont=11,this.font={title:{size:16,weight:700},content:{size:12,weight:600},footnote:{size:11,weight:500}},this.card={x:0,y:0,w:320,h:180,borderRadius:12,border:1,padding:{v:12,h:12}},this.greet={x:this.card.padding.h,y:64,w:296,h:88,borderRadius:8,border:0,padding:{v:6,h:8},maxLine:5,lineHeight:16,fontSize:12,fontWeight:600},this.logoText={x:236,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.userIDText={x:this.card.padding.h,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.levelText={x:this.card.padding.h,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.gameIdText={x:this.card.padding.h,y:32,size:this.font.title.size,weight:this.font.title.weight},this.favoriteText={x:125,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.favoriteImg={max:3,x:125,y:32,w:20,h:20},this.logoImg={x:288,y:156,w:20,h:20}}));return t.getLayout=function(e){return new t},t}(),sg=function(t){return t[t.primary=0]="primary",t[t.secondary=1]="secondary",t[t.skyBlue=2]="skyBlue",t}({}),ag=function(t){return t.black="#333333",t.white="#FFFFFF",t.green="#459C7F",t.light_green="#F0FFFA",t.orange="#E4766A",t.light_orange="#FFE9E7",t.blue="#368FD4",t.light_blue="#DDF1FF",t}({}),ug=function(){var t=u((function t(){s(this,t),this.primaryColor=ag.green,this.secondaryColor=ag.light_green,this.contentColor=ag.black,this.contentBgColor=ag.white}));return t.getTheme=function(e){var n=new t;switch(e){case sg.primary:n.primaryColor=ag.green,n.secondaryColor=ag.light_green;break;case sg.secondary:n.primaryColor=ag.orange,n.secondaryColor=ag.light_orange;break;case sg.skyBlue:n.primaryColor=ag.blue,n.secondaryColor=ag.light_blue;break;default:n.primaryColor=ag.green,n.secondaryColor=ag.light_green}return n},t}(),cg=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ig.default,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sg.primary;s(this,t),this.info=e,this.layout=og.getLayout(n),this.theme=ug.getTheme(r),this.canvasObjects=[]}return u(t,[{key:"resetCanvas",value:function(){this.canvasObjects=[]}},{key:"genBlocks",value:function(t){var e=this.genCardBlock(t),n=this.genGreetingBlock(t);this.canvasObjects.push(e),this.canvasObjects.push(n)}},{key:"genCardBlock",value:function(t){return new $p(this.layout.card.x,this.layout.card.y,this.layout.card.w,this.layout.card.h,this.layout.scale,t,this.layout.card.border,this.layout.card.borderRadius,this.theme.secondaryColor,this.theme.primaryColor)}},{key:"genGreetingBlock",value:function(t){return new $p(this.layout.greet.x,this.layout.greet.y,this.layout.greet.w,this.layout.greet.h,this.layout.scale,t,this.layout.greet.border,this.layout.greet.borderRadius,this.theme.contentBgColor,this.theme.contentBgColor)}},{key:"genTexts",value:function(t){var e,r=this.genLogoText(t,"Create by"),i=this.genUserText(t,"ID: "+this.info.uid),o=this.genLevelText(t,"Lv. "+this.info.level),s=this.genGameIDText(t,this.info.gid),a=this.genFavoriteText(t,"\u6211\u7684\u6700\u611b"),u=this.genGreetingText(t,this.info.greeting);this.canvasObjects.push(r),this.canvasObjects.push(i),this.canvasObjects.push(o),this.canvasObjects.push(s),this.canvasObjects.push(a),(e=this.canvasObjects).push.apply(e,n(u))}},{key:"genLogoText",value:function(t,e){return new Zp(e,this.layout.logoText.x,this.layout.logoText.y,this.layout.scale,t,this.theme.contentColor,this.layout.logoText.size,this.layout.logoText.weight)}},{key:"genUserText",value:function(t,e){return new Zp(e,this.layout.userIDText.x,this.layout.userIDText.y,this.layout.scale,t,this.theme.contentColor,this.layout.userIDText.size,this.layout.userIDText.weight)}},{key:"genLevelText",value:function(t,e){return new Zp(e,this.layout.levelText.x,this.layout.levelText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.levelText.size,this.layout.levelText.weight)}},{key:"genGameIDText",value:function(t,e){return new Zp(e,this.layout.gameIdText.x,this.layout.gameIdText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.gameIdText.size,this.layout.gameIdText.weight)}},{key:"genFavoriteText",value:function(t,e){return new Zp(e,this.layout.favoriteText.x,this.layout.favoriteText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.favoriteText.size,this.layout.favoriteText.weight)}},{key:"genGreetingText",value:function(t,e){for(var n=this,r=this.layout.greet.maxLine,i=this.layout.greet.x+this.layout.greet.padding.h,o=this.layout.greet.y+this.layout.greet.padding.v,s=this.layout.greet.w-2*this.layout.greet.padding.h,a=this.layout.greet.lineHeight,u=this.layout.font.content.size,c=this.layout.font.content.weight,h=0,l=e.length,f=[],d=0;d<r;d++){var p=e.indexOf("\n",h),g=Math.round((h+l+1)/2),y=e.slice(h,l),v=eg(t,y,u,c);if(h>=e.length)break;if(v<s)g=l;else{for(y=e.slice(h,g),v=eg(t,y,u,c);g<l&&v<=s;)g+=1,y=e.slice(h,g),v=eg(t,y,u,c);for(;g>=0&&v>s;)g-=1,y=e.slice(h,g),v=eg(t,y,u,c)}-1!=p&&p<g&&(g=p+1),f.push(e.slice(h,g)),h=g}return f.map((function(e,r){return new Zp(e,i,o+r*a,n.layout.scale,t,n.theme.contentColor,u,c)}))}},{key:"genImages",value:function(t,e,r){var i;this.canvasObjects.push(this.genLogoImg(t,e)),(i=this.canvasObjects).push.apply(i,n(this.genFavoriteItemsImg(t,r)))}},{key:"genLogoImg",value:function(t,e){return new tg(e,this.layout.logoImg.x,this.layout.logoImg.y,this.layout.logoImg.w,this.layout.logoImg.h,this.layout.scale,t)}},{key:"genFavoriteItemsImg",value:function(t,e){var n=this,r=this.layout.favoriteImg.x,i=this.layout.favoriteImg.y,o=this.layout.favoriteImg.w,s=this.layout.favoriteImg.h;return e.map((function(e,a){return new tg(e,r+a*o,i,o,s,n.layout.scale,t)}))}},{key:"draw",value:function(){this.canvasObjects.forEach((function(t){t.draw()}))}}]),t}(),hg=a("kvnP"),lg=a("m7U+"),fg=["cardCanvas"],dg=["downloadButton"],pg=((rg=function(){function e(t,n,r){s(this,e),this.consumableServ=t,this.cropServ=n,this.document=r,this.layout=ig.default,this.theme=sg.primary,this.logoImg="assets/icons/LOGO-71x71.png",this.isEditing=!1,this.onEdit=new p.n,this.onDelete=new p.n,this.closeSettingIcon=Hp.tb,this.settingIcon=Hp.D,this.editIcon=Hp.C,this.shareIcon=Hp.kb,this.updateThemeIcon=Hp.ab,this.copyIcon=Hp.r,this.downloadIcon=Hp.B,this.deleteIcon=Hp.wb,this.window=this.document.defaultView}return u(e,[{key:"ngOnInit",value:function(){this.isEditing=!1,this.realfarmCard=new cg(this.data,ig.default,this.theme),this.filename=this.data.gid+"_RealFarm\u5c0f\u5e6b\u624b.png"}},{key:"ngAfterViewInit",value:function(){this.context=this.canvas.nativeElement.getContext("2d"),this.drawCard()}},{key:"drawCard",value:function(){var t=this;this.realfarmCard=new cg(this.data,ig.default,this.theme),this.realfarmCard.genBlocks(this.context),this.realfarmCard.genTexts(this.context),this.realfarmCard.genImages(this.context,this.logoImg,this.data.favorites.map((function(e,n){return n>=t.realfarmCard.layout.favoriteImg.max?"":t.cropServ.searchSeed(e)?t.cropServ.searchSeed(e).img:t.consumableServ.searchConsumable(e)[0].img}))),this.realfarmCard.draw(),this.link2Canvas()}},{key:"link2Canvas",value:function(){this.downloadBtn.nativeElement.href=this.canvas.nativeElement.toDataURL("image/png")}},{key:"shareCard",value:function(){return Object(at.b)(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.link2Canvas(),t.next=3,fetch(this.downloadBtn.nativeElement.href);case 3:return t.next=5,t.sent.blob();case 5:return n=t.sent,r=Object({files:[new File([n],this.filename,{type:n.type,lastModified:(new Date).getTime()})],url:this.window.location.hostname}),t.prev=7,t.next=10,this.window.navigator.share(r);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(7),20!==t.t0.code&&alert("[".concat(t.t0.code,"] \u6b64\u700f\u89bd\u5668\u7248\u672c\u5206\u4eab\u529f\u80fd\u51fa\u4e86\u9ede\u554f\u984c\ud83d\ude25"));case 15:case"end":return t.stop()}}),e,this,[[7,12]])})))}},{key:"copyImage",value:function(){}},{key:"editInfo",value:function(){this.isEditing=!1,this.onEdit.emit(this.data.id)}},{key:"deleteCard",value:function(){this.isEditing=!1,this.onDelete.emit(this.data.id)}},{key:"switchEditButtons",value:function(){this.isEditing=!this.isEditing}},{key:"updateTheme",value:function(){switch(this.theme){case sg.primary:this.theme=sg.secondary;break;case sg.secondary:this.theme=sg.skyBlue;break;case sg.skyBlue:this.theme=sg.primary}this.drawCard()}}]),e}()).\u0275fac=function(t){return new(t||rg)(p.Ib(hg.a),p.Ib(lg.a),p.Ib(h.d))},rg.\u0275cmp=p.Cb({type:rg,selectors:[["app-realfarm-card"]],viewQuery:function(t,e){var n;1&t&&(p.xc(fg,!0),p.xc(dg,!0)),2&t&&(p.ic(n=p.Wb())&&(e.canvas=n.first),p.ic(n=p.Wb())&&(e.downloadBtn=n.first))},inputs:{data:"data"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:28,vars:12,consts:[[1,"container"],["id","card-canvas",2,"width","100%",3,"width","height","click"],["cardCanvas",""],[1,"mask",3,"ngClass"],[1,"icon-button","settings",3,"ngClass","click"],[3,"icon"],[1,"wrapper","animation",3,"ngClass"],[1,"icon-button","updateTheme",3,"click"],[1,"icon-button","edit",3,"click"],[1,"icon-button","download",3,"download","click"],["downloadButton",""],[1,"icon-button","delete",3,"click"]],template:function(t,e){1&t&&(p.Ob(0,"div",0),p.Ob(1,"canvas",1,2),p.Vb("click",(function(){return e.editInfo()})),p.Nb(),p.Jb(3,"div",3),p.Ob(4,"div",4),p.Vb("click",(function(){return e.switchEditButtons()})),p.Jb(5,"fa-icon",5),p.Nb(),p.Ob(6,"div",6),p.Ob(7,"a",7),p.Vb("click",(function(){return e.updateTheme()})),p.Jb(8,"fa-icon",5),p.Ob(9,"span"),p.sc(10,"\u66f4\u63db\u4e3b\u984c"),p.Nb(),p.Nb(),p.Ob(11,"a",8),p.Vb("click",(function(){return e.shareCard()})),p.Jb(12,"fa-icon",5),p.Ob(13,"span"),p.sc(14,"\u5206\u4eab\u5361\u7247"),p.Nb(),p.Nb(),p.Ob(15,"a",8),p.Vb("click",(function(){return e.editInfo()})),p.Jb(16,"fa-icon",5),p.Ob(17,"span"),p.sc(18,"\u7de8\u8f2f"),p.Nb(),p.Nb(),p.Ob(19,"a",9,10),p.Vb("click",(function(){return e.link2Canvas()})),p.Jb(21,"fa-icon",5),p.Ob(22,"span"),p.sc(23,"\u5132\u5b58"),p.Nb(),p.Nb(),p.Ob(24,"a",11),p.Vb("click",(function(){return e.deleteCard()})),p.Jb(25,"fa-icon",5),p.Ob(26,"span"),p.sc(27,"\u522a\u9664"),p.Nb(),p.Nb(),p.Nb(),p.Nb()),2&t&&(p.yb(1),p.dc("width",e.realfarmCard.layout.card.w*e.realfarmCard.layout.scale)("height",e.realfarmCard.layout.card.h*e.realfarmCard.layout.scale),p.yb(2),p.dc("ngClass",e.isEditing?"open":""),p.yb(1),p.dc("ngClass",e.isEditing?"closeSettings":""),p.yb(1),p.dc("icon",e.isEditing?e.closeSettingIcon:e.settingIcon),p.yb(1),p.dc("ngClass",e.isEditing?"open":""),p.yb(2),p.dc("icon",e.updateThemeIcon),p.yb(4),p.dc("icon",e.shareIcon),p.yb(4),p.dc("icon",e.editIcon),p.yb(3),p.dc("download",e.filename),p.yb(2),p.dc("icon",e.downloadIcon),p.yb(4),p.dc("icon",e.deleteIcon))},directives:[h.j,Yp.a],styles:[".container[_ngcontent-%COMP%]{min-width:320px;max-width:400px;min-height:180px;max-height:225px;width:80%;height:80%;margin:0 auto;position:relative;aspect-ratio:16/9}.wrapper[_ngcontent-%COMP%]{margin:0 auto;display:flex;align-items:flex-end;justify-content:center;position:absolute;flex-direction:column;right:0;top:28px;transform:translateY(-50%) scaleY(0);z-index:0}.wrapper.open[_ngcontent-%COMP%]{transform:translateY(0) scaleY(1);z-index:5}.icon-button[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;height:28px;margin:4px;padding:4px 12px;border-radius:8px;align-items:center;justify-content:space-around;display:inline-flex;box-shadow:0 2px 8px 4px rgba(0,0,0,.15);background-color:var(--white)}.icon-button[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.icon-button[_ngcontent-%COMP%]:hover, .icon-button[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{cursor:pointer}.icon-button.settings[_ngcontent-%COMP%]{position:absolute;right:0;top:-20px;width:28px;height:28px;padding:4px;border-radius:50%;z-index:4}.icon-button.settings.closeSettings[_ngcontent-%COMP%]{z-index:6}.mask[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;background:rgba(0,0,0,.3);border-radius:12px;transform:scale(0)}.mask.open[_ngcontent-%COMP%]{transform:scale(1)}.animation[_ngcontent-%COMP%]{transition:.2s ease-in}.delete[_ngcontent-%COMP%]{color:var(--danger)}"]}),rg),gg=((ng=function(){function t(){s(this,t)}return u(t,[{key:"ngOnInit",value:function(){}}]),t}()).\u0275fac=function(t){return new(t||ng)},ng.\u0275cmp=p.Cb({type:ng,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"wrapper"],[1,"loader"]],template:function(t,e){1&t&&(p.Ob(0,"div",0),p.Jb(1,"span",1),p.Nb())},styles:['.wrapper[_ngcontent-%COMP%]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;display:flex;justify-content:center;align-items:center}.loader[_ngcontent-%COMP%]{width:48px;height:48px;border:10px solid var(--light-gray);border-radius:50%;position:relative;transform:rotate(45deg);box-sizing:border-box}.loader[_ngcontent-%COMP%]:before{content:"";position:absolute;box-sizing:border-box;inset:-10px;border-radius:50%;border:10px solid var(--secondary);-webkit-animation:prixClipFix 2s linear infinite;animation:prixClipFix 2s linear infinite}@-webkit-keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}@keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}']}),ng),yg=a("0zEo"),vg=function(t){return t[t.Unknown=0]="Unknown",t[t.Male=1]="Male",t[t.Female=2]="Female",t}({}),mg=a("s7LF");function bg(t,e){if(1&t&&(p.Ob(0,"option",23),p.sc(1),p.Nb()),2&t){var n=e.$implicit;p.dc("value",n.name),p.yb(1),p.uc(" ",n.name," ")}}function wg(t,e){if(1&t){var n=p.Pb();p.Ob(0,"div",9),p.Ob(1,"select",20),p.Vb("ngModelChange",(function(t){return p.kc(n),p.Xb().favorite=t})),p.qc(2,bg,2,2,"option",21),p.Nb(),p.Ob(3,"button",22),p.Vb("click",(function(){return p.kc(n),p.Xb().addFavorites()})),p.Jb(4,"fa-icon",18),p.Nb(),p.Nb()}if(2&t){var r=p.Xb();p.yb(1),p.dc("ngModel",r.favorite),p.yb(1),p.dc("ngForOf",r.displayObjs),p.yb(2),p.dc("icon",r.addIcon)}}function Ig(t,e){if(1&t){var n=p.Pb();p.Ob(0,"div",24),p.Jb(1,"img",25),p.Ob(2,"fa-icon",26),p.Vb("click",(function(){p.kc(n);var t=e.$implicit;return p.Xb().removeFavorite(t)})),p.Nb(),p.Nb()}if(2&t){var r=e.$implicit,i=p.Xb();p.yb(1),p.dc("src",i.getImg(r),p.mc)("height",28)("alt",r+"\u7684\u5716\u7247"),p.yb(1),p.dc("icon",i.closeIcon)}}var Og,Tg=((Og=function(){function t(e,n){s(this,t),this.cs=e,this.is=n,this.done=new p.n,this.cancel=new p.n,this.addIcon=Hp.bb,this.closeIcon=Hp.ub,this.cancelIcon=Hp.tb,this.doneIcon=Hp.k}return u(t,[{key:"ngOnInit",value:function(){var t=this.cs.getAllCrops().map((function(t){return{name:t.name,img:t.img,group:"\u4f5c\u7269"}})),e=this.is.getAllConsumables().map((function(t){return{name:t.name,img:t.img,group:t.group}}));this.realfarmObjs=[].concat(n(t),n(e)),null==this.data&&(this.data={id:"",uid:"",gid:"",greeting:"",level:10,gender:vg.Male,is_primary:!1,favorites:[]}),this.updateObjList()}},{key:"isMale",value:function(){return this.data.gender===vg.Male}},{key:"updateGender",value:function(t){this.data.gender=t?vg.Male:vg.Female}},{key:"updateObjList",value:function(){var t=this;this.displayObjs=this.realfarmObjs.filter((function(e){return!t.data.favorites.includes(e.name)})),this.favorite=this.displayObjs[0].name}},{key:"addFavorites",value:function(){console.log(this.data),this.data.favorites=[].concat(n(this.data.favorites),[this.favorite]),this.data=Object.assign({},this.data),this.updateObjList()}},{key:"removeFavorite",value:function(t){this.data.favorites=this.data.favorites.filter((function(e){return e!==t})),this.data=Object.assign({},this.data),this.updateObjList()}},{key:"getImg",value:function(t){var e=this.realfarmObjs.filter((function(e){return e.name===t}));return e.length>0?e[0].img:""}},{key:"doDone",value:function(){this.done.emit(this.data)}},{key:"doCancel",value:function(){this.cancel.emit(!0)}}]),t}()).\u0275fac=function(t){return new(t||Og)(p.Ib(lg.a),p.Ib(hg.a))},Og.\u0275cmp=p.Cb({type:Og,selectors:[["app-realfarm-form"]],inputs:{data:"data"},outputs:{cancel:"cancel",done:"done"},decls:52,vars:11,consts:[[1,"wrapper"],[1,"header"],[1,"info"],[1,"form"],[1,"group"],[1,"title"],[1,"element","horizontal"],["type","text","name","gid",1,"value",3,"ngModel","ngModelChange"],["type","number","step","1","name","level",1,"value",3,"ngModel","ngModelChange"],[1,"value"],["type","radio","name","gender",3,"checked","change"],["class","value",4,"ngIf"],[1,"element","item-list"],["class","item",4,"ngFor","ngForOf"],[1,"element","vertical"],["rows","5","name","greeting","maxlength","200",1,"value",3,"ngModel","ngModelChange"],[1,"actions"],[1,"button","cancel",3,"click"],[3,"icon"],[1,"button","submit",3,"click"],["name","favorite",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"button","add","item",3,"click"],[3,"value"],[1,"item"],[3,"src","height","alt"],[1,"close",3,"icon","click"]],template:function(t,e){1&t&&(p.Ob(0,"section",0),p.Ob(1,"h1",1),p.sc(2),p.Nb(),p.Ob(3,"div",2),p.sc(4,"\u5efa\u7acb/\u7de8\u8f2f\u81ea\u5df1\u7684\u904a\u6232\u8cc7\u8a0a\uff0c\u4e14\u53ef\u4ee5\u4e0b\u8f09\u5716\u7247\u5f8c\u5206\u4eab\u7d66\u5176\u4ed6\u8fb2\u53cb"),p.Nb(),p.Nb(),p.Ob(5,"section",0),p.Ob(6,"form",3),p.Ob(7,"section",4),p.Ob(8,"h2",5),p.sc(9,"\u904a\u6232\u57fa\u672c\u8cc7\u8a0a"),p.Nb(),p.Ob(10,"label",6),p.Ob(11,"span",5),p.sc(12,"\u904a\u6232 ID"),p.Nb(),p.Ob(13,"input",7),p.Vb("ngModelChange",(function(t){return e.data.gid=t})),p.Nb(),p.Nb(),p.Ob(14,"label",6),p.Ob(15,"span",5),p.sc(16,"\u7b49\u7d1a"),p.Nb(),p.Ob(17,"input",8),p.Vb("ngModelChange",(function(t){return e.data.level=t})),p.Nb(),p.Nb(),p.Ob(18,"label",6),p.Ob(19,"span",5),p.sc(20,"\u89d2\u8272\u6027\u5225"),p.Nb(),p.Ob(21,"div",9),p.Ob(22,"label"),p.Ob(23,"input",10),p.Vb("change",(function(){return e.updateGender(!0)})),p.Nb(),p.Ob(24,"span"),p.sc(25,"\u7537"),p.Nb(),p.Nb(),p.Ob(26,"label"),p.Ob(27,"input",10),p.Vb("change",(function(){return e.updateGender(!1)})),p.Nb(),p.Ob(28,"span"),p.sc(29,"\u5973"),p.Nb(),p.Nb(),p.Nb(),p.Nb(),p.Nb(),p.Ob(30,"section",4),p.Ob(31,"h2",5),p.sc(32,"\u5176\u4ed6\u8cc7\u8a0a"),p.Nb(),p.Ob(33,"label",6),p.Ob(34,"div",5),p.Ob(35,"span"),p.sc(36,"\u6211\u7684\u6700\u611b"),p.Nb(),p.Nb(),p.qc(37,wg,5,3,"div",11),p.Nb(),p.Ob(38,"div",12),p.qc(39,Ig,3,4,"div",13),p.Nb(),p.Ob(40,"label",14),p.Ob(41,"span",5),p.sc(42),p.Nb(),p.Ob(43,"textarea",15),p.Vb("ngModelChange",(function(t){return e.data.greeting=t})),p.sc(44,"                "),p.Nb(),p.Nb(),p.Nb(),p.Nb(),p.Ob(45,"div",16),p.Ob(46,"button",17),p.Vb("click",(function(){return e.doCancel()})),p.Jb(47,"fa-icon",18),p.sc(48," \u53d6\u6d88 "),p.Nb(),p.Ob(49,"button",19),p.Vb("click",(function(){return e.doDone()})),p.Jb(50,"fa-icon",18),p.sc(51," \u5b8c\u6210 "),p.Nb(),p.Nb(),p.Nb()),2&t&&(p.yb(2),p.uc("",""!==e.data.id?"\u7de8\u8f2f":"\u5efa\u7acb"," \u5361\u7247\u8cc7\u8a0a"),p.yb(11),p.dc("ngModel",e.data.gid),p.yb(4),p.dc("ngModel",e.data.level),p.yb(6),p.dc("checked",e.isMale()),p.yb(4),p.dc("checked",!e.isMale()),p.yb(10),p.dc("ngIf",e.data.favorites.length<3),p.yb(2),p.dc("ngForOf",e.data.favorites),p.yb(3),p.uc("\u5361\u7247\u5167\u5bb9 (",e.data.greeting.length," / 200)"),p.yb(1),p.dc("ngModel",e.data.greeting),p.yb(4),p.dc("icon",e.cancelIcon),p.yb(3),p.dc("icon",e.doneIcon))},directives:[mg.u,mg.k,mg.l,mg.b,mg.j,mg.m,mg.o,h.l,h.k,mg.i,Yp.a,mg.r,mg.n,mg.t],styles:[".value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:8px}.value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:4px;margin-left:0}.title.favorite[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{display:inline-block;width:40%;line-height:28px}.item-list[_ngcontent-%COMP%]{margin-top:8px}.item[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:inline-block;position:relative;padding:4px 8px}.item[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-4px;width:16px;height:16px}.button.add[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;padding:4px;margin-left:12px}.actions[_ngcontent-%COMP%]{width:100%;margin:8px;display:flex;flex-direction:row;justify-content:center}.button.cancel[_ngcontent-%COMP%], .button.submit[_ngcontent-%COMP%]{flex-grow:1;margin:0 8px;font-size:18px;height:36px;border-radius:4px;border:0}.button.submit[_ngcontent-%COMP%]{background-color:var(--primary);color:var(--white)}"]}),Og);function Eg(t,e){if(1&t){var n=p.Pb();p.Ob(0,"div",6),p.Ob(1,"app-realfarm-card",9),p.Vb("onEdit",(function(t){return p.kc(n),p.Xb(2).editCard(t)}))("onDelete",(function(t){return p.kc(n),p.Xb(2).deleteCard(t)})),p.Nb(),p.Nb()}if(2&t){var r=e.$implicit;p.yb(1),p.dc("data",r)}}function _g(t,e){if(1&t){var n=p.Pb();p.Ob(0,"section"),p.Ob(1,"app-header",3),p.Vb("onClickCustomIcon",(function(){return p.kc(n),p.Xb().logout()})),p.Yb(2,"async"),p.Nb(),p.Ob(3,"div",4),p.qc(4,Eg,2,1,"div",5),p.Yb(5,"async"),p.Ob(6,"div",6),p.Ob(7,"div",7),p.Vb("click",(function(){return p.kc(n),p.Xb().editCard(void 0)})),p.Jb(8,"fa-icon",8),p.Ob(9,"span"),p.sc(10,"\u65b0\u589e RealFarm \u5361\u7247"),p.Nb(),p.Nb(),p.Nb(),p.Nb(),p.Nb()}if(2&t){var r,i=p.Xb();p.yb(1),p.dc("title",null==(r=p.Zb(2,8,i.userData))?null:r.name)("subtitle","\u500b\u4eba RealFarm \u8cc7\u8a0a "+i.cardInfos.length+"/5")("showBackIcon",!1)("showCustomIcon",!0)("customIcon",i.logoutIcon)("customString","\u767b\u51fa"),p.yb(3),p.dc("ngForOf",p.Zb(5,10,i.userRealFarm)),p.yb(4),p.dc("icon",i.addIcon)}}function Sg(t,e){1&t&&p.Jb(0,"app-loading")}function kg(t,e){if(1&t){var n=p.Pb();p.Ob(0,"app-modal",10),p.Vb("cancel",(function(){return p.kc(n),p.Xb().cancelEdit()})),p.Ob(1,"app-realfarm-form",11),p.Vb("done",(function(t){return p.kc(n),p.Xb().finishEdit(t)}))("cancel",(function(){return p.kc(n),p.Xb().cancelEdit()})),p.Nb(),p.Nb()}if(2&t){var r=p.Xb();p.yb(1),p.dc("data",-1!==r.editIdx?r.cardInfos[r.editIdx]:null)}}var xg,Ng,Cg,jg=function(){return t=["user","profile"],Object(v.a)(W,Object(m.a)((function(e){return e&&t||!0})));var t},Dg=[{path:"",component:Wp,canActivate:[H],data:{authGuardPipe:jg}},{path:"login",component:Wp,canActivate:[H],data:{authGuardPipe:jg}},{path:"profile",component:(xg=function(){function t(e,n,r){var i=this;s(this,t),this.auth=e,this.store=n,this.us=r,this.cardNumber=0,this.logoutIcon=Hp.lb,this.addIcon=Hp.bb,this.auth.user.subscribe((function(t){var e=i.store.collection("users").doc(t.uid);i.userId=t.uid,i.userData=e.valueChanges(),i.userRealFarm=e.collection("realfarms").valueChanges(),e.get().subscribe((function(e){e.exists?i.us.updateUser(e.id,"last_login",i.us.getCurrentTime()):i.us.createUser(t)})),i.userRealFarm.subscribe((function(t){i.cardInfos=t}))}))}return u(t,[{key:"ngOnInit",value:function(){this.editMode=0}},{key:"logout",value:function(){this.us.logout()}},{key:"editCard",value:function(t){var e=this;t?(this.cardInfos.forEach((function(n,r){n.id===t&&(e.editIdx=r)})),this.editMode=2):(this.editIdx=-1,this.editMode=1)}},{key:"cancelEdit",value:function(){this.editMode=0}},{key:"finishEdit",value:function(t){1==this.editMode?this.createCard(t):this.updateCard(t),this.editMode=0}},{key:"createCard",value:function(t){this.us.createRealfarmInfo(this.userId,t)}},{key:"updateCard",value:function(t){this.cardInfos[this.editIdx]=t,this.us.upateRealFamrInfo(this.userId,this.cardInfos[this.editIdx])}},{key:"deleteCard",value:function(t){var e=this;if(confirm("\u78ba\u5b9a\u522a\u9664\u6b64\u5361\u7247")&&t)for(var n=0;n<this.cardInfos.length;n++)this.cardInfos[n].id===t&&(this.us.deleteRealFarmInfo(this.userId,this.cardInfos[n]),this.userRealFarm.subscribe((function(t){e.cardInfos=t})))}}]),t}(),xg.\u0275fac=function(t){return new(t||xg)(p.Ib(Q),p.Ib(Gp),p.Ib(zp))},xg.\u0275cmp=p.Cb({type:xg,selectors:[["app-profile"]],decls:5,vars:5,consts:[[4,"ngIf","ngIfElse"],["loadingTemplate",""],[3,"cancel",4,"ngIf"],[3,"title","subtitle","showBackIcon","showCustomIcon","customIcon","customString","onClickCustomIcon"],[1,"cards"],["class","card wrapper",4,"ngFor","ngForOf"],[1,"card","wrapper"],["id","add-card",3,"click"],[3,"icon"],[3,"data","onEdit","onDelete"],[3,"cancel"],[3,"data","done","cancel"]],template:function(t,e){if(1&t&&(p.qc(0,_g,11,12,"section",0),p.Yb(1,"async"),p.qc(2,Sg,1,0,"ng-template",null,1,p.rc),p.qc(4,kg,2,1,"app-modal",2)),2&t){var n=p.jc(3);p.dc("ngIf",p.Zb(1,3,e.userData))("ngIfElse",n),p.yb(4),p.dc("ngIf",0!==e.editMode)}},directives:[h.l,Qp.a,h.k,Yp.a,pg,gg,yg.a,Tg],pipes:[h.b],styles:[".cards[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;align-items:center;justify-content:flex-start;margin-top:32px}.card[_ngcontent-%COMP%]{width:100%;margin-bottom:12px}#add-card[_ngcontent-%COMP%]{font-size:14px;min-width:320px;max-width:400px;width:80%;margin:0 auto;height:64px;color:var(--gray);display:flex;align-items:center;justify-content:center;background-image:url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23909090' stroke-width='2' stroke-dasharray='14' stroke-dashoffset='14' stroke-linecap='square'/%3e%3c/svg%3e\");border-radius:12px}#add-card[_ngcontent-%COMP%]:hover, #add-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:hover{cursor:pointer}#add-card[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 8px}"]}),xg),canActivate:[H],data:{authGuardPipe:function(){return t=["user","login"],Object(v.a)(W,Object(m.a)((function(e){return e||t})));var t}}}],Ag=((Ng=u((function t(){s(this,t)}))).\u0275mod=p.Gb({type:Ng}),Ng.\u0275inj=p.Fb({factory:function(t){return new(t||Ng)},imports:[[h.c,f.g.forChild(Dg)]]}),Ng),Rg=a("jICo"),Pg=((Cg=u((function t(){s(this,t)}))).\u0275mod=p.Gb({type:Cg}),Cg.\u0275inj=p.Fb({factory:function(t){return new(t||Cg)},imports:[[h.c,Ag,Rg.a,Yp.b,mg.h,mg.q]]}),Cg)}}])}();