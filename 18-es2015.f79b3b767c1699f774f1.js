(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"7UCR":function(t,e,n){"use strict";n.r(e),n.d(e,"UserModule",(function(){return gg}));var r=n("SVse"),i=n("iInd"),o=n("8Y7J"),s=n("LRne"),a=n("mCNh"),u=n("lJxs"),c=n("IzEk"),h=n("eIep"),l=n("XNiG"),f=n("HDdC"),d=n("Cfvw"),p=n("VRyK"),g=n("pxpQ"),y=n("qgXg"),m=n("quSY"),v=n("9ppp"),b=n("Ylt2");class w extends l.a{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new I(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;let o;if(this.closed)throw new v.a;if(this.isStopped||this.hasError?o=m.a.EMPTY:(this.observers.push(t),o=new b.a(this,t)),r&&t.add(t=new g.a(t,r)),e)for(let s=0;s<i&&!t.closed;s++)t.next(n[s]);else for(let s=0;s<i&&!t.closed;s++)t.next(n[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),o}_getNow(){return(this.scheduler||y.a).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length;let o=0;for(;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r}}class I{constructor(t,e){this.time=t,this.value=e}}function T(t,e,n){let r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let i,o,s=0,a=!1,u=!1;return function(c){let h;s++,!i||a?(a=!1,i=new w(t,e,r),h=i.subscribe(this),o=c.subscribe({next(t){i.next(t)},error(t){a=!0,i.error(t)},complete(){u=!0,o=void 0,i.complete()}}),u&&(o=void 0)):h=i.subscribe(this),this.add(()=>{s--,h.unsubscribe(),h=void 0,o&&!u&&n&&0===s&&(o.unsubscribe(),o=void 0,i=void 0)})}}(r))}var O=n("SxV6");function E(t,e){return e?Object(h.a)(()=>t,e):Object(h.a)(()=>t)}var _=n("tf+s"),S=n("pLZG"),x=n("jmUF");const N=new o.q("angularfire2.auth.use-emulator"),C=new o.q("angularfire2.auth.settings"),k=new o.q("angularfire2.auth.tenant-id"),D=new o.q("angularfire2.auth.langugage-code"),j=new o.q("angularfire2.auth.use-device-language"),A=new o.q("angularfire.auth.persistence");let R=(()=>{class t{constructor(t,e,i,o,a,c,y,m,v,b){const w=new x.d(o),I=Object(x.h)(w),N=new l.a,C=Object(s.a)(void 0).pipe(Object(g.b)(w.outsideAngular),Object(h.a)(()=>o.runOutsideAngular(()=>n.e(19).then(n.bind(null,"6nsN")))),Object(u.a)(()=>Object(x.g)(t,o,e)),Object(u.a)(t=>o.runOutsideAngular(()=>{const e=a,n=c;return Object(x.f)(t.name+".auth","AngularFireAuth",t,()=>{const r=o.runOutsideAngular(()=>t.auth());if(e&&r.useEmulator("http://"+e.join(":")),y&&(r.tenantId=y),r.languageCode=m,v&&r.useDeviceLanguage(),n)for(const[t,e]of Object.entries(n))r.settings[t]=e;return b&&r.setPersistence(b),r},[e,y,m,v,n,b])})),T({bufferSize:1,refCount:!1}));if(Object(r.s)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(s.a)(null);else{C.pipe(Object(O.a)()).subscribe();const t=C.pipe(Object(h.a)(t=>t.getRedirectResult().then(t=>t,()=>null)),I,T({bufferSize:1,refCount:!1})),e=t=>new f.a(e=>({unsubscribe:o.runOutsideAngular(()=>t(e))})),n=C.pipe(Object(h.a)(t=>e(t.onAuthStateChanged.bind(t)))),r=C.pipe(Object(h.a)(t=>e(t.onIdTokenChanged.bind(t))));this.authState=t.pipe(E(n),Object(_.a)(w.outsideAngular),Object(g.b)(w.insideAngular)),this.user=t.pipe(E(r),Object(_.a)(w.outsideAngular),Object(g.b)(w.insideAngular)),this.idToken=this.user.pipe(Object(h.a)(t=>t?Object(d.a)(t.getIdToken()):Object(s.a)(null))),this.idTokenResult=this.user.pipe(Object(h.a)(t=>t?Object(d.a)(t.getIdTokenResult()):Object(s.a)(null))),this.credential=Object(p.a)(t,N,this.authState.pipe(Object(S.a)(t=>!t))).pipe(Object(u.a)(t=>(null==t?void 0:t.user)?t:null),Object(_.a)(w.outsideAngular),Object(g.b)(w.insideAngular))}return Object(x.i)(this,C,o,{spy:{apply:(t,e,n)=>{(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then(t=>N.next(t))}}})}}return t.\u0275fac=function(e){return new(e||t)(o.Sb(x.c),o.Sb(x.b,8),o.Sb(o.B),o.Sb(o.z),o.Sb(N,8),o.Sb(C,8),o.Sb(k,8),o.Sb(D,8),o.Sb(j,8),o.Sb(A,8))},t.\u0275prov=o.Eb({factory:function(){return new t(o.Sb(x.c),o.Sb(x.b,8),o.Sb(o.B),o.Sb(o.z),o.Sb(N,8),o.Sb(C,8),o.Sb(k,8),o.Sb(D,8),o.Sb(j,8),o.Sb(A,8))},token:t,providedIn:"any"}),t})();const P=t=>!!t,F=Object(u.a)(P);let M=(()=>{class t{constructor(t,e){this.router=t,this.auth=e,this.canActivate=(t,e)=>{const n=t.data.authGuardPipe||(()=>F);return this.auth.user.pipe(Object(c.a)(1),n(t,e),Object(u.a)(t=>"boolean"==typeof t?t:Array.isArray(t)?this.router.createUrlTree(t):this.router.parseUrl(t)))}}}return t.\u0275fac=function(e){return new(e||t)(o.Sb(i.c),o.Sb(R))},t.\u0275prov=o.Eb({factory:function(){return new t(o.Sb(i.c),o.Sb(R))},token:t,providedIn:"any"}),t})();var L=n("Jgta"),V=function(t){return t[t.Admin=0]="Admin",t[t.Editor=1]="Editor",t[t.ClubAdmin=2]="ClubAdmin",t[t.User=100]="User",t}({}),U=n("D0XW"),q=n("JX91"),B=n("7o/Q");function K(){return t=>t.lift(new G)}class G{call(t,e){return e.subscribe(new z(t))}}class z extends B.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var Q=n("Kqap");class W{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new H(t,this.compare,this.keySelector))}}class H extends B.a{constructor(t,e,n){super(t),this.keySelector=n,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:n}=this;e=n?n(t):t}catch(r){return this.destination.error(r)}let n=!1;if(this.hasKey)try{const{compare:t}=this;n=t(this.key,e)}catch(r){return this.destination.error(r)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))}}var Y=n("zIRd"),X=n("mrSG"),$=n("qOnz"),J=n("q/0M"),Z=function(t,e){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function tt(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var et,nt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},rt=rt||{},it=nt||self;function ot(){}function st(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function at(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ut="closure_uid_"+(1e9*Math.random()>>>0),ct=0;function ht(t,e,n){return t.call.apply(t.bind,arguments)}function lt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function ft(t,e,n){return(ft=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ht:lt).apply(null,arguments)}function dt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function pt(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function gt(){this.s=this.s,this.o=this.o}var yt={};gt.prototype.s=!1,gt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,ut)&&t[ut]||(t[ut]=++ct)}(this);delete yt[t]}},gt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var mt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},vt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function bt(t){return Array.prototype.concat.apply([],arguments)}function wt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function It(t){return/^[\s\xa0]*$/.test(t)}var Tt,Ot=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Et(t,e){return-1!=t.indexOf(e)}function _t(t,e){return t<e?-1:t>e?1:0}t:{var St=it.navigator;if(St){var xt=St.userAgent;if(xt){Tt=xt;break t}}Tt=""}function Nt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ct(t){var e={};for(var n in t)e[n]=t[n];return e}var kt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Dt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<kt.length;o++)n=kt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function jt(t){return jt[" "](t),t}jt[" "]=ot;var At,Rt,Pt=Et(Tt,"Opera"),Ft=Et(Tt,"Trident")||Et(Tt,"MSIE"),Mt=Et(Tt,"Edge"),Lt=Mt||Ft,Vt=Et(Tt,"Gecko")&&!(Et(Tt.toLowerCase(),"webkit")&&!Et(Tt,"Edge"))&&!(Et(Tt,"Trident")||Et(Tt,"MSIE"))&&!Et(Tt,"Edge"),Ut=Et(Tt.toLowerCase(),"webkit")&&!Et(Tt,"Edge");function qt(){var t=it.document;return t?t.documentMode:void 0}t:{var Bt="",Kt=(Rt=Tt,Vt?/rv:([^\);]+)(\)|;)/.exec(Rt):Mt?/Edge\/([\d\.]+)/.exec(Rt):Ft?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Rt):Ut?/WebKit\/(\S+)/.exec(Rt):Pt?/(?:Version)[ \/]?(\S+)/.exec(Rt):void 0);if(Kt&&(Bt=Kt?Kt[1]:""),Ft){var Gt=qt();if(null!=Gt&&Gt>parseFloat(Bt)){At=String(Gt);break t}}At=Bt}var zt={};var Qt=it.document&&Ft&&(qt()||parseInt(At,10))||void 0,Wt=function(){if(!it.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{it.addEventListener("test",ot,e),it.removeEventListener("test",ot,e)}catch(n){}return t}();function Ht(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Yt(t,e){if(Ht.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Vt){t:{try{jt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Xt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Yt.Z.h.call(this)}}Ht.prototype.h=function(){this.defaultPrevented=!0},pt(Yt,Ht);var Xt={2:"touch",3:"pen",4:"mouse"};Yt.prototype.h=function(){Yt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var $t="closure_listenable_"+(1e6*Math.random()|0),Jt=0;function Zt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++Jt,this.ca=this.fa=!1}function te(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ee(t){this.src=t,this.g={},this.h=0}function ne(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=mt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(te(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function re(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}ee.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=re(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Zt(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var ie="closure_lm_"+(1e6*Math.random()|0),oe={};function se(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=de(r),e&&e[$t]?e.O(n,r,at(i)?!!i.capture:!!i,o):ae(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)se(t,e[o],n,r,i);return null}return n=de(n),t&&t[$t]?t.N(e,n,at(r)?!!r.capture:!!r,i):ae(t,e,n,!1,r,i)}function ae(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=at(i)?!!i.capture:!!i,a=le(t);if(a||(t[ie]=a=new ee(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=he;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Wt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(ce(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ue(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[$t])ne(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ce(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=le(e))?(ne(n,t),0==n.h&&(n.src=null,e[ie]=null)):te(t)}}}function ce(t){return t in oe?oe[t]:oe[t]="on"+t}function he(t,e){if(t.ca)t=!0;else{e=new Yt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&ue(t),t=n.call(r,e)}return t}function le(t){return(t=t[ie])instanceof ee?t:null}var fe="__closure_events_fn_"+(1e9*Math.random()>>>0);function de(t){return"function"==typeof t?t:(t[fe]||(t[fe]=function(e){return t.handleEvent(e)}),t[fe])}function pe(){gt.call(this),this.i=new ee(this),this.P=this,this.I=null}function ge(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Ht(e,t);else if(e instanceof Ht)e.target=e.target||t;else{var i=e;Dt(e=new Ht(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=ye(s,r,!0,e)&&i}if(i=ye(s=e.g=t,r,!0,e)&&i,i=ye(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=ye(s=e.g=n[o],r,!1,e)&&i}function ye(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&ne(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}pt(pe,gt),pe.prototype[$t]=!0,pe.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=at(i)?!!i.capture:!!i,r=de(r),e&&e[$t]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=re(s=e.g[n],r,i,o))&&(te(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):e&&(e=le(e))&&(n=e.g[n.toString()],e=-1,n&&(e=re(n,r,i,o)),(r=-1<e?n[e]:null)&&ue(r))}(this,t,e,n,r)},pe.prototype.M=function(){if(pe.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)te(n[r]);delete e.g[t],e.h--}}this.I=null},pe.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},pe.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var me=it.JSON.stringify;function ve(){var t=Se,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var be,we=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Ie.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Ie=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())((function(){return new Te}),(function(t){return t.reset()})),Te=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Oe(t){it.setTimeout((function(){throw t}),0)}function Ee(t,e){be||function(){var t=it.Promise.resolve(void 0);be=function(){t.then(xe)}}(),_e||(be(),_e=!0),Se.add(t,e)}var _e=!1,Se=new we;function xe(){for(var t;t=ve();){try{t.h.call(t.g)}catch(n){Oe(n)}var e=Ie;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}_e=!1}function Ne(t,e){pe.call(this),this.h=t||1,this.g=e||it,this.j=ft(this.kb,this),this.l=Date.now()}function Ce(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ke(t,e,n){if("function"==typeof t)n&&(t=ft(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=ft(t.handleEvent,t)}return 2147483647<Number(e)?-1:it.setTimeout(t,e||0)}function De(t){t.g=ke((function(){t.g=null,t.i&&(t.i=!1,De(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}pt(Ne,pe),(et=Ne.prototype).da=!1,et.S=null,et.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ge(this,"tick"),this.da&&(Ce(this),this.start()))}},et.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},et.M=function(){Ne.Z.M.call(this),Ce(this),delete this.g};var je=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Z(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:De(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(it.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(gt);function Ae(t){gt.call(this),this.h=t,this.g={}}pt(Ae,gt);var Re=[];function Pe(t,e,n,r){Array.isArray(n)||(n&&(Re[0]=n.toString()),n=Re);for(var i=0;i<n.length;i++){var o=se(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Fe(t){Nt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&ue(t)}),t),t.g={}}function Me(){this.g=!0}function Le(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return me(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Ae.prototype.M=function(){Ae.Z.M.call(this),Fe(this)},Ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Me.prototype.Aa=function(){this.g=!1},Me.prototype.info=function(){};var Ve={},Ue=null;function qe(){return Ue=Ue||new pe}function Be(t){Ht.call(this,Ve.Ma,t)}function Ke(t){var e=qe();ge(e,new Be(e,t))}function Ge(t,e){Ht.call(this,Ve.STAT_EVENT,t),this.stat=e}function ze(t){var e=qe();ge(e,new Ge(e,t))}function Qe(t,e){Ht.call(this,Ve.Na,t),this.size=e}function We(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return it.setTimeout((function(){t()}),e)}Ve.Ma="serverreachability",pt(Be,Ht),Ve.STAT_EVENT="statevent",pt(Ge,Ht),Ve.Na="timingevent",pt(Qe,Ht);var He={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ye={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Xe(){}function $e(){}Xe.prototype.h=null;var Je,Ze={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function tn(){Ht.call(this,"d")}function en(){Ht.call(this,"c")}function nn(){}function rn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Ae(this),this.P=sn,this.W=new Ne(t=Lt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new on}function on(){this.i=null,this.g="",this.h=!1}pt(tn,Ht),pt(en,Ht),pt(nn,Xe),nn.prototype.g=function(){return new XMLHttpRequest},nn.prototype.i=function(){return{}},Je=new nn;var sn=45e3,an={},un={};function cn(t,e,n){t.K=1,t.v=jn(Sn(e)),t.s=n,t.U=!0,hn(t,null)}function hn(t,e){t.F=Date.now(),pn(t),t.A=Sn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),zn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new on,t.g=Qr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new je(ft(t.Ia,t,t.g),t.O)),Pe(t.V,t.g,"readystatechange",t.gb),e=t.H?Ct(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ke(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function ln(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function fn(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=dn(t,n))==un){4==e&&(t.o=4,ze(14),i=!1),Le(t.j,t.m,null,"[Incomplete Response]");break}if(r==an){t.o=4,ze(15),Le(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Le(t.j,t.m,r,null),bn(t,r)}ln(t)&&r!=un&&r!=an&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ze(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Lr(e),e.L=!0,ze(11))):(Le(t.j,t.m,n,"[Invalid Chunked Response]"),vn(t),mn(t))}function dn(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?un:(n=Number(e.substring(n,r)),isNaN(n)?an:(r+=1)+n>e.length?un:(e=e.substr(r,n),t.C=r+n,e))}function pn(t){t.Y=Date.now()+t.P,gn(t,t.P)}function gn(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=We(ft(t.eb,t),e)}function yn(t){t.B&&(it.clearTimeout(t.B),t.B=null)}function mn(t){0==t.l.G||t.I||qr(t.l,t)}function vn(t){yn(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Ce(t.W),Fe(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function bn(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Jn(n.i,t)))if(n.I=t.N,!t.J&&Jn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Ur(n),Cr(n)}Mr(n),ze(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=We(ft(n.ab,n),6e3));if(1>=$n(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Kr(n,11)}else if((t.J||n.g==t)&&Ur(n),!It(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Et(h,"spdy")||Et(h,"quic")||Et(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Zn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Dn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=zr(r,r.H?r.la:null,r.W),d.J){tr(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(yn(p),pn(p)),r.g=d}else Fr(r);0<n.l.length&&jr(n)}else"stop"!=o[0]&&"close"!=o[0]||Kr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Kr(n,7):Nr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Ke(4)}catch(o){}}function wn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(st(t)||"string"==typeof t)vt(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(st(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(st(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function In(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof In)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Tn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];On(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)On(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function On(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(et=rn.prototype).setTimeout=function(t){this.P=t},et.gb=function(t){t=t.target;var e=this.L;e&&3==Or(t)?e.l():this.Ia(t)},et.Ia=function(t){try{if(t==this.g)t:{var e=Or(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||Lt||this.g&&(this.h.h||this.g.ga()||Er(this.g)))){this.I||4!=e||7==n||Ke(8==n||0>=r?3:2),yn(this);var i=this.g.ba();this.N=i;e:if(ln(this)){var o=Er(this.g);t="";var s=o.length,a=4==Or(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){vn(this),mn(this);var u="";break e}this.h.i=new it.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!It(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,ze(12),vn(this),mn(this);break t}Le(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,bn(this,i)}this.U?(fn(this,e,u),Lt&&this.i&&3==e&&(Pe(this.V,this.W,"tick",this.fb),this.W.start())):(Le(this.j,this.m,u,null),bn(this,u)),4==e&&vn(this),this.i&&!this.I&&(4==e?qr(this.l,this):(this.i=!1,pn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,ze(12)):(this.o=0,ze(13)),vn(this),mn(this)}}}catch(e){}},et.fb=function(){if(this.g){var t=Or(this.g),e=this.g.ga();this.C<e.length&&(yn(this),fn(this,t,e),this.i&&4!=t&&pn(this))}},et.cancel=function(){this.I=!0,vn(this)},et.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(Ke(3),ze(17)),vn(this),this.o=2,mn(this)):gn(this,this.Y-t)},(et=In.prototype).R=function(){Tn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},et.T=function(){return Tn(this),this.g.concat()},et.get=function(t,e){return On(this.h,t)?this.h[t]:e},et.set=function(t,e){On(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},et.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var En=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function _n(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof _n){this.g=void 0!==e?e:t.g,xn(this,t.j),this.s=t.s,Nn(this,t.i),Cn(this,t.m),this.l=t.l,e=t.h;var n=new qn;n.i=e.i,e.g&&(n.g=new In(e.g),n.h=e.h),kn(this,n),this.o=t.o}else t&&(n=String(t).match(En))?(this.g=!!e,xn(this,n[1]||"",!0),this.s=An(n[2]||""),Nn(this,n[3]||"",!0),Cn(this,n[4]),this.l=An(n[5]||"",!0),kn(this,n[6]||"",!0),this.o=An(n[7]||"")):(this.g=!!e,this.h=new qn(null,this.g))}function Sn(t){return new _n(t)}function xn(t,e,n){t.j=n?An(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Nn(t,e,n){t.i=n?An(e,!0):e}function Cn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function kn(t,e,n){e instanceof qn?(t.h=e,function(t,e){e&&!t.j&&(Bn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Kn(this,e),zn(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=Rn(e,Vn)),t.h=new qn(e,t.g))}function Dn(t,e,n){t.h.set(e,n)}function jn(t){return Dn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function An(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Rn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Pn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Pn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}_n.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Rn(e,Fn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Rn(e,Fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Rn(n,"/"==n.charAt(0)?Ln:Mn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Rn(n,Un)),t.join("")};var Fn=/[#\/\?@]/g,Mn=/[#\?:]/g,Ln=/[#\?]/g,Vn=/[#\?@]/g,Un=/#/g;function qn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Bn(t){t.g||(t.g=new In,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Kn(t,e){Bn(t),e=Qn(t,e),On(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,On((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Tn(t)))}function Gn(t,e){return Bn(t),e=Qn(t,e),On(t.g.h,e)}function zn(t,e,n){Kn(t,e),0<n.length&&(t.i=null,t.g.set(Qn(t,e),wt(n)),t.h+=n.length)}function Qn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(et=qn.prototype).add=function(t,e){Bn(this),this.i=null,t=Qn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},et.forEach=function(t,e){Bn(this),this.g.forEach((function(n,r){vt(n,(function(n){t.call(e,n,r,this)}),this)}),this)},et.T=function(){Bn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},et.R=function(t){Bn(this);var e=[];if("string"==typeof t)Gn(this,t)&&(e=bt(e,this.g.get(Qn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=bt(e,t[n])}return e},et.set=function(t,e){return Bn(this),this.i=null,Gn(this,t=Qn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},et.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},et.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Wn=function(){return function(t,e){this.h=t,this.g=e}}();function Hn(t){this.l=t||Yn,t=it.PerformanceNavigationTiming?0<(t=it.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(it.g&&it.g.Ea&&it.g.Ea()&&it.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Yn=10;function Xn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function $n(t){return t.h?1:t.g?t.g.size:0}function Jn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Zn(t,e){t.g?t.g.add(e):t.h=e}function tr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function er(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=tt(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return wt(t.i)}function nr(){}function rr(){this.g=new nr}function ir(t,e,n){var r=n||"";try{wn(t,(function(t,n){var i=t;at(t)&&(i=me(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(lp){throw e.push(r+"type="+encodeURIComponent("_badmap")),lp}}function or(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function sr(t){this.l=t.$b||null,this.j=t.ib||!1}function ar(t,e){pe.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=ur,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Hn.prototype.cancel=function(){var t,e;if(this.i=er(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=tt(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},nr.prototype.stringify=function(t){return it.JSON.stringify(t,void 0)},nr.prototype.parse=function(t){return it.JSON.parse(t,void 0)},pt(sr,Xe),sr.prototype.g=function(){return new ar(this.l,this.j)},sr.prototype.i=function(t){return function(){return t}}({}),pt(ar,pe);var ur=0;function cr(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function hr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,lr(t)}function lr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(et=ar.prototype).open=function(t,e){if(this.readyState!=ur)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,lr(this)},et.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||it).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},et.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hr(this)),this.readyState=ur},et.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,lr(this)),this.g&&(this.readyState=3,lr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==it.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;cr(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},et.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?hr(this):lr(this),3==this.readyState&&cr(this)}},et.Ua=function(t){this.g&&(this.response=this.responseText=t,hr(this))},et.Ta=function(t){this.g&&(this.response=t,hr(this))},et.ha=function(){this.g&&hr(this)},et.setRequestHeader=function(t,e){this.v.append(t,e)},et.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},et.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(ar.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var fr=it.JSON.parse;function dr(t){pe.call(this),this.headers=new In,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=pr,this.K=this.L=!1}pt(dr,pe);var pr="",gr=/^https?$/i,yr=["POST","PUT"];function mr(t){return"content-type"==t.toLowerCase()}function vr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,br(t),Ir(t)}function br(t){t.D||(t.D=!0,ge(t,"complete"),ge(t,"error"))}function wr(t){if(t.h&&void 0!==rt&&(!t.C[1]||4!=Or(t)||2!=t.ba()))if(t.v&&4==Or(t))ke(t.Fa,0,t);else if(ge(t,"readystatechange"),4==Or(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(En)[1]||null;if(!o&&it.self&&it.self.location){var s=it.self.location.protocol;o=s.substr(0,s.length-1)}i=!gr.test(o?o.toLowerCase():"")}e=i}if(e)ge(t,"complete"),ge(t,"success");else{t.m=6;try{var a=2<Or(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",br(t)}}finally{Ir(t)}}}function Ir(t,e){if(t.g){Tr(t);var n=t.g,r=t.C[0]?ot:null;t.g=null,t.C=null,e||ge(t,"ready");try{n.onreadystatechange=r}catch(lp){}}}function Tr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(it.clearTimeout(t.A),t.A=null)}function Or(t){return t.g?t.g.readyState:0}function Er(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case pr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function _r(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Nt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Dn(t,e,n))}function Sr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function xr(t){this.za=0,this.l=[],this.h=new Me,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Sr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Sr("baseRetryDelayMs",5e3,t),this.$a=Sr("retryDelaySeedMs",1e4,t),this.Ya=Sr("forwardChannelMaxRetries",2,t),this.ra=Sr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Hn(t&&t.concurrentRequestLimit),this.Ca=new rr,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Nr(t){if(kr(t),3==t.G){var e=t.V++,n=Sn(t.F);Dn(n,"SID",t.J),Dn(n,"RID",e),Dn(n,"TYPE","terminate"),Rr(t,n),(e=new rn(t,t.h,e,void 0)).K=2,e.v=jn(Sn(n)),n=!1,it.navigator&&it.navigator.sendBeacon&&(n=it.navigator.sendBeacon(e.v.toString(),"")),!n&&it.Image&&((new Image).src=e.v,n=!0),n||(e.g=Qr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),pn(e)}Gr(t)}function Cr(t){t.g&&(Lr(t),t.g.cancel(),t.g=null)}function kr(t){Cr(t),t.u&&(it.clearTimeout(t.u),t.u=null),Ur(t),t.i.cancel(),t.m&&("number"==typeof t.m&&it.clearTimeout(t.m),t.m=null)}function Dr(t,e){t.l.push(new Wn(t.Za++,e)),3==t.G&&jr(t)}function jr(t){Xn(t.i)||t.m||(t.m=!0,Ee(t.Ha,t),t.C=0)}function Ar(t,e){var n;n=e?e.m:t.V++;var r=Sn(t.F);Dn(r,"SID",t.J),Dn(r,"RID",n),Dn(r,"AID",t.U),Rr(t,r),t.o&&t.s&&_r(r,t.o,t.s),n=new rn(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Pr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Zn(t.i,n),cn(n,r,e)}function Rr(t,e){t.j&&wn({},(function(t,n){Dn(e,n,t)}))}function Pr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?ft(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{ir(h,s,"req"+c+"_")}catch(Ei){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Fr(t){t.g||t.u||(t.Y=1,Ee(t.Ga,t),t.A=0)}function Mr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=We(ft(t.Ga,t),Br(t,t.A)),t.A++,0))}function Lr(t){null!=t.B&&(it.clearTimeout(t.B),t.B=null)}function Vr(t){t.g=new rn(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Sn(t.oa);Dn(e,"RID","rpc"),Dn(e,"SID",t.J),Dn(e,"CI",t.N?"0":"1"),Dn(e,"AID",t.U),Rr(t,e),Dn(e,"TYPE","xmlhttp"),t.o&&t.s&&_r(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=jn(Sn(e)),n.s=null,n.U=!0,hn(n,t)}function Ur(t){null!=t.v&&(it.clearTimeout(t.v),t.v=null)}function qr(t,e){var n=null;if(t.g==e){Ur(t),Lr(t),t.g=null;var r=2}else{if(!Jn(t.i,e))return;n=e.D,tr(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;ge(r=qe(),new Qe(r,n,e,i)),jr(t)}else Fr(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!($n(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=We(ft(t.Ha,t,e),Br(t,t.C)),t.C++,0)))}(t,e)||2==r&&Mr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Kr(t,5);break;case 4:Kr(t,10);break;case 3:Kr(t,6);break;default:Kr(t,2)}}function Br(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Kr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=ft(t.jb,t);n||(n=new _n("//www.google.com/images/cleardot.gif"),it.location&&"http"==it.location.protocol||xn(n,"https"),jn(n)),function(t,e){var n=new Me;if(it.Image){var r=new Image;r.onload=dt(or,n,r,"TestLoadImage: loaded",!0,e),r.onerror=dt(or,n,r,"TestLoadImage: error",!1,e),r.onabort=dt(or,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=dt(or,n,r,"TestLoadImage: timeout",!1,e),it.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ze(2);t.G=0,t.j&&t.j.va(e),Gr(t),kr(t)}function Gr(t){t.G=0,t.I=-1,t.j&&(0==er(t.i).length&&0==t.l.length||(t.i.i.length=0,wt(t.l),t.l.length=0),t.j.ua())}function zr(t,e,n){var r=function(t){return t instanceof _n?Sn(t):new _n(t,void 0)}(n);if(""!=r.i)e&&Nn(r,e+"."+r.i),Cn(r,r.m);else{var i=it.location;r=function(t,e,n,r){var i=new _n(null,void 0);return t&&xn(i,t),e&&Nn(i,e),n&&Cn(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&Nt(t.aa,(function(t,e){Dn(r,e,t)})),n=t.sa,(e=t.D)&&n&&Dn(r,e,n),Dn(r,"VER",t.ma),Rr(t,r),r}function Qr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new dr(n&&t.Ba&&!t.qa?new sr({ib:!0}):t.qa)).L=t.H,e}function Wr(){}function Hr(){if(Ft&&!(10<=Number(Qt)))throw Error("Environmental error: no available transport.")}function Yr(t,e){pe.call(this),this.g=new xr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!It(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!It(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Jr(this)}function Xr(t){tn.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function $r(){en.call(this),this.status=1}function Jr(t){this.g=t}(et=dr.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Je.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Je),this.g.onreadystatechange=ft(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void vr(this,o)}t=n||"";var i=new In(this.headers);r&&wn(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=mr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=it.FormData&&t instanceof it.FormData,!(0<=mt(yr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Tr(this),0<this.B&&((this.K=function(t){return Ft&&function(){return t=zt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=Ot(String(At)).split("."),n=Ot("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=_t(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||_t(0==o[2].length,0==s[2].length)||_t(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ft(this.pa,this)):this.A=ke(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){vr(this,o)}},et.pa=function(){void 0!==rt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ge(this,"timeout"),this.abort(8))},et.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ge(this,"complete"),ge(this,"abort"),Ir(this))},et.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ir(this,!0)),dr.Z.M.call(this)},et.Fa=function(){this.s||(this.F||this.v||this.l?wr(this):this.cb())},et.cb=function(){wr(this)},et.ba=function(){try{return 2<Or(this)?this.g.status:-1}catch(Rt){return-1}},et.ga=function(){try{return this.g?this.g.responseText:""}catch(Rt){return""}},et.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),fr(e)}},et.Da=function(){return this.m},et.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(et=xr.prototype).ma=8,et.G=1,et.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},et.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new rn(this,this.h,t,void 0),n=this.s;if(this.P&&(n?Dt(n=Ct(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Pr(this,e,r),Dn(i=Sn(this.F),"RID",t),Dn(i,"CVER",22),this.D&&Dn(i,"X-HTTP-Session-Id",this.D),Rr(this,i),this.o&&n&&_r(i,this.o,n),Zn(this.i,e),this.Ra&&Dn(i,"TYPE","init"),this.ja?(Dn(i,"$req",r),Dn(i,"SID","null"),e.$=!0,cn(e,i,null)):cn(e,i,r),this.G=2}}else 3==this.G&&(t?Ar(this,t):0==this.l.length||Xn(this.i)||Ar(this))},et.Ga=function(){if(this.u=null,Vr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=We(ft(this.bb,this),t)}},et.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ze(10),Cr(this),Vr(this))},et.ab=function(){null!=this.v&&(this.v=null,Cr(this),Mr(this),ze(19))},et.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ze(2)):(this.h.info("Failed to ping google.com"),ze(1))},(et=Wr.prototype).xa=function(){},et.wa=function(){},et.va=function(){},et.ua=function(){},et.Oa=function(){},Hr.prototype.g=function(t,e){return new Yr(t,e)},pt(Yr,pe),Yr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Ee(ft(t.hb,t,e))),ze(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=zr(t,null,t.W),jr(t)},Yr.prototype.close=function(){Nr(this.g)},Yr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Dr(this.g,e)}else this.v?((e={}).__data__=me(t),Dr(this.g,e)):Dr(this.g,t)},Yr.prototype.M=function(){this.g.j=null,delete this.j,Nr(this.g),delete this.g,Yr.Z.M.call(this)},pt(Xr,tn),pt($r,en),pt(Jr,Wr),Jr.prototype.xa=function(){ge(this.g,"a")},Jr.prototype.wa=function(t){ge(this.g,new Xr(t))},Jr.prototype.va=function(t){ge(this.g,new $r(t))},Jr.prototype.ua=function(){ge(this.g,"b")},Hr.prototype.createWebChannel=Hr.prototype.g,Yr.prototype.send=Yr.prototype.u,Yr.prototype.open=Yr.prototype.m,Yr.prototype.close=Yr.prototype.close,He.NO_ERROR=0,He.TIMEOUT=8,He.HTTP_ERROR=6,Ye.COMPLETE="complete",$e.EventType=Ze,Ze.OPEN="a",Ze.CLOSE="b",Ze.ERROR="c",Ze.MESSAGE="d",pe.prototype.listen=pe.prototype.N,dr.prototype.listenOnce=dr.prototype.O,dr.prototype.getLastError=dr.prototype.La,dr.prototype.getLastErrorCode=dr.prototype.Da,dr.prototype.getStatus=dr.prototype.ba,dr.prototype.getResponseJson=dr.prototype.Qa,dr.prototype.getResponseText=dr.prototype.ga,dr.prototype.send=dr.prototype.ea;var Zr=He,ti=Ye,ei=Ve,ni=sr,ri=$e,ii=dr,oi=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();oi.o=-1;var si={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ai=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(X.c)(e,t),e}(Error),ui=new J.b("@firebase/firestore");function ci(){return ui.logLevel}function hi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ui.logLevel<=J.a.DEBUG){var r=e.map(di);ui.debug.apply(ui,Object(X.f)(["Firestore (8.10.1): "+t],r))}}function li(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ui.logLevel<=J.a.ERROR){var r=e.map(di);ui.error.apply(ui,Object(X.f)(["Firestore (8.10.1): "+t],r))}}function fi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ui.logLevel<=J.a.WARN){var r=e.map(di);ui.warn.apply(ui,Object(X.f)(["Firestore (8.10.1): "+t],r))}}function di(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(lp){return t}}function pi(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw li(e),new Error(e)}function gi(t,e){t||pi()}function yi(t,e){return t}function mi(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var vi=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=mi(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function bi(t,e){return t<e?-1:t>e?1:0}function wi(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Ii(t){return t+"\0"}var Ti=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ai(si.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ai(si.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ai(si.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ai(si.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?bi(this.nanoseconds,t.nanoseconds):bi(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Oi=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Ti(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Ei(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function _i(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Si(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var xi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&pi(),void 0===n?n=t.length-e:n>t.length-e&&pi(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Ni=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new ai(si.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(xi),Ci=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ki=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Ci.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new ai(si.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new ai(si.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ai(si.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new ai(si.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(xi),Di=function(){function t(t){this.fields=t,t.sort(ki.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return wi(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),ji=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return bi(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ji.EMPTY_BYTE_STRING=new ji("");var Ai=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ri(t){if(gi(!!t),"string"==typeof t){var e=0,n=Ai.exec(t);if(gi(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Pi(t.seconds),nanos:Pi(t.nanos)}}function Pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Fi(t){return"string"==typeof t?ji.fromBase64String(t):ji.fromUint8Array(t)}function Mi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Li(t){var e=Ri(t.mapValue.fields.__local_write_time__.timestampValue);return new Ti(e.seconds,e.nanos)}function Vi(t){return null==t}function Ui(t){return 0===t&&1/t==-1/0}function qi(t){return"number"==typeof t&&Number.isInteger(t)&&!Ui(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Bi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Ni.fromString(e))},t.fromName=function(e){return new t(Ni.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Ni.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Ni.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Ni(e.slice()))},t}();function Ki(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Mi(t)?4:10:pi()}function Gi(t,e){var n=Ki(t);if(n!==Ki(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Li(t).isEqual(Li(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ri(t.timestampValue),r=Ri(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Fi(t.bytesValue).isEqual(Fi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Pi(t.geoPointValue.latitude)===Pi(e.geoPointValue.latitude)&&Pi(t.geoPointValue.longitude)===Pi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Pi(t.integerValue)===Pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Pi(t.doubleValue),r=Pi(e.doubleValue);return n===r?Ui(n)===Ui(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return wi(t.arrayValue.values||[],e.arrayValue.values||[],Gi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ei(n)!==Ei(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Gi(n[i],r[i])))return!1;return!0}(t,e);default:return pi()}}function zi(t,e){return void 0!==(t.values||[]).find((function(t){return Gi(t,e)}))}function Qi(t,e){var n=Ki(t),r=Ki(e);if(n!==r)return bi(n,r);switch(n){case 0:return 0;case 1:return bi(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Pi(t.integerValue||t.doubleValue),r=Pi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Wi(t.timestampValue,e.timestampValue);case 4:return Wi(Li(t),Li(e));case 5:return bi(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Fi(t),r=Fi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=bi(n[i],r[i]);if(0!==o)return o}return bi(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=bi(Pi(t.latitude),Pi(e.latitude));return 0!==n?n:bi(Pi(t.longitude),Pi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Qi(n[i],r[i]);if(o)return o}return bi(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=bi(r[s],o[s]);if(0!==a)return a;var u=Qi(n[r[s]],i[o[s]]);if(0!==u)return u}return bi(r.length,o.length)}(t.mapValue,e.mapValue);default:throw pi()}}function Wi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return bi(t,e);var n=Ri(t),r=Ri(e),i=bi(n.seconds,r.seconds);return 0!==i?i:bi(n.nanos,r.nanos)}function Hi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Ri(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Fi(e.bytesValue).toBase64():"referenceValue"in e?Bi.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):pi();var n}(t)}function Yi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Xi(t){return!!t&&"integerValue"in t}function $i(t){return!!t&&"arrayValue"in t}function Ji(t){return!!t&&"nullValue"in t}function Zi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function to(t){return!!t&&"mapValue"in t}function eo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return _i(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=eo(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=eo(t.arrayValue.values[r]);return n}return Object.assign({},t)}var no=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!to(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=eo(e)},t.prototype.setAll=function(t){var e=this,n=ki.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=eo(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());to(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Gi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];to(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){_i(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(eo(this.value))},t}();function ro(t){var e=[];return _i(t.fields,(function(t,n){var r=new ki([t]);if(to(n)){var i=ro(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)})),new Di(e)}var io=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Oi.min(),no.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,no.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,no.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=no.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=no.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),oo=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function so(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new oo(t,e,n,r,i,o,s)}function ao(t){var e=yi(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Hi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),Vi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Io(e.startAt)),e.endAt&&(n+="|ub:",n+=Io(e.endAt)),e.h=n}return e.h}function uo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Oo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Gi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!_o(t.startAt,e.startAt)&&_o(t.endAt,e.endAt)}function co(t){return Bi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var ho=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(X.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new lo(t,n,r):"array-contains"===n?new yo(t,r):"in"===n?new mo(t,r):"not-in"===n?new vo(t,r):"array-contains-any"===n?new bo(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new fo(t,n):new po(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Qi(e,this.value)):null!==e&&Ki(this.value)===Ki(e)&&this.m(Qi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return pi()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),lo=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Bi.fromName(r.referenceValue),i}return Object(X.c)(e,t),e.prototype.matches=function(t){var e=Bi.comparator(t.key,this.key);return this.m(e)},e}(ho),fo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=go(0,n),r}return Object(X.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(ho),po=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=go(0,n),r}return Object(X.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(ho);function go(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Bi.fromName(t.referenceValue)}))}var yo=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(X.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return $i(e)&&zi(e.arrayValue,this.value)},e}(ho),mo=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(X.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&zi(this.value.arrayValue,e)},e}(ho),vo=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(X.c)(e,t),e.prototype.matches=function(t){if(zi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!zi(this.value.arrayValue,e)},e}(ho),bo=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(X.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!$i(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return zi(e.value.arrayValue,t)}))},e}(ho),wo=function(t,e){this.position=t,this.before=e};function Io(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Hi(t)})).join(",")}var To=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Oo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Eo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Bi.comparator(Bi.fromName(s.referenceValue),n.key):Qi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function _o(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Gi(t.position[n],e.position[n]))return!1;return!0}var So=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function xo(t,e,n,r,i,o,s,a){return new So(t,e,n,r,i,o,s,a)}function No(t){return new So(t)}function Co(t){return!Vi(t.limit)&&"F"===t.limitType}function ko(t){return!Vi(t.limit)&&"L"===t.limitType}function Do(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function jo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Ao(t){return null!==t.collectionGroup}function Ro(t){var e=yi(t);if(null===e.p){e.p=[];var n=jo(e),r=Do(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new To(n)),e.p.push(new To(ki.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new To(ki.keyField(),u))}}}return e.p}function Po(t){var e=yi(t);if(!e.T)if("F"===e.limitType)e.T=so(e.path,e.collectionGroup,Ro(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Ro(e);r<i.length;r++){var o=i[r];n.push(new To(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new wo(e.endAt.position,!e.endAt.before):null,a=e.startAt?new wo(e.startAt.position,!e.startAt.before):null;e.T=so(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Fo(t,e,n){return new So(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Mo(t,e){return uo(Po(t),Po(e))&&t.limitType===e.limitType}function Lo(t){return ao(Po(t))+"|lt:"+t.limitType}function Vo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Hi(e.value);var e})).join(", ")+"]"),Vi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Io(t.startAt)),t.endAt&&(e+=", endAt: "+Io(t.endAt)),"Target("+e+")"}(Po(t))+"; limitType="+t.limitType+")"}function Uo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Bi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Eo(t.startAt,Ro(t),e)||t.endAt&&Eo(t.endAt,Ro(t),e))}(t,e)}function qo(t){return function(e,n){for(var r=!1,i=0,o=Ro(t);i<o.length;i++){var s=o[i],a=Bo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Bo(t,e,n){var r=t.field.isKeyField()?Bi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Qi(r,i):pi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return pi()}}function Ko(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ui(e)?"-0":e}}function Go(t){return{integerValue:""+t}}function zo(t,e){return qi(e)?Go(e):Ko(t,e)}var Qo=function(){this._=void 0};function Wo(t,e,n){return t instanceof Xo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof $o?Jo(t,e):t instanceof Zo?ts(t,e):function(t,e){var n=Yo(t,e),r=ns(n)+ns(t.A);return Xi(n)&&Xi(t.A)?Go(r):Ko(t.R,r)}(t,e)}function Ho(t,e,n){return t instanceof $o?Jo(t,e):t instanceof Zo?ts(t,e):n}function Yo(t,e){return t instanceof es?Xi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Xo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e}(Qo),$o=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(X.c)(e,t),e}(Qo);function Jo(t,e){for(var n=rs(e),r=function(t){n.some((function(e){return Gi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Zo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(X.c)(e,t),e}(Qo);function ts(t,e){for(var n=rs(e),r=function(t){n=n.filter((function(e){return!Gi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var es=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(X.c)(e,t),e}(Qo);function ns(t){return Pi(t.integerValue||t.doubleValue)}function rs(t){return $i(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var is=function(t,e){this.field=t,this.transform=e},os=function(t,e){this.version=t,this.transformResults=e},ss=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function as(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var us=function(){};function cs(t,e,n){t instanceof ps?function(t,e,n){var r=t.value.clone(),i=ms(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof gs?function(t,e,n){if(as(t.precondition,e)){var r=ms(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ys(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function hs(t,e,n){t instanceof ps?function(t,e,n){if(as(t.precondition,e)){var r=t.value.clone(),i=vs(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ds(e),r).setHasLocalMutations()}}(t,e,n):t instanceof gs?function(t,e,n){if(as(t.precondition,e)){var r=vs(t.fieldTransforms,n,e),i=e.data;i.setAll(ys(t)),i.setAll(r),e.convertToFoundDocument(ds(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){as(t.precondition,e)&&e.convertToNoDocument(Oi.min())}(t,e)}function ls(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Yo(o.transform,s||null);null!=a&&(null==n&&(n=no.empty()),n.set(o.field,a))}return n||null}function fs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&wi(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof $o&&e instanceof $o||t instanceof Zo&&e instanceof Zo?wi(t.elements,e.elements,Gi):t instanceof es&&e instanceof es?Gi(t.A,e.A):t instanceof Xo&&e instanceof Xo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ds(t){return t.isFoundDocument()?t.version:Oi.min()}var ps=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(X.c)(e,t),e}(us),gs=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(X.c)(e,t),e}(us);function ys(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function ms(t,e,n){var r=new Map;gi(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Ho(s,a,n[i]))}return r}function vs(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Wo(a,u,e))}return r}var bs,ws,Is=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(X.c)(e,t),e}(us),Ts=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(X.c)(e,t),e}(us),Os=function(t){this.count=t};function Es(t){switch(t){case si.OK:return pi();case si.CANCELLED:case si.UNKNOWN:case si.DEADLINE_EXCEEDED:case si.RESOURCE_EXHAUSTED:case si.INTERNAL:case si.UNAVAILABLE:case si.UNAUTHENTICATED:return!1;case si.INVALID_ARGUMENT:case si.NOT_FOUND:case si.ALREADY_EXISTS:case si.PERMISSION_DENIED:case si.FAILED_PRECONDITION:case si.ABORTED:case si.OUT_OF_RANGE:case si.UNIMPLEMENTED:case si.DATA_LOSS:return!0;default:return pi()}}function _s(t){if(void 0===t)return li("GRPC error has no .code"),si.UNKNOWN;switch(t){case bs.OK:return si.OK;case bs.CANCELLED:return si.CANCELLED;case bs.UNKNOWN:return si.UNKNOWN;case bs.DEADLINE_EXCEEDED:return si.DEADLINE_EXCEEDED;case bs.RESOURCE_EXHAUSTED:return si.RESOURCE_EXHAUSTED;case bs.INTERNAL:return si.INTERNAL;case bs.UNAVAILABLE:return si.UNAVAILABLE;case bs.UNAUTHENTICATED:return si.UNAUTHENTICATED;case bs.INVALID_ARGUMENT:return si.INVALID_ARGUMENT;case bs.NOT_FOUND:return si.NOT_FOUND;case bs.ALREADY_EXISTS:return si.ALREADY_EXISTS;case bs.PERMISSION_DENIED:return si.PERMISSION_DENIED;case bs.FAILED_PRECONDITION:return si.FAILED_PRECONDITION;case bs.ABORTED:return si.ABORTED;case bs.OUT_OF_RANGE:return si.OUT_OF_RANGE;case bs.UNIMPLEMENTED:return si.UNIMPLEMENTED;case bs.DATA_LOSS:return si.DATA_LOSS;default:return pi()}}(ws=bs||(bs={}))[ws.OK=0]="OK",ws[ws.CANCELLED=1]="CANCELLED",ws[ws.UNKNOWN=2]="UNKNOWN",ws[ws.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ws[ws.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ws[ws.NOT_FOUND=5]="NOT_FOUND",ws[ws.ALREADY_EXISTS=6]="ALREADY_EXISTS",ws[ws.PERMISSION_DENIED=7]="PERMISSION_DENIED",ws[ws.UNAUTHENTICATED=16]="UNAUTHENTICATED",ws[ws.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ws[ws.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ws[ws.ABORTED=10]="ABORTED",ws[ws.OUT_OF_RANGE=11]="OUT_OF_RANGE",ws[ws.UNIMPLEMENTED=12]="UNIMPLEMENTED",ws[ws.INTERNAL=13]="INTERNAL",ws[ws.UNAVAILABLE=14]="UNAVAILABLE",ws[ws.DATA_LOSS=15]="DATA_LOSS";var Ss=function(){function t(t,e){this.comparator=t,this.root=e||Ns.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ns.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ns.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new xs(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new xs(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new xs(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new xs(this.root,t,this.comparator,!0)},t}(),xs=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Ns=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw pi();if(this.right.isRed())throw pi();var t=this.left.check();if(t!==this.right.check())throw pi();return t+(this.isRed()?0:1)},t}();Ns.EMPTY=null,Ns.RED=!0,Ns.BLACK=!1,Ns.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw pi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw pi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw pi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw pi()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw pi()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Ns(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Cs=function(){function t(t){this.comparator=t,this.data=new Ss(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new ks(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new ks(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),ks=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Ds=new Ss(Bi.comparator);function js(){return Ds}var As=new Ss(Bi.comparator);function Rs(){return As}var Ps=new Ss(Bi.comparator);function Fs(){return Ps}var Ms=new Cs(Bi.comparator);function Ls(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ms,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Vs=new Cs(bi);function Us(){return Vs}var qs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Bs.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Oi.min(),r,Us(),js(),Ls())},t}(),Bs=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ji.EMPTY_BYTE_STRING,n,Ls(),Ls(),Ls())},t}(),Ks=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Gs=function(t,e){this.targetId=t,this.V=e},zs=function(t,e,n,r){void 0===n&&(n=ji.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Qs=function(){function t(){this.S=0,this.D=Ys(),this.C=ji.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=Ls(),e=Ls(),n=Ls();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:pi()}})),new Bs(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=Ys()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),Ws=function(){function t(t){this.W=t,this.G=new Map,this.H=js(),this.J=Hs(),this.Y=new Cs(bi)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:pi()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(co(i))if(0===n){var o=new Bi(i.path);this.tt(e,o,io.newNoDocument(o,Oi.min()))}else gi(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&co(o.target)){var s=new Bi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,io.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=Ls();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new qs(t,n,this.Y,this.H,r);return this.H=js(),this.J=Hs(),this.Y=new Cs(bi),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Qs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Cs(bi),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||hi("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Qs),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Hs(){return new Ss(Bi.comparator)}function Ys(){return new Ss(Bi.comparator)}var Xs={asc:"ASCENDING",desc:"DESCENDING"},$s={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Js=function(t,e){this.databaseId=t,this.I=e};function Zs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ta(t,e){return t.I?e.toBase64():e.toUint8Array()}function ea(t,e){return Zs(t,e.toTimestamp())}function na(t){return gi(!!t),Oi.fromTimestamp(function(t){var e=Ri(t);return new Ti(e.seconds,e.nanos)}(t))}function ra(t,e){return function(t){return new Ni(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function ia(t){var e=Ni.fromString(t);return gi(xa(e)),e}function oa(t,e){return ra(t.databaseId,e.path)}function sa(t,e){var n=ia(e);if(n.get(1)!==t.databaseId.projectId)throw new ai(si.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ai(si.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Bi(ha(n))}function aa(t,e){return ra(t.databaseId,e)}function ua(t){var e=ia(t);return 4===e.length?Ni.emptyPath():ha(e)}function ca(t){return new Ni(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ha(t){return gi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function la(t,e,n){return{name:oa(t,e),fields:n.value.mapValue.fields}}function fa(t,e,n){var r=sa(t,e.name),i=na(e.updateTime),o=new no({mapValue:{fields:e.fields}}),s=io.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function da(t,e){var n;if(e instanceof ps)n={update:la(t,e.key,e.value)};else if(e instanceof Is)n={delete:oa(t,e.key)};else if(e instanceof gs)n={update:la(t,e.key,e.data),updateMask:Sa(e.fieldMask)};else{if(!(e instanceof Ts))return pi();n={verify:oa(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Xo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof $o)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Zo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof es)return{fieldPath:e.field.canonicalString(),increment:n.A};throw pi()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ea(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:pi()}(t,e.precondition)),n}function pa(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?ss.updateTime(na(t.updateTime)):void 0!==t.exists?ss.exists(t.exists):ss.none()}(e.currentDocument):ss.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;"setToServerValue"in e?(gi("REQUEST_TIME"===e.setToServerValue),n=new Xo):"appendMissingElements"in e?n=new $o(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Zo(e.removeAllFromArray.values||[]):"increment"in e?n=new es(t,e.increment):pi();var r=ki.fromServerFormat(e.fieldPath);return new is(r,n)}(t,e)})):[];if(e.update){var i=sa(t,e.update.name),o=new no({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new Di((t.fieldPaths||[]).map((function(t){return ki.fromServerFormat(t)})))}(e.updateMask);return new gs(i,o,s,n,r)}return new ps(i,o,n,r)}if(e.delete){var a=sa(t,e.delete);return new Is(a,n)}if(e.verify){var u=sa(t,e.verify);return new Ts(u,n)}return pi()}function ga(t,e){return{documents:[aa(t,e.path)]}}function ya(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=aa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=aa(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Zi(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NAN"}};if(Ji(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Zi(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NOT_NAN"}};if(Ji(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ta(t.field),op:Ia(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Ta(t.field),direction:wa(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Vi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=va(e.startAt)),e.endAt&&(n.structuredQuery.endAt=va(e.endAt)),n}function ma(t){var e=ua(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){gi(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[_a(e)]:void 0!==e.fieldFilter?[Ea(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):pi():[]}(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new To(Oa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return Vi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ba(n.startAt));var h=null;return n.endAt&&(h=ba(n.endAt)),xo(e,i,a,s,u,"F",c,h)}function va(t){return{before:t.before,values:t.position}}function ba(t){return new wo(t.values||[],!!t.before)}function wa(t){return Xs[t]}function Ia(t){return $s[t]}function Ta(t){return{fieldPath:t.canonicalString()}}function Oa(t){return ki.fromServerFormat(t.fieldPath)}function Ea(t){return ho.create(Oa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return pi()}}(t.fieldFilter.op),t.fieldFilter.value)}function _a(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Oa(t.unaryFilter.field);return ho.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Oa(t.unaryFilter.field);return ho.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Oa(t.unaryFilter.field);return ho.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Oa(t.unaryFilter.field);return ho.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return pi()}}function Sa(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function xa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Na(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ka(e)),e=Ca(t.get(n),e);return ka(e)}function Ca(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ka(t){return t+"\x01\x01"}function Da(t){var e=t.length;if(gi(e>=2),2===e)return gi("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Ni.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&pi(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:pi()}o=s+2}return new Ni(r)}var ja=function(t,e){this.seconds=t,this.nanoseconds=e},Aa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Aa.store="owner",Aa.key="owner";var Ra=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ra.store="mutationQueues",Ra.keyPath="userId";var Pa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Pa.store="mutations",Pa.keyPath="batchId",Pa.userMutationsIndex="userMutationsIndex",Pa.userMutationsKeyPath=["userId","batchId"];var Fa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Na(e)]},t.key=function(t,e,n){return[t,Na(e),n]},t}();Fa.store="documentMutations",Fa.PLACEHOLDER=new Fa;var Ma=function(t,e){this.path=t,this.readTime=e},La=function(t,e){this.path=t,this.version=e},Va=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Va.store="remoteDocuments",Va.readTimeIndex="readTimeIndex",Va.readTimeIndexPath="readTime",Va.collectionReadTimeIndex="collectionReadTimeIndex",Va.collectionReadTimeIndexPath=["parentPath","readTime"];var Ua=function(t){this.byteSize=t};Ua.store="remoteDocumentGlobal",Ua.key="remoteDocumentGlobalKey";var qa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};qa.store="targets",qa.keyPath="targetId",qa.queryTargetsIndexName="queryTargetsIndex",qa.queryTargetsKeyPath=["canonicalId","targetId"];var Ba=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ba.store="targetDocuments",Ba.keyPath=["targetId","path"],Ba.documentTargetsIndex="documentTargetsIndex",Ba.documentTargetsKeyPath=["path","targetId"];var Ka=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ka.key="targetGlobalKey",Ka.store="targetGlobal";var Ga=function(t,e){this.collectionId=t,this.parent=e};Ga.store="collectionParents",Ga.keyPath=["collectionId","parent"];var za=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};za.store="clientMetadata",za.keyPath="clientId";var Qa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Qa.store="bundles",Qa.keyPath="bundleId";var Wa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Wa.store="namedQueries",Wa.keyPath="name";var Ha=Object(X.f)(Object(X.f)([],Object(X.f)(Object(X.f)([],Object(X.f)(Object(X.f)([],Object(X.f)(Object(X.f)([],[Ra.store,Pa.store,Fa.store,Va.store,qa.store,Aa.store,Ka.store,Ba.store]),[za.store])),[Ua.store])),[Ga.store])),[Qa.store,Wa.store]),Ya="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Xa=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),$a=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Ja=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&pi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),Za=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new $a,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new nu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=au(e.target.error);n.ft.reject(new nu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new nu(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(hi("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new iu(e)},t}(),tu=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object($.i)())&&li("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return hi("SimpleDb","Removing database:",t),ou(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object($.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(X.b)(this,void 0,void 0,(function(){var e,n=this;return Object(X.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(hi("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new nu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new ai(si.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new nu(t,n))},i.onupgradeneeded=function(t){hi("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next((function(){hi("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(X.b)(this,void 0,void 0,(function(){var i,o,s,a,u;return Object(X.d)(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(X.d)(this,(function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Za.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),Ja.reject(t)})).toPromise(),u={},s.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return hi("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),eu=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return ou(this.Pt.delete())},t}(),nu=function(t){function e(e,n){var r=this;return(r=t.call(this,si.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(X.c)(e,t),e}(ai);function ru(t){return"IndexedDbTransactionError"===t.name}var iu=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(hi("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(hi("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ou(n)},t.prototype.add=function(t){return hi("SimpleDb","ADD",this.store.name,t,t),ou(this.store.add(t))},t.prototype.get=function(t){var e=this;return ou(this.store.get(t)).next((function(n){return void 0===n&&(n=null),hi("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return hi("SimpleDb","DELETE",this.store.name,t),ou(this.store.delete(t))},t.prototype.count=function(){return hi("SimpleDb","COUNT",this.store.name),ou(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.kt=function(t,e){hi("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Ja((function(n,r){e.onerror=function(t){var e=au(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new Ja((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new eu(i),s=e(i.primaryKey,i.value,o);if(s instanceof Ja){var a=s.catch((function(t){return o.done(),Ja.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return Ja.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ou(t){return new Ja((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=au(t.target.error);n(e)}}))}var su=!1;function au(t){var e=tu._t(Object($.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new ai("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return su||(su=!0,setTimeout((function(){throw r}),0)),r}}return t}var uu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(X.c)(e,t),e}(Xa);function cu(t,e){var n=yi(t);return tu.It(n.Mt,e)}var hu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&cs(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&hs(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&hs(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Oi.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Ls())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&wi(this.mutations,t.mutations,(function(t,e){return fs(t,e)}))&&wi(this.baseMutations,t.baseMutations,(function(t,e){return fs(t,e)}))},t}(),lu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){gi(e.mutations.length===r.length);for(var i=Fs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),fu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Oi.min()),void 0===o&&(o=Oi.min()),void 0===s&&(s=ji.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),du=function(t){this.Lt=t};function pu(t,e){if(e.document)return fa(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Bi.fromSegments(e.noDocument.path),r=bu(e.noDocument.readTime),i=io.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Bi.fromSegments(e.unknownDocument.path);return r=bu(e.unknownDocument.version),io.newUnknownDocument(o,r)}return pi()}function gu(t,e,n){var r=yu(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:oa(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Zs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Va(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=vu(e.version);return s=e.hasCommittedMutations,new Va(null,new Ma(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=vu(e.version);return new Va(new La(c,h),null,null,!0,r,i)}return pi()}function yu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function mu(t){var e=new Ti(t[0],t[1]);return Oi.fromTimestamp(e)}function vu(t){var e=t.toTimestamp();return new ja(e.seconds,e.nanoseconds)}function bu(t){var e=new Ti(t.seconds,t.nanoseconds);return Oi.fromTimestamp(e)}function wu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return pa(t.Lt,e)})),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map((function(e){return pa(t.Lt,e)})),o=Ti.fromMillis(e.localWriteTimeMs);return new hu(e.batchId,o,n,i)}function Iu(t){var e,n,r=bu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?bu(t.lastLimboFreeSnapshotVersion):Oi.min();return void 0!==t.query.documents?(gi(1===(n=t.query).documents.length),e=Po(No(ua(n.documents[0])))):e=function(t){return Po(ma(t))}(t.query),new fu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ji.fromBase64String(t.resumeToken))}function Tu(t,e){var n,r=vu(e.snapshotVersion),i=vu(e.lastLimboFreeSnapshotVersion);n=co(e.target)?ga(t.Lt,e.target):ya(t.Lt,e.target);var o=e.resumeToken.toBase64();return new qa(e.targetId,ao(e.target),r,o,e.sequenceNumber,i,n)}function Ou(t){var e=ma({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Fo(e,e.limit,"L"):e}var Eu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return _u(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:bu(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return _u(t).put({bundleId:(n=e).id,createTime:vu(na(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Su(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Ou(e.bundledQuery),readTime:bu(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Su(t).put(function(t){return{name:t.name,readTime:vu(na(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function _u(t){return cu(t,Qa.store)}function Su(t){return cu(t,Wa.store)}var xu=function(){function t(){this.Bt=new Nu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ja.resolve()},t.prototype.getCollectionParents=function(t,e){return Ja.resolve(this.Bt.getEntries(e))},t}(),Nu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Cs(Ni.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Cs(Ni.comparator)).toArray()},t}(),Cu=function(){function t(){this.qt=new Nu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Na(i)};return ku(t).put(o)}return Ja.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ii(e),""],!1,!0);return ku(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Da(o.parent))}return n}))},t}();function ku(t){return cu(t,Ga.store)}var Du={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ju=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Au(t,e,n){var r=t.store(Pa.store),i=t.store(Fa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){gi(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Fa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Ja.waitFor(o).next((function(){return c}))}function Ru(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw pi();e=t.noDocument}return JSON.stringify(e).length}ju.DEFAULT_COLLECTION_PERCENTILE=10,ju.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ju.DEFAULT=new ju(41943040,ju.DEFAULT_COLLECTION_PERCENTILE,ju.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ju.DISABLED=new ju(-1,0,0);var Pu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return gi(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mu(t).$t({index:Pa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Lu(t),s=Mu(t);return s.add({}).next((function(a){gi("number"==typeof a);for(var u=new hu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return da(t.Lt,e)})),i=n.mutations.map((function(e){return da(t.Lt,e)}));return new Pa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Cs((function(t,e){return bi(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],g=Fa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Fa.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),Ja.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Mu(t).get(e).next((function(t){return t?(gi(t.userId===n.userId),wu(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Ja.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Mu(t).$t({index:Pa.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(gi(e.batchId>=r),o=wu(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Mu(t).$t({index:Pa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Mu(t).Nt(Pa.userMutationsIndex,n).next((function(t){return t.map((function(t){return wu(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Fa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Lu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[2],c=Da(r[1]);if(a===n.userId&&e.path.isEqual(c))return Mu(t).get(u).next((function(t){if(!t)throw pi();gi(t.userId===n.userId),o.push(wu(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Cs(bi),i=[];return e.forEach((function(e){var o=Fa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Lu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[2],u=Da(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()}));i.push(a)})),Ja.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Fa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Cs(bi);return Lu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[2],c=Da(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Mu(t).get(e).next((function(t){if(null===t)throw pi();gi(t.userId===n.userId),r.push(wu(n.R,t))})))})),Ja.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Au(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),Ja.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return Ja.resolve();var r=IDBKeyRange.lowerBound(Fa.prefixForUser(e.userId)),i=[];return Lu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Da(t[1]);i.push(o)}else r.done()})).next((function(){gi(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Fu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Vu(t).get(this.userId).next((function(t){return t||new Ra(e.userId,-1,"")}))},t}();function Fu(t,e,n){var r=Fa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Lu(t).$t({range:o,Ft:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()})).next((function(){return s}))}function Mu(t){return cu(t,Pa.store)}function Lu(t){return cu(t,Fa.store)}function Vu(t){return cu(t,Ra.store)}var Uu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),qu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Uu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Oi.fromTimestamp(new Ti(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Bu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return gi(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Bu(t).$t((function(s,a){var u=Iu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return Ja.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return Bu(t).$t((function(t,n){var r=Iu(n);e(r)}))},t.prototype.Xt=function(t){return Ku(t).get(Ka.key).next((function(t){return gi(null!==t),t}))},t.prototype.Zt=function(t,e){return Ku(t).put(Ka.key,e)},t.prototype.te=function(t,e){return Bu(t).put(Tu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=ao(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Bu(t).$t({range:r,index:qa.queryTargetsIndexName},(function(t,n,r){var o=Iu(n);uo(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Gu(t);return e.forEach((function(e){var s=Na(e.path);i.push(o.put(new Ba(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),Ja.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Gu(t);return Ja.forEach(e,(function(e){var o=Na(e.path);return Ja.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Gu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Gu(t),i=Ls();return r.$t({range:n,Ft:!0},(function(t,e,n){var r=Da(t[1]),o=new Bi(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Na(e.path),r=IDBKeyRange.bound([n],[Ii(n)],!1,!0),i=0;return Gu(t).$t({index:Ba.documentTargetsIndex,Ft:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return Bu(t).get(e).next((function(t){return t?Iu(t):null}))},t}();function Bu(t){return cu(t,qa.store)}function Ku(t){return cu(t,Ka.store)}function Gu(t){return cu(t,Ba.store)}function zu(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){if(t.code!==si.FAILED_PRECONDITION||t.message!==Ya)throw t;return hi("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Qu(t,e){var n=t[1],r=e[1],i=bi(t[0],e[0]);return 0===i?bi(n,r):i}var Wu=function(){function t(t){this.ne=t,this.buffer=new Cs(Qu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Qu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Hu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;hi("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return Object(X.b)(e,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ru(e=n.sent())?(hi("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,zu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Yu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Ja.resolve(oi.o);var r=new Wu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(hi("LruGarbageCollector","Garbage collection skipped; disabled"),Ja.resolve(Du)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(hi("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Du):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(hi("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),ci()<=J.a.DEBUG&&hi("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Ja.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),Xu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Yu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return $u(t,n)},t.prototype.removeReference=function(t,e,n){return $u(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return $u(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Vu(t).Ot((function(r){return Fu(t,r,e).next((function(t){return t&&(n=!0),Ja.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Gu(t).delete([0,Na(s.path)])}))}));i.push(u)}})).next((function(){return Ja.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return $u(t,e)},t.prototype.we=function(t,e){var n,r=Gu(t),i=oi.o;return r.$t({index:Ba.documentTargetsIndex},(function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==oi.o&&e(new Bi(Da(n)),i),i=s,n=o):i=oi.o})).next((function(){i!==oi.o&&e(new Bi(Da(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function $u(t,e){return Gu(t).put(function(t,e){return new Ba(0,Na(t.path),e)}(e,t.currentSequenceNumber))}var Ju=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){_i(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},t.prototype.isEmpty=function(){return Si(this.inner)},t}(),Zu=function(){function t(){this.changes=new Ju((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Oi.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:io.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ja.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),tc=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return rc(t).put(ic(e),n)},t.prototype.removeEntry=function(t,e){var n=rc(t),r=ic(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return rc(t).get(ic(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return rc(t).get(ic(e)).next((function(t){return{document:n.ye(e,t),size:Ru(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=js();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=js(),i=new Ss(Bi.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Ru(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Ja.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return rc(t).$t({range:r},(function(t,e,r){for(var s=Bi.fromSegments(t);o&&Bi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=js(),o=e.path.length+1,s={};if(n.isEqual(Oi.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=yu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Va.collectionReadTimeIndex}return rc(t).$t(s,(function(t,n,s){if(t.length===o){var a=pu(r.R,n);e.path.isPrefixOf(a.key.path)?Uo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new ec(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return nc(t).get(Ua.key).next((function(t){return gi(!!t),t}))},t.prototype.me=function(t,e){return nc(t).put(Ua.key,e)},t.prototype.ye=function(t,e){if(e){var n=pu(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Oi.min()))return n}return io.newInvalidDocument(t)},t}(),ec=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Ju((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(X.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Cs((function(t,e){return bi(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=gu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Ru(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=gu(e.Ie.R,io.newNoDocument(o,Oi.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),Ja.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(Zu);function nc(t){return cu(t,Ua.store)}function rc(t){return cu(t,Va.store)}function ic(t){return t.path.toArray()}var oc=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;gi(n<r&&n>=0&&r<=11);var o=new Za("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Aa.store)}(t),function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath}),t.createObjectStore(Pa.store,{keyPath:Pa.keyPath,autoIncrement:!0}).createIndex(Pa.userMutationsIndex,Pa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Fa.store)}(t),sc(t),function(t){t.createObjectStore(Va.store)}(t));var s=Ja.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ba.store),t.deleteObjectStore(qa.store),t.deleteObjectStore(Ka.store)}(t),sc(t)),s=s.next((function(){return function(t){var e=t.store(Ka.store),n=new Ka(0,0,Oi.min().toTimestamp(),0);return e.put(Ka.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Pa.store).Nt().next((function(n){t.deleteObjectStore(Pa.store),t.createObjectStore(Pa.store,{keyPath:Pa.keyPath,autoIncrement:!0}).createIndex(Pa.userMutationsIndex,Pa.userMutationsKeyPath,{unique:!0});var r=e.store(Pa.store),i=n.map((function(t){return r.put(t)}));return Ja.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(za.store,{keyPath:za.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Ua.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Va.store);e.createIndex(Va.readTimeIndex,Va.readTimeIndexPath,{unique:!1}),e.createIndex(Va.collectionReadTimeIndex,Va.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath})}(t),function(t){t.createObjectStore(Wa.store,{keyPath:Wa.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Va.store).$t((function(t,n){e+=Ru(n)})).next((function(){var n=new Ua(e);return t.store(Ua.store).put(Ua.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Ra.store),r=t.store(Pa.store);return n.Nt().next((function(n){return Ja.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Pa.userMutationsIndex,i).next((function(r){return Ja.forEach(r,(function(r){gi(r.userId===n.userId);var i=wu(e.R,r);return Au(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(Ba.store),n=t.store(Va.store);return t.store(Ka.store).get(Ka.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new Ni(n),s=function(t){return[0,Na(t)]}(o);r.push(e.get(s).next((function(n){return n?Ja.resolve():function(n){return e.put(new Ba(0,Na(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Ja.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(Ga.store,{keyPath:Ga.keyPath});var n=e.store(Ga.store),r=new Nu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Na(i)})}};return e.store(Va.store).$t({Ft:!0},(function(t,e){var n=new Ni(t);return i(n.popLast())})).next((function(){return e.store(Fa.store).$t({Ft:!0},(function(t,e){var n=Da(t[1]);return i(n.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(qa.store);return n.$t((function(t,r){var i=Iu(r),o=Tu(e.R,i);return n.put(o)}))},t}();function sc(t){t.createObjectStore(Ba.store,{keyPath:Ba.keyPath}).createIndex(Ba.documentTargetsIndex,Ba.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(qa.store,{keyPath:qa.keyPath}).createIndex(qa.queryTargetsIndexName,qa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ka.store)}var ac="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",uc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new ai(si.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Xu(this,i),this.Le=n+"main",this.R=new du(u),this.Be=new tu(this.Le,11,new oc(this.R)),this.qe=new qu(this.referenceDelegate,this.R),this.Ut=new Cu,this.Ue=function(t,e){return new tc(t,e)}(this.R,this.Ut),this.Ke=new Eu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&li("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new ai(si.FAILED_PRECONDITION,ac);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new oi(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(X.b)(e,void 0,void 0,(function(){return Object(X.d)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return Object(X.b)(e,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return Object(X.b)(e,void 0,void 0,(function(){return Object(X.d)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return hc(e).put(new za(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(ru(e))return hi("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return hi("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return cc(t).get(Aa.key).next((function(t){return Ja.resolve(e.tn(t))}))},t.prototype.en=function(t){return hc(t).delete(this.clientId)},t.prototype.nn=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(X.d)(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=cu(t,za.store);return e.Nt().next((function(t){var n=r.rn(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return Ja.forEach(i,(function(t){return e.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Ja.resolve(!0):cc(t).get(Aa.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new ai(si.FAILED_PRECONDITION,ac);return!1}}return!(!e.networkEnabled||!e.inForeground)||hc(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&hi("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Object(X.b)(this,void 0,void 0,(function(){var t=this;return Object(X.d)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Aa.store,za.store],(function(e){var n=new uu(e,oi.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return hc(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Pu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return hi("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ha,(function(o){return r=new uu(o,i.Ne?i.Ne.next():oi.o),"readwrite-primary"===e?i.Je(r).next((function(t){return!!t||i.Ye(r)})).next((function(e){if(!e)throw li("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable((function(){return i.Me(!1)})),new ai(si.FAILED_PRECONDITION,Ya);return n(r)})).next((function(t){return i.Ze(r).next((function(){return t}))})):i.dn(r).next((function(){return n(r)}))})).then((function(t){return r.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return cc(t).get(Aa.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new ai(si.FAILED_PRECONDITION,ac)}))},t.prototype.Ze=function(t){var e=new Aa(this.clientId,this.allowTabSynchronization,Date.now());return cc(t).put(Aa.key,e)},t.yt=function(){return tu.yt()},t.prototype.Xe=function(t){var e=this,n=cc(t);return n.get(Aa.key).next((function(t){return e.tn(t)?(hi("IndexedDbPersistence","Releasing primary lease."),n.delete(Aa.key)):Ja.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(li("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),Object($.q)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return hi("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return li("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){li("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function cc(t){return cu(t,Aa.store)}function hc(t){return cu(t,za.store)}function lc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var fc=function(t,e){this.progress=t,this.wn=e},dc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Bi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Ao(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Bi(e)).next((function(t){var e=Rs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Rs();return this.Ut.getCollectionParents(t,i).next((function(s){return Ja.forEach(s,(function(s){var a=function(t,e){return new So(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o.Rn(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=io.newInvalidDocument(c),r=r.insert(c,h)),hs(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Uo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Ls(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof gs&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),pc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ls(),i=Ls(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),gc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Oi.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return(Co(e)||ko(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(ci()<=J.a.DEBUG&&hi("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Vo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Cs(qo(t));return e.forEach((function(e,r){Uo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return ci()<=J.a.DEBUG&&hi("QueryEngine","Using full collection scan to execute query:",Vo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Oi.min())},t}(),yc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Ss(bi),this.Fn=new Ju((function(t){return ao(t)}),uo),this.$n=Oi.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new dc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},t}();function mc(t,e,n,r){return new yc(t,e,n,r)}function vc(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(X.d)(this,(function(s){switch(s.label){case 0:return n=yi(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new dc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Ls(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function bc(t,e){var n=yi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Ja.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);gi(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function wc(t){var e=yi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Ic(t,e){var n=yi(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return gi(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=js();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Tc(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Oi.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return Ja.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.kn=i,t}))}function Tc(t,e,n,r,i){var o=Ls();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=js();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Oi.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):hi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Oc(t,e){var n=yi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Ec(t,e){var n=yi(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?Ja.resolve(r=i):n.qe.allocateTargetId(t).next((function(i){return r=new fu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t}))}function _c(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(X.d)(this,(function(a){switch(a.label){case 0:r=yi(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!ru(s=a.sent()))throw s;return hi("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}}))}))}function Sc(t,e,n){var r=yi(t),i=Oi.min(),o=Ls();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=yi(t),i=r.Fn.get(n);return void 0!==i?Ja.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,Po(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Oi.min(),n?o:Ls())})).next((function(t){return{documents:t,Bn:o}}))}))}function xc(t,e){var n=yi(t),r=yi(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Nc(t){var e=yi(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=yi(t),i=js(),o=yu(n),s=rc(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Va.readTimeIndex,range:a},(function(t,e){var n=pu(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:mu(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn;return e.$n=t.readTime,n}))}function Cc(t){return Object(X.b)(this,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){return[2,(e=yi(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=rc(t),n=Oi.min();return e.$t({index:Va.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=mu(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}function kc(t,e,n,r){return Object(X.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return Object(X.d)(this,(function(p){switch(p.label){case 0:for(i=yi(t),o=Ls(),s=js(),a=Fs(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,Ec(i,function(t){return Po(No(Ni.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Tc(t,f,s,Oi.min(),a).next((function(e){return f.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Dc(t,e,n){return void 0===n&&(n=Ls()),Object(X.b)(this,void 0,void 0,(function(){var r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:return[4,Ec(t,Po(Ou(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=yi(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=na(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(ji.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Ke.saveNamedQuery(t,e)}))}))]}}))}))}var jc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Ja.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:na(n.createTime)}),Ja.resolve()},t.prototype.getNamedQuery=function(t,e){return Ja.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Ou(t.bundledQuery),readTime:na(t.readTime)}}(e)),Ja.resolve()},t}(),Ac=function(){function t(){this.Wn=new Cs(Rc.Gn),this.zn=new Cs(Rc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Rc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Rc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new Bi(new Ni([])),r=new Rc(n,t),i=new Rc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Bi(new Ni([])),n=new Rc(e,t),r=new Rc(e,t+1),i=Ls();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Rc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Rc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Bi.comparator(t.key,e.key)||bi(t.ns,e.ns)},t.Hn=function(t,e){return bi(t.ns,e.ns)||Bi.comparator(t.key,e.key)},t}(),Pc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Cs(Rc.Gn)}return t.prototype.checkEmpty=function(t){return Ja.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new hu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Rc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Ja.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Ja.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Ja.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Ja.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Ja.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Rc(e,0),i=new Rc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),Ja.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Cs(bi);return e.forEach((function(t){var e=new Rc(t,0),i=new Rc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),Ja.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Bi.isDocumentKey(i)||(i=i.child(""));var o=new Rc(new Bi(i),0),s=new Cs(bi);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),Ja.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;gi(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Ja.forEach(e.mutations,(function(i){var o=new Rc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Rc(e,0),r=this.rs.firstAfterOrEqual(n);return Ja.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Ja.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Fc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ss(Bi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ja.resolve(n?n.document.clone():io.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=js();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():io.newInvalidDocument(t))})),Ja.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=js(),i=new Bi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Uo(e,u)&&(r=r.insert(u.key,u.clone()))}return Ja.resolve(r)},t.prototype.fs=function(t,e){return Ja.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Mc(this)},t.prototype.getSize=function(t){return Ja.resolve(this.size)},t}(),Mc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(X.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),Ja.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Zu),Lc=function(){function t(t){this.persistence=t,this.ds=new Ju((function(t){return ao(t)}),uo),this.lastRemoteSnapshotVersion=Oi.min(),this.highestTargetId=0,this.ws=0,this._s=new Ac,this.targetCount=0,this.ys=Uu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),Ja.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Ja.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Ja.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ja.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ja.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Uu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ja.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Ja.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Ja.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),Ja.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return Ja.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Ja.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ja.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),Ja.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ja.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Ja.resolve(n)},t.prototype.containsKey=function(t,e){return Ja.resolve(this._s.containsKey(e))},t}(),Vc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new oi(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Lc(this),this.Ut=new xu,this.Ue=function(t,e){return new Fc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new du(e),this.Ke=new jc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Pc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;hi("MemoryPersistence","Starting transaction:",t);var i=new Uc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return Ja.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),Uc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(X.c)(e,t),e}(Xa),qc=function(){function t(t){this.persistence=t,this.As=new Ac,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw pi()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ja.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ja.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ja.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ja.forEach(this.vs,(function(r){var i=Bi.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Ja.or([function(){return Ja.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Bc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Kc(t,e){return"firestore_clients_"+t+"_"+e}function Gc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function zc(t,e){return"firestore_targets_"+t+"_"+e}Bc.UNAUTHENTICATED=new Bc(null),Bc.GOOGLE_CREDENTIALS=new Bc("google-credentials-uid"),Bc.FIRST_PARTY=new Bc("first-party-uid"),Bc.MOCK_USER=new Bc("mock-user");var Qc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new ai(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(li("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Wc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new ai(i.error.code,i.error.message)),o?new t(e,i.state,r):(li("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Hc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Us(),s=0;i&&s<r.activeTargetIds.length;++s)i=qi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(li("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Yc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(li("SharedClientState","Failed to parse online state: "+e),null)},t}(),Xc=function(){function t(){this.activeTargetIds=Us()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),$c=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Ss(bi),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Kc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new Xc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(X.d)(this,(function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Kc(this.persistenceKey,r)))&&(o=Hc.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.ks(c[u]);return this.$s=[],this.window.addEventListener("pagehide",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(zc(this.persistenceKey,t));if(n){var r=Wc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(zc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return hi("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){hi("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){hi("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(hi("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void li("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return Object(X.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(X.d)(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=oi.o;if(null!=t)try{var n=JSON.parse(t);gi("number"==typeof n),e=n}catch(t){li("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==oi.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Qc(this.currentUser,t,e,n),i=Gc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Gc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=zc(this.persistenceKey,t),i=new Wc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Hc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Qc.Vs(new Bc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Wc.Vs(r,e)},t.prototype.js=function(t){return Yc.Vs(t)},t.prototype.ii=function(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(hi("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Us();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),Jc=function(){function t(){this.li=new Xc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Xc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Zc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),th=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){hi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){hi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),eh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},nh=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),rh=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(X.c)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise((function(i,o){var s=new ii;s.listenOnce(ti.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Zr.NO_ERROR:var e=s.getResponseJson();hi("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Zr.TIMEOUT:hi("Connection",'RPC "'+t+'" timed out'),o(new ai(si.DEADLINE_EXCEEDED,"Request time out"));break;case Zr.HTTP_ERROR:var n=s.getStatus();if(hi("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(si).indexOf(e)>=0?e:si.UNKNOWN}(r.status);o(new ai(a,r.message))}else o(new ai(si.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new ai(si.UNAVAILABLE,"Connection failed."));break;default:pi()}}finally{hi("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Hr,i=qe(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new ni({})),this.ki(o.initMessageHeaders,e),Object($.n)()||Object($.p)()||Object($.l)()||Object($.m)()||Object($.r)()||Object($.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");hi("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new nh({Ei:function(t){c?hi("Connection","Not sending because WebChannel is closed:",t):(u||(hi("Connection","Opening WebChannel transport."),a.open(),u=!0),hi("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return l(a,ri.EventType.OPEN,(function(){c||hi("Connection","WebChannel transport opened.")})),l(a,ri.EventType.CLOSE,(function(){c||(c=!0,hi("Connection","WebChannel transport closed"),h.Vi())})),l(a,ri.EventType.ERROR,(function(t){c||(c=!0,fi("Connection","WebChannel transport errored:",t),h.Vi(new ai(si.UNAVAILABLE,"The operation could not be completed")))})),l(a,ri.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];gi(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){hi("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=bs[t];if(void 0!==e)return _s(e)}(i),s=r.message;void 0===o&&(o=si.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new ai(o,s)),a.close()}else hi("Connection","WebChannel received:",n),h.Si(n)}})),l(i,ei.STAT_EVENT,(function(t){10===t.stat?hi("Connection","Detected buffering proxy"):11===t.stat&&hi("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Pi()}),0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);hi("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then((function(t){return hi("RestConnection","Received: ",t),t}),(function(e){throw fi("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+eh[t]},t}());function ih(){return"undefined"!=typeof window?window:null}function oh(){return"undefined"!=typeof document?document:null}function sh(t){return new Js(t,!0)}var ah=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&hi("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),uh=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new ah(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===si.RESOURCE_EXHAUSTED?(li(e.toString()),li("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===si.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new ai(si.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return Object(X.b)(t,void 0,void 0,(function(){return Object(X.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return hi("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(hi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),ch=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(X.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:pi()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(gi(void 0===e||"string"==typeof e),ji.fromBase64String(e||"")):(gi(void 0===e||e instanceof Uint8Array),ji.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?si.UNKNOWN:_s(t.code);return new ai(e,t.message||"")}(a);n=new zs(r,i,o,s||null)}else if("documentChange"in e){i=sa(t,(r=e.documentChange).document.name),o=na(r.document.updateTime);var a=new no({mapValue:{fields:r.document.fields}}),u=(s=io.newFoundDocument(i,o,a),r.targetIds||[]);n=new Ks(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=sa(t,(r=e.documentDelete).document),o=r.readTime?na(r.readTime):Oi.min(),a=io.newNoDocument(i,o),n=new Ks([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=sa(t,(r=e.documentRemove).document),n=new Ks([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return pi();var c=e.filter;i=new Os(r=c.count||0),n=new Gs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Oi.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Oi.min():e.readTime?na(e.readTime):Oi.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=ca(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=co(r)?{documents:ga(t,r)}:{query:ya(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ta(t,e.resumeToken):e.snapshotVersion.compareTo(Oi.min())>0&&(n.readTime=Zs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return pi()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=ca(this.R),e.removeTarget=t,this.cr(e)},e}(uh),hh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(X.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(gi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(gi(void 0!==e),t.map((function(t){return function(t,e){var n=na(t.updateTime?t.updateTime:e);return n.isEqual(Oi.min())&&(n=na(e)),new os(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=na(t.commitTime);return this.listener.Tr(n,e)}return gi(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=ca(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return da(e.R,t)}))};this.cr(n)},e}(uh),lh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(X.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new ai(si.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===si.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ai(si.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===si.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ai(si.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),fh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(li(e),this.Vr=!1):hi("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),dh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return Object(X.b)(o,void 0,void 0,(function(){return Object(X.d)(this,(function(t){switch(t.label){case 0:return Th(this)?(hi("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(X.b)(this,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return(e=yi(t)).Or.add(4),[4,gh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,ph(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new fh(n,r)};function ph(t){return Object(X.b)(this,void 0,void 0,(function(){var e,n;return Object(X.d)(this,(function(r){switch(r.label){case 0:if(!Th(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function gh(t){return Object(X.b)(this,void 0,void 0,(function(){var e,n;return Object(X.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function yh(t,e){var n=yi(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Ih(n)?wh(n):Mh(n).er()&&vh(n,e))}function mh(t,e){var n=yi(t),r=Mh(n);n.$r.delete(e),r.er()&&bh(n,e),0===n.$r.size&&(r.er()?r.ir():Th(n)&&n.Br.set("Unknown"))}function vh(t,e){t.qr.U(e.targetId),Mh(t).mr(e)}function bh(t,e){t.qr.U(e),Mh(t).yr(e)}function wh(t){t.qr=new Ws({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Mh(t).start(),t.Br.Sr()}function Ih(t){return Th(t)&&!Mh(t).tr()&&t.$r.size>0}function Th(t){return 0===yi(t).Or.size}function Oh(t){t.qr=void 0}function Eh(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){return t.$r.forEach((function(e,n){vh(t,e)})),[2]}))}))}function _h(t,e){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(n){return Oh(t),Ih(t)?(t.Br.Nr(e),wh(t)):t.Br.set("Unknown"),[2]}))}))}function Sh(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i,o;return Object(X.d)(this,(function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof zs&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(X.d)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),hi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,xh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Ks?t.qr.X(e):e instanceof Gs?t.qr.rt(e):t.qr.et(e),n.isEqual(Oi.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,wc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(ji.EMPTY_BYTE_STRING,n.snapshotVersion)),bh(t,e);var r=new fu(n.target,e,1,n.sequenceNumber);vh(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return hi("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,xh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function xh(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r=this;return Object(X.d)(this,(function(i){switch(i.label){case 0:if(!ru(e))throw e;return t.Or.add(1),[4,gh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return wc(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return Object(X.b)(r,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return hi("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,ph(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Nh(t,e){return e().catch((function(n){return xh(t,n,e)}))}function Ch(t){return Object(X.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(X.d)(this,(function(s){switch(s.label){case 0:e=yi(t),n=Lh(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Th(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Oc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=Lh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,xh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return kh(e)&&Dh(e),[2]}}))}))}function kh(t){return Th(t)&&!Lh(t).tr()&&t.Fr.length>0}function Dh(t){Lh(t).start()}function jh(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){return Lh(t).Ar(),[2]}))}))}function Ah(t){return Object(X.b)(this,void 0,void 0,(function(){var e,n,r;return Object(X.d)(this,(function(i){for(e=Lh(t),n=0,r=t.Fr;n<r.length;n++)e.Er(r[n].mutations);return[2]}))}))}function Rh(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=lu.from(r,e,n),[4,Nh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Ch(t)];case 2:return o.sent(),[2]}}))}))}function Ph(t,e){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(n){switch(n.label){case 0:return e&&Lh(t).pr?[4,function(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r;return Object(X.d)(this,(function(i){switch(i.label){case 0:return Es(r=e.code)&&r!==si.ABORTED?(n=t.Fr.shift(),Lh(t).sr(),[4,Nh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Ch(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return kh(t)&&Dh(t),[2]}}))}))}function Fh(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n;return Object(X.d)(this,(function(r){switch(r.label){case 0:return n=yi(t),e?(n.Or.delete(2),[4,ph(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,gh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Mh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=yi(t);return r.br(),new ch(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Eh.bind(null,t),Ri:_h.bind(null,t),_r:Sh.bind(null,t)}),t.Mr.push((function(n){return Object(X.b)(e,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Ih(t)?wh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Oh(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function Lh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=yi(t);return r.br(),new hh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:jh.bind(null,t),Ri:Ph.bind(null,t),Ir:Ah.bind(null,t),Tr:Rh.bind(null,t)}),t.Mr.push((function(n){return Object(X.b)(e,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Ch(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(hi("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var Vh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new $a,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ai(si.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Uh(t,e){if(li("AsyncQueue",e+": "+t),ru(t))return new ai(si.UNAVAILABLE,e+": "+t);throw t}var qh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Bi.comparator(e.key,n.key)}:function(t,e){return Bi.comparator(t.key,e.key)},this.keyedMap=Rs(),this.sortedSet=new Ss(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Bh=function(){function t(){this.Qr=new Ss(Bi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):pi():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),Kh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,qh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Mo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Gh=function(){this.Wr=void 0,this.listeners=[]},zh=function(){this.queries=new Ju((function(t){return Lo(t)}),Mo),this.onlineState="Unknown",this.Gr=new Set};function Qh(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(X.d)(this,(function(c){switch(c.label){case 0:if(n=yi(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Gh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Uh(a,"Initialization of query '"+Vo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Xh(n),[2]}}))}))}function Wh(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(X.d)(this,(function(a){return n=yi(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function Hh(t,e){for(var n=yi(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Xh(n)}function Yh(t,e,n){var r=yi(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Xh(t){t.Gr.forEach((function(t){t.next()}))}var $h=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Kh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Kh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Jh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Zh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return sa(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?fa(this.R,t.document,!1):io.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return na(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Zh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ls()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:return[4,kc(this.localStore,new Zh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Dc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new fc(Object.assign({},this.progress),t))]}}))}))}}();var tl=function(t){this.key=t},el=function(t){this.key=t},nl=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ls(),this.mutatedKeys=Ls(),this.lo=qo(t),this.fo=new qh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Bh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Co(this.query)&&i.size===this.query.limit?i.last():null,c=ko(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Uo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Co(this.query)||ko(this.query))for(;s.size>this.query.limit;){var h=Co(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return pi()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Kh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Bh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ls(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new el(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new tl(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ls();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Kh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),rl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},il=function(t){this.key=t,this.bo=!1},ol=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Ju((function(t){return Lo(t)}),Mo),this.Vo=new Map,this.So=new Set,this.Do=new Ss(Bi.comparator),this.Co=new Map,this.No=new Ac,this.xo={},this.ko=new Map,this.Fo=Uu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function sl(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(X.d)(this,(function(a){switch(a.label){case 0:return n=Pl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Ec(n.localStore,Po(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,al(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&yh(n.remoteStore,o),a.label=4;case 4:return[2,r]}}))}))}function al(t,e,n,r){return Object(X.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c;return Object(X.d)(this,(function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(X.b)(this,void 0,void 0,(function(){var i,o,s;return Object(X.d)(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Sc(t.localStore,e.query,!1).then((function(t){return e.view._o(t.documents,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(wl(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Sc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new nl(e,i.Bn),s=o._o(i.documents),a=Bs.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),wl(t,n,u.To),c=new rl(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}}))}))}function ul(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:return n=yi(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!Mo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,_c(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),mh(n.remoteStore,r.targetId),vl(n,r.targetId)})).catch(zu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return vl(n,r.targetId),[4,_c(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function cl(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(X.d)(this,(function(a){switch(a.label){case 0:r=Fl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=yi(t),i=Ti.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Ls());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=ls(c,n.get(c.key));null!=h&&s.push(new gs(c.key,h,ro(h.value.mapValue),ss.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ss(bi)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Ol(r,i.changes)];case 3:return a.sent(),[4,Ch(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Uh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function hl(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r;return Object(X.d)(this,(function(i){switch(i.label){case 0:n=yi(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Ic(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(gi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?gi(r.bo):t.removedDocuments.size>0&&(gi(r.bo),r.bo=!1))})),[4,Ol(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,zu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function ll(t,e,n){var r=yi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=yi(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&Xh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function fl(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u;return Object(X.d)(this,(function(c){switch(c.label){case 0:return(r=yi(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Ss(Bi.comparator)).insert(o,io.newNoDocument(o,Oi.min())),a=Ls().add(o),u=new qs(Oi.min(),new Map,new Cs(bi),s,a),[4,hl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Tl(r),[3,4];case 2:return[4,_c(r.localStore,e,!1).then((function(){return vl(r,e,n)})).catch(zu)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function dl(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:n=yi(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,bc(n.localStore,e)];case 2:return i=o.sent(),ml(n,r,null),yl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Ol(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,zu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function pl(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:r=yi(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=yi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return gi(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),ml(r,e,n),yl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Ol(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,zu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function gl(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(X.d)(this,(function(a){switch(a.label){case 0:Th((n=yi(t)).remoteStore)||hi("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=yi(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=Uh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function yl(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function ml(t,e,n){var r=yi(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function vl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||bl(t,e)}))}function bl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(mh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Tl(t))}function wl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof tl?(t.No.addReference(o.key,e),Il(t,o)):o instanceof el?(hi("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||bl(t,o.key)):pi()}}function Il(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(hi("SyncEngine","New document in limbo: "+n),t.So.add(r),Tl(t))}function Tl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Bi(Ni.fromString(e)),r=t.Fo.next();t.Co.set(r,new il(n)),t.Do=t.Do.insert(n,r),yh(t.remoteStore,new fu(Po(No(n.path)),r,2,oi.o))}}function Ol(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(X.d)(this,(function(a){switch(a.label){case 0:return r=yi(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.Oo(a,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=pc.Pn(a.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return Object(X.d)(this,(function(h){switch(h.label){case 0:n=yi(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Ja.forEach(e,(function(e){return Ja.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return Ja.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!ru(r=h.sent()))throw r;return hi("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.kn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.kn=n.kn.insert(a,c));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function El(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r;return Object(X.d)(this,(function(i){switch(i.label){case 0:return(n=yi(t)).currentUser.isEqual(e)?[3,3]:(hi("SyncEngine","User change. New user:",e.toKey()),[4,vc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach((function(t){t.forEach((function(t){t.reject(new ai(si.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Ol(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function _l(t,e){var n=yi(t),r=n.Co.get(e);if(r&&r.bo)return Ls().add(r.key);var i=Ls(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Sl(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:return[4,Sc((n=yi(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&wl(n,e.targetId,i.To),i)]}}))}))}function xl(t){return Object(X.b)(this,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){return[2,Nc((e=yi(t)).localStore).then((function(t){return Ol(e,t)}))]}))}))}function Nl(t,e,n,r){return Object(X.b)(this,void 0,void 0,(function(){var i,o;return Object(X.d)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=yi(t),r=yi(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):Ja.resolve(null)}))}))}((i=yi(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Ch(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(ml(i,e,r||null),yl(i,e),function(t,e){yi(yi(t)._n).Gt(e)}(i.localStore,e)):pi(),s.label=4;case 4:return[4,Ol(i,o)];case 5:return s.sent(),[3,7];case 6:hi("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Cl(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return Object(X.d)(this,(function(c){switch(c.label){case 0:return Pl(n=yi(t)),Fl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,kl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Fh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)yh(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then((function(){return vl(n,e),_c(n.localStore,e,!0)})),mh(n.remoteStore,e)})),[4,u]);case 4:return c.sent(),[4,kl(n,a)];case 5:return c.sent(),function(t){var e=yi(t);e.Co.forEach((function(t,n){mh(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Ss(Bi.comparator)}(n),n.$o=!1,[4,Fh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))}function kl(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(X.d)(this,(function(g){switch(g.label){case 0:n=yi(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Ec(n.localStore,Po(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Sl(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,xc(n.localStore,a)];case 8:return p=g.sent(),[4,Ec(n.localStore,p)];case 9:return u=g.sent(),[4,al(n,Dl(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function Dl(t){return xo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function jl(t){var e=yi(t);return yi(yi(e.localStore).persistence).fn()}function Al(t,e,n,r){return Object(X.b)(this,void 0,void 0,(function(){var i,o,s;return Object(X.d)(this,(function(a){switch(a.label){case 0:return(i=yi(t)).$o?(hi("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Nc(i.localStore)];case 3:return o=a.sent(),s=qs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Ol(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,_c(i.localStore,e,!0)];case 6:return a.sent(),vl(i,e,r),[3,8];case 7:pi(),a.label=8;case 8:return[2]}}))}))}function Rl(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,h,l;return Object(X.d)(this,(function(f){switch(f.label){case 0:if(!(r=Pl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(hi("SyncEngine","Adding an already active target "+s),[3,5]):[4,xc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Ec(r.localStore,a)];case 3:return u=f.sent(),[4,al(r,Dl(a),u.targetId,!1)];case 4:f.sent(),yh(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(X.d)(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,_c(r.localStore,t,!1).then((function(){mh(r.remoteStore,t),vl(r,t)})).catch(zu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function Pl(t){var e=yi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=hl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=_l.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fl.bind(null,e),e.vo._r=Hh.bind(null,e.eventManager),e.vo.Mo=Yh.bind(null,e.eventManager),e}function Fl(t){var e=yi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=dl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pl.bind(null,e),e}var Ml=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return this.R=sh(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return mc(this.persistence,new gc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Vc(qc.bs,this.R)},t.prototype.Bo=function(t){return new Jc},t.prototype.terminate=function(){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),Ll=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(X.c)(e,t),e.prototype.initialize=function(e){return Object(X.b)(this,void 0,void 0,(function(){var n=this;return Object(X.d)(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,Cc(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,Fl(this.Qo.syncEngine)];case 4:return r.sent(),[4,Ch(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}))];case 6:return r.sent(),[2]}}))}))},e.prototype.Ko=function(t){return mc(this.persistence,new gc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Hu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=lc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ju.withCacheSize(this.cacheSizeBytes):ju.DEFAULT;return new uc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,ih(),oh(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Jc},e}(Ml),Vl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(X.c)(e,t),e.prototype.initialize=function(e){return Object(X.b)(this,void 0,void 0,(function(){var n,r=this;return Object(X.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof $c?(this.sharedClientState.syncEngine={ui:Nl.bind(null,n),ai:Al.bind(null,n),hi:Rl.bind(null,n),fn:jl.bind(null,n),ci:xl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return Object(X.b)(r,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return[4,Cl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=ih();if(!$c.yt(e))throw new ai(si.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=lc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new $c(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Ll),Ul=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n=this;return Object(X.d)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return ll(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=El.bind(null,this.syncEngine),[4,Fh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new zh},t.prototype.createDatastore=function(t){var e=sh(t.databaseInfo.databaseId),n=new rh(t.databaseInfo);return function(t,e,n){return new lh(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return ll(s.syncEngine,t,0)},o=th.yt()?new th:new Zc,new dh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new ol(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(X.b)(this,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return e=yi(t),hi("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,gh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),ql=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),Bl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new $a,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(X.d)(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Jh(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return Object(X.b)(this,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(X.b)(this,void 0,void 0,(function(){var e,n=this;return Object(X.d)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new ai(si.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(X.d)(this,(function(u){switch(u.label){case 0:return n=yi(t),r=ca(n.R)+"/documents",i={documents:e.map((function(t){return oa(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){gi(!!e.found);var n=sa(t,e.found.name),r=na(e.found.updateTime),i=new no({mapValue:{fields:e.found.fields}});return io.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){gi(!!e.missing),gi(!!e.readTime);var n=sa(t,e.missing),r=na(e.readTime);return io.newNoDocument(n,r)}(t,e):pi()}(n.R,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());gi(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Is(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e=this;return Object(X.d)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Bi.fromPath(n);e.mutations.push(new Ts(r,e.precondition(r)))})),[4,function(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:return n=yi(t),r=ca(n.R)+"/documents",i={writes:e.map((function(t){return da(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw pi();e=Oi.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new ai(si.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ss.updateTime(e):ss.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Oi.min()))throw new ai(si.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ss.updateTime(e)}return ss.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Kl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new ah(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return Object(X.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(X.d)(this,(function(r){return t=new Bl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Vi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Es(e)}return!1},t}(),Gl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Bc.UNAUTHENTICATED,this.clientId=vi.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return Object(X.b)(r,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return hi("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new ai(si.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new $a;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return Object(X.b)(t,void 0,void 0,(function(){var t,n;return Object(X.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Uh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function zl(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(X.d)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),hi("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return Object(X.b)(i,void 0,void 0,(function(){return Object(X.d)(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,vc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Ql(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r;return Object(X.d)(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Wl(t)];case 1:return n=i.sent(),hi("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return Object(X.b)(this,void 0,void 0,(function(){var n,r;return Object(X.d)(this,(function(i){switch(i.label){case 0:return(n=yi(t)).asyncQueue.verifyOperationInProgress(),hi("RemoteStore","RemoteStore received new credentials"),r=Th(n),n.Or.add(3),[4,gh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,ph(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function Wl(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(hi("FirestoreClient","Using default OfflineComponentProvider"),[4,zl(t,new Ml)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function Hl(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(hi("FirestoreClient","Using default OnlineComponentProvider"),[4,Ql(t,new Ul)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function Yl(t){return Wl(t).then((function(t){return t.persistence}))}function Xl(t){return Wl(t).then((function(t){return t.localStore}))}function $l(t){return Hl(t).then((function(t){return t.remoteStore}))}function Jl(t){return Hl(t).then((function(t){return t.syncEngine}))}function Zl(t){return Object(X.b)(this,void 0,void 0,(function(){var e,n;return Object(X.d)(this,(function(r){switch(r.label){case 0:return[4,Hl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=sl.bind(null,e.syncEngine),n.onUnlisten=ul.bind(null,e.syncEngine),n)]}}))}))}function tf(t,e,n){var r=this;void 0===n&&(n={});var i=new $a;return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(r,void 0,void 0,(function(){var r;return Object(X.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new ql({next:function(o){e.enqueueAndForget((function(){return Wh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new ai(si.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new ai(si.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new $h(No(n.path),o,{includeMetadataChanges:!0,so:!0});return Qh(t,s)},[4,Zl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function ef(t,e,n){var r=this;void 0===n&&(n={});var i=new $a;return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(r,void 0,void 0,(function(){var r;return Object(X.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new ql({next:function(n){e.enqueueAndForget((function(){return Wh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new ai(si.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new $h(n,o,{includeMetadataChanges:!0,so:!0});return Qh(t,s)},[4,Zl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var nf=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},rf=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),of=new Map,sf=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},af=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(Bc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),uf=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),cf=function(){function t(t){var e=this;this.currentUser=Bc.UNAUTHENTICATED,this.oc=new $a,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){hi("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(hi("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(hi("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(gi("string"==typeof n.accessToken),new sf(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return Object(X.b)(n,void 0,void 0,(function(){return Object(X.d)(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return gi(null===t||"string"==typeof t),new Bc(t)},t}(),hf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Bc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),lf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new hf(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(Bc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ff(t,e,n){if(!n)throw new ai(si.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function df(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new ai(si.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function pf(t,e,n,r){if(!0===e&&!0===r)throw new ai(si.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function gf(t){if(!Bi.isDocumentKey(t))throw new ai(si.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function yf(t){if(Bi.isDocumentKey(t))throw new ai(si.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function mf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":pi()}function vf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ai(si.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=mf(t);throw new ai(si.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function bf(t,e){if(e<=0)throw new ai(si.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var wf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new ai(si.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ai(si.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,pf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),If=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new wf({}),this._settingsFrozen=!1,t instanceof rf?(this._databaseId=t,this._credentials=new af):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ai(si.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rf(t.options.projectId)}(t),this._credentials=new cf(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new ai(si.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new ai(si.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new wf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new af;switch(t.type){case"gapi":var e=t.client;return gi(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new lf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new ai(si.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=of.get(this))&&(hi("ComponentProvider","Removing Datastore"),of.delete(this),t.terminate()),Promise.resolve();var t},t}(),Tf=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ef(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Of=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Ef=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,No(r))||this)._path=r,i.type="collection",i}return Object(X.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Tf(this.firestore,null,new Bi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Of);function _f(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object($.h)(t),ff("collection","path",e),t instanceof If)return yf(n=Ni.fromString.apply(Ni,Object(X.f)([e],r))),new Ef(t,null,n);if(!(t instanceof Tf||t instanceof Ef))throw new ai(si.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return yf(n=Ni.fromString.apply(Ni,Object(X.f)([t.path],r)).child(Ni.fromString(e))),new Ef(t.firestore,null,n)}function Sf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object($.h)(t),1===arguments.length&&(e=vi.u()),ff("doc","path",e),t instanceof If)return gf(n=Ni.fromString.apply(Ni,Object(X.f)([e],r))),new Tf(t,null,new Bi(n));if(!(t instanceof Tf||t instanceof Ef))throw new ai(si.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return gf(n=t._path.child(Ni.fromString.apply(Ni,Object(X.f)([e],r)))),new Tf(t.firestore,t instanceof Ef?t.converter:null,new Bi(n))}function xf(t,e){return t=Object($.h)(t),e=Object($.h)(e),(t instanceof Tf||t instanceof Ef)&&(e instanceof Tf||e instanceof Ef)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Nf(t,e){return t=Object($.h)(t),e=Object($.h)(e),t instanceof Of&&e instanceof Of&&t.firestore===e.firestore&&Mo(t._query,e._query)&&t.converter===e.converter}var Cf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new ah(this,"async_queue_retry"),this.Ic=function(){var e=oh();e&&hi("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=oh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=oh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new $a;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return Object(X.b)(this,void 0,void 0,(function(){var t,e=this;return Object(X.d)(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!ru(t=n.sent()))throw t;return hi("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,li("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Vh.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&pi()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(X.b)(this,void 0,void 0,(function(){var t;return Object(X.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function kf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new $a,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Df=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Cf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(X.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Af(this),this._firestoreClient.terminate()},e}(If);function jf(t){return t._firestoreClient||Af(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Af(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new nf(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Gl(t._credentials,t._queue,r)}function Rf(t,e,n){var r=this,i=new $a;return t.asyncQueue.enqueue((function(){return Object(X.b)(r,void 0,void 0,(function(){var r;return Object(X.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,zl(t,n)];case 1:return o.sent(),[4,Ql(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===si.FAILED_PRECONDITION||t.code===si.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Pf(t){if(t._initialized||t._terminated)throw new ai(si.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ff=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new ai(si.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ki(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Mf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ji.fromBase64String(e))}catch(e){throw new ai(si.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(ji.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Lf=function(t){this._methodName=t},Vf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new ai(si.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ai(si.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return bi(this._lat,t._lat)||bi(this._long,t._long)},t}(),Uf=/^__.*__$/,qf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new gs(t,this.data,this.fieldMask,e,this.fieldTransforms):new ps(t,this.data,e,this.fieldTransforms)},t}(),Bf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new gs(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Kf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw pi()}}var Gf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return hd(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Kf(this.Nc)&&Uf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),zf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||sh(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new Gf({Nc:t,methodName:e,qc:n,path:ki.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Qf(t){var e=t._freezeSettings(),n=sh(t._databaseId);return new zf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Wf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);sd("Data must be an object, but it was:",s,r);var a,u,c=id(r,s);if(o.merge)a=new Di(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=ad(e,f[l],n);if(!s.contains(d))throw new ai(si.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");ld(h,d)||h.push(d)}a=new Di(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new qf(new no(c),a,u)}var Hf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Lf);function Yf(t,e,n){return new Gf({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e.prototype._toFieldTransform=function(t){return new is(t.path,new Xo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Lf),$f=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(X.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Yf(this,t,!0),n=this.Kc.map((function(t){return rd(t,e)})),r=new $o(n);return new is(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Lf),Jf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(X.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Yf(this,t,!0),n=this.Kc.map((function(t){return rd(t,e)})),r=new Zo(n);return new is(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Lf),Zf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(X.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new es(t.R,zo(t.R,this.Qc));return new is(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Lf);function td(t,e,n,r){var i=t.Uc(1,e,n);sd("Data must be an object, but it was:",i,r);var o=[],s=no.empty();_i(r,(function(t,r){var a=cd(e,t,n);r=Object($.h)(r);var u=i.Oc(a);if(r instanceof Hf)o.push(a);else{var c=rd(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Di(o);return new Bf(s,a,i.fieldTransforms)}function ed(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[ad(e,r,n)],u=[i];if(o.length%2!=0)throw new ai(si.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(ad(e,o[c])),u.push(o[c+1]);for(var h=[],l=no.empty(),f=a.length-1;f>=0;--f)if(!ld(h,a[f])){var d=a[f],p=u[f];p=Object($.h)(p);var g=s.Oc(d);if(p instanceof Hf)h.push(d);else{var y=rd(p,g);null!=y&&(h.push(d),l.set(d,y))}}var m=new Di(h);return new Bf(l,m,s.fieldTransforms)}function nd(t,e,n,r){return void 0===r&&(r=!1),rd(n,t.Uc(r?4:3,e))}function rd(t,e){if(od(t=Object($.h)(t)))return sd("Unsupported field value:",e,t),id(t,e);if(t instanceof Lf)return function(t,e){if(!Kf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=rd(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object($.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return zo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ti.fromDate(t);return{timestampValue:Zs(e.R,n)}}if(t instanceof Ti)return n=new Ti(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Zs(e.R,n)};if(t instanceof Vf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Mf)return{bytesValue:ta(e.R,t._byteString)};if(t instanceof Tf){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ra(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+mf(t))}(t,e)}function id(t,e){var n={};return Si(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_i(t,(function(t,r){var i=rd(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function od(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ti||t instanceof Vf||t instanceof Mf||t instanceof Tf||t instanceof Lf)}function sd(t,e,n){if(!od(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=mf(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function ad(t,e,n){if((e=Object($.h)(e))instanceof Ff)return e._internalPath;if("string"==typeof e)return cd(t,e);throw hd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ud=new RegExp("[~\\*/\\[\\]]");function cd(t,e,n){if(e.search(ud)>=0)throw hd("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Ff.bind.apply(Ff,Object(X.f)([void 0],e.split(".")))))._internalPath}catch(lp){throw hd("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function hd(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new ai(si.INVALID_ARGUMENT,(a+=". ")+t+u)}function ld(t,e){return t.some((function(t){return t.isEqual(e)}))}var fd=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Tf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new dd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(pd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),dd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(fd);function pd(t,e){return"string"==typeof e?cd(t,e):e instanceof Ff?e._internalPath:e._delegate._internalPath}var gd=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),yd=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(X.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new md(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(pd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(fd),md=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(yd),vd=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new gd(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new md(n._firestore,n._userDataWriter,r.key,r,new gd(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ai(si.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new md(t._firestore,t._userDataWriter,e.doc.key,e.doc,new gd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new md(t._firestore,t._userDataWriter,e.doc.key,e.doc,new gd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:bd(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function bd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return pi()}}function wd(t,e){return t instanceof yd&&e instanceof yd?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof vd&&e instanceof vd&&t._firestore===e._firestore&&Nf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Id(t){if(ko(t)&&0===t.explicitOrderBy.length)throw new ai(si.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Td=function(){};function Od(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Ed=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(X.c)(e,t),e.prototype._apply=function(t){var e=Qf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new ai(si.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Dd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(kd(r,t,h[c]));a={arrayValue:{values:u}}}else a=kd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Dd(s,o),a=nd(n,"where",s,"in"===o||"not-in"===o);var l=ho.create(i,o,a);return function(t,e){if(e.g()){var n=jo(t);if(null!==n&&!n.isEqual(e.field))throw new ai(si.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Do(t);null!==r&&jd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new ai(si.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Of(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new So(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Td),_d=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(X.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new ai(si.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new ai(si.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new To(e,n);return function(t,e){if(null===Do(t)){var n=jo(t);null!==n&&jd(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Of(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new So(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Td),Sd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(X.c)(e,t),e.prototype._apply=function(t){return new Of(t.firestore,t.converter,Fo(t._query,this.Hc,this.Jc))},e}(Td),xd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(X.c)(e,t),e.prototype._apply=function(t){var e=Cd(t,this.type,this.Yc,this.Xc);return new Of(t.firestore,t.converter,function(t,e){return new So(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Td),Nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(X.c)(e,t),e.prototype._apply=function(t){var e=Cd(t,this.type,this.Yc,this.Xc);return new Of(t.firestore,t.converter,function(t,e){return new So(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Td);function Cd(t,e,n,r){if(n[0]=Object($.h)(n[0]),n[0]instanceof fd)return function(t,e,n,r,i){if(!r)throw new ai(si.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Ro(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Yi(e,r.key));else{var c=r.data.field(u.field);if(Mi(c))throw new ai(si.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new ai(si.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new wo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Qf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new ai(si.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new ai(si.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ao(t)&&-1!==c.indexOf("/"))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Ni.fromString(c));if(!Bi.isDocumentKey(h))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Bi(h);a.push(Yi(e,l))}else{var f=nd(n,r,c);a.push(f)}}return new wo(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function kd(t,e,n){if("string"==typeof(n=Object($.h)(n))){if(""===n)throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ao(e)&&-1!==n.indexOf("/"))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Ni.fromString(n));if(!Bi.isDocumentKey(r))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Yi(t,new Bi(r))}if(n instanceof Tf)return Yi(t,n._key);throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+mf(n)+".")}function Dd(t,e){if(!Array.isArray(t)||0===t.length)throw new ai(si.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new ai(si.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function jd(t,e,n){if(!n.isEqual(e))throw new ai(si.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Ad=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ki(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Pi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Fi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw pi()}},t.prototype.convertObject=function(t,e){var n=this,r={};return _i(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Vf(Pi(t.latitude),Pi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return Mi(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Li(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Ri(t);return new Ti(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Ni.fromString(t);gi(xa(n));var r=new rf(n.get(1),n.get(3)),i=new Bi(n.popFirst(5));return r.isEqual(e)||li("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Rd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Pd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(X.c)(e,t),e.prototype.convertBytes=function(t){return new Mf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Tf(this.firestore,null,e)},e}(Ad),Fd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Qf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Md(t,this._firestore),i=Rd(r.converter,e,n),o=Wf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,ss.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Md(t,this._firestore);return o="string"==typeof(e=Object($.h)(e))||e instanceof Ff?ed(this._dataReader,"WriteBatch.update",s._key,e,n,r):td(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,ss.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Md(t,this._firestore);return this._mutations=this._mutations.concat(new Is(e._key,ss.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new ai(si.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Md(t,e){if((t=Object($.h)(t)).firestore!==e)throw new ai(si.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Ld=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(X.c)(e,t),e.prototype.convertBytes=function(t){return new Mf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Tf(this.firestore,null,e)},e}(Ad);function Vd(t,e,n){t=vf(t,Tf);var r=vf(t.firestore,Df),i=Rd(t.converter,e,n);return Bd(r,[Wf(Qf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,ss.none())])}function Ud(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=vf(t,Tf);var o=vf(t.firestore,Df),s=Qf(o);return Bd(o,[("string"==typeof(e=Object($.h)(e))||e instanceof Ff?ed(s,"updateDoc",t._key,e,n,r):td(s,"updateDoc",t._key,e)).toMutation(t._key,ss.exists(!0))])}function qd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object($.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||kf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(kf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Tf)c=vf(t.firestore,Df),h=No(t._key.path),u={next:function(e){i[a]&&i[a](Kd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=vf(t,Of);c=vf(d.firestore,Df),h=d._query;var p=new Ld(c);u={next:function(t){i[a]&&i[a](new vd(c,p,d,t))},error:i[a+1],complete:i[a+2]},Id(t._query)}return function(t,e,n,r){var i=this,o=new ql(r),s=new $h(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(i,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return e=Qh,[4,Zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(i,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return e=Wh,[4,Zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(jf(c),h,l,u)}function Bd(t,e){return function(t,e){var n=this,r=new $a;return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(n,void 0,void 0,(function(){var n;return Object(X.d)(this,(function(i){switch(i.label){case 0:return n=cl,[4,Jl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(jf(t),e)}function Kd(t,e,n){var r=n.docs.get(e._key),i=new Ld(t);return new yd(t,i,e._key,r,new gd(n.hasPendingWrites,n.fromCache),e.converter)}var Gd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(X.c)(e,t),e.prototype.get=function(e){var n=this,r=Md(e,this._firestore),i=new Ld(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new yd(n._firestore,i,r._key,t._document,new gd(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Qf(t)}return t.prototype.get=function(t){var e=this,n=Md(t,this._firestore),r=new Pd(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return pi();var i=t[0];if(i.isFoundDocument())return new fd(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new fd(e._firestore,r,n._key,null,n.converter);throw pi()}))},t.prototype.set=function(t,e,n){var r=Md(t,this._firestore),i=Rd(r.converter,e,n),o=Wf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Md(t,this._firestore);return o="string"==typeof(e=Object($.h)(e))||e instanceof Ff?ed(this._dataReader,"Transaction.update",s._key,e,n,r):td(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Md(t,this._firestore);return this._transaction.delete(e._key),this},t}());function zd(){if("undefined"==typeof Uint8Array)throw new ai(si.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Qd(){if("undefined"==typeof atob)throw new ai(si.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Wd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Qd(),new t(Mf.fromBase64String(e))},t.fromUint8Array=function(e){return zd(),new t(Mf.fromUint8Array(e))},t.prototype.toBase64=function(){return Qd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return zd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Hd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Pf(t=vf(t,Df));var n=jf(t),r=t._freezeSettings(),i=new Ul;return Rf(n,i,new Ll(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Pf(t=vf(t,Df));var e=jf(t),n=t._freezeSettings(),r=new Ul;return Rf(e,r,new Vl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new ai(si.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new $a;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return Object(X.b)(e,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(X.b)(this,void 0,void 0,(function(){return Object(X.d)(this,(function(e){switch(e.label){case 0:return tu.yt()?[4,tu.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(lc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),Yd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof rf||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||fi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=vf(t,If))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&fi("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=Bc.MOCK_USER;else{s=Object($.d)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new ai(si.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Bc(u)}t._credentials=new uf(new sf(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(X.b)(e,void 0,void 0,(function(){var e,n;return Object(X.d)(this,(function(r){switch(r.label){case 0:return[4,Yl(t)];case 1:return e=r.sent(),[4,$l(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=yi(t);return e.Or.delete(0),ph(e)}(n))]}}))}))}))}(jf(vf(this._delegate,Df)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(X.b)(e,void 0,void 0,(function(){var e,n;return Object(X.d)(this,(function(r){switch(r.label){case 0:return[4,Yl(t)];case 1:return e=r.sent(),[4,$l(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(X.b)(this,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return(e=yi(t)).Or.add(0),[4,gh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(jf(vf(this._delegate,Df)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&pf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new $a;return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(e,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(r){switch(r.label){case 0:return e=gl,[4,Jl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(jf(vf(this._delegate,Df)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new ql(e);return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(n,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){yi(t).Gr.add(e),e.next()},[4,Zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(n,void 0,void 0,(function(){var e;return Object(X.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){yi(t).Gr.delete(e)},[4,Zl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(jf(t=vf(t,Df)),kf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new ai(si.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new cp(this,_f(this._delegate,t))}catch(t){throw ep(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new tp(this,Sf(this._delegate,t))}catch(t){throw ep(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new sp(this,function(t,e){if(t=vf(t,If),ff("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ai(si.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Of(t,null,function(t){return new So(Ni.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw ep(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new $a;return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(n,void 0,void 0,(function(){var n;return Object(X.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return Hl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new Kl(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(jf(t),(function(n){return e(new Gd(t,n))}))}(this._delegate,(function(n){return t(new $d(e,n))}))},t.prototype.batch=function(){var t=this;return jf(this._delegate),new Jd(new Fd(this._delegate,(function(e){return Bd(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new ai(si.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new ai(si.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Xd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(X.c)(e,t),e.prototype.convertBytes=function(t){return new Wd(new Mf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return tp.eu(e,this.firestore,null)},e}(Ad),$d=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Xd(t)}return t.prototype.get=function(t){var e=this,n=hp(t);return this._delegate.get(n).then((function(t){return new ip(e._firestore,new yd(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=hp(t);return n?(df("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=hp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(X.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=hp(t);return this._delegate.delete(e),this},t}(),Jd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=hp(t);return n?(df("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=hp(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(X.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=hp(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Zd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new md(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new op(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Xd(e),n),i.set(n,o)),o},t}();Zd.su=new WeakMap;var tp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Xd(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new ai(si.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Tf(n._delegate,r,new Bi(e)))},t.eu=function(e,n,r){return new t(n,new Tf(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new cp(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new cp(this.firestore,_f(this._delegate,t))}catch(t){throw ep(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object($.h)(t))instanceof Tf&&xf(this._delegate,t)},t.prototype.set=function(t,e){e=df("DocumentReference.set",e);try{return e?Vd(this._delegate,t,e):Vd(this._delegate,t)}catch(t){throw ep(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Ud(this._delegate,t):Ud.apply(void 0,Object(X.f)([this._delegate,t,e],n))}catch(t){throw ep(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Bd(vf((t=this._delegate).firestore,Df),[new Is(t._key,ss.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=np(e),i=rp(e,(function(e){return new ip(t.firestore,new yd(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return qd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=vf(t,Tf);var e=vf(t.firestore,Df),n=jf(e),r=new Ld(e);return function(t,e){var n=this,r=new $a;return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(n,void 0,void 0,(function(){var n;return Object(X.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i;return Object(X.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=yi(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new ai(si.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Uh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,Xl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new yd(e,r,t._key,n,new gd(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=vf(t,Tf);var e=vf(t.firestore,Df);return tf(jf(e),t._key,{source:"server"}).then((function(n){return Kd(e,t,n)}))}(this._delegate):function(t){t=vf(t,Tf);var e=vf(t.firestore,Df);return tf(jf(e),t._key).then((function(n){return Kd(e,t,n)}))}(this._delegate)).then((function(t){return new ip(e.firestore,new yd(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Zd.nu(this.firestore,e):null))},t}();function ep(t,e,n){return t.message=t.message.replace(e,n),t}function np(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!kf(r))return r}return{}}function rp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=kf(t[0])?t[0]:kf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var ip=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new tp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return wd(this._delegate,t._delegate)},t}(),op=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(X.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(ip),sp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Xd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Od(this._delegate,function(t,e,n){var r=e,i=pd("where",t);return new Ed(i,r,n)}(e,n,r)))}catch(e){throw ep(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Od(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=pd("orderBy",t);return new _d(r,n)}(e,n)))}catch(e){throw ep(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Od(this._delegate,function(t){return bf("limit",t),new Sd("limit",t,"F")}(e)))}catch(e){throw ep(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Od(this._delegate,function(t){return bf("limitToLast",t),new Sd("limitToLast",t,"L")}(e)))}catch(e){throw ep(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw ep(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw ep(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Nd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw ep(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Nd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw ep(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Nf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=vf(t,Of);var e=vf(t.firestore,Df),n=jf(e),r=new Ld(e);return function(t,e){var n=this,r=new $a;return t.asyncQueue.enqueueAndForget((function(){return Object(X.b)(n,void 0,void 0,(function(){var n;return Object(X.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(X.b)(this,void 0,void 0,(function(){var r,i,o,s,a;return Object(X.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Sc(t,e,!0)];case 1:return a=u.sent(),r=new nl(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Uh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,Xl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new vd(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=vf(t,Of);var e=vf(t.firestore,Df),n=jf(e),r=new Ld(e);return ef(n,t._query,{source:"server"}).then((function(n){return new vd(e,r,t,n)}))}(this._delegate):function(t){t=vf(t,Of);var e=vf(t.firestore,Df),n=jf(e),r=new Ld(e);return Id(t._query),ef(n,t._query).then((function(n){return new vd(e,r,t,n)}))}(this._delegate)).then((function(t){return new up(e.firestore,new vd(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=np(e),i=rp(e,(function(e){return new up(t.firestore,new vd(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return qd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Zd.nu(this.firestore,e):null))},t}(),ap=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new op(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),up=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new sp(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new op(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new ap(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new op(n._firestore,r))}))},t.prototype.isEqual=function(t){return wd(this._delegate,t._delegate)},t}(),cp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(X.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new tp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new tp(this.firestore,void 0===t?Sf(this._delegate):Sf(this._delegate,t))}catch(t){throw ep(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=vf(t.firestore,Df),r=Sf(t),i=Rd(t.converter,e);return Bd(n,[Wf(Qf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,ss.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new tp(e.firestore,t)}))},e.prototype.isEqual=function(t){return xf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Zd.nu(this.firestore,t):null))},e}(sp);function hp(t){return vf(t,Tf)}var lp,fp=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Ff.bind.apply(Ff,Object(X.f)([void 0],t)))}return t.documentId=function(){return new t(ki.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object($.h)(t))instanceof Ff&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),dp=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Xf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Hf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $f("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Jf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Zf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),pp=n("/6Yf"),gp={Firestore:Yd,GeoPoint:Vf,Timestamp:Ti,Blob:Wd,Transaction:$d,WriteBatch:Jd,DocumentReference:tp,DocumentSnapshot:ip,Query:sp,QueryDocumentSnapshot:op,QuerySnapshot:up,CollectionReference:cp,FieldPath:fp,FieldValue:dp,setLogLevel:function(t){ui.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function yp(t,e){return function(t,e=U.b){return new f.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function mp(t,e){return yp(t,e).pipe(Object(u.a)(t=>({payload:t,type:"query"})))}function vp(t,e){return mp(t,e).pipe(Object(q.a)(void 0),K(),Object(u.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function bp(t,e,n){return vp(t,n).pipe(Object(Q.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return wp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return wp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return wp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),t=>t.lift(new W(void 0,void 0)),Object(u.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function wp(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function Ip(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}(function(t,e){t.INTERNAL.registerComponent(new pp.a("firestore",(function(t){return function(t,e){return new Yd(t,new Df(t,e),new Hd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},gp)))})(lp=Y.a),lp.registerVersion("@firebase/firestore","2.4.1");class Tp{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=vp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(u.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(q.a)(void 0),K(),Object(S.a)(([t,e])=>e.length>0||!t),Object(u.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(Q.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Ip(t);return bp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return mp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(d.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Op(this.ref.doc(t),this.afs)}}class Op{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Cp(n,e);return new Tp(r,i,this.afs)}snapshotChanges(){return yp(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(q.a)(void 0),K(),Object(u.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(u.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(d.a)(this.ref.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}class Ep{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?vp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(S.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):vp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(Q.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Ip(t);return bp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return mp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(d.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}const _p=new o.q("angularfire2.enableFirestorePersistence"),Sp=new o.q("angularfire2.firestore.persistenceSettings"),xp=new o.q("angularfire2.firestore.settings"),Np=new o.q("angularfire2.firestore.use-emulator");function Cp(t,e=(t=>t)){return{query:e(t),ref:t}}let kp=(()=>{class t{constructor(t,e,n,i,o,a,u,c,h){this.schedulers=new x.d(a),this.keepUnstableUntilFirst=Object(x.h)(this.schedulers);const l=Object(x.g)(t,a,e);!L.a.auth&&h&&Object(x.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(x.f)(l.name+".firestore","AngularFirestore",l,()=>{const t=a.runOutsideAngular(()=>l.firestore());if(i&&t.settings(i),f&&t.useEmulator(...f),n&&!Object(r.s)(o)){const e=()=>{try{return Object(d.a)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(lp){return"undefined"!=typeof console&&console.warn(lp),Object(s.a)(!1)}};return[t,a.runOutsideAngular(e)]}return[t,Object(s.a)(!1)]},[i,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Cp(n,e),o=this.schedulers.ngZone.run(()=>r);return new Tp(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Ep(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Op(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(o.Sb(x.c),o.Sb(x.b,8),o.Sb(_p,8),o.Sb(xp,8),o.Sb(o.B),o.Sb(o.z),o.Sb(Sp,8),o.Sb(Np,8),o.Sb(N,8))},t.\u0275prov=o.Eb({factory:function(){return new t(o.Sb(x.c),o.Sb(x.b,8),o.Sb(_p,8),o.Sb(xp,8),o.Sb(o.B),o.Sb(o.z),o.Sb(Sp,8),o.Sb(Np,8),o.Sb(N,8))},token:t,providedIn:"any"}),t})(),Dp=(()=>{class t{constructor(t,e,n){this.auth=t,this.router=e,this.firestore=n,this.db=this.firestore.collection("users"),this.authUser=this.auth.user}login(){return this.auth.signInWithPopup(new L.a.auth.GoogleAuthProvider).then(t=>{this.authUser=this.auth.user,this.router.navigateByUrl("/user/profile")})}logout(){this.auth.signOut().then(t=>{this.router.navigateByUrl("/")})}createUser(t){const e=this.db.doc(t.uid);let n=this.getCurrentTime(),r=V.User,i={id:t.uid,name:t.displayName,auth_data:[Object.assign({},t.providerData[0])],email:t.email,image_url:t.photoURL,level:r,created_time:n,last_login:n,max_card_limit:5,max_card_edit_limit:1e3,total_card:0,total_card_edit:0};e.set(i)}createRealfarmInfo(t,e){this.db.doc(t).get().subscribe(n=>{const r=n.data();if(r.total_card<r.max_card_limit&&r.total_card_edit<r.max_card_edit_limit){const n=this.getUID(),i=this.getCurrentTime();let o=Object.assign(Object.assign({},e),{id:n,uid:r.name,last_update:i,created_time:i});this.db.doc(t).collection("realfarms").doc(n).set(o),this.updateUser(t,"total_card",r.total_card+1)}})}updateUser(t,e,n){const r=this.db.doc(t);let i={};i[e]=n,r.update(i)}upateRealFamrInfo(t,e){this.db.doc(t).get().subscribe(n=>{const r=n.data();if(r.total_card_edit<r.max_card_edit_limit){this.getUID();const n=this.getCurrentTime();let i=Object.assign(Object.assign({},e),{id:e.id,uid:e.uid,last_update:n,created_time:e.created_time});this.db.doc(t).collection("realfarms").doc(e.id).update(i),this.updateUser(t,"total_card_edit",r.total_card_edit+1)}})}deleteRealFarmInfo(t,e){this.db.doc(t).get().subscribe(n=>{const r=n.data();this.db.doc(t).collection("realfarms").doc(e.id).delete(),this.updateUser(t,"total_card",r.total_card-1)})}updateUserCollection(t,e,n){this.db.doc(t).collection(e).doc(n.id).update(n)}getCurrentTime(){let t=new Date;return t.toDateString()+" "+t.toTimeString()}getUID(){return Date.now().toString(36)+Math.random().toString(36).slice(2)}}return t.\u0275fac=function(e){return new(e||t)(o.Sb(R),o.Sb(i.c),o.Sb(kp))},t.\u0275prov=o.Eb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var jp=n("320Y");let Ap=(()=>{class t{constructor(t){this.user=t}ngOnInit(){}login(){this.user.login()}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(Dp))},t.\u0275cmp=o.Cb({type:t,selectors:[["app-login"]],decls:6,vars:4,consts:[["title","\u6b61\u8fce\u4f86\u5230\u500b\u4eba\u9801\u9762","subtitle","\u8acb\u767b\u5165\u4ee5\u7e7c\u7e8c\u4f7f\u7528",3,"showBackIcon","showCustomIcon"],[1,"container"],["id","googleBtn",1,"button",3,"click"],["src","/assets/others/g-logo.png",3,"width","height"]],template:function(t,e){1&t&&(o.Jb(0,"app-header",0),o.Ob(1,"section",1),o.Ob(2,"button",2),o.Vb("click",(function(){return e.login()})),o.Jb(3,"img",3),o.Ob(4,"span"),o.sc(5,"\u4f7f\u7528 Google \u767b\u5165"),o.Nb(),o.Nb(),o.Nb()),2&t&&(o.dc("showBackIcon",!1)("showCustomIcon",!1),o.yb(3),o.dc("width",18)("height",18))},directives:[jp.a],styles:[".container[_ngcontent-%COMP%]{display:flex;width:90%;margin:16px auto;justify-content:center}#googleBtn[_ngcontent-%COMP%]{display:flex;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;border:0;border-radius:2px;padding:11px 8px}#googleBtn[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{height:18px;width:18px;padding-right:24px}#googleBtn[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{cursor:inherit;height:18px;font-size:14px;color:rgba(0,0,0,.54);font-weight:600;display:inline-block;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}"]}),t})();var Rp=n("wHSu"),Pp=n("Nv++");class Fp{static drawRect(t,e,n,r,i,o="#FFFFF",s=0,a="#333333"){t.fillStyle=o,t.fillRect(e,n,r,i),s>0&&(t.strokeStyle=a,t.lineWidth=s,t.strokeRect(e,n,r,i))}static drawRoundRect(t,e,n,r,i,o,s="#FFFFFF",a=0,u="#333333"){r<2*o&&(o=r/2),i<2*o&&(o=i/2),t.fillStyle=s,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.fill(),a>0&&(t.strokeStyle=u,t.beginPath(),t.lineWidth=a,t.moveTo(e+o,n),t.arcTo(e+r,n,e+r,n+i,o),t.arcTo(e+r,n+i,e,n+i,o),t.arcTo(e,n+i,e,n,o),t.arcTo(e,n,e+r,n,o),t.closePath(),t.stroke())}static addImage(t,e,n,r,i,o){let s=new Image;s.onload=()=>{t.drawImage(s,n,r,i,o)},s.src=e}static addImageSource(t,e,n,r,i,o){t.drawImage(e,n,r,i,o)}static addText(t,e,n,r,i=14,o="#333333",s=500){t.font=`${s} ${i}px sans-serif`,t.fillStyle=o,t.fillText(e,n,r+i)}}class Mp{constructor(t,e,n,r,i=2,o){this.canvas=o,this.x=t,this.y=e,this.width=n,this.height=r,this.scale=i}}class Lp extends Mp{constructor(t,e,n,r,i=2,o,s=0,a=0,u="#FEFEFE",c="#333333"){super(t,e,n,r,i,o),this.bgColor=u,this.borderWidth=s,this.borderRadius=a,this.borderColor=c,this.width<2*this.borderRadius&&(this.borderRadius=this.width/2),this.height<2*this.borderRadius&&(this.borderRadius=this.height/2)}draw(){this.borderRadius>0?this.drawRoundRect():this.drawRect()}drawRect(){Fp.drawRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}drawRoundRect(){Fp.drawRoundRect(this.canvas,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale,this.borderRadius*this.scale,this.bgColor,this.borderWidth*this.scale,this.borderColor)}}class Vp extends Mp{constructor(t,e,n,r=2,i,o="#000000",s=12,a=500){super(e,n,0,0,r,i),this.text=t,this.color=o,this.fontSize=s,this.fontWeight=a}draw(){Fp.addText(this.canvas,this.text,this.x*this.scale,this.y*this.scale,this.fontSize*this.scale,this.color,this.fontWeight)}}class Up extends Mp{constructor(t,e,n,r,i,o=2,s){super(e,n,r,i,o,s),this.src=t}draw(){Fp.addImage(this.canvas,this.src,this.x*this.scale,this.y*this.scale,this.width*this.scale,this.height*this.scale)}}function qp(t,e,n,r=500){return t.font=`${r} ${n}px sans-serif`,t.measureText(e).width}var Bp=function(t){return t[t.default=0]="default",t}({});let Kp=(()=>{class t{constructor(){this.scale=4,this.titleFont=16,this.detailFont=12,this.footnoteFont=11,this.font={title:{size:16,weight:700},content:{size:12,weight:600},footnote:{size:11,weight:500}},this.card={x:0,y:0,w:320,h:180,borderRadius:12,border:1,padding:{v:12,h:12}},this.greet={x:this.card.padding.h,y:64,w:296,h:88,borderRadius:8,border:0,padding:{v:6,h:8},maxLine:5,lineHeight:16,fontSize:12,fontWeight:600},this.logoText={x:236,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.userIDText={x:this.card.padding.h,y:161,size:this.font.footnote.size,weight:this.font.footnote.weight},this.levelText={x:this.card.padding.h,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.gameIdText={x:this.card.padding.h,y:32,size:this.font.title.size,weight:this.font.title.weight},this.favoriteText={x:125,y:this.card.padding.v,size:this.font.content.size,weight:this.font.footnote.weight},this.favoriteImg={max:3,x:125,y:32,w:20,h:20},this.logoImg={x:288,y:156,w:20,h:20}}}return t.getLayout=e=>new t,t})();var Gp=function(t){return t[t.primary=0]="primary",t[t.secondary=1]="secondary",t[t.skyBlue=2]="skyBlue",t}({}),zp=function(t){return t.black="#333333",t.white="#FFFFFF",t.green="#459C7F",t.light_green="#F0FFFA",t.orange="#E4766A",t.light_orange="#FFE9E7",t.blue="#368FD4",t.light_blue="#DDF1FF",t}({});let Qp=(()=>{class t{constructor(){this.primaryColor=zp.green,this.secondaryColor=zp.light_green,this.contentColor=zp.black,this.contentBgColor=zp.white}}return t.getTheme=e=>{const n=new t;switch(e){case Gp.primary:n.primaryColor=zp.green,n.secondaryColor=zp.light_green;break;case Gp.secondary:n.primaryColor=zp.orange,n.secondaryColor=zp.light_orange;break;case Gp.skyBlue:n.primaryColor=zp.blue,n.secondaryColor=zp.light_blue;break;default:n.primaryColor=zp.green,n.secondaryColor=zp.light_green}return n},t})();class Wp{constructor(t,e=Bp.default,n=Gp.primary){this.info=t,this.layout=Kp.getLayout(e),this.theme=Qp.getTheme(n),this.canvasObjects=[]}resetCanvas(){this.canvasObjects=[]}genBlocks(t){let e=this.genCardBlock(t),n=this.genGreetingBlock(t);this.canvasObjects.push(e),this.canvasObjects.push(n)}genCardBlock(t){return new Lp(this.layout.card.x,this.layout.card.y,this.layout.card.w,this.layout.card.h,this.layout.scale,t,this.layout.card.border,this.layout.card.borderRadius,this.theme.secondaryColor,this.theme.primaryColor)}genGreetingBlock(t){return new Lp(this.layout.greet.x,this.layout.greet.y,this.layout.greet.w,this.layout.greet.h,this.layout.scale,t,this.layout.greet.border,this.layout.greet.borderRadius,this.theme.contentBgColor,this.theme.contentBgColor)}genTexts(t){let e=this.genLogoText(t,"Create by"),n=this.genUserText(t,"ID: "+this.info.uid),r=this.genLevelText(t,"Lv. "+this.info.level),i=this.genGameIDText(t,this.info.gid),o=this.genFavoriteText(t,"\u6211\u7684\u6700\u611b"),s=this.genGreetingText(t,this.info.greeting);this.canvasObjects.push(e),this.canvasObjects.push(n),this.canvasObjects.push(r),this.canvasObjects.push(i),this.canvasObjects.push(o),this.canvasObjects.push(...s)}genLogoText(t,e){return new Vp(e,this.layout.logoText.x,this.layout.logoText.y,this.layout.scale,t,this.theme.contentColor,this.layout.logoText.size,this.layout.logoText.weight)}genUserText(t,e){return new Vp(e,this.layout.userIDText.x,this.layout.userIDText.y,this.layout.scale,t,this.theme.contentColor,this.layout.userIDText.size,this.layout.userIDText.weight)}genLevelText(t,e){return new Vp(e,this.layout.levelText.x,this.layout.levelText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.levelText.size,this.layout.levelText.weight)}genGameIDText(t,e){return new Vp(e,this.layout.gameIdText.x,this.layout.gameIdText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.gameIdText.size,this.layout.gameIdText.weight)}genFavoriteText(t,e){return new Vp(e,this.layout.favoriteText.x,this.layout.favoriteText.y,this.layout.scale,t,this.theme.primaryColor,this.layout.favoriteText.size,this.layout.favoriteText.weight)}genGreetingText(t,e){const n=this.layout.greet.maxLine,r=this.layout.greet.x+this.layout.greet.padding.h,i=this.layout.greet.y+this.layout.greet.padding.v,o=this.layout.greet.w-2*this.layout.greet.padding.h,s=this.layout.greet.lineHeight,a=this.layout.font.content.size,u=this.layout.font.content.weight;let c=0,h=e.length,l=[];for(let f=0;f<n;f++){const n=e.indexOf("\n",c);let r=Math.round((c+h+1)/2),i=e.slice(c,h),s=qp(t,i,a,u);if(c>=e.length)break;if(s<o)r=h;else{for(i=e.slice(c,r),s=qp(t,i,a,u);r<h&&s<=o;)r+=1,i=e.slice(c,r),s=qp(t,i,a,u);for(;r>=0&&s>o;)r-=1,i=e.slice(c,r),s=qp(t,i,a,u)}-1!=n&&n<r&&(r=n+1),l.push(e.slice(c,r)),c=r}return l.map((e,n)=>new Vp(e,r,i+n*s,this.layout.scale,t,this.theme.contentColor,a,u))}genImages(t,e,n){this.canvasObjects.push(this.genLogoImg(t,e)),this.canvasObjects.push(...this.genFavoriteItemsImg(t,n))}genLogoImg(t,e){return new Up(e,this.layout.logoImg.x,this.layout.logoImg.y,this.layout.logoImg.w,this.layout.logoImg.h,this.layout.scale,t)}genFavoriteItemsImg(t,e){let n=this.layout.favoriteImg.x,r=this.layout.favoriteImg.y,i=this.layout.favoriteImg.w,o=this.layout.favoriteImg.h;return e.map((e,s)=>new Up(e,n+s*i,r,i,o,this.layout.scale,t))}draw(){this.canvasObjects.forEach(t=>{t.draw()})}}var Hp=n("kvnP"),Yp=n("m7U+");const Xp=["cardCanvas"],$p=["downloadButton"];let Jp=(()=>{class t{constructor(t,e,n){this.consumableServ=t,this.cropServ=e,this.document=n,this.layout=Bp.default,this.theme=Gp.primary,this.logoImg="assets/icons/LOGO-71x71.png",this.isEditing=!1,this.onEdit=new o.n,this.onDelete=new o.n,this.closeSettingIcon=Rp.tb,this.settingIcon=Rp.D,this.editIcon=Rp.C,this.shareIcon=Rp.kb,this.updateThemeIcon=Rp.ab,this.copyIcon=Rp.r,this.downloadIcon=Rp.B,this.deleteIcon=Rp.wb,this.window=this.document.defaultView}ngOnInit(){this.isEditing=!1,this.realfarmCard=new Wp(this.data,Bp.default,this.theme),this.filename=this.data.gid+"_RealFarm\u5c0f\u5e6b\u624b.png"}ngAfterViewInit(){this.context=this.canvas.nativeElement.getContext("2d"),this.drawCard()}drawCard(){this.realfarmCard=new Wp(this.data,Bp.default,this.theme),this.realfarmCard.genBlocks(this.context),this.realfarmCard.genTexts(this.context),this.realfarmCard.genImages(this.context,this.logoImg,this.data.favorites.map((t,e)=>{let n="";return e>=this.realfarmCard.layout.favoriteImg.max?"":(n=this.cropServ.searchSeed(t)?this.cropServ.searchSeed(t).img:this.consumableServ.searchConsumable(t)[0].img,n)})),this.realfarmCard.draw(),this.link2Canvas()}link2Canvas(){this.downloadBtn.nativeElement.href=this.canvas.nativeElement.toDataURL("image/png")}shareCard(){return Object(X.b)(this,void 0,void 0,(function*(){this.link2Canvas();const t=yield(yield fetch(this.downloadBtn.nativeElement.href)).blob(),e=Object({files:[new File([t],this.filename,{type:t.type,lastModified:(new Date).getTime()})]});try{yield this.window.navigator.share(e)}catch(n){20!==n.code&&alert(`[${n.code}] \u6b64\u700f\u89bd\u5668\u7248\u672c\u5206\u4eab\u529f\u80fd\u51fa\u4e86\u9ede\u554f\u984c\u{1f625}`)}}))}copyImage(){}editInfo(){this.isEditing=!1,this.onEdit.emit(this.data.id)}deleteCard(){this.isEditing=!1,this.onDelete.emit(this.data.id)}switchEditButtons(){this.isEditing=!this.isEditing}updateTheme(){switch(this.theme){case Gp.primary:this.theme=Gp.secondary;break;case Gp.secondary:this.theme=Gp.skyBlue;break;case Gp.skyBlue:this.theme=Gp.primary}this.drawCard()}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(Hp.a),o.Ib(Yp.a),o.Ib(r.d))},t.\u0275cmp=o.Cb({type:t,selectors:[["app-realfarm-card"]],viewQuery:function(t,e){var n;1&t&&(o.xc(Xp,!0),o.xc($p,!0)),2&t&&(o.ic(n=o.Wb())&&(e.canvas=n.first),o.ic(n=o.Wb())&&(e.downloadBtn=n.first))},inputs:{data:"data"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:28,vars:12,consts:[[1,"container"],["id","card-canvas",2,"width","100%",3,"width","height","click"],["cardCanvas",""],[1,"mask",3,"ngClass"],[1,"icon-button","settings",3,"ngClass","click"],[3,"icon"],[1,"wrapper","animation",3,"ngClass"],[1,"icon-button","updateTheme",3,"click"],[1,"icon-button","edit",3,"click"],[1,"icon-button","download",3,"download","click"],["downloadButton",""],[1,"icon-button","delete",3,"click"]],template:function(t,e){1&t&&(o.Ob(0,"div",0),o.Ob(1,"canvas",1,2),o.Vb("click",(function(){return e.editInfo()})),o.Nb(),o.Jb(3,"div",3),o.Ob(4,"div",4),o.Vb("click",(function(){return e.switchEditButtons()})),o.Jb(5,"fa-icon",5),o.Nb(),o.Ob(6,"div",6),o.Ob(7,"a",7),o.Vb("click",(function(){return e.updateTheme()})),o.Jb(8,"fa-icon",5),o.Ob(9,"span"),o.sc(10,"\u66f4\u63db\u4e3b\u984c"),o.Nb(),o.Nb(),o.Ob(11,"a",8),o.Vb("click",(function(){return e.shareCard()})),o.Jb(12,"fa-icon",5),o.Ob(13,"span"),o.sc(14,"\u5206\u4eab\u5361\u7247"),o.Nb(),o.Nb(),o.Ob(15,"a",8),o.Vb("click",(function(){return e.editInfo()})),o.Jb(16,"fa-icon",5),o.Ob(17,"span"),o.sc(18,"\u7de8\u8f2f"),o.Nb(),o.Nb(),o.Ob(19,"a",9,10),o.Vb("click",(function(){return e.link2Canvas()})),o.Jb(21,"fa-icon",5),o.Ob(22,"span"),o.sc(23,"\u5132\u5b58"),o.Nb(),o.Nb(),o.Ob(24,"a",11),o.Vb("click",(function(){return e.deleteCard()})),o.Jb(25,"fa-icon",5),o.Ob(26,"span"),o.sc(27,"\u522a\u9664"),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&t&&(o.yb(1),o.dc("width",e.realfarmCard.layout.card.w*e.realfarmCard.layout.scale)("height",e.realfarmCard.layout.card.h*e.realfarmCard.layout.scale),o.yb(2),o.dc("ngClass",e.isEditing?"open":""),o.yb(1),o.dc("ngClass",e.isEditing?"closeSettings":""),o.yb(1),o.dc("icon",e.isEditing?e.closeSettingIcon:e.settingIcon),o.yb(1),o.dc("ngClass",e.isEditing?"open":""),o.yb(2),o.dc("icon",e.updateThemeIcon),o.yb(4),o.dc("icon",e.shareIcon),o.yb(4),o.dc("icon",e.editIcon),o.yb(3),o.dc("download",e.filename),o.yb(2),o.dc("icon",e.downloadIcon),o.yb(4),o.dc("icon",e.deleteIcon))},directives:[r.j,Pp.a],styles:[".container[_ngcontent-%COMP%]{min-width:320px;max-width:400px;min-height:180px;max-height:225px;width:80%;height:80%;margin:0 auto;position:relative;aspect-ratio:16/9}.wrapper[_ngcontent-%COMP%]{margin:0 auto;display:flex;align-items:flex-end;justify-content:center;position:absolute;flex-direction:column;right:0;top:28px;transform:translateY(-50%) scaleY(0);z-index:0}.wrapper.open[_ngcontent-%COMP%]{transform:translateY(0) scaleY(1);z-index:5}.icon-button[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;height:28px;margin:4px;padding:4px 12px;border-radius:8px;align-items:center;justify-content:space-around;display:inline-flex;box-shadow:0 2px 8px 4px rgba(0,0,0,.15);background-color:var(--white)}.icon-button[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.icon-button[_ngcontent-%COMP%]:hover, .icon-button[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{cursor:pointer}.icon-button.settings[_ngcontent-%COMP%]{position:absolute;right:0;top:-20px;width:28px;height:28px;padding:4px;border-radius:50%;z-index:4}.icon-button.settings.closeSettings[_ngcontent-%COMP%]{z-index:6}.mask[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;background:rgba(0,0,0,.3);border-radius:12px;transform:scale(0)}.mask.open[_ngcontent-%COMP%]{transform:scale(1)}.animation[_ngcontent-%COMP%]{transition:.2s ease-in}.delete[_ngcontent-%COMP%]{color:var(--danger)}"]}),t})(),Zp=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Cb({type:t,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"wrapper"],[1,"loader"]],template:function(t,e){1&t&&(o.Ob(0,"div",0),o.Jb(1,"span",1),o.Nb())},styles:['.wrapper[_ngcontent-%COMP%]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;display:flex;justify-content:center;align-items:center}.loader[_ngcontent-%COMP%]{width:48px;height:48px;border:10px solid var(--light-gray);border-radius:50%;position:relative;transform:rotate(45deg);box-sizing:border-box}.loader[_ngcontent-%COMP%]:before{content:"";position:absolute;box-sizing:border-box;inset:-10px;border-radius:50%;border:10px solid var(--secondary);-webkit-animation:prixClipFix 2s linear infinite;animation:prixClipFix 2s linear infinite}@-webkit-keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}@keyframes prixClipFix{0%{-webkit-clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0);clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)}25%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)}50%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)}75%{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)}to{-webkit-clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0);clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)}}']}),t})();var tg=n("0zEo"),eg=function(t){return t[t.Unknown=0]="Unknown",t[t.Male=1]="Male",t[t.Female=2]="Female",t}({}),ng=n("s7LF");function rg(t,e){if(1&t&&(o.Ob(0,"option",23),o.sc(1),o.Nb()),2&t){const t=e.$implicit;o.dc("value",t.name),o.yb(1),o.uc(" ",t.name," ")}}function ig(t,e){if(1&t){const t=o.Pb();o.Ob(0,"div",9),o.Ob(1,"select",20),o.Vb("ngModelChange",(function(e){return o.kc(t),o.Xb().favorite=e})),o.qc(2,rg,2,2,"option",21),o.Nb(),o.Ob(3,"button",22),o.Vb("click",(function(){return o.kc(t),o.Xb().addFavorites()})),o.Jb(4,"fa-icon",18),o.Nb(),o.Nb()}if(2&t){const t=o.Xb();o.yb(1),o.dc("ngModel",t.favorite),o.yb(1),o.dc("ngForOf",t.displayObjs),o.yb(2),o.dc("icon",t.addIcon)}}function og(t,e){if(1&t){const t=o.Pb();o.Ob(0,"div",24),o.Jb(1,"img",25),o.Ob(2,"fa-icon",26),o.Vb("click",(function(){o.kc(t);const n=e.$implicit;return o.Xb().removeFavorite(n)})),o.Nb(),o.Nb()}if(2&t){const t=e.$implicit,n=o.Xb();o.yb(1),o.dc("src",n.getImg(t),o.mc)("height",28)("alt",t+"\u7684\u5716\u7247"),o.yb(1),o.dc("icon",n.closeIcon)}}let sg=(()=>{class t{constructor(t,e){this.cs=t,this.is=e,this.done=new o.n,this.cancel=new o.n,this.addIcon=Rp.bb,this.closeIcon=Rp.ub,this.cancelIcon=Rp.tb,this.doneIcon=Rp.k}ngOnInit(){const t=this.cs.getAllCrops().map(t=>({name:t.name,img:t.img,group:"\u4f5c\u7269"})),e=this.is.getAllConsumables().map(t=>({name:t.name,img:t.img,group:t.group}));this.realfarmObjs=[...t,...e],null==this.data&&(this.data={id:"",uid:"",gid:"",greeting:"",level:10,gender:eg.Male,is_primary:!1,favorites:[]}),this.updateObjList()}isMale(){return this.data.gender===eg.Male}updateGender(t){this.data.gender=t?eg.Male:eg.Female}updateObjList(){this.displayObjs=this.realfarmObjs.filter(t=>!this.data.favorites.includes(t.name)),this.favorite=this.displayObjs[0].name}addFavorites(){console.log(this.data),this.data.favorites=[...this.data.favorites,this.favorite],this.data=Object.assign({},this.data),this.updateObjList()}removeFavorite(t){this.data.favorites=this.data.favorites.filter(e=>e!==t),this.data=Object.assign({},this.data),this.updateObjList()}getImg(t){const e=this.realfarmObjs.filter(e=>e.name===t);return e.length>0?e[0].img:""}doDone(){this.done.emit(this.data)}doCancel(){this.cancel.emit(!0)}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(Yp.a),o.Ib(Hp.a))},t.\u0275cmp=o.Cb({type:t,selectors:[["app-realfarm-form"]],inputs:{data:"data"},outputs:{cancel:"cancel",done:"done"},decls:52,vars:11,consts:[[1,"wrapper"],[1,"header"],[1,"info"],[1,"form"],[1,"group"],[1,"title"],[1,"element","horizontal"],["type","text","name","gid",1,"value",3,"ngModel","ngModelChange"],["type","number","step","1","name","level",1,"value",3,"ngModel","ngModelChange"],[1,"value"],["type","radio","name","gender",3,"checked","change"],["class","value",4,"ngIf"],[1,"element","item-list"],["class","item",4,"ngFor","ngForOf"],[1,"element","vertical"],["rows","5","name","greeting","maxlength","200",1,"value",3,"ngModel","ngModelChange"],[1,"actions"],[1,"button","cancel",3,"click"],[3,"icon"],[1,"button","submit",3,"click"],["name","favorite",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"button","add","item",3,"click"],[3,"value"],[1,"item"],[3,"src","height","alt"],[1,"close",3,"icon","click"]],template:function(t,e){1&t&&(o.Ob(0,"section",0),o.Ob(1,"h1",1),o.sc(2),o.Nb(),o.Ob(3,"div",2),o.sc(4,"\u5efa\u7acb/\u7de8\u8f2f\u81ea\u5df1\u7684\u904a\u6232\u8cc7\u8a0a\uff0c\u4e14\u53ef\u4ee5\u4e0b\u8f09\u5716\u7247\u5f8c\u5206\u4eab\u7d66\u5176\u4ed6\u8fb2\u53cb"),o.Nb(),o.Nb(),o.Ob(5,"section",0),o.Ob(6,"form",3),o.Ob(7,"section",4),o.Ob(8,"h2",5),o.sc(9,"\u904a\u6232\u57fa\u672c\u8cc7\u8a0a"),o.Nb(),o.Ob(10,"label",6),o.Ob(11,"span",5),o.sc(12,"\u904a\u6232 ID"),o.Nb(),o.Ob(13,"input",7),o.Vb("ngModelChange",(function(t){return e.data.gid=t})),o.Nb(),o.Nb(),o.Ob(14,"label",6),o.Ob(15,"span",5),o.sc(16,"\u7b49\u7d1a"),o.Nb(),o.Ob(17,"input",8),o.Vb("ngModelChange",(function(t){return e.data.level=t})),o.Nb(),o.Nb(),o.Ob(18,"label",6),o.Ob(19,"span",5),o.sc(20,"\u89d2\u8272\u6027\u5225"),o.Nb(),o.Ob(21,"div",9),o.Ob(22,"label"),o.Ob(23,"input",10),o.Vb("change",(function(){return e.updateGender(!0)})),o.Nb(),o.Ob(24,"span"),o.sc(25,"\u7537"),o.Nb(),o.Nb(),o.Ob(26,"label"),o.Ob(27,"input",10),o.Vb("change",(function(){return e.updateGender(!1)})),o.Nb(),o.Ob(28,"span"),o.sc(29,"\u5973"),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Ob(30,"section",4),o.Ob(31,"h2",5),o.sc(32,"\u5176\u4ed6\u8cc7\u8a0a"),o.Nb(),o.Ob(33,"label",6),o.Ob(34,"div",5),o.Ob(35,"span"),o.sc(36,"\u6211\u7684\u6700\u611b"),o.Nb(),o.Nb(),o.qc(37,ig,5,3,"div",11),o.Nb(),o.Ob(38,"div",12),o.qc(39,og,3,4,"div",13),o.Nb(),o.Ob(40,"label",14),o.Ob(41,"span",5),o.sc(42),o.Nb(),o.Ob(43,"textarea",15),o.Vb("ngModelChange",(function(t){return e.data.greeting=t})),o.sc(44,"                "),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Ob(45,"div",16),o.Ob(46,"button",17),o.Vb("click",(function(){return e.doCancel()})),o.Jb(47,"fa-icon",18),o.sc(48," \u53d6\u6d88 "),o.Nb(),o.Ob(49,"button",19),o.Vb("click",(function(){return e.doDone()})),o.Jb(50,"fa-icon",18),o.sc(51," \u5b8c\u6210 "),o.Nb(),o.Nb(),o.Nb()),2&t&&(o.yb(2),o.uc("",""!==e.data.id?"\u7de8\u8f2f":"\u5efa\u7acb"," \u5361\u7247\u8cc7\u8a0a"),o.yb(11),o.dc("ngModel",e.data.gid),o.yb(4),o.dc("ngModel",e.data.level),o.yb(6),o.dc("checked",e.isMale()),o.yb(4),o.dc("checked",!e.isMale()),o.yb(10),o.dc("ngIf",e.data.favorites.length<3),o.yb(2),o.dc("ngForOf",e.data.favorites),o.yb(3),o.uc("\u5361\u7247\u5167\u5bb9 (",e.data.greeting.length," / 200)"),o.yb(1),o.dc("ngModel",e.data.greeting),o.yb(4),o.dc("icon",e.cancelIcon),o.yb(3),o.dc("icon",e.doneIcon))},directives:[ng.u,ng.k,ng.l,ng.b,ng.j,ng.m,ng.o,r.l,r.k,ng.i,Pp.a,ng.r,ng.n,ng.t],styles:[".value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:8px}.value[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:4px;margin-left:0}.title.favorite[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{display:inline-block;width:40%;line-height:28px}.item-list[_ngcontent-%COMP%]{margin-top:8px}.item[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:inline-block;position:relative;padding:4px 8px}.item[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;right:-6px;top:-4px;width:16px;height:16px}.button.add[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;padding:4px;margin-left:12px}.actions[_ngcontent-%COMP%]{width:100%;margin:8px;display:flex;flex-direction:row;justify-content:center}.button.cancel[_ngcontent-%COMP%], .button.submit[_ngcontent-%COMP%]{flex-grow:1;margin:0 8px;font-size:18px;height:36px;border-radius:4px;border:0}.button.submit[_ngcontent-%COMP%]{background-color:var(--primary);color:var(--white)}"]}),t})();function ag(t,e){if(1&t){const t=o.Pb();o.Ob(0,"div",6),o.Ob(1,"app-realfarm-card",9),o.Vb("onEdit",(function(e){return o.kc(t),o.Xb(2).editCard(e)}))("onDelete",(function(e){return o.kc(t),o.Xb(2).deleteCard(e)})),o.Nb(),o.Nb()}if(2&t){const t=e.$implicit;o.yb(1),o.dc("data",t)}}function ug(t,e){if(1&t){const t=o.Pb();o.Ob(0,"section"),o.Ob(1,"app-header",3),o.Vb("onClickCustomIcon",(function(){return o.kc(t),o.Xb().logout()})),o.Yb(2,"async"),o.Nb(),o.Ob(3,"div",4),o.qc(4,ag,2,1,"div",5),o.Yb(5,"async"),o.Ob(6,"div",6),o.Ob(7,"div",7),o.Vb("click",(function(){return o.kc(t),o.Xb().editCard(void 0)})),o.Jb(8,"fa-icon",8),o.Ob(9,"span"),o.sc(10,"\u65b0\u589e RealFarm \u5361\u7247"),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb()}if(2&t){const t=o.Xb();var n;o.yb(1),o.dc("title",null==(n=o.Zb(2,8,t.userData))?null:n.name)("subtitle","\u500b\u4eba RealFarm \u8cc7\u8a0a "+t.cardInfos.length+"/5")("showBackIcon",!1)("showCustomIcon",!0)("customIcon",t.logoutIcon)("customString","\u767b\u51fa"),o.yb(3),o.dc("ngForOf",o.Zb(5,10,t.userRealFarm)),o.yb(4),o.dc("icon",t.addIcon)}}function cg(t,e){1&t&&o.Jb(0,"app-loading")}function hg(t,e){if(1&t){const t=o.Pb();o.Ob(0,"app-modal",10),o.Vb("cancel",(function(){return o.kc(t),o.Xb().cancelEdit()})),o.Ob(1,"app-realfarm-form",11),o.Vb("done",(function(e){return o.kc(t),o.Xb().finishEdit(e)}))("cancel",(function(){return o.kc(t),o.Xb().cancelEdit()})),o.Nb(),o.Nb()}if(2&t){const t=o.Xb();o.yb(1),o.dc("data",-1!==t.editIdx?t.cardInfos[t.editIdx]:null)}}const lg=()=>{return t=["user","profile"],Object(a.a)(F,Object(u.a)(e=>e&&t||!0));var t},fg=[{path:"",component:Ap,canActivate:[M],data:{authGuardPipe:lg}},{path:"login",component:Ap,canActivate:[M],data:{authGuardPipe:lg}},{path:"profile",component:(()=>{class t{constructor(t,e,n){this.auth=t,this.store=e,this.us=n,this.cardNumber=0,this.logoutIcon=Rp.lb,this.addIcon=Rp.bb,this.auth.user.subscribe(t=>{const e=this.store.collection("users").doc(t.uid);this.userId=t.uid,this.userData=e.valueChanges(),this.userRealFarm=e.collection("realfarms").valueChanges(),e.get().subscribe(e=>{e.exists?this.us.updateUser(e.id,"last_login",this.us.getCurrentTime()):this.us.createUser(t)}),this.userRealFarm.subscribe(t=>{this.cardInfos=t})})}ngOnInit(){this.editMode=0}logout(){this.us.logout()}editCard(t){t?(this.cardInfos.forEach((e,n)=>{e.id===t&&(this.editIdx=n)}),this.editMode=2):(this.editIdx=-1,this.editMode=1)}cancelEdit(){this.editMode=0}finishEdit(t){1==this.editMode?this.createCard(t):this.updateCard(t),this.editMode=0}createCard(t){this.us.createRealfarmInfo(this.userId,t)}updateCard(t){this.cardInfos[this.editIdx]=t,this.us.upateRealFamrInfo(this.userId,this.cardInfos[this.editIdx])}deleteCard(t){if(confirm("\u78ba\u5b9a\u522a\u9664\u6b64\u5361\u7247")&&t)for(let e=0;e<this.cardInfos.length;e++)this.cardInfos[e].id===t&&(this.us.deleteRealFarmInfo(this.userId,this.cardInfos[e]),this.userRealFarm.subscribe(t=>{this.cardInfos=t}))}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(R),o.Ib(kp),o.Ib(Dp))},t.\u0275cmp=o.Cb({type:t,selectors:[["app-profile"]],decls:5,vars:5,consts:[[4,"ngIf","ngIfElse"],["loadingTemplate",""],[3,"cancel",4,"ngIf"],[3,"title","subtitle","showBackIcon","showCustomIcon","customIcon","customString","onClickCustomIcon"],[1,"cards"],["class","card wrapper",4,"ngFor","ngForOf"],[1,"card","wrapper"],["id","add-card",3,"click"],[3,"icon"],[3,"data","onEdit","onDelete"],[3,"cancel"],[3,"data","done","cancel"]],template:function(t,e){if(1&t&&(o.qc(0,ug,11,12,"section",0),o.Yb(1,"async"),o.qc(2,cg,1,0,"ng-template",null,1,o.rc),o.qc(4,hg,2,1,"app-modal",2)),2&t){const t=o.jc(3);o.dc("ngIf",o.Zb(1,3,e.userData))("ngIfElse",t),o.yb(4),o.dc("ngIf",0!==e.editMode)}},directives:[r.l,jp.a,r.k,Pp.a,Jp,Zp,tg.a,sg],pipes:[r.b],styles:[".cards[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;align-items:center;justify-content:flex-start;margin-top:32px}.card[_ngcontent-%COMP%]{width:100%;margin-bottom:12px}#add-card[_ngcontent-%COMP%]{font-size:14px;min-width:320px;max-width:400px;width:80%;margin:0 auto;height:64px;color:var(--gray);display:flex;align-items:center;justify-content:center;background-image:url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23909090' stroke-width='2' stroke-dasharray='14' stroke-dashoffset='14' stroke-linecap='square'/%3e%3c/svg%3e\");border-radius:12px}#add-card[_ngcontent-%COMP%]:hover, #add-card[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:hover{cursor:pointer}#add-card[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 8px}"]}),t})(),canActivate:[M],data:{authGuardPipe:()=>{return t=["user","login"],Object(a.a)(F,Object(u.a)(e=>e||t));var t}}}];let dg=(()=>{class t{}return t.\u0275mod=o.Gb({type:t}),t.\u0275inj=o.Fb({factory:function(e){return new(e||t)},imports:[[r.c,i.g.forChild(fg)]]}),t})();var pg=n("jICo");let gg=(()=>{class t{}return t.\u0275mod=o.Gb({type:t}),t.\u0275inj=o.Fb({factory:function(e){return new(e||t)},imports:[[r.c,dg,pg.a,Pp.b,ng.h,ng.q]]}),t})()}}]);